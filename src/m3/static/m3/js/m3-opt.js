Ext.ux.Reorderer=Ext.extend(Object,{defaults:{animate:true,animationDuration:0.2,defaultReorderable:false},constructor:function(a){Ext.apply(this,a||{},this.defaults)},init:function(a){this.target=a;this.initEvents();a=this.getItems();var b=a.length,d;for(d=0;d<b;d++)this.createIfReorderable(a[d])},reorder:function(a){var b=this.target;if(b.fireEvent("before-reorder",a,b,this)!==false){this.doReorder(a);b.fireEvent("reorder",a,b,this)}},doReorder:function(){throw Error("doReorder must be implemented in the Ext.ux.Reorderer subclass");
},createItemDD:function(){throw Error("createItemDD must be implemented in the Ext.ux.Reorderer subclass");},createItemDD:function(a){var b=a.getEl(),d=this.target,e=this;a.dd=new Ext.dd.DD(b,undefined,{isTarget:false});a.dd.constrainTo(d.getEl());a.dd.setYConstraint(0,0,0);Ext.apply(a.dd,{b4StartDrag:function(){this.startPosition=b.getXY();this.startZIndex=b.getStyle("zIndex");b.setStyle("zIndex",1E4);a.suspendEvents()},onDrag:function(){for(var f=b.getXY()[0],g=f-this.startPosition[0],j=d.items.items,
k=j.indexOf(a),l=0;l<j.length;l++){var n=j[l];if(n.reorderable&&n.id!=a.id){var q=n.getEl().getBox();q=(e.buttonXCache[n.id]||q.x)+q.width/2;n=k>l&&g<0&&f<q;q=k<l&&g>0&&f+b.getWidth()>q;if(n||q){e[n?"onMovedLeft":"onMovedRight"](a,l,k);break}}}},endDrag:function(){e.updateButtonXCache();b.moveTo(e.buttonXCache[a.id],undefined,{duration:e.animationDuration,scope:this,callback:function(){a.resumeEvents();d.fireEvent("reordered",a,d)}});b.setStyle("zIndex",this.startZIndex)}})},createIfReorderable:function(a){if(this.defaultReorderable&&
a.reorderable==undefined)a.reorderable=true;if(a.reorderable&&!a.dd)a.rendered?this.createItemDD(a):a.on("render",this.createItemDD.createDelegate(this,[a]),this,{single:true})},getItems:function(){return this.target.items.items},initEvents:function(){this.target.addEvents("before-reorder","reorder")}});
Ext.ux.HBoxReorderer=Ext.extend(Ext.ux.Reorderer,{init:function(a){this.buttonXCache={};a.on({scope:this,add:function(b,d){this.createIfReorderable(d)}});Ext.ux.HBoxReorderer.superclass.init.apply(this,arguments)},createItemDD:function(a){if(a.dd==undefined){var b=a.getEl(),d=this,e=d.target;a.dd=new Ext.dd.DD(b,undefined,{isTarget:false});b.applyStyles({position:"absolute"});var f=function(){return false};Ext.apply(a.dd,{b4StartDrag:function(){this.startPosition=b.getXY();this.startZIndex=b.getStyle("zIndex");
b.setStyle("zIndex",1E4);a.suspendEvents();a.menu&&a.menu.on("beforeshow",f,d)},startDrag:function(){this.constrainTo(e.getEl());this.setYConstraint(0,0,0)},onDrag:function(){var g=b.getXY()[0],j=g-this.startPosition[0],k=e.items.items,l=k.length,n=k.indexOf(a),q,v;for(q=0;q<l;q++){v=k[q];if(v.reorderable&&v.id!=a.id){var G=v.getEl().getBox();G=(d.buttonXCache[v.id]||G.x)+G.width/2;v=n>q&&j<0&&g<G;G=n<q&&j>0&&g+b.getWidth()>G;if(v||G){d[v?"onMovedLeft":"onMovedRight"](a,q,n);break}}}},endDrag:function(){d.updateButtonXCache();
b.moveTo(d.buttonXCache[a.id],b.getY(),{duration:d.animationDuration,scope:this,callback:function(){a.resumeEvents();a.menu&&a.menu.un("beforeshow",f,d);e.fireEvent("reordered",a,e)}});b.setStyle("zIndex",this.startZIndex)}})}},onMovedLeft:function(a,b,d){var e=this.target,f=e.items.items,g=f.length;if(b!=undefined&&b!=d){e.remove(a,false);e.insert(b,a);this.updateButtonXCache();for(b=0;b<g;b++){e=f[b];d=this.buttonXCache[e.id];if(a==e)a.dd.startPosition[0]=d;else{e=e.getEl();e.moveTo(d,e.getY(),
{duration:this.animationDuration})}}}},onMovedRight:function(){this.onMovedLeft.apply(this,arguments)},updateButtonXCache:function(){var a=this.target,b=a.items,d=a.getEl().getBox(true).x;b.each(function(e){this.buttonXCache[e.id]=d;d+=e.getEl().getWidth()},this)}});Ext.ns("Ext.ux.plugins.grid");
Ext.ux.plugins.grid.CellToolTips=function(a){var b;if(Ext.isArray(a)){b=a;a={}}else b=a.ajaxTips;Ext.ux.plugins.grid.CellToolTips.superclass.constructor.call(this,a);if(a.tipConfig)this.tipConfig=a.tipConfig;this.ajaxTips=b};
Ext.extend(Ext.ux.plugins.grid.CellToolTips,Ext.util.Observable,{version:1.3,ajaxTips:false,tipTpls:false,tipFns:false,tipUrls:"",tipConfig:{},request:false,init:function(a){if(this.ajaxTips){this.tipTpls={};this.tipFns={};this.tipAfterFns={};this.tipUrls={};Ext.each(this.ajaxTips,function(b){this.tipTpls[b.field]=new Ext.XTemplate(b.tpl);if(b.url)this.tipUrls[b.field]=b.url;if(b.fn)this.tipFns[b.field]=b.fn;if(b.afterFn)this.tipAfterFns[b.field]=b.afterFn;if(b.tipConfig)this.tipConfig=b.tipConfig},
this);delete this.ajaxTips;a.on("render",this.onGridRender.createDelegate(this))}},setFieldTpl:function(a,b){this.tipTpls[a]=Ext.isObject(b)?b:new Ext.XTemplate(b)},onGridRender:function(a){if(this.tipTpls){Ext.apply(this.tipConfig,{target:a.getView().mainBody,delegate:".x-grid3-cell-inner",renderTo:document.body,finished:false});Ext.applyIf(this.tipConfig,{trackMouse:true});this.tip=new Ext.ToolTip(this.tipConfig);this.tip.ctt=this;this.tip.on("beforeshow",this.beforeTipShow.createDelegate(this.tip,
[this,a],true));this.tip.on("hide",this.hideTip)}},beforeTipShow:function(a,b,d){var e=d.getView().findCellIndex(a.triggerElement);e=d.getColumnModel().getDataIndex(e);if(!b.tipTpls[e])return false;if(a.finished)a.body.dom.innerHTML=a.ctt.tipTpls[e].apply(a.tipdata);else{var f=typeof b.tipUrls[e]=="string",g=d.getView().findRowIndex(a.triggerElement),j=d.getStore().getAt(g);if(d.CellToolTipCondition&&d.CellToolTipCondition(g,j)===false)return false;g=j.copy().data;if(f){b.loadDetails(b.tipFns[e]?
b.tipFns[e](g):g,a,d,b,e);a.body.dom.innerHTML="Loading..."}else a.body.dom.innerHTML=b.tipTpls[e].apply(b.tipFns[e]?b.tipFns[e](j.data):j.data)}},hideTip:function(a){a.finished=false},loadDetails:function(a,b,d,e,f){Ext.Ajax.request({url:e.tipUrls[f],params:a,method:"POST",success:function(g){b.finished=true;b.tipdata=Ext.decode(g.responseText);if(e.tipAfterFns[f])b.tipdata=e.tipAfterFns[f](b.tipdata);b.show()}})}});Ext.namespace("Ext.ux.grid");
Ext.ux.grid.GridHeaderFilters=function(a){a&&Ext.apply(this,a)};
Ext.extend(Ext.ux.grid.GridHeaderFilters,Ext.util.Observable,{fieldHeight:22,fieldPadding:1,highlightOnFilter:true,highlightColor:"yellow",highlightCls:null,stateful:true,applyMode:"auto",filters:null,filtersInitMode:"replace",ensureFilteredVisible:true,cfgFilterInit:false,containerConfig:null,labelWidth:50,fcc:null,filterFields:null,filterContainers:null,filterContainerCls:"x-ghf-filter-container",inResizeProcess:false,init:function(a){this.grid=a;a=this.grid.getView();a.updateHeaders=a.updateHeaders.createSequence(function(){this.renderFilters.call(this)},
this).createInterceptor(function(){return true},this);this.grid.on({scope:this,render:this.onRender,resize:this.onResize,columnresize:this.onColResize,reconfigure:this.onReconfigure,beforedestroy:this.destroyFilters});if(this.stateful){this.grid.on("beforestatesave",this.saveFilters,this);this.grid.on("beforestaterestore",this.loadFilters,this)}this.grid.getColumnModel().on("hiddenchange",this.onColHidden,this);this.grid.addEvents("filterupdate");this.addEvents({render:true});this.cfgFilterInit=Ext.isDefined(this.filters)&&
this.filters!==null;if(!this.filters)this.filters={};this.configure(this.grid.getColumnModel());Ext.ux.grid.GridHeaderFilters.superclass.constructor.call(this);if(this.stateful){if(!Ext.isArray(this.grid.stateEvents))this.grid.stateEvents=[];this.grid.stateEvents.push("filterupdate")}Ext.apply(this.grid,{headerFilters:this,getHeaderFilter:function(b){if(!this.headerFilters)return null;return this.headerFilters.filters[b]},setHeaderFilter:function(b,d){if(this.headerFilters){var e={};e[b]=d;this.setHeaderFilters(e)}},
setHeaderFilters:function(b,d,e){if(this.headerFilters){d&&this.resetHeaderFilters(false);if(arguments.length<3)e=true;var f=false,g;for(g in b)if(this.headerFilters.filterFields[g]){f=this.headerFilters.filterFields[g];this.headerFilters.setFieldValue(f,b[g]);this.headerFilters.applyFilter(f,false);f=true}f&&e&&this.headerFilters.storeReload()}},getHeaderFilterField:function(b){if(this.headerFilters)return this.headerFilters.filterFields[b]?this.headerFilters.filterFields[b]:null},resetHeaderFilters:function(b){if(this.headerFilters){if(arguments.length==
0)b=true;for(var d in this.headerFilters.filterFields){var e=this.headerFilters.filterFields[d];Ext.isFunction(e.clearValue)?e.clearValue():this.headerFilters.setFieldValue(e,"");this.headerFilters.applyFilter(e,false)}b&&this.headerFilters.storeReload()}},applyHeaderFilters:function(b){if(arguments.length==0)b=true;this.headerFilters.applyFilters(b)}})},configure:function(a){a=a.getColumnsBy(function(k){return Ext.isObject(k.filter)||Ext.isArray(k.filter)?true:false});this.fcc={};for(var b=0;b<a.length;b++){var d=
a[b],e=d.filter;Ext.isArray(e)||(e=[e]);for(var f=0;f<e.length;f++){var g=Ext.apply({filterName:f>0?d.dataIndex+f:d.dataIndex},e[f]);Ext.apply(g,{columnId:d.id,dataIndex:d.dataIndex,hideLabel:true,anchor:"100%"});if(!this.cfgFilterInit&&!Ext.isEmpty(g.value))this.filters[g.filterName]=Ext.isFunction(g.filterEncoder)?g.filterEncoder.call(this,g.value):g.value;delete g.value;if(g.applyFilterEvent){g.listeners={scope:this};g.listeners[g.applyFilterEvent]=function(k){this.applyFilter(k)};delete g.applyFilterEvent}else if(this.applyMode===
"auto"||this.applyMode==="change"||Ext.isEmpty(this.applyMode))if(g.hasListener!=undefined){g.hasListener("change")||g.on("change",function(k){var l=k.getXType();l=="combo"||l=="datefield"||this.applyFilter(k)},this);g.hasListener("specialkey")||g.on("specialkey",function(k,l){l.stopPropagation();l.getKey()==l.ENTER&&k.el.dom.blur()},this);g.hasListener("select")||g.on("select",function(k){this.applyFilter(k)},this)}else g.listeners={change:function(k){var l=k.getXType();l=="combo"||l=="datefield"||
this.applyFilter(k)},select:function(k){this.applyFilter(k)},scope:this};else if(this.applyMode==="enter")g.listeners={specialkey:function(k,l){l.stopPropagation();l.getKey()==l.ENTER&&this.applyFilters()},scope:this};var j=this.fcc[g.columnId];if(!j){j={cls:this.filterContainerCls,border:false,bodyBorder:false,bodyStyle:"background-color: transparent",labelSeparator:"",labelWidth:this.labelWidth,layout:"hbox",style:{},items:[]};this.containerConfig&&Ext.apply(j,this.containerConfig);this.fcc[g.columnId]=
j}j.items.push({bodyStyle:"background-color: transparent",border:false,bodyBorder:false,layout:"form",padding:2,margins:"0 0 -4 0",flex:1,items:[g]})}}},renderFilterContainer:function(a,b){if(!this.filterContainers)this.filterContainers={};var d=this.grid.getColumnModel().getIndexById(a),e=this.grid.getView().getHeaderCell(d);e=Ext.get(e);if(Ext.isGecko)e.dom.style.MozUserSelect="text";e.dom.style.verticalAlign="top";b.width=e.getWidth()-3;d=new Ext.Container(b);d.render(e);this.filterContainers[a]=
d;e=0;if(!this.filterFields)this.filterFields={};var f=d.findBy(function(j){return!Ext.isEmpty(j.filterName)});if(!Ext.isEmpty(f))for(var g=0;g<f.length;g++){this.filterFields[f[g].filterName]=f[g];e+=f[g].getHeight()}return d},renderFilters:function(){if(this.fcc){for(var a in this.fcc)this.renderFilterContainer(a,this.fcc[a]);this.setFilters(this.filters);this.highlightFilters(this.isFiltered())}},onRender:function(){this.isFiltered()&&this.applyFilters(false);this.fireEvent("render",this)},getFilterField:function(a){return this.filterFields?
this.filterFields[a]:null},setFilters:function(a,b){if((this.filters=a)&&this.filterFields){for(var d in this.filters)this.filterFields[d]||delete this.filters[d];for(d in this.filterFields){var e=this.filterFields[d],f=this.filters[e.filterName];if(Ext.isEmpty(f))b&&this.setFieldValue(e,"");else this.setFieldValue(e,f)}}},onColResize:function(a,b){if(this.filterContainers){if(!this.inResizeProcess)if(this.grid.viewConfig&&this.grid.viewConfig.forceFit){this.onResize();return}var d=this.filterContainers[this.grid.getColumnModel().getColumnId(a)];
if(d){if(isNaN(b))b=0;d.setWidth(b<3?0:b-3);d.doLayout(false,true)}}},onResize:function(){this.inResizeProcess=true;for(var a=this.grid.getColumnModel().getColumnCount(),b=0;b<a;b++){var d=this.grid.getView().getHeaderCell(b);d=Ext.get(d);this.onColResize(b,d.getWidth())}this.inResizeProcess=false},onColHidden:function(a,b,d){if(!d){a=this.grid.getColumnModel().getColumnWidth(b);this.onColResize(b,a)}},onReconfigure:function(a,b,d){this.destroyFilters();this.configure(d);this.renderFilters()},saveFilters:function(a,
b){var d={},e;for(e in this.filters)d[e]=this.filters[e];b.gridHeaderFilters=d;return true},loadFilters:function(a,b){var d=b.gridHeaderFilters;if(d)if(this.cfgFilterInit)this.filtersInitMode==="merge"&&Ext.apply(d,this.filters);else this.filters=d},isFiltered:function(){for(var a in this.filters)if(!Ext.isEmpty(this.filters[a]))return true;return false},highlightFilters:function(a){if(this.highlightOnFilter)if(this.filterContainers)if(this.grid.getView().mainHd){var b=a?this.highlightColor:"transparent",
d;for(d in this.filterContainers){var e=this.filterContainers[d];if(e.rendered)if(Ext.isEmpty(this.highlightCls))e.getEl().setStyle("backgroundColor",b);else a?e.getEl().addClass(this.highlightCls):e.getEl().removeClass(this.highlightCls)}}},getFieldValue:function(a){return Ext.isFunction(a.filterEncoder)?a.filterEncoder.call(a,a.getValue()):a.getValue()},setFieldValue:function(a,b){if(Ext.isFunction(a.filterDecoder))b=a.filterDecoder.call(a,b);a.setValue(b)},applyFilter:function(a,b){if(arguments.length<
2)b=true;if(a)if(a.isValid())if(!(a.disabled&&!Ext.isDefined(this.grid.store.baseParams[a.filterName]))){var d=this.getFieldValue(a);if(a.disabled||Ext.isEmpty(d)){delete this.grid.store.baseParams[a.filterName];delete this.filters[a.filterName]}else{this.grid.store.baseParams[a.filterName]=d;this.filters[a.filterName]=d;if(this.ensureFilteredVisible){var e=this.grid.getColumnModel().getIndexById(a.columnId);e>=0&&this.grid.getColumnModel().isHidden(e)&&this.grid.getColumnModel().setHidden(e,false)}}this.highlightFilters(this.isFiltered());
this.grid.fireEvent("filterupdate",a.filterName,d,a);b&&this.storeReload()}},applyFilters:function(a){if(arguments.length<1)a=true;for(var b in this.filterFields)this.applyFilter(this.filterFields[b],false);a&&this.storeReload()},storeReload:function(){if(this.grid.store.lastOptions){var a={start:0};if(this.grid.store.lastOptions.params&&this.grid.store.lastOptions.params.limit)a.limit=this.grid.store.lastOptions.params.limit;this.grid.store.load({params:a})}},getFilterContainer:function(a){return this.filterContainers?
this.filterContainers[a]:null},destroyFilters:function(){if(this.filterFields)for(var a in this.filterFields){Ext.destroy(this.filterFields[a]);delete this.filterFields[a]}if(this.filterContainers)for(a in this.filterContainers){Ext.destroy(this.filterContainers[a]);delete this.filterContainers[a]}}});Ext.ns("Ext.ux.grid");
Ext.ux.grid.LockingHeaderGroupGridView=Ext.extend(Ext.grid.GridView,{lockText:"Lock",unlockText:"Unlock",rowBorderWidth:1,lockedBorderWidth:1,syncHeights:false,initTemplates:function(){var a=this.templates||{};if(!a.master)a.master=new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-locked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{lstyle}">{lockedHeader}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{lstyle}">{lockedBody}</div><div class="x-grid3-scroll-spacer"></div></div>',
"</div>",'<div class="x-grid3-viewport x-grid3-unlocked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{ostyle}">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{bstyle}">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',"</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>");if(!a.gcell)a.gcell=
new Ext.XTemplate('<td class="x-grid3-hd x-grid3-gcell x-grid3-td-{id} ux-grid-hd-group-row-{row} {cls}" style="{style}">','<div {tooltip} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"","{value}</div></td>");this.templates=a;this.hrowRe=/ux-grid-hd-group-row-(\d+)/;Ext.ux.grid.LockingHeaderGroupGridView.superclass.initTemplates.call(this)},getEditorParent:function(){return this.el.dom},initElements:function(){var a=
Ext.Element,b=this.grid.getGridEl().dom.firstChild,d=b.childNodes;this.el=new a(b);this.lockedWrap=new a(d[0]);this.lockedHd=new a(this.lockedWrap.dom.firstChild);this.lockedInnerHd=this.lockedHd.dom.firstChild;this.lockedScroller=new a(this.lockedWrap.dom.childNodes[1]);this.lockedBody=new a(this.lockedScroller.dom.firstChild);this.mainWrap=new a(d[1]);this.mainHd=new a(this.mainWrap.dom.firstChild);if(this.grid.hideHeaders){this.lockedHd.setDisplayed(false);this.mainHd.setDisplayed(false)}this.innerHd=
this.mainHd.dom.firstChild;this.scroller=new a(this.mainWrap.dom.childNodes[1]);this.forceFit&&this.scroller.setStyle("overflow-x","hidden");this.mainBody=new a(this.scroller.dom.firstChild);this.focusEl=new a(this.scroller.dom.childNodes[1]);this.resizeMarker=new a(d[2]);this.resizeProxy=new a(d[3]);this.focusEl.swallowEvent("click",true)},getLockedRows:function(){return this.hasRows()?this.lockedBody.dom.childNodes:[]},getLockedRow:function(a){return this.getLockedRows()[a]},getCell:function(a,
b){var d=this.cm.getLockedCount();if(b<d)return this.getLockedRow(a).getElementsByTagName("td")[b];return Ext.ux.grid.LockingHeaderGroupGridView.superclass.getCell.call(this,a,b-d)},getHeaderCell:function(a){var b=this.cm.getLockedCount();if(a<b)return this.lockedHd.dom.getElementsByTagName("td")[a];return this.mainHd.query(this.cellSelector)[a-b]},addRowClass:function(a,b){var d=this.getLockedRow(a);d&&this.fly(d).addClass(b);Ext.ux.grid.LockingHeaderGroupGridView.superclass.addRowClass.call(this,
a,b)},removeRowClass:function(a,b){var d=this.getLockedRow(a);d&&this.fly(d).removeClass(b);Ext.ux.grid.LockingHeaderGroupGridView.superclass.removeRowClass.call(this,a,b)},removeRow:function(a){Ext.removeNode(this.getLockedRow(a));Ext.ux.grid.LockingHeaderGroupGridView.superclass.removeRow.call(this,a)},removeRows:function(a,b){for(var d=this.lockedBody.dom,e=a;e<=b;e++)Ext.removeNode(d.childNodes[a]);Ext.ux.grid.LockingHeaderGroupGridView.superclass.removeRows.call(this,a,b)},syncScroll:function(a){this.lockedScroller.dom.scrollTop=
this.scroller.dom.scrollTop;Ext.ux.grid.LockingHeaderGroupGridView.superclass.syncScroll.call(this,a)},updateSortIcon:function(a,b){var d=this.sortClasses,e=this.lockedHd.select("td").removeClass(d),f=this.mainHd.select("td").removeClass(d),g=this.cm.getLockedCount();d=d[b=="DESC"?1:0];a<g?e.item(a).addClass(d):f.item(a-g).addClass(d)},updateAllColumnWidths:function(){var a=this.getTotalWidth(),b=this.cm.getColumnCount(),d=this.getLockedWidth(),e=this.cm.getLockedCount(),f=[],g,j;this.updateLockedWidth();
for(j=0;j<b;j++){f[j]=this.getColumnWidth(j);this.getHeaderCell(j).style.width=f[j]}var k=this.getLockedRows(),l=this.getRows(),n,q;j=0;for(g=l.length;j<g;j++){n=k[j];n.style.width=d;if(n.firstChild){n.firstChild.style.width=d;n=n.firstChild.rows[0];for(q=0;q<e;q++)n.childNodes[q].style.width=f[q]}n=l[j];n.style.width=a;if(n.firstChild){n.firstChild.style.width=a;n=n.firstChild.rows[0];for(q=e;q<b;q++)n.childNodes[q-e].style.width=f[q]}}this.updateGroupStyles();this.onAllColumnWidthsUpdated(f,a);
this.syncHeaderHeight()},onColumnWidthUpdated:function(){Ext.ux.grid.LockingHeaderGroupGridView.superclass.onColumnWidthUpdated.call(this,arguments);this.updateGroupStyles.call(this)},onAllColumnWidthsUpdated:function(){Ext.ux.grid.LockingHeaderGroupGridView.superclass.onAllColumnWidthsUpdated.call(this,arguments);this.updateGroupStyles.call(this)},updateColumnWidth:function(a){var b=this.getColumnWidth(a),d=this.cm.getLockedCount(),e,f,g;this.updateLockedWidth();if(a<d){e=this.getLockedRows();f=
this.getLockedWidth();d=a}else{e=this.getRows();f=this.getTotalWidth();d=a-d}this.getHeaderCell(a).style.width=b;for(var j=0,k=e.length;j<k;j++){g=e[j];g.style.width=f;if(g.firstChild){g.firstChild.style.width=f;g.firstChild.rows[0].childNodes[d].style.width=b}}this.onColumnWidthUpdated(a,b,this.getTotalWidth());this.syncHeaderHeight()},updateColumnHidden:function(a,b){var d=this.cm.getLockedCount(),e,f,g,j=b?"none":"";this.updateLockedWidth();if(a<d){e=this.getLockedRows();f=this.getLockedWidth();
d=a}else{e=this.getRows();f=this.getTotalWidth();d=a-d}this.getHeaderCell(a).style.display=j;for(var k=0,l=e.length;k<l;k++){g=e[k];g.style.width=f;if(g.firstChild){g.firstChild.style.width=f;g.firstChild.rows[0].childNodes[d].style.display=j}}this.onColumnHiddenUpdated(a,b,this.getTotalWidth());delete this.lastViewWidth;this.layout()},doRender:function(a,b,d,e,f,g){var j=this.templates,k=j.cell;j=j.row;for(var l=f-1,n="width:"+this.getTotalWidth()+";",q="width:"+this.getLockedWidth()+";",v=[],G=
[],P,R,y,H={},J={},Q,V=0,ca=b.length;V<ca;V++){Q=b[V];P=[];R=[];for(var B=V+e,L=0;L<f;L++){y=a[L];H.id=y.id;H.css=(L===0?"x-grid3-cell-first ":L==l?"x-grid3-cell-last ":"")+(this.cm.config[L].cellCls?" "+this.cm.config[L].cellCls:"");H.attr=H.cellAttr="";H.value=y.renderer(Q.data[y.name],H,Q,B,L,d);H.style=y.style;if(Ext.isEmpty(H.value))H.value="&#160;";if(this.markDirty&&Q.dirty&&Ext.isDefined(Q.modified[y.name]))H.css+=" x-grid3-dirty-cell";if(y.locked)R[R.length]=k.apply(H);else P[P.length]=k.apply(H)}y=
[];if(g&&(B+1)%2===0)y[0]="x-grid3-row-alt";if(Q.dirty)y[1]=" x-grid3-dirty-row";J.cols=f;if(this.getRowClass)y[2]=this.getRowClass(Q,B,J,d);J.alt=y.join(" ");J.cells=P.join("");J.tstyle=n;v[v.length]=j.apply(J);J.cells=R.join("");J.tstyle=q;G[G.length]=j.apply(J)}return[v.join(""),G.join("")]},processRows:function(a,b){if(!(!this.ds||this.ds.getCount()<1)){var d=this.getRows(),e=this.getLockedRows(),f,g;b=b||!this.grid.stripeRows;a=a||0;for(var j=0,k=d.length;j<k;++j){f=d[j];g=e[j];f.rowIndex=j;
g.rowIndex=j;if(!b){f.className=f.className.replace(this.rowClsRe," ");g.className=g.className.replace(this.rowClsRe," ");if((j+1)%2===0){f.className+=" x-grid3-row-alt";g.className+=" x-grid3-row-alt"}}if(this.syncHeights){f=Ext.get(f);g=Ext.get(g);var l=f.getHeight(),n=g.getHeight();if(l>n)g.setHeight(l);else n>l&&f.setHeight(n)}}if(a===0){Ext.fly(d[0]).addClass(this.firstRowCls);Ext.fly(e[0]).addClass(this.firstRowCls)}Ext.fly(d[d.length-1]).addClass(this.lastRowCls);Ext.fly(e[e.length-1]).addClass(this.lastRowCls)}},
afterRender:function(){if(this.ds&&this.cm){var a=this.renderRows()||["&#160;","&#160;"];this.mainBody.dom.innerHTML=a[0];this.lockedBody.dom.innerHTML=a[1];this.processRows(0,true);this.deferEmptyText!==true&&this.applyEmptyText()}},renderUI:function(){var a=this.renderHeaders(),b=this.templates.body.apply({rows:"&#160;"});a=this.templates.master.apply({body:b,header:a[0],ostyle:"width:"+this.getOffsetWidth()+";",bstyle:"width:"+this.getTotalWidth()+";",lockedBody:b,lockedHeader:a[1],lstyle:"width:"+
this.getLockedWidth()+";"});b=this.grid;b.getGridEl().dom.innerHTML=a;this.initElements();Ext.fly(this.innerHd).on("click",this.handleHdDown,this);Ext.fly(this.lockedInnerHd).on("click",this.handleHdDown,this);this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.lockedHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.scroller.on("scroll",this.syncScroll,this);if(b.enableColumnResize!==
false){this.splitZone=new Ext.grid.GridView.SplitDragZone(b,this.mainHd.dom);this.splitZone.setOuterHandleElId(Ext.id(this.lockedHd.dom));this.splitZone.setOuterHandleElId(Ext.id(this.mainHd.dom))}if(b.enableColumnMove){this.columnDrag=new Ext.grid.GridView.ColumnDragZone(b,this.innerHd);this.columnDrag.setOuterHandleElId(Ext.id(this.lockedInnerHd));this.columnDrag.setOuterHandleElId(Ext.id(this.innerHd));this.columnDrop=new Ext.grid.HeaderDropZone(b,this.mainHd.dom)}if(b.enableHdMenu!==false){this.hmenu=
new Ext.menu.Menu({id:b.id+"-hctx"});this.hmenu.add({itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"});this.grid.enableColLock!==false&&this.hmenu.add("-",{itemId:"lock",text:this.lockText,cls:"xg-hmenu-lock"},{itemId:"unlock",text:this.unlockText,cls:"xg-hmenu-unlock"});if(b.enableColumnHide!==false){this.colMenu=new Ext.menu.Menu({id:b.id+"-hcols-menu"});this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});
this.hmenu.add("-",{itemId:"columns",hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})}this.hmenu.on("itemclick",this.handleHdMenuClick,this)}if(b.trackMouseOver){this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut});this.lockedBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut})}if(b.enableDragDrop||b.enableDrag)this.dragZone=new Ext.grid.GridDragZone(b,{ddGroup:b.ddGroup||"GridDD"});this.updateHeaderSortState()},splitZoneConfig:{allowHeaderDrag:function(a){return!a.getTarget(null,
null,true).hasClass("ux-grid-hd-group-cell")}},columnDropConfig:{getTargetFromEvent:function(a){return this.view.findHeaderCell(Ext.lib.Event.getTarget(a))},positionIndicator:function(a,b,d){a=this.getDragDropData.call(this,a,b,d);if(a===false)return false;b=a.px+this.proxyOffsets[0];this.proxyTop.setLeftTop(b,a.r.top+this.proxyOffsets[1]);this.proxyTop.show();this.proxyBottom.setLeftTop(b,a.r.bottom);this.proxyBottom.show();return a.pt},onNodeDrop:function(a,b,d,e){b=e.header;if(b!=a){a=this.getDragDropData.call(this,
b,a,d);if(a===false)return false;d=this.grid.colModel;b=a.oldIndex<a.newIndex;e=d.rows;for(var f=a.row,g=e.length;f<g;f++){for(var j=e[f],k=j.length,l=0,n=1,q=k,v=0,G=0;v<k;v++){var P=j[v];if(a.oldIndex>=G&&a.oldIndex<G+P.colspan)l=v;if(a.oldIndex+a.colspan-1>=G&&a.oldIndex+a.colspan-1<G+P.colspan)n=v-l+1;if(a.newIndex>=G&&a.newIndex<G+P.colspan)q=v;G+=P.colspan}k=j.splice(l,n);e[f]=j.splice(0,q-(b?n:0)).concat(k).concat(j)}for(e=0;e<a.colspan;e++){f=a.oldIndex+(b?0:e);g=a.newIndex+(b?-1:e);d.moveColumn(f,
g);this.grid.fireEvent("columnmove",f,g)}return true}return false}},updateGroupStyles:function(a){for(var b=this.lockedHd.query(".x-grid3-header-offset > table"),d=this.getLockedWidth(),e=this.rows,f=[],g=0;g<b.length;g++){b[g].style.width=d;if(g<e.length){var j=b[g].firstChild.firstChild.childNodes;for(var k=f[g]=0,l=0;k<j.length;k++){var n=e[g][k];f[g]+=1;if(typeof a!="number"||a>=l&&a<l+n.colspan){var q=this.getGroupStyle.call(this,n,l);j[k].style.width=q.width;j[k].style.display=q.hidden?"none":
""}l+=n.colspan}}}b=this.mainHd.query(".x-grid3-header-offset > table");d=this.getTotalWidth();e=this.rows;for(g=0;g<b.length;g++){b[g].style.width=d;if(g<e.length){j=b[g].firstChild.firstChild.childNodes;k=0;for(l=this.cm.getLockedCount();k<j.length;k++){n=e[g][f[g]+k];if(typeof a!="number"||a>=l&&a<l+n.colspan){q=this.getGroupStyle.call(this,n,l);j[k].style.width=q.width;j[k].style.display=q.hidden?"none":""}l+=n.colspan}}}},getGroupRowIndex:function(a){if(a)if((a=a.className.match(this.hrowRe))&&
a[1])return parseInt(a[1],10);return this.cm.rows.length},layout:function(){if(this.mainBody){var a=this.grid,b=a.getGridEl().getSize(true),d=b.width;if(!(!a.hideHeaders&&(d<20||b.height<20))){this.syncHeaderHeight();if(a.autoHeight){this.scroller.dom.style.overflow="visible";this.lockedScroller.dom.style.overflow="visible";if(Ext.isWebKit){this.scroller.dom.style.position="static";this.lockedScroller.dom.style.position="static"}}else{this.el.setSize(b.width,b.height);a=this.mainHd.getHeight();var e=
b.height-a}this.updateLockedWidth();if(this.forceFit){if(this.lastViewWidth!=d){this.fitColumns(false,false);this.lastViewWidth=d}}else{this.autoExpand();this.syncHeaderScroll()}this.onLayout(d,e)}}},getGroupSpan:function(a,b){if(a<0)return{col:0,colspan:this.cm.getColumnCount()};var d=this.cm.rows[a];if(d){for(var e=0,f=0,g=d.length;e<g;e++){var j=d[e];if(b>=f&&b<f+j.colspan)return{col:f,colspan:j.colspan};f+=j.colspan}return{col:f,colspan:0}}return{col:b,colspan:1}},getOffsetWidth:function(){return this.cm.getTotalWidth()-
this.cm.getTotalLockedWidth()+this.getScrollOffset()+"px"},renderHeaders:function(){var a=this.cm,b=this.templates;b=b.hcell;for(var d=[],e=[],f={},g=a.getColumnCount(),j=g-1,k=0;k<g;k++){f.id=a.getColumnId(k);f.value=a.getColumnHeader(k)||"";f.style=this.getColumnStyle(k,true);f.tooltip=this.getColumnTooltip(k);f.css=(k===0?"x-grid3-cell-first ":k==j?"x-grid3-cell-last ":"")+(a.config[k].headerCls?" "+a.config[k].headerCls:"");if(a.config[k].align=="right")f.istyle="padding-right:16px";else delete f.istyle;
if(a.isLocked(k))e[e.length]=b.apply(f);else d[d.length]=b.apply(f)}b=this.templates;f=[];j=[];a=this.cm;for(var l=this.rows,n="width:"+this.getTotalWidth()+";",q=0,v=l.length;q<v;q++){var G=l[q],P=[],R=[],y=k=0;for(g=G.length;k<g;k++){var H=G[k];H.colspan=H.colspan||1;var J=this.getColumnId(H.dataIndex?a.findColumnIndex(H.dataIndex):y),Q=this.getGroupStyle.call(this,H,y);J=b.gcell.apply({cls:"ux-grid-hd-group-cell",id:J,row:q,style:"width:"+Q.width+";"+(Q.hidden?"display:none;":"")+(H.align?"text-align:"+
H.align+";":""),tooltip:H.tooltip?(Ext.QuickTips.isEnabled()?"ext:qtip":"title")+'="'+H.tooltip+'"':"",istyle:H.align=="right"?"padding-right:16px":"",btn:this.grid.enableHdMenu&&H.header,value:H.header||"&nbsp;"});if(a.isLocked(H.dataIndex?a.findColumnIndex(H.dataIndex):y))R[k]=J;else P[k]=J;y+=H.colspan}f[q]=b.header.apply({tstyle:n,cells:P.join("")});j[q]=b.header.apply({tstyle:n,cells:R.join("")})}f.push(b.header.apply({cells:d.join(""),tstyle:"width:"+this.getTotalWidth()+";"}));j.push(b.header.apply({cells:e.join(""),
tstyle:"width:"+this.getLockedWidth()+";"}));return[f.join(""),j.join("")]},getGroupStyle:function(a,b){for(var d=0,e=true,f=b,g=b+a.colspan;f<g;f++)if(!this.cm.isHidden(f)){e=this.cm.getColumnWidth(f);if(typeof e=="number")d+=e;e=false}return{width:(Ext.isBorderBox||Ext.isWebKit&&!Ext.isSafari2?d:Math.max(d-this.borderWidth,0))+"px",hidden:e}},findHeaderCell:function(a){return a?this.fly(a).findParent("td.x-grid3-hd",this.cellSelectorDepth):false},findHeaderIndex:function(a){return(a=this.findHeaderCell(a))?
this.getCellIndex(a):false},updateHeaders:function(){var a=this.renderHeaders();this.innerHd.firstChild.innerHTML=a[0];this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=this.getTotalWidth();this.lockedInnerHd.firstChild.innerHTML=a[1];a=this.getLockedWidth();this.lockedInnerHd.firstChild.style.width=a;this.lockedInnerHd.firstChild.firstChild.style.width=a},getResolvedXY:function(a){if(!a)return null;var b=a.cell;a=a.row;return b?Ext.fly(b).getXY():
[this.scroller.getX(),Ext.fly(a).getY()]},syncFocusEl:function(a,b,d){Ext.ux.grid.LockingHeaderGroupGridView.superclass.syncFocusEl.call(this,a,b,b<this.cm.getLockedCount()?false:d)},ensureVisible:function(a,b,d){return Ext.ux.grid.LockingHeaderGroupGridView.superclass.ensureVisible.call(this,a,b,b<this.cm.getLockedCount()?false:d)},insertRows:function(a,b,d,e){a=a.getCount()-1;if(!e&&b===0&&d>=a)this.refresh();else{e||this.fireEvent("beforerowsinserted",this,b,d);var f=this.renderRows(b,d),g=this.getRow(b);
if(g){b===0&&this.removeRowClass(0,this.firstRowCls);Ext.DomHelper.insertHtml("beforeBegin",g,f[0]);g=this.getLockedRow(b);Ext.DomHelper.insertHtml("beforeBegin",g,f[1])}else{this.removeRowClass(a-1,this.lastRowCls);Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,f[0]);Ext.DomHelper.insertHtml("beforeEnd",this.lockedBody.dom,f[1])}if(e){if(b===0||b>=a)this.addRowClass(b,b===0?this.firstRowCls:this.lastRowCls)}else{this.fireEvent("rowsinserted",this,b,d);this.processRows(b)}}this.syncFocusEl(b)},
getColumnStyle:function(a,b){var d=!b?this.cm.config[a].cellStyle||this.cm.config[a].css||"":this.cm.config[a].headerStyle||"";d+="width:"+this.getColumnWidth(a)+";";if(this.cm.isHidden(a))d+="display:none;";var e=this.cm.config[a].align;if(e)d+="text-align:"+e+";";return d},getLockedWidth:function(){return this.cm.getTotalLockedWidth()+"px"},getTotalWidth:function(){return this.cm.getTotalWidth()-this.cm.getTotalLockedWidth()+"px"},getColumnData:function(){for(var a=[],b=this.cm,d=b.getColumnCount(),
e=0;e<d;e++){var f=b.getDataIndex(e);a[e]={name:!Ext.isDefined(f)?this.ds.fields.get(e).name:f,renderer:b.getRenderer(e),id:b.getColumnId(e),style:this.getColumnStyle(e),locked:b.isLocked(e)}}return a},renderBody:function(){var a=this.renderRows()||["&#160;","&#160;"];return[this.templates.body.apply({rows:a[0]}),this.templates.body.apply({rows:a[1]})]},refreshRow:function(a){Ext.ux.grid.LockingHeaderGroupGridView.superclass.refreshRow.call(this,a);a=Ext.isNumber(a)?a:this.ds.indexOf(a);this.getLockedRow(a).rowIndex=
a},refresh:function(a){this.fireEvent("beforerefresh",this);this.grid.stopEditing(true);var b=this.renderBody();this.mainBody.update(b[0]).setWidth(this.getTotalWidth());this.lockedBody.update(b[1]).setWidth(this.getLockedWidth());if(a===true){this.updateHeaders();this.updateHeaderSortState()}this.processRows(0,true);this.layout();this.applyEmptyText();this.fireEvent("refresh",this)},onDenyColumnLock:function(){},initData:function(a,b){this.cm&&this.cm.un("columnlockchange",this.onColumnLock,this);
Ext.ux.grid.LockingHeaderGroupGridView.superclass.initData.call(this,a,b);this.cm&&this.cm.on("columnlockchange",this.onColumnLock,this)},onColumnLock:function(){this.refresh(true)},handleHdMenuClick:function(a){var b=this.hdCtxIndex,d=this.cm,e=a.getItemId(),f=d.getLockedCount();switch(e){case "lock":if(d.getColumnCount(true)<=f+1){this.onDenyColumnLock();return}d.setLocked(b,true);if(f!=b){d.moveColumn(b,f);this.grid.fireEvent("columnmove",b,f)}break;case "unlock":if(f-1!=b){d.setLocked(b,false,
true);d.moveColumn(b,f-1);this.grid.fireEvent("columnmove",b,f-1)}else d.setLocked(b,false);break;default:return Ext.ux.grid.LockingHeaderGroupGridView.superclass.handleHdMenuClick.call(this,a)}return true},handleHdDown:function(a,b){var d=Ext.get(b);if(d.hasClass("x-grid3-hd-btn")){a.stopEvent();var e=this.findHeaderCell(b);Ext.fly(e).addClass("x-grid3-hd-menu-open");this.hdCtxIndex=d=this.getCellIndex(e);var f=this.hmenu.items,g=this.cm;f.get("asc").setDisabled(!g.isSortable(d));f.get("desc").setDisabled(!g.isSortable(d));
this.hmenu.on("hide",function(){Ext.fly(e).removeClass("x-grid3-hd-menu-open")},this,{single:true});this.hmenu.show(b,"tl-bl?")}else if(d.hasClass("ux-grid-hd-group-cell")||Ext.fly(b).up(".ux-grid-hd-group-cell"))a.stopEvent();if(this.grid.enableColLock!==false)if(Ext.fly(b).hasClass("x-grid3-hd-btn")){e=this.findHeaderCell(b);d=this.getCellIndex(e);f=this.hmenu.items;g=this.cm;f.get("lock").setDisabled(g.isLocked(d));f.get("unlock").setDisabled(!g.isLocked(d))}},handleHdOver:function(a,b){var d=
this.findHeaderCell(b);if(d&&!this.headersDisabled){this.activeHdRef=b;this.activeHdIndex=this.getCellIndex(d);var e=this.fly(d);this.activeHdRegion=e.getRegion();if(!(this.cm.isMenuDisabled(this.activeHdIndex)||e.hasClass("ux-grid-hd-group-cell"))){e.addClass("x-grid3-hd-over");if(this.activeHdBtn=e.child(".x-grid3-hd-btn"))this.activeHdBtn.dom.style.height=d.firstChild.offsetHeight-1+"px"}}},handleHdOut:function(a,b){var d=this.findHeaderCell(b);if(d&&(!Ext.isIE||!a.within(d,true))){this.activeHdRef=
null;this.fly(d).removeClass("x-grid3-hd-over");d.style.cursor=""}},syncHeaderHeight:function(){this.innerHd.firstChild.firstChild.style.height="auto";this.lockedInnerHd.firstChild.firstChild.style.height="auto";var a=this.innerHd.firstChild.firstChild.offsetHeight,b=this.lockedInnerHd.firstChild.firstChild.offsetHeight;a=(b>a?b:a)+"px";this.innerHd.firstChild.firstChild.style.height=a;this.lockedInnerHd.firstChild.firstChild.style.height=a},updateLockedWidth:function(){var a=this.cm.getTotalLockedWidth(),
b=this.cm.getTotalWidth()-a,d=this.grid.getGridEl().getSize(true),e=Ext.isBorderBox?0:this.lockedBorderWidth,f=Ext.isBorderBox?0:this.rowBorderWidth,g=d.width-a-e-f+"px",j=this.getScrollOffset();if(!this.grid.autoHeight){d=d.height-this.mainHd.getHeight()+"px";this.lockedScroller.dom.style.height=d;this.scroller.dom.style.height=d}this.lockedWrap.dom.style.width=a+f+"px";this.scroller.dom.style.width=g;this.mainWrap.dom.style.left=a+e+f+"px";if(this.innerHd){this.lockedInnerHd.firstChild.style.width=
a+"px";this.lockedInnerHd.firstChild.firstChild.style.width=a+"px";this.innerHd.style.width=g;this.innerHd.firstChild.style.width=b+f+j+"px";this.innerHd.firstChild.firstChild.style.width=b+"px"}if(this.mainBody){this.lockedBody.dom.style.width=a+f+"px";this.mainBody.dom.style.width=b+f+"px"}}});
Ext.ux.grid.LockingGroupColumnModel=Ext.extend(Ext.grid.ColumnModel,{isLocked:function(a){return this.config[a].locked===true},setLocked:function(a,b,d){if(this.isLocked(a)!=b){this.config[a].locked=b;d||this.fireEvent("columnlockchange",this,a,b)}},getTotalLockedWidth:function(){for(var a=0,b=0,d=this.config.length;b<d;b++)if(this.isLocked(b)&&!this.isHidden(b))a+=this.getColumnWidth(b);return a},getLockedCount:function(){for(var a=this.config.length,b=0;b<a;b++)if(!this.isLocked(b))return b;return a},
moveColumn:function(a,b){var d=this.isLocked(a),e=this.isLocked(b);if(a<b&&d&&!e)this.setLocked(a,false,true);else a>b&&!d&&e&&this.setLocked(a,true,true);Ext.ux.grid.LockingGroupColumnModel.superclass.moveColumn.apply(this,arguments)}});Ext.namespace("Ext.ux.Ribbon");
Ext.ux.Ribbon=Ext.extend(Ext.TabPanel,{titleId:null,constructor:function(a){this.titleId=[];Ext.apply(a,{baseCls:"x-plain ui-ribbon",margins:"0 0 0 0",plain:true,border:false,deferredRender:false,layoutOnTabChange:true,title:"",activeTab:0,listeners:{beforetabchange:function(d){d.expand()},afterrender:{scope:this,fn:function(){if(this.titleId.length>0)for(var d=0;d<this.titleId.length;d++)(r=Ext.get(this.titleId[d].id))&&r.on("click",this.titleId[d].fn)}}}});Ext.apply(this,Ext.apply(this.initialConfig,
a));if(a.items)for(var b=0;b<a.items.length;b++)this.initRibbon(a.items[b],b);Ext.ux.Ribbon.superclass.constructor.apply(this,arguments)},initRibbon:function(a){for(var b=[],d=0;d<a.ribbon.length;d++){c={xtype:"buttongroup",cls:"x-btn-group-ribbonstyle",defaults:{scale:"small",iconAlign:"left",minWidth:40},items:a.ribbon[d].items};title=a.ribbon[d].title||"";topTitle=a.ribbon[d].topTitle||false;if(onTitleClick=a.ribbon[d].onTitleClick||false){titleId="ux-ribbon-"+Ext.id();title='<span id="'+titleId+
'" style="cursor:pointer;">'+title+"</span>";this.titleId.push({id:titleId,fn:onTitleClick})}if(title!=="")topTitle?Ext.apply(c,{title:title}):Ext.apply(c,{footerCfg:{cls:"x-btn-group-header x-unselectable",tag:"span",html:title}});if(cfg=a.ribbon[d].cfg||null){Ext.applyIf(c,a.ribbon[d].cfg);cfg.defaults&&Ext.apply(c.defaults,cfg.defaults)}b.push(c)}Ext.apply(a,{baseCls:"x-plain",tbar:b})}});
Ext.ux.ToolbarDroppable=Ext.extend(Object,{constructor:function(a){Ext.apply(this,a,{})},init:function(a){this.toolbar=a;this.toolbar.on({scope:this,render:this.createDropTarget})},createDropTarget:function(){this.dropTarget=new Ext.dd.DropTarget(this.toolbar.getEl(),{notifyOver:this.notifyOver.createDelegate(this),notifyDrop:this.notifyDrop.createDelegate(this)})},addDDGroup:function(a){this.dropTarget!=undefined&&this.dropTarget.addToGroup(a)},calculateEntryIndex:function(a){var b=0,d=this.toolbar,
e=d.items.items,f=e.length;d=d.getEl().getXY()[0];a=a.getXY()[0]-d;for(var g=0;g<f;g++){b=e[g].getEl().getWidth();var j=d+b/2;d+=b;if(a<j){b=g;break}else b=g+1}return b},canDrop:function(){return true},notifyOver:function(){return this.canDrop.apply(this,arguments)?this.dropTarget.dropAllowed:this.dropTarget.dropNotAllowed},notifyDrop:function(a,b,d){a=this.canDrop(a,b,d);var e=this.toolbar;if(a){b=this.calculateEntryIndex(b);e.insert(b,this.createItem(d));e.doLayout();this.afterLayout()}return a},
createItem:function(){throw Error("The createItem method must be implemented in the ToolbarDroppable plugin");},afterLayout:Ext.emptyFn});
Ext.ux.ToolbarReorderer=Ext.extend(Ext.ux.Reorderer,{init:function(a){this.buttonXCache={};a.on({scope:this,add:function(b,d){this.createIfReorderable(d)}});Ext.ux.ToolbarReorderer.superclass.init.apply(this,arguments)},createItemDD:function(a){if(a.dd==undefined){var b=a.getEl(),d=this.target,e=this;a.dd=new Ext.dd.DD(b,undefined,{isTarget:false});var f=function(){return false};Ext.apply(a.dd,{b4StartDrag:function(){this.startPosition=b.getXY();this.startZIndex=b.getStyle("zIndex");b.setStyle("zIndex",
1E4);a.suspendEvents();a.menu&&a.menu.on("beforeshow",f,e)},startDrag:function(){this.constrainTo(d.getEl());this.setYConstraint(0,0,0)},onDrag:function(){for(var g=b.getXY()[0],j=g-this.startPosition[0],k=d.items.items,l=k.indexOf(a),n=0;n<k.length;n++){var q=k[n];if(q.reorderable&&q.id!=a.id){var v=q.getEl().getBox();v=(e.buttonXCache[q.id]||v.x)+v.width/2;q=l>n&&j<0&&g<v;v=l<n&&j>0&&g+b.getWidth()>v;if(q||v){e[q?"onMovedLeft":"onMovedRight"](a,n,l);break}}}},endDrag:function(){e.updateButtonXCache();
b.moveTo(e.buttonXCache[a.id],b.getY(),{duration:e.animationDuration,scope:this,callback:function(){a.resumeEvents();a.menu&&a.menu.un("beforeshow",f,e);d.fireEvent("reordered",a,d)}});b.setStyle("zIndex",this.startZIndex)}})}},onMovedLeft:function(a,b,d){var e=this.target,f=e.items.items;if(b!=undefined&&b!=d){e.remove(a,false);e.insert(b,a);this.updateButtonXCache();for(b=0;b<f.length;b++){e=f[b];d=this.buttonXCache[e.id];if(a==e)a.dd.startPosition[0]=d;else{e=e.getEl();e.moveTo(d,e.getY(),{duration:this.animationDuration})}}}},
onMovedRight:function(){this.onMovedLeft.apply(this,arguments)},updateButtonXCache:function(){var a=this.target,b=a.items,d=a.getEl().getBox(true).x;b.each(function(e){this.buttonXCache[e.id]=d;d+=e.getEl().getWidth()},this)}});Ext.ux.Mask=function(a){Ext.apply(this,{mask:a})};
Ext.extend(Ext.ux.Mask,Object,{init:function(a){this.LetrasL="abcdefghijklmnopqrstuvwxyz";this.LetrasU=Ext.util.Format.uppercase(this.LetrasL);this.Letras=this.LetrasL+this.LetrasU;this.Numeros="0123456789";this.Fixos="().-:/ ";this.Charset=" !\"#$%&'()*+,-./0123456789:;<=>?@"+this.LetrasU+"[]^_/`"+this.LetrasL+"{|}~";a.enableKeyEvents=true;a.on("keypress",function(b,d){return this.press(b,d)},this)},press:function(a,b){var d=a.getValue(),e=b.getKey(),f=this.mask,g=a.el.dom;if(b){if(g.selectionEnd-
g.selectionStart>0)return true;if(g.selectionStart>0&&g.selectionStart<g.textLength)return true;var j=this.Charset.substr(e-32,1);if(e<32||b.isNavKeyPress()||e==b.BACKSPACE)return true;if(Ext.isGecko||Ext.isGecko2||Ext.isGecko3)if(b.charCode==0&&b.keyCode==46||b.isSpecialKey())return true;e=d.length;if(e>=f.length){a.setValue(d);b.stopEvent();return false}for(e=f.substr(e,1);this.Fixos.indexOf(e)!=-1;){d+=e;e=d.length;if(e>=f.length){b.stopEvent();return false}e=f.substr(e,1)}switch(e){case "#":if(this.Numeros.indexOf(j)==
-1){b.stopEvent();return false}break;case "A":j=j.toUpperCase();if(this.LetrasU.indexOf(j)==-1){b.stopEvent();return false}break;case "a":j=j.toLowerCase();if(this.LetrasL.indexOf(j)==-1){b.stopEvent();return false}break;case "Z":if(this.Letras.indexOf(j)==-1){b.stopEvent();return false}break;case "*":a.setValue(d+j);break;default:a.setValue(d)}}a.setValue(d+j);g.selectionEnd=g.selectionStart;b.stopEvent();return false}});Ext.ns("Ext.ux");
Ext.ux.Lightbox=function(){var a={},b=[],d,e=false,f=[];return{overlayOpacity:0.85,animate:true,resizeSpeed:8,borderSize:10,labelImage:"Image",labelOf:"of",init:function(){this.resizeDuration=this.animate?(11-this.resizeSpeed)*0.15:0;this.overlayDuration=this.animate?0.2:0;if(!e){Ext.apply(this,Ext.util.Observable.prototype);Ext.util.Observable.constructor.call(this);this.addEvents("open","close");this.initMarkup();this.initEvents();e=true}},initMarkup:function(){a.shim=Ext.DomHelper.append(document.body,
{tag:"iframe",id:"ux-lightbox-shim"},true);a.overlay=Ext.DomHelper.append(document.body,{id:"ux-lightbox-overlay"},true);var g=new Ext.Template(this.getTemplate());a.lightbox=g.append(document.body,{},true);Ext.each(["outerImageContainer","imageContainer","image","hoverNav","navPrev","navNext","loading","loadingLink","outerDataContainer","dataContainer","data","details","caption","imageNumber","bottomNav","navClose"],function(j){a[j]=Ext.get("ux-lightbox-"+j)});Ext.each([a.overlay,a.lightbox,a.shim],
function(j){j.setVisibilityMode(Ext.Element.DISPLAY);j.hide()});g=(this.animate?250:1)+"px";a.outerImageContainer.setStyle({width:g,height:g})},getTemplate:function(){return['<div id="ux-lightbox">','<div id="ux-lightbox-outerImageContainer">','<div id="ux-lightbox-imageContainer">','<img id="ux-lightbox-image">','<div id="ux-lightbox-hoverNav">','<a href="#" id="ux-lightbox-navPrev"></a>','<a href="#" id="ux-lightbox-navNext"></a>',"</div>",'<div id="ux-lightbox-loading">','<a id="ux-lightbox-loadingLink"></a>',
"</div>","</div>","</div>",'<div id="ux-lightbox-outerDataContainer">','<div id="ux-lightbox-dataContainer">','<div id="ux-lightbox-data">','<div id="ux-lightbox-details">','<span id="ux-lightbox-caption"></span>','<span id="ux-lightbox-imageNumber"></span>',"</div>",'<div id="ux-lightbox-bottomNav">','<a href="#" id="ux-lightbox-navClose"></a>',"</div>","</div>","</div>","</div>","</div>"]},initEvents:function(){var g=function(j){j.preventDefault();this.close()};a.overlay.on("click",g,this);a.loadingLink.on("click",
g,this);a.navClose.on("click",g,this);a.lightbox.on("click",function(j){j.getTarget().id=="ux-lightbox"&&this.close()},this);a.navPrev.on("click",function(j){j.preventDefault();this.setImage(d-1)},this);a.navNext.on("click",function(j){j.preventDefault();this.setImage(d+1)},this)},register:function(g,j){if(f.indexOf(g)===-1){f.push(g);Ext.fly(document).on("click",function(k){var l=k.getTarget(g);if(l){k.preventDefault();this.open(l,g,j)}},this)}},open:function(g,j,k){k=k||false;this.setViewSize();
a.overlay.fadeIn({duration:this.overlayDuration,endOpacity:this.overlayOpacity,callback:function(){b=[];var l=0;if(k){var n=Ext.query(j);for(Ext.each(n,function(v){v.href&&b.push([v.href,v.title])});b[l][0]!=g.href;)l++}else b.push([g.href,g.title]);n=Ext.fly(document).getScroll();var q=n.top+Ext.lib.Dom.getViewportHeight()/10;a.lightbox.setStyle({top:q+"px",left:n.left+"px"}).show();this.setImage(l);this.fireEvent("open",b[l])},scope:this})},setViewSize:function(){var g=this.getViewSize();a.overlay.setStyle({width:g[0]+
"px",height:g[1]+"px"});a.shim.setStyle({width:g[0]+"px",height:g[1]+"px"}).show()},setImage:function(g){d=g;this.disableKeyNav();this.animate&&a.loading.show();a.image.hide();a.hoverNav.hide();a.navPrev.hide();a.navNext.hide();a.dataContainer.setOpacity(1.0E-4);a.imageNumber.hide();var j=new Image;j.onload=function(){a.image.dom.src=b[d][0];this.resizeImage(j.width,j.height)}.createDelegate(this);j.src=b[d][0]},resizeImage:function(g,j){var k=a.outerImageContainer.getWidth(),l=a.outerImageContainer.getHeight(),
n=g+this.borderSize*2,q=j+this.borderSize*2;k=k-n;var v=function(){a.hoverNav.setWidth(a.imageContainer.getWidth()+"px");a.navPrev.setHeight(j+"px");a.navNext.setHeight(j+"px");a.outerDataContainer.setWidth(n+"px");this.showImage()};l-q!=0||k!=0?a.outerImageContainer.shift({height:q,width:n,duration:this.resizeDuration,scope:this,callback:v,delay:50}):v.call(this)},showImage:function(){a.loading.hide();a.image.fadeIn({duration:this.resizeDuration,scope:this,callback:function(){this.updateDetails()}});
this.preloadImages()},updateDetails:function(){var g=a.data.getWidth(true)-a.navClose.getWidth()-10;a.details.setWidth((g>0?g:0)+"px");a.caption.update(b[d][1]);a.caption.show();if(b.length>1){a.imageNumber.update(this.labelImage+" "+(d+1)+" "+this.labelOf+"  "+b.length);a.imageNumber.show()}a.dataContainer.fadeIn({duration:this.resizeDuration/2,scope:this,callback:function(){var j=this.getViewSize();a.overlay.setHeight(j[1]+"px");this.updateNav()}})},updateNav:function(){this.enableKeyNav();a.hoverNav.show();
d>0&&a.navPrev.show();d<b.length-1&&a.navNext.show()},enableKeyNav:function(){Ext.fly(document).on("keydown",this.keyNavAction,this)},disableKeyNav:function(){Ext.fly(document).un("keydown",this.keyNavAction,this)},keyNavAction:function(g){g=g.getKey();if(g==88||g==67||g==27)this.close();else if(g==80||g==37)d!=0&&this.setImage(d-1);else if(g==78||g==39)d!=b.length-1&&this.setImage(d+1)},preloadImages:function(){var g;if(b.length>d+1){g=new Image;g.src=b[d+1][0]}if(d>0){g=new Image;g.src=b[d-1][0]}},
close:function(){this.disableKeyNav();a.lightbox.hide();a.overlay.fadeOut({duration:this.overlayDuration});a.shim.hide();this.fireEvent("close",d)},getViewSize:function(){return[Ext.lib.Dom.getViewWidth(),Ext.lib.Dom.getViewHeight()]}}}();Ext.onReady(Ext.ux.Lightbox.init,Ext.ux.Lightbox);Ext.QuickTips.init();if(typeof console=="undefined")var console={log:function(){}};Ext.namespace("Ext.m3");var SOFTWARE_NAME="\u041f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0430 \u041c3";
function assert(a,b){if(!a){console.error(b);throw Error(b);}}
function smart_eval(a){if(a!=undefined)if(a.substring(0,1)=="{"){if(a=Ext.util.JSON.decode(a))if(a.code){var b=a.code();b&&b instanceof Ext.Window&&typeof AppDesktop!="undefined"&&AppDesktop&&AppDesktop.getDesktop().createWindow(b);return b}else if(a.message&&a.message!="")Ext.Msg.show({title:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435",msg:a.message,buttons:Ext.Msg.OK,icon:a.success!=undefined&&!a.success?Ext.Msg.WARNING:Ext.Msg.Info})}else{try{b=eval(a)}catch(d){Ext.Msg.show({title:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435",
msg:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043d\u0435\u043f\u0440\u0435\u0434\u0432\u0438\u0434\u0435\u043d\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430!",buttons:Ext.Msg.OK,fn:Ext.emptyFn,animEl:"elId",icon:Ext.MessageBox.WARNING});throw d;}b&&b instanceof Ext.Window&&typeof AppDesktop!="undefined"&&AppDesktop&&AppDesktop.getDesktop().createWindow(b);return b}}Ext.ns("Ext.app.form");
Ext.app.form.SearchField=Ext.extend(Ext.form.TwinTriggerField,{initComponent:function(){Ext.app.form.SearchField.superclass.initComponent.call(this);this.on("specialkey",function(a,b){b.getKey()==b.ENTER&&this.onTrigger2Click()},this)},validationEvent:false,validateOnBlur:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:true,width:180,hasSearch:false,paramName:"filter",paramId:"id",nodeId:"-1",onTrigger1Click:function(){if(this.hasSearch){this.el.dom.value=
"";var a=this.getComponentForSearch();if(a instanceof Ext.grid.GridPanel){var b=a.getStore();b.baseParams=b.baseParams||{};b.baseParams[this.paramName]="";b.baseParams[this.paramId]=this.nodeId||"";b.reload({params:{start:0}})}else if(a instanceof Ext.ux.tree.TreeGrid){this.el.dom.value="";b=a.getLoader();b.baseParams=b.baseParams||{};b.baseParams[this.paramName]="";a=a.getRootNode();b.load(a);a.expand()}this.triggers[0].hide();this.hasSearch=false}},onTrigger2Click:function(){var a=this.getRawValue(),
b=this.getComponentForSearch();if(b instanceof Ext.grid.GridPanel){var d=b.getStore();d.baseParams=d.baseParams||{};d.baseParams[this.paramName]=a;d.baseParams[this.paramId]=this.nodeId||"";d.reload({params:{start:0}})}else if(b instanceof Ext.ux.tree.TreeGrid){d=b.getLoader();d.baseParams=d.baseParams||{};d.baseParams[this.paramName]=a;b=b.getRootNode();d.load(b);b.expand()}if(a){this.hasSearch=true;this.triggers[0].show()}},clear:function(){this.onTrigger1Click()},search:function(){this.onTrigger2Click()}});
Ext.override(Ext.form.Field,{isEdit:true,isModified:false,updateLabel:function(){this.setFieldLabel(this.fieldLabel)},setFieldLabel:function(a){if(a!=undefined){if(this.rendered){var b=a+":";if(this.isModified)b='<span style="color:darkmagenta;">'+b+"</span>";var d=this.el.up(".x-form-item",10,true);d&&d.child(".x-form-item-label").update(b)}this.fieldLabel=a}},fireKey:function(a){if(a.isSpecialKey()){a.getKey()==a.ENTER&&this.onBlur();this.fireEvent("specialkey",this,a)}}});
Ext.app.TitlePanel=Ext.extend(Ext.Panel,{titleItems:null,addTitleItem:function(a){a=Ext.ComponentMgr.create(a);var b=Ext.DomHelper.append(this.header,{tag:"div",style:"float:right;margin-top:-4px;margin-left:3px;"},true);a.render(b)},onRender:function(){Ext.app.TitlePanel.superclass.onRender.apply(this,arguments);if(this.titleItems!=null){if(Ext.isArray(this.titleItems))for(var a=this.titleItems.length-1;a>=0;a--)this.addTitleItem(this.titleItems[a]);else this.addTitleItems(this.titleItems);this.header&&
this.header.removeClass("x-unselectable")}},getChildByName:function(a){if(this.items)for(var b=0;b<this.items.length;b++)if(this.items.items[b].name==a)return this.items.items[b];if(this.titleItems)for(b=0;b<this.titleItems.length;b++)if(this.titleItems[b].name==a)return this.titleItems[b];return null}});
function uiFailureResponseOnFormSubmit(a){if(a.action.failureType=="server"){obj=Ext.util.JSON.decode(a.action.response.responseText);Ext.Msg.show({title:a.title,msg:obj.error_msg,buttons:Ext.Msg.OK,icon:Ext.Msg.WARNING})}else Ext.Msg.alert(a.title,a.message)}
function uiAjaxFailMessage(a,b){if(Ext.isEmpty(a))Ext.Msg.alert(SOFTWARE_NAME,"\u0418\u0437\u0432\u0438\u043d\u0438\u0442\u0435, \u0441\u0435\u0440\u0432\u0435\u0440 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043d\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d.");else if(b.failureType==="server")b&&b.response&&b.response.responseText&&smart_eval(b.response.responseText);else{var d=Ext.getBody().getViewSize(),e=d.width<500?d.width-50:500;d=d.height<300?d.height-50:300;if(!a.responseText&&
b&&b.response)a=b.response;(new Ext.Window({modal:true,width:e,height:d,title:"Request Failure",layout:"fit",maximizable:true,maximized:true,listeners:{maximize:{fn:function(f){var g=Ext.getBody().getViewSize();f.setSize(g.width,g.height)},scope:this},resize:{fn:function(f){var g=Ext.getCmp("__ErrorMessageEditor");f=f.body.getViewSize();g.setSize(f.width,f.height-42)}}},items:new Ext.form.FormPanel({baseCls:"x-plain",layout:"absolute",defaultType:"label",items:[{x:5,y:5,html:'<div class="x-window-dlg"><div class="ext-mb-error" style="width:32px;height:32px"></div></div>'},
{x:42,y:6,html:"<b>Status Code: </b>"},{x:125,y:6,text:a.status},{x:42,y:25,html:"<b>Status Text: </b>"},{x:125,y:25,text:a.statusText},{x:0,y:42,id:"__ErrorMessageEditor",xtype:"htmleditor",value:a.responseText,readOnly:true,enableAlignments:false,enableColors:false,enableFont:false,enableFontSize:false,enableFormat:false,enableLinks:false,enableLists:false,enableSourceEdit:false,listeners:{push:{fn:function(){(function(f){try{for(var g=f.getElementsByTagName("script"),j=0;j<g.length;j++)g[j].innerText?
this.eval(g[j].innerText):this.eval(g[j].textContent);this.hideAll(this.getElementsByClassName(f,"table","vars"));this.hideAll(this.getElementsByClassName(f,"ol","pre-context"));this.hideAll(this.getElementsByClassName(f,"ol","post-context"));this.hideAll(this.getElementsByClassName(f,"div","pastebin"))}catch(k){}}).call(this.iframe.contentWindow,this.iframe.contentDocument)}}}}]})})).show()}}
function uiShowErrorMessage(a){obj=Ext.util.JSON.decode(a.responseText);obj.error_msg&&Ext.Msg.alert(SOFTWARE_NAME,obj.error_msg);return obj.success}function sendRequest(a,b,d){var e=new Ext.LoadMask(Ext.getBody());e.show();Ext.Ajax.request({params:d,url:a,method:"POST",success:function(f){try{smart_eval(f.responseText)}finally{e.hide()}},failure:function(){uiAjaxFailMessage.apply(this,arguments);e.hide()}})}
function thousandCurrencyRenderer(a){if(typeof a!="number"){var b=a;try{b=parseFloat(a.replace(/,+/,".").replace(/\s+/g,""))}catch(d){b=NaN}if(isNaN(b))return a;else a=b}b="";var e=a.toFixed(2).split(".");a=e[0];e=e[1];var f=0,g=0,j=a.length%3;if(j!=0){for(;g<j;g++)b+=a.charAt(g);b+=" "}for(;g<a.length;g++){if(f%3==0&&f!=0)b+=" ";b+=a.charAt(g);f++}if(e)b+=","+e;return b=b.replace(/\s,/,",")}function includeInArr(a,b){return a.indexOf(b)!=-1}
function showMessage(a,b,d){b=b||"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435";a=a||"";d=d||Ext.MessageBox.INFO;Ext.Msg.show({title:b,msg:a,buttons:Ext.Msg.OK,icon:d})}function showWarning(a,b){showMessage(a,b,Ext.MessageBox.WARNING)}Ext.m3.ComboBox=Ext.extend(Ext.form.ComboBox,{getText:function(){return this.lastSelectionText}});
Ext.m3.GridPanel=Ext.extend(Ext.grid.GridPanel,{constructor:function(a,b){var d=b.selModel,e=b.colModel||[];d&&d instanceof Ext.grid.CheckboxSelectionModel&&e.columns.unshift(d);var f;f=b.menus.contextMenu&&b.menus.contextMenu instanceof Ext.menu.Menu?function(l){l.stopEvent();b.menus.contextMenu.showAt(l.getXY())}:Ext.emptyFn;var g;g=b.menus.rowContextMenu&&b.menus.rowContextMenu instanceof Ext.menu.Menu?function(l,n,q){q.stopEvent();this.getSelectionModel().isSelected(n)||this.getSelectionModel().selectRow(n);
b.menus.rowContextMenu.showAt(q.getXY())}:Ext.emptyFn;var j=b.plugins||[],k=b.bundedColumns;k&&k instanceof Array&&k.length>0&&j.push(new Ext.ux.grid.ColumnHeaderGroup({rows:k}));a.listeners=Ext.applyIf({contextmenu:f,rowcontextmenu:g,beforerender:function(){var l=this.getBottomToolbar();if(l&&l instanceof Ext.PagingToolbar){var n=this.getStore();n.setBaseParam("start",0);n.setBaseParam("limit",l.pageSize);l.bind(n)}}},a.listeners||{});d=Ext.applyIf({sm:d,colModel:e,plugins:j},a);Ext.m3.GridPanel.superclass.constructor.call(this,
d)},initComponent:function(){Ext.m3.GridPanel.superclass.initComponent.call(this);this.getStore().on("exception",this.storeException,this)},storeException:function(a,b,d,e,f){uiAjaxFailMessage(f,e)}});
Ext.m3.EditorGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{constructor:function(a,b){var d=b.selModel,e=b.colModel||[];d&&d instanceof Ext.grid.CheckboxSelectionModel&&e.unshift(d);var f;f=b.menus.contextMenu&&b.menus.contextMenu instanceof Ext.menu.Menu?function(l){l.stopEvent();b.menus.contextMenu.showAt(l.getXY())}:Ext.emptyFn;var g;g=b.menus.rowContextMenu&&b.menus.contextMenu instanceof Ext.menu.Menu?function(l,n,q){q.stopEvent();this.getSelectionModel().selectRow(n);b.menus.rowContextMenu.showAt(q.getXY())}:
Ext.emptyFn;var j=b.plugins||[],k=b.bundedColumns;k&&k instanceof Array&&k.length>0&&j.push(new Ext.ux.grid.ColumnHeaderGroup({rows:k}));a.listeners=Ext.applyIf({contextmenu:f,rowcontextmenu:g,beforerender:function(){var l=this.getBottomToolbar();if(l&&l instanceof Ext.PagingToolbar){var n=this.getStore();n.setBaseParam("start",0);n.setBaseParam("limit",l.pageSize);l.bind(n)}}},a.listeners||{});d=Ext.applyIf({sm:d,colModel:e,plugins:j},a);Ext.m3.EditorGridPanel.superclass.constructor.call(this,d)},
initComponent:function(){Ext.m3.EditorGridPanel.superclass.initComponent.call(this);this.getStore().on("exception",this.storeException,this)},storeException:function(a,b,d,e,f){if(b=="remote"&&d!=Ext.data.Api.actions.read)f.raw.message&&Ext.Msg.show({title:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!",msg:f.raw.message,buttons:Ext.Msg.CANCEL,icon:Ext.Msg.WARNING});else uiAjaxFailMessage(f,e)}});
Ext.version=="3.0"&&Ext.override(Ext.grid.GridView,{ensureVisible:function(a,b,d){if((a=this.resolveCell(a,b,d))&&a.row){var e=a.row,f=a.cell;b=this.scroller.dom;var g=0,j=e,k=this.el.dom;j=e;for(k=this.el.dom;j&&j!=k;){g+=j.offsetTop;j=j.offsetParent}g-=this.mainHd.dom.offsetHeight;e=g+e.offsetHeight;j=b.clientHeight;k=parseInt(b.scrollTop,10);var l=k+j;if(g<k)b.scrollTop=g;else if(e>l)b.scrollTop=e-j;if(d!==false){d=parseInt(f.offsetLeft,10);f=d+f.offsetWidth;g=parseInt(b.scrollLeft,10);k=g+b.clientWidth;
if(d<g)b.scrollLeft=d;else if(f>k)b.scrollLeft=f-b.clientWidth}return this.getResolvedXY(a)}}});Ext.namespace("Ext.ux.maximgb.tg");
Ext.ux.maximgb.tg.AbstractTreeStore=Ext.extend(Ext.data.Store,{leaf_field_name:"_is_leaf",page_offset:0,active_node:null,constructor:function(a){Ext.ux.maximgb.tg.AbstractTreeStore.superclass.constructor.call(this,a);if(!this.paramNames.active_node)this.paramNames.active_node="anode";this.addEvents("beforeexpandnode","expandnode","expandnodefailed","beforecollapsenode","collapsenode","beforeactivenodechange","activenodechange")},remove:function(a){a===this.active_node&&this.setActiveNode(null);this.removeNodeDescendants(a);
Ext.ux.maximgb.tg.AbstractTreeStore.superclass.remove.call(this,a)},removeNodeDescendants:function(a){var b,d=this.getNodeChildren(a);a=0;for(b=d.length;a<b;a++)this.remove(d[a])},load:function(a){if(a)if(a.params){if(a.params[this.paramNames.active_node]===undefined)a.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null}else{a.params={};a.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null}else{a={params:{}};a.params[this.paramNames.active_node]=
this.active_node?this.active_node.id:null}if(a.params[this.paramNames.active_node]!==null)a.add=true;return Ext.ux.maximgb.tg.AbstractTreeStore.superclass.load.call(this,a)},loadRecords:function(a,b,d){if(!a||d===false){d!==false&&this.fireEvent("load",this,[],b);if(b.callback)b.callback.call(b.scope||this,[],b,false)}else{d=a.records;var e=a.totalRecords||d.length,f=this.getPageOffsetFromOptions(b);a=this.getLoadedNodeIdFromOptions(b);var g,j,k=this;if(!b||b.add!==true){if(this.pruneModifiedRecords)this.modified=
[];g=0;for(a=d.length;g<a;g++)d[g].join(this);if(this.snapshot){this.data=this.snapshot;delete this.snapshot}this.data.clear();this.data.addAll(d);this.page_offset=f;this.totalLength=e;this.applySort();this.fireEvent("datachanged",this)}else{if(a)g=this.getById(a);if(g){this.setNodeLoaded(g,true);this.setNodeChildrenOffset(g,f);this.setNodeChildrenTotalCount(g,Math.max(e,d.length));this.removeNodeDescendants(g)}this.suspendEvents();f={};g=0;for(a=d.length;g<a;g++){e=d[g];j=this.indexOfId(e.id);if(j==
-1){f[e.id]=false;this.add(e)}else{f[e.id]=true;j=this.getAt(j);j.reject();j.data=e.data;d[g]=j}}this.applySort();this.resumeEvents();d.sort(function(l,n){var q=k.data.indexOf(l),v=k.data.indexOf(n);return q>v?1:-1});g=0;for(a=d.length;g<a;g++){e=d[g];f[e.id]==true?this.fireEvent("update",this,e,Ext.data.Record.COMMIT):this.fireEvent("add",this,[e],this.data.indexOf(e))}}this.fireEvent("load",this,d,b);if(b.callback)b.callback.call(b.scope||this,d,b,true)}},sort:function(a,b){if(this.remoteSort){this.setActiveNode(null);
if(this.lastOptions){this.lastOptions.add=false;if(this.lastOptions.params)this.lastOptions.params[this.paramNames.active_node]=null}}return Ext.ux.maximgb.tg.AbstractTreeStore.superclass.sort.call(this,a,b)},applySort:function(){if(this.sortInfo&&!this.remoteSort){var a=this.sortInfo;this.sortData(a.field,a.direction)}else this.applyTreeSort()},sortData:function(a,b){b=b||"ASC";var d=this.fields.get(a).sortType,e=function(f,g){var j=d(f.data[a]),k=d(g.data[a]);return j>k?1:j<k?-1:0};this.data.sort(b,
e);this.snapshot&&this.snapshot!=this.data&&this.snapshot.sort(b,e);this.applyTreeSort()},applyTreeSort:function(){var a,b,d,e=[],f=this.getRootNodes();a=0;for(b=f.length;a<b;a++){d=f[a];e.push(d);this.collectNodeChildrenTreeSorted(e,d)}if(e.length>0){this.data.clear();this.data.addAll(e)}if(this.snapshot&&this.snapshot!==this.data){a=this.data;this.data=this.snapshot;this.snapshot=null;this.applyTreeSort();this.snapshot=this.data;this.data=a}},collectNodeChildrenTreeSorted:function(a,b){var d,e,
f,g=this.getNodeChildren(b);d=0;for(e=g.length;d<e;d++){f=g[d];a.push(f);this.collectNodeChildrenTreeSorted(a,f)}},getActiveNode:function(){return this.active_node},setActiveNode:function(a){if(this.active_node!==a)if(a)if(this.data.indexOf(a)!=-1){if(this.fireEvent("beforeactivenodechange",this,this.active_node,a)!==false){this.active_node=a;this.fireEvent("activenodechange",this,this.active_node,a)}}else throw"Given record is not from the store.";else if(this.fireEvent("beforeactivenodechange",
this,this.active_node,a)!==false){this.active_node=a;this.fireEvent("activenodechange",this,this.active_node,a)}},isExpandedNode:function(a){return a.ux_maximgb_tg_expanded===true},setNodeExpanded:function(a,b){a.ux_maximgb_tg_expanded=b},isVisibleNode:function(a){var b,d=this.getNodeAncestors(a),e=true;a=0;for(b=d.length;a<b;a++){e=e&&this.isExpandedNode(d[a]);if(!e)break}return e},isLeafNode:function(a){return a.get(this.leaf_field_name)==true},isLoadedNode:function(a){return a.ux_maximgb_tg_loaded!==
undefined?a.ux_maximgb_tg_loaded:this.isLeafNode(a)||this.hasChildNodes(a)?true:false},setNodeLoaded:function(a,b){a.ux_maximgb_tg_loaded=b},getNodeChildrenOffset:function(a){return a.ux_maximgb_tg_offset||0},setNodeChildrenOffset:function(a,b){a.ux_maximgb_tg_offset=b},getNodeChildrenTotalCount:function(a){return a.ux_maximgb_tg_total||0},setNodeChildrenTotalCount:function(a,b){a.ux_maximgb_tg_total=b},collapseNode:function(a){if(this.isExpandedNode(a)&&this.fireEvent("beforecollapsenode",this,a)!==
false){this.setNodeExpanded(a,false);this.fireEvent("collapsenode",this,a)}},expandNode:function(a){var b;if(!this.isExpandedNode(a)&&this.fireEvent("beforeexpandnode",this,a)!==false)if(this.isLoadedNode(a)){this.setNodeExpanded(a,true);this.fireEvent("expandnode",this,a)}else{b={};b[this.paramNames.active_node]=a.id;this.load({add:true,params:b,callback:this.expandNodeCallback,scope:this})}},expandNodeCallback:function(a,b,d){a=this.getById(b.params[this.paramNames.active_node]);if(d&&a){this.setNodeExpanded(a,
true);this.fireEvent("expandnode",this,a)}else this.fireEvent("expandnodefailed",this,b.params[this.paramNames.active_node],a)},expandAll:function(){var a,b,d,e=this.data.getRange();this.suspendEvents();b=0;for(d=e.length;b<d;b++){a=e[b];this.isExpandedNode(a)||this.expandNode(a)}this.resumeEvents();this.fireEvent("datachanged",this)},collapseAll:function(){var a,b,d,e=this.data.getRange();this.suspendEvents();b=0;for(d=e.length;b<d;b++){a=e[b];this.isExpandedNode(a)&&this.collapseNode(a)}this.resumeEvents();
this.fireEvent("datachanged",this)},getLoadedNodeIdFromOptions:function(a){var b=null;if(a&&a.params&&a.params[this.paramNames.active_node])b=a.params[this.paramNames.active_node];return b},getPageOffsetFromOptions:function(a){var b=0;if(a&&a.params&&a.params[this.paramNames.start]){b=parseInt(a.params[this.paramNames.start],10);if(isNaN(b))b=0}return b},hasNextSiblingNode:function(a){return this.getNodeNextSibling(a)!==null},hasPrevSiblingNode:function(a){return this.getNodePrevSibling(a)!==null},
hasChildNodes:function(a){return this.getNodeChildrenCount(a)>0},getNodeAncestors:function(a){var b=[];for(a=this.getNodeParent(a);a;){b.push(a);a=this.getNodeParent(a)}return b},getNodeChildrenCount:function(a){return this.getNodeChildren(a).length},getNodeNextSibling:function(a){var b,d=null;b=(b=this.getNodeParent(a))?this.getNodeChildren(b):this.getRootNodes();a=b.indexOf(a);if(a<b.length-1)d=b[a+1];return d},getNodePrevSibling:function(a){var b,d=null;b=(b=this.getNodeParent(a))?this.getNodeChildren(b):
this.getRootNodes();a=b.indexOf(a);if(a>0)d=b[a-1];return d},getRootNodes:function(){throw"Abstract method call";},getNodeDepth:function(){throw"Abstract method call";},getNodeParent:function(){throw"Abstract method call";},getNodeChildren:function(){throw"Abstract method call";},addToNode:function(){throw"Abstract method call";},removeFromNode:function(){throw"Abstract method call";},getPageOffset:function(){return this.page_offset},getActiveNodePageOffset:function(){return this.active_node?this.getNodeChildrenOffset(this.active_node):
this.getPageOffset()},getActiveNodeCount:function(){return this.active_node?this.getNodeChildrenCount(this.active_node):this.getRootNodes().length},getActiveNodeTotalCount:function(){return this.active_node?this.getNodeChildrenTotalCount(this.active_node):this.getTotalCount()}});
Ext.ux.maximgb.tg.AdjacencyListStore=Ext.extend(Ext.ux.maximgb.tg.AbstractTreeStore,{parent_id_field_name:"_parent",getRootNodes:function(){var a,b,d=[],e=this.data.getRange();a=0;for(b=e.length;a<b;a++)e[a].get(this.parent_id_field_name)==null&&d.push(e[a]);return d},getNodeDepth:function(a){return this.getNodeAncestors(a).length},getNodeParent:function(a){return this.getById(a.get(this.parent_id_field_name))},getNodeChildren:function(a){var b,d,e=[],f=this.data.getRange();b=0;for(d=f.length;b<d;b++)f[b].get(this.parent_id_field_name)==
a.id&&e.push(f[b]);return e},addToNode:function(a,b){b.set(this.parent_id_field_name,a.id);this.addSorted(b)},removeFromNode:function(a,b){this.remove(b)}});Ext.reg("Ext.ux.maximgb.tg.AdjacencyListStore",Ext.ux.maximgb.tg.AdjacencyListStore);
Ext.ux.maximgb.tg.NestedSetStore=Ext.extend(Ext.ux.maximgb.tg.AbstractTreeStore,{left_field_name:"_lft",right_field_name:"_rgt",level_field_name:"_level",root_node_level:1,getRootNodes:function(){var a,b,d=[],e=this.data.getRange();a=0;for(b=e.length;a<b;a++)e[a].get(this.level_field_name)==this.root_node_level&&d.push(e[a]);return d},getNodeDepth:function(a){return a.get(this.level_field_name)-this.root_node_level},getNodeParent:function(a){var b=null,d=this.data.getRange(),e,f,g,j,k,l,n,q;g=a.get(this.left_field_name);
k=a.get(this.right_field_name);n=a.get(this.level_field_name);e=0;for(f=d.length;e<f;e++){a=d[e];j=a.get(this.left_field_name);l=a.get(this.right_field_name);q=a.get(this.level_field_name);if(q==n-1&&j<g&&l>k){b=a;break}}return b},getNodeChildren:function(a){var b,d,e,f,g,j,k,l=[];j=this.data.getRange();b=a.get(this.left_field_name);d=a.get(this.right_field_name);f=a.get(this.level_field_name);i=0;for(len=j.length;i<len;i++){k=j[i];a=k.get(this.left_field_name);e=k.get(this.right_field_name);g=k.get(this.level_field_name);
g==f+1&&a>b&&e<d&&l.push(k)}return l}});
Ext.ux.maximgb.tg.GridView=Ext.extend(Ext.grid.GridView,{expanded_icon_class:"ux-maximgb-tg-elbow-minus",last_expanded_icon_class:"ux-maximgb-tg-elbow-end-minus",collapsed_icon_class:"ux-maximgb-tg-elbow-plus",last_collapsed_icon_class:"ux-maximgb-tg-elbow-end-plus",skip_width_update_class:"ux-maximgb-tg-skip-width-update",initTemplates:function(){var a=this.templates||{};if(!a.row)a.row=new Ext.Template('<div class="x-grid3-row ux-maximgb-tg-level-{level} {alt}" style="{tstyle} {display_style}">','<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',
"<tbody>","<tr>{cells}</tr>",this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':"","</tbody>","</table>","</div>");if(!a.mastercell)a.mastercell=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="ux-maximgb-tg-mastercell-wrap">',"{treeui}",'<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',
"</div>","</td>");if(!a.treeui)a.treeui=new Ext.Template('<div class="ux-maximgb-tg-uiwrap" style="width: {wrap_width}px">',"{elbow_line}",'<div style="left: {left}px" class="{cls}">&#160;</div>',"</div>");if(!a.elbow_line)a.elbow_line=new Ext.Template('<div style="left: {left}px" class="{cls}">&#160;</div>');this.templates=a;Ext.ux.maximgb.tg.GridView.superclass.initTemplates.call(this)},doRender:function(a,b,d,e,f,g){for(var j=this.templates,k=j.cell,l=j.row,n=f-1,q=[],v,G={},P={tstyle:"width:"+
this.getTotalWidth()+";"},R,y=0,H=b.length;y<H;y++){R=b[y];v=[];var J=y+e,Q=this.renderRow(R,J,f,d,this.cm.getTotalWidth());if(Q===false)for(Q=0;Q<f;Q++){k=a[Q];G.id=k.id;G.css=Q==0?"x-grid3-cell-first ":Q==n?"x-grid3-cell-last ":"";G.attr=G.cellAttr="";G.value=k.renderer.call(k.scope,R.data[k.name],G,R,J,Q,d);G.style=k.style;if(Ext.isEmpty(G.value))G.value="&#160;";if(this.markDirty&&R.dirty&&typeof R.modified[k.name]!=="undefined")G.css+=" x-grid3-dirty-cell";if(k.id==this.grid.master_column_id){G.treeui=
this.renderCellTreeUI(R,d);k=j.mastercell}else k=j.cell;v[v.length]=k.apply(G)}else v.push(Q);Q=[];if(g&&(J+1)%2==0)Q[0]="x-grid3-row-alt";if(R.dirty)Q[1]=" x-grid3-dirty-row";P.cols=f;if(this.getRowClass)Q[2]=this.getRowClass(R,J,P,d);P.alt=Q.join(" ");P.cells=v.join("");P.display_style=d.isVisibleNode(R)?"":"display: none;";P.level=d.getNodeDepth(R);q[q.length]=l.apply(P)}return q.join("")},renderCellTreeUI:function(a,b){var d=this.templates.treeui,e=this.templates.elbow_line,f={},g,j,k=level=b.getNodeDepth(a);
f.wrap_width=(k+1)*16;if(level>0){f.elbow_line="";g=a;for(left=0;level--;){if(j=b.getNodeParent(g))f.elbow_line=b.hasNextSiblingNode(j)?e.apply({left:level*16,cls:"ux-maximgb-tg-elbow-line"})+f.elbow_line:e.apply({left:level*16,cls:"ux-maximgb-tg-elbow-empty"})+f.elbow_line;else throw["Tree inconsistency can't get level ",level+1," node(id=",g.id,") parent."].join("");g=j}}if(b.isLeafNode(a))f.cls=b.hasNextSiblingNode(a)?"ux-maximgb-tg-elbow":"ux-maximgb-tg-elbow-end";else{f.cls="ux-maximgb-tg-elbow-active ";
f.cls+=b.isExpandedNode(a)?b.hasNextSiblingNode(a)?this.expanded_icon_class:this.last_expanded_icon_class:b.hasNextSiblingNode(a)?this.collapsed_icon_class:this.last_collapsed_icon_class}f.left=1+k*16;return d.apply(f)},renderRow:function(){return false},afterRender:function(){Ext.ux.maximgb.tg.GridView.superclass.afterRender.call(this);this.updateAllColumnWidths()},updateAllColumnWidths:function(){var a=this.getTotalWidth(),b=this.cm.getColumnCount(),d=[],e,f;for(f=0;f<b;f++)d[f]=this.getColumnWidth(f);
this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=a;this.mainBody.dom.style.width=a;for(f=0;f<b;f++)this.getHeaderCell(f).style.width=d[f];var g=this.getRows(),j;f=0;for(e=g.length;f<e;f++){j=g[f];j.style.width=a;if(j.firstChild){j.firstChild.style.width=a;j=j.firstChild.rows[0];for(var k=0;k<b&&k<j.childNodes.length;k++)if(!Ext.fly(j.childNodes[k]).hasClass(this.skip_width_update_class))j.childNodes[k].style.width=d[k]}}this.onAllColumnWidthsUpdated(d,
a)},updateColumnWidth:function(a){var b=this.getColumnWidth(a),d=this.getTotalWidth();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=d;this.mainBody.dom.style.width=d;this.getHeaderCell(a).style.width=b;for(var e=this.getRows(),f,g=0,j=e.length;g<j;g++){f=e[g];f.style.width=d;if(f.firstChild){f.firstChild.style.width=d;if(a<f.firstChild.rows[0].childNodes.length)if(!Ext.fly(f.firstChild.rows[0].childNodes[a]).hasClass(this.skip_width_update_class))f.firstChild.rows[0].childNodes[a].style.width=
b}}this.onColumnWidthUpdated(a,b,d)},updateColumnHidden:function(a,b){var d=this.getTotalWidth();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=d;this.mainBody.dom.style.width=d;var e=b?"none":"";this.getHeaderCell(a).style.display=e;for(var f=this.getRows(),g,j=0,k=f.length;j<k;j++){g=f[j];g.style.width=d;if(g.firstChild){g.firstChild.style.width=d;if(a<g.firstChild.rows[0].childNodes.length)if(!Ext.fly(g.firstChild.rows[0].childNodes[a]).hasClass(this.skip_width_update_class))g.firstChild.rows[0].childNodes[a].style.display=
e}}this.onColumnHiddenUpdated(a,b,d);delete this.lastViewWidth;this.layout()},processRows:function(a,b){var d=0;if(!(this.ds.getCount()<1)){b=!this.grid.stripeRows;var e=this.getRows();d=0;Ext.each(e,function(f,g){f.rowIndex=g;f.className=f.className.replace(this.rowClsRe," ");if(f.style.display!="none"){if(!b&&(d+1)%2===0)f.className+=" x-grid3-row-alt";d++}},this);Ext.fly(e[0]).addClass(this.firstRowCls);Ext.fly(e[e.length-1]).addClass(this.lastRowCls)}},ensureVisible:function(a,b,d){var e,f=this.ds.getAt(a);
if(!this.ds.isVisibleNode(f))for(e=this.ds.getNodeAncestors(f);e.length>0;){f=e.shift();this.ds.isExpandedNode(f)||this.ds.expandNode(f)}return Ext.ux.maximgb.tg.GridView.superclass.ensureVisible.call(this,a,b,d)},expandRow:function(a,b){var d=this.ds,e,f,g,j,k;if(typeof a=="number"){e=a;a=d.getAt(e)}else e=d.indexOf(a);b=b||false;g=this.getRow(e);if(e=Ext.fly(g).child(".ux-maximgb-tg-elbow-active"))if(d.hasNextSiblingNode(a)){e.removeClass(this.collapsed_icon_class);e.removeClass(this.last_collapsed_icon_class);
e.addClass(this.expanded_icon_class)}else{e.removeClass(this.collapsed_icon_class);e.removeClass(this.last_collapsed_icon_class);e.addClass(this.last_expanded_icon_class)}if(d.isVisibleNode(a)){j=d.getNodeChildren(a);e=0;for(f=j.length;e<f;e++){k=d.indexOf(j[e]);g=this.getRow(k);g.style.display="block";d.isExpandedNode(j[e])&&this.expandRow(k,true)}}b||this.processRows(0)},collapseRow:function(a,b){var d=this.ds,e,f,g,j,k;if(typeof a=="number"){e=a;a=d.getAt(e)}else e=d.indexOf(a);b=b||false;j=this.getRow(e);
if(pmel=Ext.fly(j).child(".ux-maximgb-tg-elbow-active"))if(d.hasNextSiblingNode(a)){pmel.removeClass(this.expanded_icon_class);pmel.removeClass(this.last_expanded_icon_class);pmel.addClass(this.collapsed_icon_class)}else{pmel.removeClass(this.expanded_icon_class);pmel.removeClass(this.last_expanded_icon_class);pmel.addClass(this.last_collapsed_icon_class)}g=d.getNodeChildren(a);e=0;for(f=g.length;e<f;e++){k=d.indexOf(g[e]);j=this.getRow(k);if(j.style.display!="none"){j.style.display="none";this.collapseRow(k,
true)}}b||this.processRows(0)},initData:function(a,b){Ext.ux.maximgb.tg.GridView.superclass.initData.call(this,a,b);if(this.ds){this.ds.un("expandnode",this.onStoreExpandNode,this);this.ds.un("collapsenode",this.onStoreCollapseNode,this)}if(a){a.on("expandnode",this.onStoreExpandNode,this);a.on("collapsenode",this.onStoreCollapseNode,this)}},onLoad:function(a,b,d){if(d&&d.params&&(d.params[a.paramNames.active_node]===null||a.indexOfId(d.params[a.paramNames.active_node])==-1))Ext.ux.maximgb.tg.GridView.superclass.onLoad.call(this,
a,b,d)},onAdd:function(a,b,d){Ext.ux.maximgb.tg.GridView.superclass.onAdd.call(this,a,b,d);this.mainWrap&&this.processRows(0)},onRemove:function(a,b,d,e){Ext.ux.maximgb.tg.GridView.superclass.onRemove.call(this,a,b,d,e);e!==true&&this.mainWrap&&this.processRows(0)},onUpdate:function(a,b){Ext.ux.maximgb.tg.GridView.superclass.onUpdate.call(this,a,b);this.mainWrap&&this.processRows(0)},onStoreExpandNode:function(a,b){this.expandRow(b)},onStoreCollapseNode:function(a,b){this.collapseRow(b)}});
Ext.ux.maximgb.tg.GridPanel=Ext.extend(Ext.m3.GridPanel,{master_column_id:0,tg_cls:"ux-maximgb-tg-panel",initComponent:function(){this.initComponentPreOverride();Ext.ux.maximgb.tg.GridPanel.superclass.initComponent.call(this);this.getSelectionModel().on("selectionchange",this.onTreeGridSelectionChange,this);this.initComponentPostOverride()},initComponentPreOverride:Ext.emptyFn,initComponentPostOverride:Ext.emptyFn,onRender:function(a,b){Ext.ux.maximgb.tg.GridPanel.superclass.onRender.call(this,a,
b);this.el.addClass(this.tg_cls)},getView:function(){if(!this.view)this.view=new Ext.ux.maximgb.tg.GridView(this.viewConfig);return this.view},onClick:function(a){var b=a.getTarget(),d=this.getView().findRowIndex(b),e=this.getStore();this.getSelectionModel();var f=true;if(d!==false)if(Ext.fly(b).hasClass("ux-maximgb-tg-elbow-active")){b=e.getAt(d);e.isExpandedNode(b)?e.collapseNode(b):e.expandNode(b);f=false}f&&Ext.ux.maximgb.tg.GridPanel.superclass.onClick.call(this,a)},onMouseDown:function(a){var b=
a.getTarget();Ext.fly(b).hasClass("ux-maximgb-tg-elbow-active")||Ext.ux.maximgb.tg.GridPanel.superclass.onMouseDown.call(this,a)},onTreeGridSelectionChange:function(a,b){var d,e=this.getStore();if(a.getSelected){d=a.getSelected();e.setActiveNode(d)}else if(a.getSelectedCell&&b){d=b.record;e.setActiveNode(d)}if(d)if(!e.isVisibleNode(d))for(d=e.getNodeAncestors(d);d.length>0;)e.expandNode(d.pop())}});
Ext.ux.maximgb.tg.EditorGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{master_column_id:0,initComponent:function(){this.initComponentPreOverride();Ext.ux.maximgb.tg.EditorGridPanel.superclass.initComponent.call(this);this.getSelectionModel().on("selectionchange",this.onTreeGridSelectionChange,this);this.initComponentPostOverride()},initComponentPreOverride:Ext.emptyFn,initComponentPostOverride:Ext.emptyFn,onRender:function(a,b){Ext.ux.maximgb.tg.EditorGridPanel.superclass.onRender.call(this,a,b);
this.el.addClass("ux-maximgb-tg-panel")},getView:function(){if(!this.view)this.view=new Ext.ux.maximgb.tg.GridView(this.viewConfig);return this.view},onClick:function(a){var b=a.getTarget(),d=this.getView().findRowIndex(b),e=this.getStore();this.getSelectionModel();var f=true;if(d!==false)if(Ext.fly(b).hasClass("ux-maximgb-tg-elbow-active")){b=e.getAt(d);e.isExpandedNode(b)?e.collapseNode(b):e.expandNode(b);f=false}f&&Ext.ux.maximgb.tg.EditorGridPanel.superclass.onClick.call(this,a)},onMouseDown:function(a){var b=
a.getTarget();Ext.fly(b).hasClass("ux-maximgb-tg-elbow-active")||Ext.ux.maximgb.tg.EditorGridPanel.superclass.onMouseDown.call(this,a)},onTreeGridSelectionChange:function(a,b){var d,e=this.getStore();if(a.getSelected){d=a.getSelected();e.setActiveNode(d)}else if(a.getSelectedCell&&b){d=b.record;e.setActiveNode(d)}if(d)if(!e.isVisibleNode(d))for(d=e.getNodeAncestors(d);d.length>0;)e.expandNode(d.pop())}});
Ext.ux.maximgb.tg.PagingToolbar=Ext.extend(Ext.PagingToolbar,{onRender:function(a,b){Ext.ux.maximgb.tg.PagingToolbar.superclass.onRender.call(this,a,b);this.updateUI()},getPageData:function(){var a=0,b=0;if(this.store){b=this.store.getActiveNodePageOffset();a=this.store.getActiveNodeTotalCount()}return{total:a,activePage:Math.ceil((b+this.pageSize)/this.pageSize),pages:a<this.pageSize?1:Math.ceil(a/this.pageSize)}},updateInfo:function(){var a=0,b=0,d=0;if(this.displayItem){if(this.store){b=this.store.getActiveNodePageOffset();
a=this.store.getActiveNodeCount();d=this.store.getActiveNodeTotalCount()}a=a==0?this.emptyMsg:String.format(this.displayMsg,b+1,b+a,d);this.displayItem.setText(a)}},updateUI:function(){var a=this.getPageData(),b=a.activePage,d=a.pages;this.afterTextItem.setText(String.format(this.afterPageText,a.pages));this.inputItem.setValue(b);this.first.setDisabled(b==1);this.prev.setDisabled(b==1);this.next.setDisabled(b==d);this.last.setDisabled(b==d);this.refresh.enable();this.updateInfo()},bindStore:function(a,
b){!b&&this.store&&this.store.un("activenodechange",this.onStoreActiveNodeChange,this);a&&a.on("activenodechange",this.onStoreActiveNodeChange,this);Ext.ux.maximgb.tg.PagingToolbar.superclass.bindStore.call(this,a,b)},beforeLoad:function(a,b){var d=this.getParams();Ext.ux.maximgb.tg.PagingToolbar.superclass.beforeLoad.call(this,a,b);if(b&&b.params){if(b.params[d.start]===undefined)b.params[d.start]=0;if(b.params[d.limit]===undefined)b.params[d.limit]=this.pageSize}},moveFirst:function(){this.doLoad(0)},
movePrevious:function(){var a=this.store;a=a?a.getActiveNodePageOffset():0;this.doLoad(Math.max(0,a-this.pageSize))},moveNext:function(){var a=this.store;this.doLoad((a?a.getActiveNodePageOffset():0)+this.pageSize)},moveLast:function(){var a=this.store;a&&a.getActiveNodePageOffset();a=a?a.getActiveNodeTotalCount():0;var b=a%this.pageSize;this.doLoad(b?a-b:a-this.pageSize)},onStoreActiveNodeChange:function(){this.rendered&&this.updateUI()}});Ext.reg("Ext.ux.maximgb.tg.GridPanel",Ext.ux.maximgb.tg.GridPanel);
Ext.reg("Ext.ux.maximgb.tg.EditorGridPanel",Ext.ux.maximgb.tg.EditorGridPanel);Ext.reg("Ext.ux.maximgb.tg.PagingToolbar",Ext.ux.maximgb.tg.PagingToolbar);
Ext.m3.Window=Ext.extend(Ext.Window,{constructor:function(a,b){this.actionContextJson=this.parentWindow=null;if(b&&b.parentWindowID)this.parentWindow=Ext.getCmp(b.parentWindowID);if(b&&b.helpTopic)this.m3HelpTopic=b.helpTopic;if(b&&b.contextJson)this.actionContextJson=b.contextJson;Ext.m3.Window.superclass.constructor.call(this,a)},initTools:function(){if(this.m3HelpTopic){var a=this.m3HelpTopic;this.addTool({id:"help",handler:function(){showHelpWindow(a)}})}Ext.m3.Window.superclass.initTools.call(this)}});
Ext.m3.AdvancedTreeGrid=Ext.extend(Ext.ux.maximgb.tg.GridPanel,{constructor:function(a,b){assert(b.storeParams.url,"\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043e \u0437\u0430\u0434\u0430\u043d\u043e url. \t\t\turl="+b.storeParams.url);var d=b.columnsToRecord||[];d.push({name:"_id",type:"int"},{name:"_level",type:"int"},{name:"_lft",type:"int"},{name:"_rgt",type:"int"},{name:"_is_leaf",type:"bool"},{name:"_parent",type:"int"});d=new Ext.ux.maximgb.tg.AdjacencyListStore({autoLoad:true,
url:b.storeParams.url,reader:new Ext.data.JsonReader({id:"_id",root:b.storeParams.root,totalProperty:"total",successProperty:"success"},Ext.data.Record.create(d))});var e;if(b.bbar)e=new Ext.ux.maximgb.tg.PagingToolbar({store:d,displayInfo:true,pageSize:b.bbar.pageSize});e=Ext.applyIf({store:d,bbar:e},a);Ext.m3.AdvancedTreeGrid.superclass.constructor.call(this,e,b)}});
Ext.m3.AddrField=Ext.extend(Ext.Container,{constructor:function(a,b){var d=b.items||[],e=new Ext.data.JsonStore({url:b.kladr_url,idProperty:"code",root:"rows",totalProperty:"total",fields:[{name:"code"},{name:"display_name"},{name:"socr"},{name:"zipcode"},{name:"gni"},{name:"uno"},{name:"okato"},{name:"addr_name"}]});if(b.place_record!=""&&b.place_record!=undefined){var f=Ext.util.JSON.decode(b.place_record);e.loadData({total:1,rows:[f]})}var g=b.read_only?"m3-grey-field":"";this.place=new Ext.form.ComboBox({name:b.place_field_name,
fieldLabel:b.place_label,allowBlank:b.place_allow_blank,readOnly:b.read_only,cls:g,hideTrigger:true,minChars:2,emptyText:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0430\u0441\u0435\u043b\u0435\u043d\u043d\u044b\u0439 \u043f\u0443\u043d\u043a\u0442...",queryParam:"filter",store:e,resizable:true,displayField:"display_name",valueField:"code",mode:"remote",hiddenName:b.place_field_name,valueNotFoundText:"",invalidClass:b.invalid_class});this.place.setValue(b.place_value);this.zipcode=new Ext.form.TextField({name:b.zipcode_field_name,
value:b.zipcode_value,emptyText:"\u0438\u043d\u0434\u0435\u043a\u0441",readOnly:b.read_only,cls:g,width:55,maskRe:/[0-9]/});if(b.level>1){e=new Ext.data.JsonStore({url:b.street_url,idProperty:"code",root:"rows",totalProperty:"total",fields:[{name:"code"},{name:"display_name"},{name:"socr"},{name:"zipcode"},{name:"gni"},{name:"uno"},{name:"okato"},{name:"name"}]});if(b.street_record!=""&&b.street_record!=undefined){f=Ext.util.JSON.decode(b.street_record);e.loadData({total:1,rows:[f]})}this.street=
new Ext.form.ComboBox({name:b.street_field_name,fieldLabel:b.street_label,allowBlank:b.street_allow_blank,readOnly:b.read_only,cls:g,hideTrigger:true,minChars:2,emptyText:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0443\u043b\u0438\u0446\u0443...",queryParam:"filter",store:e,resizable:true,displayField:"display_name",valueField:"code",mode:"remote",hiddenName:b.street_field_name,valueNotFoundText:"",invalidClass:b.invalid_class});this.street.setValue(b.street_value);if(b.level>2){this.house=new Ext.form.TextField({name:b.house_field_name,
allowBlank:b.house_allow_blank,readOnly:b.read_only,cls:g,fieldLabel:b.house_label,value:b.house_value,emptyText:"",width:40,invalidClass:b.invalid_class});if(b.level>3)this.flat=new Ext.form.TextField({name:b.flat_field_name,fieldLabel:b.flat_label,value:b.flat_value,allowBlank:b.flat_allow_blank,readOnly:b.read_only,cls:g,emptyText:"",width:40,invalidClass:b.invalid_class})}}if(b.addr_visible)this.addr=new Ext.form.TextArea({name:b.addr_field_name,anchor:"100%",fieldLabel:b.addr_label,value:b.addr_value,
readOnly:true,cls:g,height:36});if(b.view_mode==1){this.place.flex=1;f=b.level>2?[this.place,this.zipcode]:[this.place];if(b.level>1){this.street.flex=1;this.street.fieldLabel=b.place_label;f.push({xtype:"label",style:{padding:"3px"},text:b.street_label+":"},this.street);if(b.level>2){this.house.fieldLabel=b.place_label;f.push({xtype:"label",style:{padding:"3px"},text:b.house_label+":"},this.house);if(b.level>3){this.flat.fieldLabel=b.place_label;f.push({xtype:"label",style:{padding:"3px"},text:b.flat_label+
":"},this.flat)}}}f={xtype:"compositefield",anchor:"100%",fieldLabel:b.place_label,items:f,invalidClass:b.invalid_composite_field_class};d.push(f);b.addr_visible&&d.push(this.addr)}if(b.view_mode==2){if(b.level>2){this.place.flex=1;f={xtype:"compositefield",anchor:"100%",fieldLabel:b.place_label,items:[this.place,this.zipcode],invalidClass:b.invalid_composite_field_class};d.push(f)}else{this.place.anchor="100%";d.push(this.place)}if(b.level>1){this.street.flex=1;f=[this.street];if(b.level>2){this.house.fieldLabel=
b.street_label;f.push({xtype:"label",style:{padding:"3px"},text:b.house_label+":"},this.house);if(b.level>3){this.flat.fieldLabel=b.street_label;f.push({xtype:"label",style:{padding:"3px"},text:b.flat_label+":"},this.flat)}}f={xtype:"compositefield",anchor:"100%",fieldLabel:b.street_label,items:f,invalidClass:b.invalid_composite_field_class};d.push(f)}b.addr_visible&&d.push(this.addr)}if(b.view_mode==3){if(b.level>2){this.place.flex=1;f={xtype:"compositefield",anchor:"100%",fieldLabel:b.place_label,
items:[this.place,this.zipcode],invalidClass:b.invalid_composite_field_class};d.push(f)}else{this.place.anchor="100%";d.push(this.place)}if(b.level>1){this.street.anchor="100%";d.push(this.street);if(b.level>2){f=[{xtype:"container",layout:"form",items:this.house,style:{overflow:"hidden"}}];b.level>3&&f.push({xtype:"container",layout:"form",style:{padding:"0px 0px 0px 5px",overflow:"hidden"},items:this.flat});f=new Ext.Container({anchor:"100%",layout:"column",items:f,style:{overflow:"hidden"}});d.push(f)}}b.addr_visible&&
d.push(this.addr)}d=Ext.applyIf({items:d,get_addr_url:b.get_addr_url,level:b.level,addr_visible:b.addr_visible,style:{overflow:"hidden"}},a);Ext.Container.superclass.constructor.call(this,d)},beforeStreetQuery:function(){this.street.getStore().baseParams.place_code=this.place.value},clearStreet:function(){this.street.setValue("")},afterRenderAddr:function(){this.addr_visible&&this.addr.getEl().on("dblclick",this.onDblClickAddr,this)},initComponent:function(){Ext.m3.AddrField.superclass.initComponent.call(this);
this.mon(this.place,"change",this.onChangePlace,this);if(this.level>1){this.mon(this.street,"change",this.onChangeStreet,this);if(this.level>2){this.mon(this.house,"change",this.onChangeHouse,this);this.mon(this.zipcode,"change",this.onChangeZipcode,this);this.level>3&&this.mon(this.flat,"change",this.onChangeFlat,this)}}this.mon(this.place,"beforequery",this.beforePlaceQuery,this);this.level>1&&this.mon(this.street,"beforequery",this.beforeStreetQuery,this);this.addr_visible&&this.addr.on("afterrender",
this.afterRenderAddr,this);this.addEvents("change","change_place","change_street","change_house","change_flat","change_zipcode","before_query_place")},getNewAddr:function(){var a;if(this.place!=undefined)a=this.place.getValue();var b;if(this.street!=undefined)b=this.street.getValue();var d;if(this.house!=undefined)d=this.house.getValue();var e;if(this.flat!=undefined)e=this.flat.getValue();var f;if(this.zipcode!=undefined)f=this.zipcode.getValue();var g=null;a=this.place.getStore().data.get(a);if(a!=
undefined)g=a.data;a=null;b=this.street.getStore().data.get(b);if(b!=undefined)a=b.data;d=this.generateTextAddr(g,a,d,e,f);this.addr!=undefined&&this.addr.setValue(d)},generateTextAddr:function(a,b,d,e,f){var g="";g=b!=undefined?a.addr_name+", "+b.socr+" "+b.name:a.addr_name;if(f!="")g=f+", "+g;if(d!=""&&d!=undefined)g=g+", \u0434. "+d;if(e!=""&&e!=undefined)g=g+", \u043a. "+e;return g},setNewAddr:function(a){if(this.addr!=undefined)this.addr.value=a},onChangePlace:function(){var a=this.place.getValue(),
b=this.place.getStore().data.get(a);if(b!=undefined){b=b.data;b.zipcode&&this.zipcode.setValue(b.zipcode)}else this.place.setValue("");this.clearStreet();this.fireEvent("change_place",this,a,b);this.addr_visible&&this.getNewAddr()},onChangeStreet:function(){var a=this.street.getValue(),b=this.street.getStore().data.get(a);if(b!=undefined){b=b.data;b.zipcode&&this.zipcode.setValue(b.zipcode)}else this.clearStreet();this.fireEvent("change_street",this,a,b);this.addr_visible&&this.getNewAddr()},onChangeHouse:function(){this.fireEvent("change_house",
this,this.house.getValue());this.addr_visible&&this.getNewAddr()},onChangeFlat:function(){this.fireEvent("change_flat",this,this.flat.getValue());this.addr_visible&&this.getNewAddr()},onChangeZipcode:function(){this.fireEvent("change_zipcode",this,this.zipcode.getValue());this.addr_visible&&this.getNewAddr()},beforePlaceQuery:function(a){this.fireEvent("before_query_place",this,a)},onDblClickAddr:function(){this.addr_visible&&this.addr.setReadOnly(false)}});
Ext.m3.AdvancedComboBox=Ext.extend(Ext.m3.ComboBox,{constructor:function(a,b){this.askBeforeDeleting=true;this.actionContextJson=this.actionEditUrl=this.actionSelectUrl=null;this.hideBaseTrigger=false;this.defaultText=this.defaultValue=null;this.hideTriggerClear=b.hideClearTrigger||false;this.hideTriggerDropDown=false;this.hideTriggerDictSelect=b.hideDictSelectTrigger||false;this.hideTriggerDictEdit=true;if(!b.hideEditTrigger)this.hideTriggerDictEdit=b.hideEditTrigger;this.defaultLimit=50;this.triggerClearClass=
"x-form-clear-trigger";this.triggerSelectClass="x-form-select-trigger";this.triggerEditClass="x-form-edit-trigger";assert(b.actions,"params.actions is undefined");if(b.actions.actionSelectUrl)this.actionSelectUrl=b.actions.actionSelectUrl;if(b.actions.actionEditUrl)this.actionEditUrl=b.actions.actionEditUrl;this.askBeforeDeleting=b.askBeforeDeleting;this.actionContextJson=b.actions.contextJson;this.hideBaseTrigger=false;if(a.hideTrigger){delete a.hideTrigger;this.hideBaseTrigger=true}this.defaultValue=
b.defaultValue;this.defaultText=b.defaultText;this.baseTriggers=[{iconCls:"x-form-clear-trigger",handler:null,hide:null},{iconCls:"",handler:null,hide:null},{iconCls:"x-form-select-trigger",handler:null,hide:null},{iconCls:"x-form-edit-trigger",handler:null,hide:true}];this.allTriggers=[].concat(this.baseTriggers);b.customTriggers&&Ext.each(b.customTriggers,function(d){this.allTriggers.push(d)},this);Ext.m3.AdvancedComboBox.superclass.constructor.call(this,a)},initComponent:function(){Ext.m3.AdvancedComboBox.superclass.initComponent.call(this);
this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",cn:[]};Ext.each(this.allTriggers,function(a){this.triggerConfig.cn.push({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+a.iconCls})},this);if(!this.actionSelectUrl)this.hideTriggerDictSelect=true;if(!this.actionEditUrl)this.hideTriggerDictEdit=true;if(this.hideBaseTrigger)this.hideTriggerDropDown=true;this.defaultValue&&this.defaultText&&this.addRecordToStore(this.defaultValue,this.defaultText);this.initBaseTrigger();this.addEvents("beforerequest",
"afterselect","changed");this.getStore().baseParams=Ext.applyIf({start:0,limit:this.defaultLimit},this.getStore().baseParams)},getTrigger:function(a){return this.triggers[a]},initTrigger:function(){var a=this.trigger.select(".x-form-trigger",true),b=this;a.each(function(d,e,f){var g="Trigger"+(f+1);d.hide=function(){var j=b.wrap.getWidth();this.dom.style.display="none";b.el.setWidth(j-b.trigger.getWidth());this["hidden"+g]=true};d.show=function(){var j=b.wrap.getWidth();this.dom.style.display="";
b.el.setWidth(j-b.trigger.getWidth());this["hidden"+g]=false};if(this.allTriggers[f].hide){d.dom.style.display="none";this["hidden"+g]=true}if(this.disabled)this.mun(d,"click",this.allTriggers[f].handler,this,{preventDefault:true});else{this.mon(d,"click",this.allTriggers[f].handler,this,{preventDefault:true});d.addClassOnOver("x-form-trigger-over");d.addClassOnClick("x-form-trigger-click")}},this);this.triggers=a.elements},initBaseTrigger:function(){this.baseTriggers[0].handler=this.onTriggerClearClick;
this.baseTriggers[1].handler=this.onTriggerDropDownClick;this.baseTriggers[2].handler=this.onTriggerDictSelectClick;this.baseTriggers[3].handler=this.onTriggerDictEditClick;this.baseTriggers[0].hide=this.hideTriggerClear;this.baseTriggers[1].hide=this.hideTriggerDropDown;this.baseTriggers[2].hide=this.hideTriggerDictSelect;this.baseTriggers[3].hide=this.hideTriggerDictEdit;if(!this.getValue()){this.baseTriggers[0].hide=true;this.baseTriggers[3].hide=true}},getTriggerWidth:function(){var a=0;Ext.each(this.triggers,
function(b,d){var e="Trigger"+(d+1),f=b.getWidth();a+=f===0&&!this["hidden"+e]?this.defaultTriggerWidth:f},this);return a},onDestroy:function(){Ext.destroy(this.triggers);Ext.destroy(this.allTriggers);Ext.destroy(this.baseTriggers);Ext.m3.AdvancedComboBox.superclass.onDestroy.call(this)},onTriggerDropDownClick:function(){if(this.fireEvent("beforerequest",this)){if(this.isExpanded())this.collapse();else{this.getStore().load();this.onFocus({});this.doQuery(this.allQuery,true)}this.el.focus()}},onTriggerDictSelectClick:function(){this.onSelectInDictionary()},
onTriggerClearClick:function(){if(this.askBeforeDeleting){var a=this;Ext.Msg.show({title:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435",msg:"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435?",icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,
fn:function(b){b=="yes"&&a.clearValue()}})}else this.clearValue()},onTriggerDictEditClick:function(){this.onEditBtn()},onSelect:function(a,b){if(this.fireEvent("afterselect",this,a.data[this.valueField],a.data[this.displayField])){Ext.m3.AdvancedComboBox.superclass.onSelect.call(this,a,b);this.showClearBtn();this.showEditBtn();this.fireEvent("change",this,a.data[this.valueField||this.displayField]);this.fireEvent("changed",this)}},showClearBtn:function(){if(!this.hideTriggerClear){this.el.parent().setOverflow("hidden");
this.getTrigger(0).show()}},hideClearBtn:function(){this.el.parent().setOverflow("auto");this.getTrigger(0).hide()},showEditBtn:function(){if(this.actionEditUrl&&!this.hideTriggerDictEdit&&this.getValue()){this.el.parent().setOverflow("hidden");this.getTrigger(3).show()}},hideEditBtn:function(){if(this.actionEditUrl){this.el.parent().setOverflow("auto");this.getTrigger(3).hide()}},clearValue:function(){var a=this.getValue();Ext.m3.AdvancedComboBox.superclass.clearValue.call(this);this.hideClearBtn();
this.hideEditBtn();this.fireEvent("change",this,"",a);this.fireEvent("changed",this)},setValue:function(a){Ext.m3.AdvancedComboBox.superclass.setValue.call(this,a);if(a)if(this.rendered){this.showClearBtn();this.showEditBtn()}else this.hideTrigger4=this.hideTrigger1=true},onSelectInDictionary:function(){assert(this.actionSelectUrl,"actionSelectUrl is undefined");if(this.fireEvent("beforerequest",this)){var a=this;Ext.Ajax.request({url:this.actionSelectUrl,method:"POST",params:this.actionContextJson,
success:function(b){(b=smart_eval(b.responseText))&&b.on("closed_ok",function(d,e){a.fireEvent("afterselect",a,d,e)&&a.addRecordToStore(d,e)})},failure:function(){uiAjaxFailMessage.apply(this,arguments)}})}},addRecordToStore:function(a,b){var d=new Ext.data.Record;d.id=a;d[this.displayField]=b;this.getStore().loadData({total:1,rows:[d]});d=this.getValue();this.setValue(a);this.collapse();this.fireEvent("change",this,a,d);this.fireEvent("changed",this)},onEditBtn:function(){assert(this.actionEditUrl,
"actionEditUrl is undefined");var a=this.getValue();assert(a,"Value not selected but edit window called");Ext.Ajax.request({url:this.actionEditUrl,method:"POST",params:Ext.applyIf({id:a},this.actionContextJson),success:function(b){smart_eval(b.responseText)},failure:function(){uiAjaxFailMessage()}})},triggerBlur:function(){this.focusClass&&this.el.removeClass(this.focusClass);this.wrap&&this.wrap.removeClass(this.wrapFocusClass);!this.getValue()&&this.lastQuery&&this.setRawValue("");this.validate()}});
Ext.reg("m3-select",Ext.m3.AdvancedComboBox);
Ext.m3.AdvancedDataField=Ext.extend(Ext.form.DateField,{constructor:function(a,b){this.baseTriggers=[{iconCls:"x-form-date-trigger",handler:null,hide:null},{iconCls:"x-form-current-date-trigger",handler:null,hide:null}];this.hideTriggerToday=false;if(b.hideTriggerToday)this.hideTriggerToday=true;Ext.m3.AdvancedDataField.superclass.constructor.call(this,a)},initComponent:function(){Ext.m3.AdvancedDataField.superclass.initComponent.call(this);this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",
cn:[]};Ext.each(this.baseTriggers,function(a){this.triggerConfig.cn.push({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+a.iconCls})},this);this.initBaseTrigger()},initTrigger:function(){var a=this.trigger.select(".x-form-trigger",true),b=this;a.each(function(d,e,f){var g="Trigger"+(f+1);d.hide=function(){var j=b.wrap.getWidth();this.dom.style.display="none";b.el.setWidth(j-b.trigger.getWidth());this["hidden"+g]=true};d.show=function(){var j=b.wrap.getWidth();this.dom.style.display="";b.el.setWidth(j-
b.trigger.getWidth());this["hidden"+g]=false};if(this.baseTriggers[f].hide){d.dom.style.display="none";this["hidden"+g]=true}this.mon(d,"click",this.baseTriggers[f].handler,this,{preventDefault:true});d.addClassOnOver("x-form-trigger-over");d.addClassOnClick("x-form-trigger-click")},this);this.triggers=a.elements},initBaseTrigger:function(){this.baseTriggers[0].handler=this.onTriggerClick;this.baseTriggers[1].handler=function(){var a=new Date;this.setValue(a);this.fireEvent("select",this,a)};this.baseTriggers[1].hide=
this.hideTriggerToday}});Ext.reg("m3-date",Ext.m3.AdvancedDataField);Ext.ns("Ext.m3.CodeEditorConfig");Ext.apply(Ext.m3.CodeEditorConfig,{parser:{python:{mode:{name:"python",version:2,singleLineStringErrors:false}},css:{mode:"css"},html:{mode:"text/html",tabMode:"indent"},javascript:{mode:{name:"javascript",json:true}},sql:{lineNumbers:true,matchBrackets:true,indentUnit:4,mode:"text/x-plsql"}}});
Ext.m3.CodeEditor=Ext.extend(Ext.Panel,{sourceCode:"/*Default code*/ ",readOnly:false,theme:"default",constructor:function(a){Ext.m3.CodeEditor.superclass.constructor.call(this,a)},initComponent:function(){this.contentChanged=false;Ext.apply(this,{items:[{xtype:"textarea",readOnly:this.readOnly,hidden:true,value:this.sourceCode,enableKeyEvents:true}]});this.addEvents("editorkeyevent","editorfocus");Ext.m3.CodeEditor.superclass.initComponent.apply(this,arguments)},onRender:function(){Ext.m3.CodeEditor.superclass.onRender.apply(this,
arguments);this.oldSourceCode=this.sourceCode;this.on("afterlayout",this.triggerCodeEditor,this,{single:true})},fireKeyEvent:function(a,b){this.fireEvent("editorkeyevent",a,b)},fireFocusEvent:function(){this.fireEvent("editorfocus")},contentChange:function(){var a=this.getTextArea(),b=this.codeMirrorEditor.getValue();a.setValue(b);this.oldSourceCode==b?this.setTitleClass(true):this.setTitleClass();this.fireEvent("contentchanged",this)},triggerCodeEditor:function(){var a=this.getTextArea(),b=Ext.applyIf(this.codeMirrorEditor||
{},{height:"100%",width:"100%",theme:this.theme,lineNumbers:true,indentUnit:4,tabMode:"shift",matchBrackets:true,textWrapping:false,content:a.getValue(),readOnly:a.readOnly,autoMatchParens:true,onKeyEvent:this.fireKeyEvent.createDelegate(this),onChange:this.contentChange.createDelegate(this),onFocus:this.fireFocusEvent.createDelegate(this)});b=Ext.applyIf(b,Ext.m3.CodeEditorConfig.parser[this.parser||"python"]);this.codeMirrorEditor=new CodeMirror.fromTextArea(Ext.getDom(a.id),b)},setTitleClass:function(a){this.contentChanged=
a!==true},getTextArea:function(){return this.findByType("textarea")[0]}});Ext.reg("uxCodeEditor",Ext.m3.CodeEditor);
Ext.m3.EditWindow=Ext.extend(Ext.m3.Window,{constructor:function(a,b){this.dataUrl=this.formUrl=this.formId=null;this.changesCount=0;this.originalTitle=null;if(b){if(b.form){if(b.form.id)this.formId=b.form.id;if(b.form.url)this.formUrl=b.form.url}if(b.dataUrl)this.dataUrl=b.dataUrl}Ext.m3.EditWindow.superclass.constructor.call(this,a,b)},initComponent:function(){Ext.m3.EditWindow.superclass.initComponent.call(this);this.items.each(function(a){this.setFieldOnChange(a,this)},this);this.addEvents("beforesubmit",
"closing_canceled","beforeloaddata","dataloaded")},getForm:function(){assert(this.formId,"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d formId \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u044b");return Ext.getCmp(this.formId).getForm()},getInvalidNames:function(a){var b=[];a.items.each(function(d){d.validate()||b.push("<br>- "+d.fieldLabel)});return b},submitForm:function(a,b,d){assert(this.formUrl,"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d url \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u044b");
if(a=Ext.getCmp(this.formId).getForm()){invalidNames=this.getInvalidNames(a);if(invalidNames.length){Ext.Msg.show({title:"\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0444\u043e\u0440\u043c\u044b",msg:"\u041d\u0430 \u0444\u043e\u0440\u043c\u0435 \u0438\u043c\u0435\u044e\u0442\u0441\u044f \u043d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435 \u043f\u043e\u043b\u044f:"+invalidNames.toString()+".",buttons:Ext.Msg.OK,
icon:Ext.Msg.WARNING});return}}var e=this,f=new Ext.LoadMask(this.body,{msg:"\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435..."}),g=Ext.applyIf(d||{},this.actionContextJson||{});d=a.el.dom.elements||(document.forms[a.el.dom]||Ext.getDom(a.el.dom)).elements;Ext.each(d,function(j){name=j.name;!j.disabled&&name&&delete g[name]});d={url:this.formUrl,submitEmptyText:false,params:g,success:function(j,k){e.fireEvent("closed_ok",k.response.responseText);e.close(true);try{smart_eval(k.response.responseText)}finally{f.hide();
e.disableToolbars(false)}},failure:function(){uiAjaxFailMessage.apply(e,arguments);f.hide();e.disableToolbars(false)}};if(e.fireEvent("beforesubmit",d)){this.disableToolbars(true);f.show();a.submit(d)}},onChangeFieldValue:function(a,b,d,e){if(a.originalValue!==b){a.isModified||e.changesCount++;a.isModified=true}else{a.isModified&&e.changesCount--;a.isModified=false}e.updateTitle();a.updateLabel()},setFieldOnChange:function(a,b){if(a){a instanceof Ext.form.Field&&a.isEdit&&a.on("change",function(e,
f,g){b.onChangeFieldValue(e,f,g,b)});if(a.items)if(a.items instanceof Array)for(var d=0;d<a.items.length;d++)b.setFieldOnChange(a.items[d],b);else a.items.each(function(e){b.setFieldOnChange(e,b)});if(a.titleItems)for(d=0;d<a.titleItems.length;d++)b.setFieldOnChange(a.titleItems[d],b)}},updateTitle:function(){if(this.title!==this.originalTitle&&this.originalTitle===null)this.originalTitle=this.title;this.changesCount!==0?this.setTitle("*"+this.originalTitle):this.setTitle(this.originalTitle)},close:function(a){if(this.changesCount!==
0&&!a){var b=this;Ext.Msg.show({title:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435",msg:"\u0414\u0430\u043d\u043d\u044b\u0435 \u0431\u044b\u043b\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u044b! C\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f?",buttons:Ext.Msg.YESNOCANCEL,fn:function(d){if(d==="yes")this.submitForm();else d==="no"?Ext.m3.EditWindow.superclass.close.call(b):b.fireEvent("closing_canceled")},animEl:"elId",icon:Ext.MessageBox.QUESTION,
scope:this})}else Ext.m3.EditWindow.superclass.close.call(this)},disableToolbars:function(a){for(var b=[this.getTopToolbar(),this.getFooterToolbar(),this.getBottomToolbar()],d=0;d<b.length;d++)b[d]&&b[d].setDisabled(a)},loadForm:function(){assert(this.dataUrl,"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d dataUrl \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u044b");var a=this.getForm(),b=new Ext.LoadMask(this.body,{msg:"\u0427\u0442\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445..."}),
d={url:this.dataUrl,params:Ext.applyIf({isGetData:true},this.actionContextJson||{}),success:function(e,f){b.hide();this.disableToolbars(false);this.fireEvent("dataloaded",f)},failure:function(){uiAjaxFailMessage.apply(this,arguments);b.hide();this.disableToolbars(false)},scope:this};this.disableToolbars(true);b.show();this.fireEvent("beforeloaddata",d)&&a.doAction("load",d)}});Ext.ns("Ext.ux.grid");
Ext.ux.grid.Exporter=Ext.extend(Ext.util.Observable,{title:"",sendDatFromStore:true,constructor:function(){Ext.ux.grid.Exporter.superclass.constructor.call(this)},init:function(a){if(a instanceof Ext.grid.GridPanel){this.grid=a;this.grid.on("afterrender",this.onRender,this)}this.dataUrl=this.grid.dataUrl},onRender:function(){if(!this.grid.tbar){this.grid.elements+=",tbar";tbar=new Ext.Toolbar;this.grid.tbar=tbar;this.grid.add(tbar);this.grid.doLayout()}this.grid.tbar.insert(0,new Ext.Button({text:"\u042d\u043a\u0441\u043f\u043e\u0440\u0442",
iconCls:"icon-application-go",listeners:{scope:this,click:this.exportData}}))},exportData:function(){columns=[];Ext.each(this.grid.colModel.config,function(a){columns.push({data_index:a.dataIndex,header:a.header,id:a.id,is_column:a.isCoumn,sortable:a.sortable,width:a.width})});data=[];this.sendDatFromStore&&Ext.each(this.grid.store.data.items,function(a){data.push(a.data)});params={columns:Ext.encode(columns),title:this.title||this.grid.title||this.grid.id,data:Ext.encode(data)};Ext.Ajax.request({url:"/ui/exportgrid-export",
success:function(a){location.href=a.responseText},failure:function(){},params:params})}});Ext.m3.HelpWindow=Ext.extend(Ext.Window,{constructor:function(a){this.title="\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f";this.minimizable=this.maximizable=this.maximized=true;this.width=800;this.height=550;Ext.m3.HelpWindow.superclass.constructor.call(this,a)}});function showHelpWindow(a){window.open(a)}Ext.ns("Ext.m3");
Ext.m3.MultiSelectField=Ext.extend(Ext.m3.AdvancedComboBox,{delimeter:",",initComponent:function(){this.checkedItems=[];this.hideTriggerDictEdit=true;this.editable=false;this._isClearHidden=true;if(!this.tpl){this.tpl='<tpl for="."><div class="x-combo-list-item x-multi-combo-item"><img src="'+Ext.BLANK_IMAGE_URL+'" class="{[this.getImgClass(values)]}" /><div>{'+this.displayField+"}</div></div></tpl>";this.tpl=new Ext.XTemplate(this.tpl,{getImgClass:this.getCheckboxCls.createDelegate(this)})}Ext.m3.MultiSelectField.superclass.initComponent.apply(this)},
setValue:function(a){if(a){this.value=this.getValue();this.setRawValue(this.getText());if(this.hiddenField)this.hiddenField.value=this.value;this.el&&this.el.removeClass(this.emptyClass);this.toggleClearButton()}},getValue:function(){var a=[];Ext.each(this.checkedItems,function(b){a.push(b.get(this.valueField))},this);return Ext.util.JSON.encode(a)},initValue:function(){var a=0,b,d,e;if(this.store&&this.value&&this.mode==="local"){b=Ext.util.JSON.decode(this.value);this.store.each(function(f){Ext.each(b,
function(g){if(f.get(this.valueField)==g){this.checkedItems.push(f);return false}},this)},this)}else if(this.value)for(b=Ext.util.JSON.decode(this.value);a<b.length;a++){d=b[a];if(!(typeof d!=="object"||!(d[this.displayField]&&d[this.valueField]))){e=new Ext.data.Record;e.data.id=d[this.valueField];e.data[this.displayField]=d[this.displayField];this.checkedItems.push(e)}}Ext.m3.MultiSelectField.superclass.initValue.call(this)},getText:function(){var a=[];Ext.each(this.checkedItems,function(b){a.push(b.get(this.displayField))},
this);return a.join(this.delimeter+" ")},getCheckboxCls:function(a){for(var b=0;b<this.checkedItems.length;b++)if(a[this.valueField]==this.checkedItems[b].data[this.valueField])return"x-grid3-check-col-on";return"x-grid3-check-col"},getCheckedRecords:function(){return this.checkedItems},onSelect:function(a,b){var d;d=this.findCheckedRecord(a);if(this.fireEvent("beforeselect",this,a,b)!==false){d===-1?this.checkedItems.push(a):this.checkedItems.remove(this.checkedItems[d]);this.refreshItem(a);this.setValue(this.getValue());
this.fireEvent("select",this,this.checkedItems)}},refreshItem:function(a){this.view&&this.view.refreshNode(this.store.indexOf(a))},onSelectInDictionary:function(){this.fireEvent("beforerequest",this)&&Ext.Ajax.request({url:this.actionSelectUrl,method:"POST",params:this.actionContextJson,success:function(a){if(a=smart_eval(a.responseText)){a.initMultiSelect(this.checkedItems);a.on("closed_ok",function(b){this.addRecordsToStore(b);this.fireEvent("select",this,this.checkedItems)},this)}},failure:function(){window.uiAjaxFailMessage.apply(this,
arguments)},scope:this})},clearValue:function(){this.checkedItems=[];this.hideClearBtn();this.setValue(this.getValue())},addRecordsToStore:function(a){for(var b=0,d=[],e;b<a.length;b++){e=new Ext.data.Record;e.data.id=a[b].data.id;e.data[this.displayField]=a[b].data[this.displayField];d.push(e)}this.checkedItems=d;this.setValue(this.getValue())},findCheckedRecord:function(a){for(var b=0,d=-1;b<this.checkedItems.length;b++)if(this.checkedItems[b].data[this.valueField]===a.data[this.valueField]){d=
b;break}return d},toggleClearButton:function(){this.hideClearTrigger||(this._isClearHidden?this.showClearBtn():this.hideClearBtn())},showClearBtn:function(){if(!this.hideTriggerClear){this.el.parent().setOverflow("hidden");this.getTrigger(0).show();this._isClearHidden=false}},hideClearBtn:function(){this.el.parent().setOverflow("auto");this.getTrigger(0).hide();this._isClearHidden=true}});Ext.reg("m3-multiselect",Ext.m3.MultiSelectField);
Ext.m3.ObjectGrid=Ext.extend(Ext.m3.GridPanel,{constructor:function(a,b){assert(b.allowPaging!==undefined,"allowPaging is undefined");assert(b.rowIdName!==undefined,"rowIdName is undefined");assert(b.actions!==undefined,"actions is undefined");this.allowPaging=b.allowPaging;this.rowIdName=b.rowIdName;this.columnParamName=b.columnParamName;this.actionNewUrl=b.actions.newUrl;this.actionEditUrl=b.actions.editUrl;this.actionDeleteUrl=b.actions.deleteUrl;this.actionDataUrl=b.actions.dataUrl;this.actionContextJson=
b.actions.contextJson;Ext.m3.ObjectGrid.superclass.constructor.call(this,a,b)},initComponent:function(){Ext.m3.ObjectGrid.superclass.initComponent.call(this);var a=this.getStore();a.baseParams=Ext.applyIf(a.baseParams||{},this.actionContextJson||{});this.addEvents("beforenewrequest","afternewrequest","beforeeditrequest","aftereditrequest","beforedeleterequest","afterdeleterequest")},onNewRecord:function(){assert(this.actionNewUrl,"actionNewUrl is not define");var a=new Ext.LoadMask(this.body),b={url:this.actionNewUrl,
params:this.actionContextJson||{},success:function(e,f){if(d.fireEvent("afternewrequest",d,e,f)){try{var g=d.childWindowOpenHandler(e,f)}finally{a.hide();d.disableToolbars(false)}return g}a.hide();d.disableToolbars(false)},failure:function(){uiAjaxFailMessage.apply(this,arguments);a.hide();d.disableToolbars(false)}};if(this.fireEvent("beforenewrequest",this,b)){var d=this;this.disableToolbars(true);a.show();Ext.Ajax.request(b)}},onEditRecord:function(){assert(this.actionEditUrl,"actionEditUrl is not define");
assert(this.rowIdName,"rowIdName is not define");if(this.getSelectionModel().hasSelection()){var a={},b=this.getSelectionModel();if(b instanceof Ext.grid.RowSelectionModel)if(b.singleSelect)a[this.rowIdName]=b.getSelected().id;else{b=b.getSelections();for(var d=[],e=0,f=b.length;e<f;e++)d.push(b[e].id);a[this.rowIdName]=d.join()}else if(b instanceof Ext.grid.CellSelectionModel){assert(this.columnParamName,"columnParamName is not define");if(b=b.getSelectedCell()){d=this.getStore().getAt(b[0]);a[this.rowIdName]=
d.id;a[this.columnParamName]=this.getColumnModel().getDataIndex(b[1])}}var g=new Ext.LoadMask(this.body);a={url:this.actionEditUrl,params:Ext.applyIf(a,this.actionContextJson||{}),success:function(k,l){if(j.fireEvent("aftereditrequest",j,k,l)){try{var n=j.childWindowOpenHandler(k,l)}finally{g.hide();j.disableToolbars(false)}return n}g.hide();j.disableToolbars(false)},failure:function(){uiAjaxFailMessage.apply(this,arguments);g.hide();j.disableToolbars(false)}};if(this.fireEvent("beforeeditrequest",
this,a)){var j=this;this.disableToolbars(true);g.show();Ext.Ajax.request(a)}}},onDeleteRecord:function(){assert(this.actionDeleteUrl,"actionDeleteUrl is not define");assert(this.rowIdName,"rowIdName is not define");var a=this;a.getSelectionModel().hasSelection()&&Ext.Msg.show({title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438",msg:"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c?",
icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,fn:function(b){if(b=="yes"){b={};var d=a.getSelectionModel();if(d instanceof Ext.grid.RowSelectionModel)if(d.singleSelect)b[a.rowIdName]=d.getSelected().id;else{d=d.getSelections();for(var e=[],f=0,g=d.length;f<g;f++)e.push(d[f].id);b[a.rowIdName]=e.join()}else if(d instanceof Ext.grid.CellSelectionModel){assert(a.columnParamName,"columnParamName is not define");if(d=d.getSelectedCell()){e=a.getStore().getAt(d[0]);b[a.rowIdName]=e.id;b[a.columnParamName]=
a.getColumnModel().getDataIndex(d[1])}}var j=new Ext.LoadMask(a.body);b={url:a.actionDeleteUrl,params:Ext.applyIf(b,a.actionContextJson||{}),success:function(k,l){if(a.fireEvent("afterdeleterequest",a,k,l)){try{var n=a.deleteOkHandler(k,l)}finally{j.hide();a.disableToolbars(false)}return n}j.hide();a.disableToolbars(false)},failure:function(){uiAjaxFailMessage.apply(this,arguments);j.hide();a.disableToolbars(false)}};if(a.fireEvent("beforedeleterequest",a,b)){a.disableToolbars(true);j.show();Ext.Ajax.request(b)}}}})},
childWindowOpenHandler:function(a){if(a=smart_eval(a.responseText)){var b=this;a.on("closed_ok",function(){return b.refreshStore()})}},deleteOkHandler:function(a){smart_eval(a.responseText);this.refreshStore()},refreshStore:function(){if(this.allowPaging){var a=this.getBottomToolbar();a&&a instanceof Ext.PagingToolbar&&a.changePage(Math.ceil((a.cursor+a.pageSize)/a.pageSize))}else this.getStore().load()},disableToolbars:function(a){for(var b=[this.getTopToolbar(),this.getFooterToolbar(),this.getBottomToolbar()],
d=0;d<b.length;d++)b[d]&&b[d].setDisabled(a)}});
Ext.m3.EditorObjectGrid=Ext.extend(Ext.m3.EditorGridPanel,{constructor:function(a,b){assert(b.allowPaging!==undefined,"allowPaging is undefined");assert(b.rowIdName!==undefined,"rowIdName is undefined");assert(b.actions!==undefined,"actions is undefined");this.allowPaging=b.allowPaging;this.rowIdName=b.rowIdName;this.columnParamName=b.columnParamName;this.actionNewUrl=b.actions.newUrl;this.actionEditUrl=b.actions.editUrl;this.actionDeleteUrl=b.actions.deleteUrl;this.actionDataUrl=b.actions.dataUrl;
this.actionContextJson=b.actions.contextJson;Ext.m3.EditorObjectGrid.superclass.constructor.call(this,a,b)},initComponent:function(){Ext.m3.EditorObjectGrid.superclass.initComponent.call(this);var a=this.getStore();a.baseParams=Ext.applyIf(a.baseParams||{},this.actionContextJson||{});this.addEvents("beforenewrequest","afternewrequest","beforeeditrequest","aftereditrequest","beforedeleterequest","afterdeleterequest")},onNewRecord:function(){assert(this.actionNewUrl,"actionNewUrl is not define");var a=
{url:this.actionNewUrl,params:this.actionContextJson||{},success:function(d,e){if(b.fireEvent("afternewrequest",b,d,e))return b.childWindowOpenHandler(d,e)},failure:Ext.emptyFn};if(this.fireEvent("beforenewrequest",this,a)){var b=this;Ext.Ajax.request(a)}},onEditRecord:function(){assert(this.actionEditUrl,"actionEditUrl is not define");assert(this.rowIdName,"rowIdName is not define");if(this.getSelectionModel().hasSelection()){var a={},b=this.getSelectionModel();if(b instanceof Ext.grid.RowSelectionModel)if(b.singleSelect)a[this.rowIdName]=
b.getSelected().id;else{b=b.getSelections();for(var d=[],e=0,f=b.length;e<f;e++)d.push(b[e].id);a[this.rowIdName]=d}else if(b instanceof Ext.grid.CellSelectionModel){assert(this.columnParamName,"columnParamName is not define");if(b=b.getSelectedCell()){d=this.getStore().getAt(b[0]);a[this.rowIdName]=d.id;a[this.columnParamName]=this.getColumnModel().getDataIndex(b[1])}}a={url:this.actionEditUrl,params:Ext.applyIf(a,this.actionContextJson||{}),success:function(j,k){if(g.fireEvent("aftereditrequest",
g,j,k))return g.childWindowOpenHandler(j,k)},failure:Ext.emptyFn};if(this.fireEvent("beforeeditrequest",this,a)){var g=this;Ext.Ajax.request(a)}}},onDeleteRecord:function(){assert(this.actionDeleteUrl,"actionDeleteUrl is not define");assert(this.rowIdName,"rowIdName is not define");var a=this;a.getSelectionModel().hasSelection()&&Ext.Msg.show({title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438",msg:"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c?",
icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,fn:function(b){if(b=="yes"){b={};var d=a.getSelectionModel();if(d instanceof Ext.grid.RowSelectionModel)if(d.singleSelect)b[a.rowIdName]=d.getSelected().id;else{d=d.getSelections();for(var e=[],f=0,g=d.length;f<g;f++)e.push(d[f].id);b[a.rowIdName]=e}else if(d instanceof Ext.grid.CellSelectionModel){assert(a.columnParamName,"columnParamName is not define");if(d=d.getSelectedCell()){e=a.getStore().getAt(d[0]);b[a.rowIdName]=e.id;b[a.columnParamName]=a.getColumnModel().getDataIndex(d[1])}}b=
{url:a.actionDeleteUrl,params:Ext.applyIf(b,a.actionContextJson||{}),success:function(j,k){if(a.fireEvent("afterdeleterequest",a,j,k))return a.deleteOkHandler(j,k)},failure:Ext.emptyFn};a.fireEvent("beforedeleterequest",a,b)&&Ext.Ajax.request(b)}}})},childWindowOpenHandler:function(a){if(a=smart_eval(a.responseText)){var b=this;a.on("closed_ok",function(){return b.refreshStore()})}},deleteOkHandler:function(a){smart_eval(a.responseText);this.refreshStore()},refreshStore:function(){if(this.allowPaging){var a=
this.getBottomToolbar();a&&a instanceof Ext.PagingToolbar&&a.changePage(Math.ceil((a.cursor+a.pageSize)/a.pageSize))}else this.getStore().load()}});
Ext.m3.ObjectTree=Ext.extend(Ext.m3.AdvancedTreeGrid,{constructor:function(a,b){assert(b.allowPaging!==undefined,"allowPaging is undefined");assert(b.rowIdName!==undefined,"rowIdName is undefined");assert(b.actions!==undefined,"actions is undefined");this.allowPaging=b.allowPaging;this.rowIdName=b.rowIdName;this.actionNewUrl=b.actions.newUrl;this.actionEditUrl=b.actions.editUrl;this.actionDeleteUrl=b.actions.deleteUrl;this.actionDataUrl=b.actions.dataUrl;this.actionContextJson=b.actions.contextJson;
Ext.m3.ObjectTree.superclass.constructor.call(this,a,b)},initComponent:function(){Ext.m3.AdvancedTreeGrid.superclass.initComponent.call(this);var a=this.getStore();a.baseParams=Ext.applyIf(a.baseParams||{},this.actionContextJson||{})},onNewRecord:function(){assert(this.actionNewUrl,"actionNewUrl is not define");var a=this;Ext.Ajax.request({url:this.actionNewUrl,params:this.actionContextJson||{},success:function(b,d){return a.childWindowOpenHandler(b,d)},failure:Ext.emptyFn})},onNewRecordChild:function(){assert(this.actionNewUrl,
"actionNewUrl is not define");if(this.getSelectionModel().getSelected()){var a={};a[this.rowIdName]=this.getSelectionModel().getSelected().get("_parent");var b=this;Ext.Ajax.request({url:this.actionNewUrl,params:Ext.applyIf(a,this.actionContextJson||{}),success:function(d,e){return b.childWindowOpenHandler(d,e)},failure:Ext.emptyFn})}else Ext.Msg.show({title:"\u041d\u043e\u0432\u044b\u0439",msg:"\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d",buttons:Ext.Msg.OK,
icon:Ext.MessageBox.INFO})},onEditRecord:function(){assert(this.actionEditUrl,"actionEditUrl is not define");assert(this.rowIdName,"rowIdName is not define");if(this.getSelectionModel().hasSelection()){var a={};a[this.rowIdName]=this.getSelectionModel().getSelected().id;var b=this;Ext.Ajax.request({url:this.actionEditUrl,params:Ext.applyIf(a,this.actionContextJson||{}),success:function(d,e){return b.childWindowOpenHandler(d,e)},failure:Ext.emptyFn})}},onDeleteRecord:function(){assert(this.actionDeleteUrl,
"actionDeleteUrl is not define");assert(this.rowIdName,"rowIdName is not define");var a=this;Ext.Msg.show({title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438",msg:"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c?",icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,
fn:function(b){if(b=="yes")if(a.getSelectionModel().hasSelection()){b={};b[a.rowIdName]=a.getSelectionModel().getSelected().id;Ext.Ajax.request({url:a.actionDeleteUrl,params:Ext.applyIf(b,a.actionContextJson||{}),success:function(d,e){return a.deleteOkHandler(d,e)},failure:Ext.emptyFn})}}})},childWindowOpenHandler:function(a){if(a=smart_eval(a.responseText)){var b=this;a.on("closed_ok",function(){return b.refreshStore()})}},deleteOkHandler:function(a){smart_eval(a.responseText);this.refreshStore()},
refreshStore:function(){if(this.allowPaging){var a=this.getBottomToolbar();a&&a instanceof Ext.PagingToolbar&&a.changePage(Math.ceil((a.cursor+a.pageSize)/a.pageSize))}else this.getStore().load()}});Ext.namespace("Ext.ux");
Ext.ux.OnDemandLoad=function(){loadComponent=function(a,b){var d=a.substring(a.lastIndexOf(".")),e=document.getElementsByTagName("head")[0],f=false;if(d===".js"){var g=document.createElement("script");g.setAttribute("type","text/javascript");g.setAttribute("src",a);g.onload=g.onreadystatechange=function(){if(!f){f=true;typeof b=="function"&&b();e.removeChild(g)}}}else if(d===".css"){g=document.createElement("link");g.setAttribute("type","text/css");g.setAttribute("rel","stylesheet");g.setAttribute("href",
a)}typeof g!="undefined"&&e.appendChild(g)};return{load:function(a,b){loadComponent(a,b)}}}();
var CodeMirror=function(){function a(p,t){if(p.indexOf)return p.indexOf(t);for(var K=0,z=p.length;K<z;++K)if(p[K]==t)return K;return-1}function b(p){return p.replace(/[<>&]/g,function(t){return t=="&"?"&amp;":t=="<"?"&lt;":"&gt;"})}function d(p,t){return p.line<t.line||p.line==t.line&&p.ch<t.ch}function e(p,t){return p.line==t.line&&p.ch==t.ch}function f(p,t){for(var K=p.ownerDocument.body,z=0,O=0,aa=false,S=p;S;S=S.offsetParent){z+=S.offsetLeft;O+=S.offsetTop;S==K&&(aa=true)}K=t&&aa?null:K;for(S=
p.parentNode;S!=K;S=S.parentNode)S.scrollLeft!=null&&(z-=S.scrollLeft,O-=S.scrollTop);return{left:z,top:O}}function g(p,t){t==null&&(t=p.search(/[^\s\u00a0]/),t==-1&&(t=p.length));for(var K=0,z=0;K<t;++K)p.charAt(K)=="\t"?z+=ga-z%ga:++z;return z}function j(){this.id=null}function k(p,t,K,z){function O(aa){K(new l(aa||window.event))}if(typeof p.addEventListener=="function"){p.addEventListener(t,O,false);if(z)return function(){p.removeEventListener(t,O,false)}}else{p.attachEvent("on"+t,O);if(z)return function(){p.detachEvent("on"+
t,O)}}}function l(p){this.e=p}function n(p){p.stop||(p.stop=q);return p}function q(){this.preventDefault?(this.preventDefault(),this.stopPropagation()):(this.returnValue=false,this.cancelBubble=true)}function v(){this.time=0;this.done=[];this.undone=[]}function G(p,t,K,z){for(var O=0,aa=0,S=0;aa<t;O+=2){var ja=K[O],x=aa+ja.length;S==0?(x>p&&z.push(ja.slice(p-aa,Math.min(ja.length,t-aa)),K[O+1]),x>=p&&(S=1)):S==1&&(x>t?z.push(ja.slice(0,t-aa),K[O+1]):z.push(ja,K[O+1]));aa=x}}function P(p,t){this.styles=
t||[p,null];this.stateAfter=null;this.text=p;this.marked=this.gutterMarker=this.className=null}function R(p){this.pos=this.start=0;this.string=p}function y(p,t,K){return p.startState?p.startState(t,K):true}function H(p,t){if(t===true)return t;if(p.copyState)return p.copyState(t);var K={},z;for(z in t){var O=t[z];O instanceof Array&&(O=O.concat([]));K[z]=O}return K}function J(p,t){function K(h,m,o){this.atOccurrence=false;o==null&&(o=typeof h=="string"&&h==h.toLowerCase());m&&typeof m=="object"?m=
oa(m):m={line:0,ch:0};this.pos={from:m,to:m};if(typeof h!="string")this.matches=function(F,C){if(F)for(var E=N[C.line].text.slice(0,C.ch),I=E.match(h),D=0;I;){var W=E.indexOf(I[0]);D+=W;E=E.slice(W+1);if(W=E.match(h))I=W;else break;D++}else{E=N[C.line].text.slice(C.ch);D=(I=E.match(h))&&C.ch+E.indexOf(I[0])}if(I)return{from:{line:C.line,ch:D},to:{line:C.line,ch:D+I[0].length},match:I}};else{o&&(h=h.toLowerCase());var s=o?function(F){return F.toLowerCase()}:function(F){return F},w=h.split("\n");w.length==
1?this.matches=function(F,C){var E=s(N[C.line].text),I=h.length,D;if(F?C.ch>=I&&(D=E.lastIndexOf(h,C.ch-I))!=-1:(D=E.indexOf(h,C.ch))!=-1)return{from:{line:C.line,ch:D},to:{line:C.line,ch:D+I}}}:this.matches=function(F,C){var E=C.line,I=F?w.length-1:0,D=w[I],W=s(N[E].text),ea=F?W.indexOf(D)+D.length:W.lastIndexOf(D);if(!(F?ea>=C.ch||ea!=D.length:ea<=C.ch||ea!=W.length-D.length))for(;;){if(F?!E:E==N.length-1)break;W=s(N[E+=F?-1:1].text);D=w[F?--I:++I];if(I>0&&I<w.length-1){if(W!=D)break}else{I=F?W.lastIndexOf(D):
W.indexOf(D)+D.length;if(F?I!=W.length-D.length:I!=D.length)break;D={line:C.line,ch:ea};E={line:E,ch:I};return{from:F?E:D,to:F?D:E}}}}}}function z(h){return function(){Gb++||aa();try{var m=h.apply(this,arguments)}finally{--Gb||O()}return m}}function O(){var h=false;La&&(h=!Hb());wa.length?jb(wa):La&&Ib();h&&Hb();La&&Z();!kb&&(Ea===true||Ea!==false&&La)&&lb();La&&ba.matchBrackets&&setTimeout(z(function(){mb&&(mb(),mb=null);X(false)}),20);h=vb;La&&ba.onCursorActivity&&ba.onCursorActivity(xa);h&&ba.onChange&&
xa&&ba.onChange(xa,h)}function aa(){Ea=null;wa=[];vb=La=false}function S(h){!Fa.length||$b.set(h,z(ja))}function ja(){for(var h=+new Date+ba.workTime,m=Fa.length;Fa.length;){var o=N[ra].stateAfter?Fa.pop():ra;if(!(o>=N.length)){var s=U(o),w=s&&N[s-1].stateAfter;w?w=H(ta,w):w=y(ta);var F=0,C=ta.compareStates;s=s;for(var E=N.length;s<E;++s){var I=N[s],D=I.stateAfter;if(+new Date>h){Fa.push(s);S(ba.workDelay);wa.push({from:o,to:s});return}var W=I.highlight(ta,w);I.stateAfter=H(ta,w);if(C){if(D&&C(D,
w))break}else if(W||!D)F=0;else if(++F>3)break}wa.push({from:o,to:s})}}m&&ba.onHighlightComplete&&ba.onHighlightComplete(xa)}function x(h){var m=U(h),o=m&&N[m-1].stateAfter;o?o=H(ta,o):o=y(ta);for(m=m;m<h;++m){var s=N[m];s.highlight(ta,o);s.stateAfter=H(ta,o)}N[h].stateAfter||Fa.push(h);return o}function U(h){var m,o,s=h;for(h=h-40;s>h;--s){if(s==0)return 0;var w=N[s-1];if(w.stateAfter)return s;w=w.indentation();if(o==null||m>w){o=s;m=w}}return o}function X(h){function m(sa,cb,Oa){if(sa.text){var db=
sa.styles;sa=C?0:sa.text.length-1;for(var wb,eb=C?0:db.length-2,ac=C?db.length:-2;eb!=ac;eb+=2*E){var nb=db[eb];if(db[eb+1]!=null&&db[eb+1]!=ea)sa+=E*nb.length;else for(var xb=C?0:nb.length-1,bc=C?nb.length:-1;xb!=bc;xb+=E,sa+=E)if(sa>=cb&&sa<Oa&&Ga.test(wb=nb.charAt(xb))){var Jb=yb[wb];if(Jb.charAt(1)==">"==C)ka.push(wb);else{if(ka.pop()!=Jb.charAt(0))return{pos:sa,match:false};if(!ka.length)return{pos:sa,match:true}}}}}}var o=M.inverted?M.from:M.to,s=N[o.line],w=o.ch-1,F=w>=0&&yb[s.text.charAt(w)]||
yb[s.text.charAt(++w)];if(F){F.charAt(0);var C=F.charAt(1)==">",E=C?1:-1,I=s.styles,D=w+1;F=0;for(var W=I.length;F<W;F+=2)if((D-=I[F].length)<=0){var ea=I[F+1];break}var ka=[s.text.charAt(w)],Ga=/[(){}[\]]/;F=o.line;for(W=C?Math.min(F+50,N.length):Math.max(-1,F-50);F!=W;F+=E){s=N[F];I=F==o.line;if(s=m(s,I&&C?w+1:0,I&&!C?w:s.text.length)){ea=s.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";var za=Ta({line:o.line,ch:w},{line:o.line,ch:w+1},ea),Ha=Ta({line:F,ch:s.pos},{line:F,ch:s.pos+
1},ea);o=z(function(){za();Ha()});h?setTimeout(o,800):mb=o;break}}}}function Z(){clearInterval(zb);var h=true;Pa.style.visibility="";zb=setInterval(function(){Pa.style.visibility=(h=!h)?"":"hidden"},650)}function pa(h){function m(){la.value!=w&&z(ob)(la.value,"end");la.style.cssText=s;kb=false;lb();pb()}var o=ha(h);if(o&&!window.opera){(e(M.from,M.to)||d(o,M.from)||!d(o,M.to))&&fb(o.line,o.ch);var s=la.style.cssText;la.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(h.pageY()-1)+
"px; left: "+(h.pageX()-1)+"px; z-index: 1000; background: white; border-width: 0; outline: none; overflow: hidden; opacity: .05;";var w=la.value=Kb();qb();qa(la,0,la.value.length);kb=true;if(L){h.stop();var F=k(window,"mouseup",function(){F();setTimeout(m,20)},true)}else setTimeout(m,50)}}function ha(h,m){var o=f(ia,true),s=h.e.clientX,w=h.e.clientY;if(!m&&(s-o.left>ia.clientWidth||w-o.top>ia.clientHeight))return null;o=f(Aa,true);w=ra+Math.floor((w-o.top)/na());return oa({line:w,ch:Ua(Qa(w),s-o.left)})}
function na(){var h=va.childNodes.length;if(h)return va.offsetHeight/h||1;Ia.innerHTML="<pre>x</pre>";return Ia.firstChild.offsetHeight||1}function ya(h){h=Ja(h,true);var m=f(Aa);return{x:m.left+h.x,y:m.top+h.y,yBot:m.top+h.yBot}}function Ja(h,m){var o=na(),s=h.line-(m?ra:0);return{x:gb(h.line,h.ch),y:s*o,yBot:(s+1)*o}}function Ua(h,m){function o(W){Ia.innerHTML="<pre><span>"+s.getHTML(null,null,false,W)+"</span></pre>";return Ia.firstChild.firstChild.offsetWidth}if(m<=0)return 0;for(var s=N[h],w=
0,F=0,C=s.text.length,E,I=Math.min(C,Math.ceil(m/Va("x")));;){var D=o(I);if(D<=m&&I<C)I=Math.min(C,Math.ceil(I*1.2));else{E=D;C=I;break}}if(m>E)return C;I=Math.floor(C*0.8);D=o(I);for(D<m&&(w=I,F=D);;){if(C-w<=1)return E-m>m-F?w:C;I=Math.ceil((w+C)/2);D=o(I);D>m?(C=I,E=D):(w=I,F=D)}}function gb(h,m){if(m==0)return 0;Ia.innerHTML="<pre><span>"+N[h].getHTML(null,null,false,m)+"</span></pre>";return Ia.firstChild.firstChild.offsetWidth}function Va(h){Ia.innerHTML="<pre><span>x</span></pre>";Ia.firstChild.firstChild.firstChild.nodeValue=
h;return Ia.firstChild.firstChild.offsetWidth||10}function Ta(h,m,o){function s(E,I,D,W){E=N[E];I=E.addMark(I,D,W);I.line=E;w.push(I)}h=oa(h);m=oa(m);var w=[];if(h.line==m.line)s(h.line,h.ch,m.ch,o);else{s(h.line,h.ch,null,o);for(var F=h.line+1,C=m.line;F<C;++F)s(F,0,null,o);s(m.line,0,m.ch,o)}wa.push({from:h.line,to:m.line+1});return function(){for(var E,I,D=0;D<w.length;++D){var W=w[D],ea=a(N,W.line);W.line.removeMark(W);ea>-1&&(E==null&&(E=ea),I=ea)}E!=null&&wa.push({from:E,to:I+1})}}function Lb(){ta=
J.getMode(ba,ba.mode);for(var h=0,m=N.length;h<m;++h)N[h].stateAfter=null;Fa=[0];S()}function Wa(h,m){if(m=="smart")if(ta.indent)var o=x(h);else m="prev";var s=N[h],w=s.indentation(),F=s.text.match(/^\s*/)[0],C;m=="prev"?h?C=N[h-1].indentation():C=0:m=="smart"?C=ta.indent(o,s.text.slice(F.length)):m=="add"?C=w+ba.indentUnit:m=="subtract"&&(C=w-ba.indentUnit);C=Math.max(0,C);if(C-w){w="";o=0;if(ba.indentWithTabs)for(s=Math.floor(C/ga);s;--s){o+=ga;w+="\t"}for(;o<C;){++o;w+=" "}}else{if(M.from.line!=
h&&M.to.line!=h)return;w=F}Xa(w,{line:h,ch:0},{line:h,ch:F.length})}function cc(h){Ya({line:h,ch:0},{line:h,ch:N[h].text.length})}function oa(h){if(h.line<0)return{line:0,ch:0};if(h.line>=N.length)return{line:N.length-1,ch:N[N.length-1].text.length};var m=h.ch,o=N[h.line].text.length;return m==null||m>o?{line:h.line,ch:o}:m<0?{line:h.line,ch:0}:h}function Qa(h){return Math.max(0,Math.min(h,N.length-1))}function fb(h,m,o){h=oa({line:h,ch:m||0});(o?Ya:Za)(h,h)}function Za(h,m,o,s){if(!e(M.from,h)||
!e(M.to,m)){if(d(m,h)){var w=m;m=h;h=w}e(h,m)?M.inverted=false:e(h,M.to)?M.inverted=false:e(m,M.from)&&(M.inverted=true);o==null&&(o=M.from.line,s=M.to.line);e(h,m)?e(M.from,M.to)||wa.push({from:o,to:s+1}):e(M.from,M.to)?wa.push({from:h.line,to:m.line+1}):(e(h,M.from)||(h.line<o?wa.push({from:h.line,to:Math.min(m.line,o)+1}):wa.push({from:o,to:Math.min(s,h.line)+1})),e(m,M.to)||(m.line<s?wa.push({from:Math.max(o,h.line),to:s+1}):wa.push({from:Math.max(h.line,s),to:m.line+1})));M.from=h;M.to=m;La=
true}}function Ya(h,m){var o=Da&&oa(Da);o&&(d(o,h)?h=o:d(m,o)&&(m=o));Za(h,m)}function Ib(){var h=M.inverted?M.from:M.to,m=na(),o=gb(h.line,h.ch)+"px",s=(h.line-ra)*m+"px";Mb.style.top=h.line*m-ia.scrollTop+"px";e(M.from,M.to)?(Pa.style.top=s,Pa.style.left=o,Pa.style.display=""):Pa.style.display="none"}function rb(){if(ba.gutter||ba.lineNumbers){var h=Ab.offsetHeight,m=ia.clientHeight;Ma.style.height=(h-m<2?m:h)+"px";h=[];for(m=ra;m<Math.max(Ka,ra+1);++m){var o=N[m].gutterMarker,s=ba.lineNumbers?
m+ba.firstLineNumber:null;o&&o.text?s=o.text.replace("%N%",s!=null?s:""):s==null&&(s="\u00a0");h.push(o&&o.style?'<pre class="'+o.style+'">':"<pre>",s,"</pre>")}Ma.style.display="none";sb.innerHTML=h.join("");h=String(N.length).length;m=sb.firstChild;o=m.textContent||m.innerText||m.nodeValue||"";for(s="";o.length+s.length<h;)s+="\u00a0";s&&m.insertBefore(Ra.createTextNode(s),m.firstChild);Ma.style.display="";Aa.style.marginLeft=Ma.offsetWidth+"px"}}function jb(h){if(ia.clientWidth){for(var m=h===
true?[]:[{from:ra,to:Ka,domStart:0}],o=0,s=h.length||0;o<s;++o){for(var w=h[o],F=[],C=w.diff||0,E=0,I=m.length;E<I;++E){var D=m[E];w.to<=D.from?F.push({from:D.from+C,to:D.to+C,domStart:D.domStart}):D.to<=w.from?F.push(D):(w.from>D.from&&F.push({from:D.from,to:w.from,domStart:D.domStart}),w.to<D.to&&F.push({from:w.to+C,to:D.to+C,domStart:D.domStart+(w.to-D.from)}))}m=F}C=Nb();w=Math.min(ra,Math.max(C.from-3,0));F=Math.min(N.length,Math.max(Ka,C.to+3));h=[];E=0;I=Ka-ra;var W=w,ea=0;o=0;for(s=m.length;o<
s;++o){D=m[o];if(!(D.to<=w)){if(D.from>=F)break;if(D.domStart>E||D.from>W){h.push({from:W,to:D.from,domSize:D.domStart-E,domStart:E});ea+=D.from-W}W=D.to;E=D.domStart+(D.to-D.from)}}if(E!=I||W!=F){ea+=Math.abs(F-W);h.push({from:W,to:F,domSize:I-E,domStart:E})}if(h.length){va.style.display="none";if(ea>(C.to-C.from)*0.3){D=w=Math.max(C.from-10,0);m=F=Math.min(C.to+7,N.length);o=[];s={line:D,ch:0};s=d(M.from,s)&&!d(M.to,s);for(D=D;D<m;++D){E=C=null;s?(C=0,M.to.line==D&&(s=false,E=M.to.ch)):M.from.line==
D&&(M.to.line==D?(C=M.from.ch,E=M.to.ch):(s=true,C=M.from.ch));o.push(N[D].getHTML(C,E,true))}va.innerHTML=o.join("")}else{m=M.from.line;o=M.to.line;s=0;D=B&&Ra.createElement("div");C=0;for(E=h.length;C<E;++C){I=h[C];W=I.to-I.from-I.domSize;ea=va.childNodes[I.domStart+I.domSize+s]||null;if(B)for(var ka=Math.max(-W,I.domSize);ka>0;--ka)va.removeChild(ea?ea.previousSibling:va.lastChild);else if(W){for(ka=Math.max(0,W);ka>0;--ka)va.insertBefore(Ra.createElement("pre"),ea);for(ka=Math.max(0,-W);ka>0;--ka)va.removeChild(ea?
ea.previousSibling:va.lastChild)}var Ga=va.childNodes[I.domStart+s],za=m<I.from&&o>=I.from;for(ka=I.from;ka<I.to;++ka){var Ha=null,sa=null;za?(Ha=0,o==ka&&(za=false,sa=M.to.ch)):m==ka&&(o==ka?(Ha=M.from.ch,sa=M.to.ch):(za=true,Ha=M.from.ch));B?(D.innerHTML=N[ka].getHTML(Ha,sa,true),va.insertBefore(D.firstChild,ea)):(Ga.innerHTML=N[ka].getHTML(Ha,sa,false),Ga.className=N[ka].className||"",Ga=Ga.nextSibling)}s+=W}}va.style.display="";m=w!=ra||F!=Ka||Ob!=ia.clientHeight;ra=w;Ka=F;Ab.style.top=w*na()+
"px";m&&(Ob=ia.clientHeight,$a.style.height=N.length*na()+2*Aa.offsetTop+"px",rb());w=Va(hb);Aa.style.width=w>ia.clientWidth?w+"px":"";if(va.childNodes.length!=Ka-ra)throw Error("BAD PATCH! "+JSON.stringify(h)+" size="+(Ka-ra)+" nodes="+va.childNodes.length);Ib()}}else ra=Ka=0}function Nb(){var h=na(),m=ia.scrollTop-Aa.offsetTop;return{from:Math.min(N.length,Math.max(0,Math.floor(m/h))),to:Math.min(N.length,Math.ceil((m+ia.clientHeight)/h))}}function Pb(h,m,o,s){var w=Aa.offsetLeft,F=Aa.offsetTop,
C=na();m+=F;s+=F;h+=w;o+=w;var E=ia.clientHeight,I=ia.scrollTop;w=false;F=true;m<I?(ia.scrollTop=Math.max(0,m-2*C),w=true):s>I+E&&(ia.scrollTop=s+C-E,w=true);m=ia.clientWidth;s=ia.scrollLeft;h<s?(h<50&&(h=0),ia.scrollLeft=Math.max(0,h-10),w=true):o>m+s&&(ia.scrollLeft=o+10-m,w=true,o>$a.clientWidth&&(F=false));w&&ba.onScroll&&ba.onScroll(xa);return F}function Hb(){var h=Ja(M.inverted?M.from:M.to);return Pb(h.x,h.y,h.x,h.yBot)}function qb(){ba.readOnly!="nocursor"&&la.focus()}function lb(){for(var h=
[],m=Math.max(0,M.from.line-1),o=Math.min(N.length,M.to.line+2),s=m;s<o;++s)h.push(N[s].text);h=la.value=h.join($);var w=M.from.ch,F=M.to.ch;for(s=m;s<M.from.line;++s)w+=$.length+N[s].text.length;for(s=m;s<M.to.line;++s)F+=$.length+N[s].text.length;ua={text:h,from:m,to:o,start:w,end:F};qa(la,w,Sa?w:F)}function Qb(){function h(Ha,sa){for(var cb=0;;){var Oa=o.indexOf("\n",cb);if(Oa==-1||(o.charAt(Oa-1)=="\r"?Oa-1:Oa)>=Ha)return{line:sa,ch:Ha-cb};++sa;cb=Oa+1}}if(!kb){var m=false,o=la.value,s=fa(la);
if(!s)return false;m=ua.text!=o;var w=Sa,F=m||s.start!=ua.start||s.end!=(w?ua.start:ua.end);if(!F&&!w)return false;if(m){Da=Sa=null;if(ba.readOnly){Ea=true;return"changed"}}var C=h(s.start,ua.from),E=h(s.end,ua.from);if(w){var I=s.start==w.anchor?E:C;w=Da?M.to:s.start==w.anchor?C:E;(M.inverted=d(I,w))?(C=I,E=w):(Sa=null,C=w,E=I)}C.line==E.line&&C.line==M.from.line&&C.line==M.to.line&&!Da&&(Ea=false);if(m){I=0;w=o.length;for(var D=Math.min(w,ua.text.length),W,ea=ua.from,ka=-1;I<D&&(W=o.charAt(I))==
ua.text.charAt(I);){++I;W=="\n"&&(ea++,ka=I)}D=ka>-1?I-ka:I;for(var Ga=ua.to-1,za=ua.text.length;;){W=ua.text.charAt(za);if(o.charAt(w)!=W){++w;++za;break}W=="\n"&&Ga--;if(za<=I||w<=I)break;--w;--za}ka=ua.text.lastIndexOf("\n",za-1);Bb({line:ea,ch:D},{line:Ga,ch:ka==-1?za:za-ka-1},da(o.slice(I,w)),C,E);if(ea!=Ga||C.line!=ea)Ea=true}else Za(C,E);ua.text=o;ua.start=s.start;ua.end=s.end;return m?"changed":F?"moved":false}}function ab(h){function m(){aa();var s=Qb();s=="moved"&&h&&(T[h]=true);!s&&!o?
(o=true,Cb.set(80,m)):(Db=false,pb());O()}var o=false;Db=true;Cb.set(20,m)}function pb(){Db||Cb.set(2E3,function(){aa();Qb();Na&&pb();O()})}function Kb(){return Rb(M.from,M.to)}function Rb(h,m){var o=h.line,s=m.line;if(o==s)return N[o].text.slice(h.ch,m.ch);var w=[N[o].text.slice(h.ch)];for(o=o+1;o<s;++o)w.push(N[o].text);w.push(N[s].text.slice(0,m.ch));return w.join("\n")}function Sb(h,m,o,s){s=s({line:m.line+h.length-1,ch:h.length==1?h[0].length+m.ch:h[h.length-1].length});Bb(m,o,h,s.from,s.to)}
function ob(h,m){Sb(da(h),M.from,M.to,function(o){return m=="end"?{from:o,to:o}:m=="start"?{from:M.from,to:M.from}:{from:M.from,to:o}})}function Xa(h,m,o){function s(F){if(d(F,m))return F;if(!d(o,F))return w;var C=F.line+h.length-(o.line-m.line)-1,E=F.ch;F.line==o.line&&(E+=h[h.length-1].length-(o.ch-(o.line==m.line?m.ch:0)));return{line:C,ch:E}}m=oa(m);o?o=oa(o):o=m;h=da(h);var w;Sb(h,m,o,function(F){w=F;return{from:s(M.from),to:s(M.to)}});return w}function Tb(h,m,o,s,w){for(var F=false,C=hb.length,
E=h.line;E<=m.line;++E)if(N[E].text.length==C){F=true;break}var I=m.line-h.line;E=N[h.line];var D=N[m.line];if(E==D)if(o.length==1)E.replace(h.ch,m.ch,o[0]);else{D=E.split(m.ch,o[o.length-1]);var W=[h.line+1,I];E.replace(h.ch,E.text.length,o[0]);E=1;for(var ea=o.length-1;E<ea;++E)W.push(new P(o[E]));W.push(D);N.splice.apply(N,W)}else if(o.length==1){E.replace(h.ch,E.text.length,o[0]+D.text.slice(m.ch));N.splice(h.line+1,I)}else{W=[h.line+1,I-1];E.replace(h.ch,E.text.length,o[0]);D.replace(0,m.ch,
o[o.length-1]);E=1;for(ea=o.length-1;E<ea;++E)W.push(new P(o[E]));N.splice.apply(N,W)}E=h.line;for(ea=E+o.length;E<ea;++E){D=N[E].text;D.length>C&&(hb=D,C=D.length,F=false)}if(F){C=0;hb="";E=0;for(ea=N.length;E<ea;++E){D=N[E].text;D.length>C&&(C=D.length,hb=D)}}F=[];I=o.length-I-1;E=0;for(D=Fa.length;E<D;++E){C=Fa[E];C<h.line?F.push(C):C>m.line&&F.push(C+I)}if(o.length<5){D=h.line;E=h.line+o.length;C=x(D);for(D=D;D<E;++D){W=N[D];W.highlight(ta,C);W.stateAfter=H(ta,C)}F.push(h.line+o.length)}else F.push(h.line);
Fa=F;S(100);wa.push({from:h.line,to:m.line+1,diff:I});vb={from:h,to:m,text:o};Za(s,w,M.from.line<=Math.min(m.line,m.line+I)?M.from.line:M.from.line+I,M.to.line<=Math.min(m.line,m.line+I)?M.to.line:M.to.line+I);$a.style.height=N.length*na()+2*Aa.offsetTop+"px"}function Ub(){Vb(Ba.undone,Ba.done)}function Wb(){Vb(Ba.done,Ba.undone)}function Vb(h,m){var o=h.pop();if(o){for(var s=[],w=o.start+o.added,F=o.start;F<w;++F)s.push(N[F].text);m.push({start:o.start,added:o.old.length,old:s});F=o.start+o.old.length-
1;s=s[s.length-1];var C=o.old[o.old.length-1];if(C)if(s){for(var E=s.length,I=C.length;E>=0&&I>=0;--E,--I)if(s.charAt(E)!=C.charAt(I))break;s=I+1}else s=C.length;else s=s?s.length:0;F=oa({line:F,ch:s});Tb({line:o.start,ch:0},{line:w-1,ch:N[w-1].text.length},o.old,F,F)}}function Bb(h,m,o,s,w){if(Ba){for(var F=[],C=h.line,E=m.line+1;C<E;++C)F.push(N[C].text);for(Ba.addChange(h.line,o.length,F);Ba.done.length>ba.undoDepth;)Ba.done.shift()}Tb(h,m,o,s,w)}function Xb(){Na&&ba.onBlur&&ba.onBlur(xa);clearInterval(zb);
Da=null;Na=false;Ca.className=Ca.className.replace(" CodeMirror-focused","")}function bb(){ba.readOnly!="nocursor"&&(!Na&&ba.onFocus&&ba.onFocus(xa),Na=true,pb(),Ca.className.search(/\bCodeMirror-focused\b/)==-1&&(Ca.className+=" CodeMirror-focused"),Z())}function Yb(h){Ba=null;var m={line:0,ch:0};Bb(m,{line:N.length-1,ch:N[N.length-1].text.length},da(h),m,m);Ba=new v}var ba={},Eb=J.defaults,ib;for(ib in Eb)Eb.hasOwnProperty(ib)&&(ba[ib]=(t&&t.hasOwnProperty(ib)?t:Eb)[ib]);var Ra=ba.document,Ca=Ra.createElement("div");
Ca.className="CodeMirror";Ca.innerHTML='<div style="overflow: hidden; position: relative; width: 1px; height: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off"></textarea></div><div class="CodeMirror-scroll cm-s-'+ba.theme+'"><div style="position: relative"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"></div><div style="position: relative"><div class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative"><pre class="CodeMirror-cursor">&#160;</pre><div></div></div></div></div></div></div>';
p.appendChild?p.appendChild(Ca):p(Ca);var Mb=Ca.firstChild,la=Mb.firstChild,ia=Ca.lastChild,$a=ia.firstChild,Ia=$a.firstChild,Ab=Ia.nextSibling,Ma=Ab.firstChild,sb=Ma.firstChild,Aa=Ma.nextSibling.firstChild,Pa=Aa.firstChild,va=Pa.nextSibling;ba.tabindex!=null&&(la.tabindex=ba.tabindex);!ba.gutter&&!ba.lineNumbers&&(Ma.style.display="none");var Cb=new j,$b=new j,zb,ta,N=[new P("")],Fa,Ba=new v,Na;Lb();var M={from:{line:0,ch:0},to:{line:0,ch:0},inverted:false},Da,Sa,Fb,Ea,wa,vb,La,kb,ra=0,Ka=0,Ob=0,
tb=null,ua,mb,hb="";z(function(){Yb(ba.value||"");Ea=false})();setTimeout(lb,20);k(ia,"mousedown",z(function(h){function m(D){var W=ha(D,true);if(W&&!e(W,F)){Na||bb();F=W;Ya(w,W);Ea=false;var ea=Nb();if(W.line>=ea.to||W.line<ea.from)C=setTimeout(z(function(){m(D)}),150)}}var o=Fb;Fb=null;for(var s=h.target();s!=Ca;s=s.parentNode)if(s.parentNode==sb){ba.onGutterClick&&ba.onGutterClick(xa,a(sb.childNodes,s)+ra);return h.stop()}L&&h.button()==3&&pa(h);if(h.button()==1){var w=ha(h),F=w,C;if(w){Na||bb();
h.stop();if(o&&+new Date-o<400)return cc(w.line);fb(w.line,w.ch,true);var E=k(Ra,"mousemove",z(function(D){clearTimeout(C);D.stop();m(D)}),true),I=k(Ra,"mouseup",z(function(D){clearTimeout(C);var W=ha(D);W&&Ya(w,W);D.stop();qb();Ea=true;E();I()}),true)}else h.target()==ia&&h.stop()}}));L||k(ia,"contextmenu",z(pa));k($a,"dblclick",z(function(h){var m=ha(h);if(m){for(var o=N[m.line].text,s=m.ch,w=m.ch;s>0&&/\w/.test(o.charAt(s-1));)--s;for(;w<o.length&&/\w/.test(o.charAt(w));)++w;Ya({line:m.line,ch:s},
{line:m.line,ch:w});h.stop();Fb=+new Date}}));k(ia,"scroll",function(){jb([]);ba.onScroll&&ba.onScroll(xa)});k(window,"resize",function(){jb(true)});k(la,"keyup",z(function(h){if(!ba.onKeyEvent||!ba.onKeyEvent(xa,n(h.e))){Sa&&(Sa=null,Ea=true);h.e.keyCode==16&&(Da=null)}}));k(la,"keydown",z(function(h){Na||bb();var m=h.e.keyCode;u&&m==27&&(h.e.returnValue=false);var o=(ma?h.e.metaKey:h.e.ctrlKey)&&!h.e.altKey,s=h.e.ctrlKey||h.e.altKey||h.e.metaKey;m==16||h.e.shiftKey?Da=Da||(M.inverted?M.to:M.from):
Da=null;if(!ba.onKeyEvent||!ba.onKeyEvent(xa,n(h.e))){if(m==33||m==34){m=m==34;o=Math.floor(ia.clientHeight/na());s=M.inverted?M.from:M.to;fb(s.line+Math.max(o-1,1)*(m?1:-1),s.ch,true);return h.stop()}if(o&&(m==36||m==35||ma&&(m==38||m==40))){m=m==36||m==38?{line:0,ch:0}:{line:N.length-1,ch:N[N.length-1].text.length};Ya(m,m);return h.stop()}if(o&&m==65){m=N.length-1;Za({line:0,ch:0},{line:m,ch:N[m].text.length});return h.stop()}if(!ba.readOnly){if(!s&&m==13)return;if(s=!s){if(s=m==9)a:{s=h.e.shiftKey;
Da=null;switch(ba.tabMode){case "default":s=false;break a;case "indent":for(var w=M.from.line,F=M.to.line;w<=F;++w)Wa(w,"smart");break;case "classic":if(e(M.from,M.to)){s?Wa(M.from.line,"smart"):ob("\t","end");break}case "shift":w=M.from.line;for(F=M.to.line;w<=F;++w)Wa(w,s?"subtract":"add")}s=true}s=s}if(s)return h.stop();if(o&&m==90){Wb();return h.stop()}if(o&&(h.e.shiftKey&&m==90||m==89)){Ub();return h.stop()}}tb=(o?"c":"")+m;if(M.inverted&&T.hasOwnProperty(tb))(h=fa(la))&&(Sa={anchor:h.start},
qa(la,h.start,h.start));ab(tb)}}));k(la,"keypress",z(function(h){if(!ba.onKeyEvent||!ba.onKeyEvent(xa,n(h.e))){if(ba.electricChars&&ta.electricChars){var m=String.fromCharCode(h.e.charCode==null?h.e.keyCode:h.e.charCode);ta.electricChars.indexOf(m)>-1&&setTimeout(z(function(){Wa(M.to.line,"smart")}),50)}m=h.e.keyCode;if(m==13){if(!ba.readOnly){ob("\n","end");ba.enterMode!="flat"&&Wa(M.from.line,ba.enterMode=="keep"?"prev":"smart")}h.stop()}else!h.e.ctrlKey&&!h.e.altKey&&!h.e.metaKey&&m==9&&ba.tabMode!=
"default"?h.stop():ab(tb)}}));k(la,"focus",bb);k(la,"blur",Xb);k(ia,"dragenter",function(h){h.stop()});k(ia,"dragover",function(h){h.stop()});k(ia,"drop",z(function(h){h.e.preventDefault();var m=ha(h,true),o=h.e.dataTransfer.files;if(m&&!ba.readOnly)if(o&&o.length&&window.FileReader&&window.File){h=function(I,D){var W=new FileReader;W.onload=function(){w[D]=W.result;++F==s&&Xa(w.join(""),oa(m),oa(m))};W.readAsText(I)};for(var s=o.length,w=Array(s),F=0,C=0;C<s;++C)h(o[C],C)}else try{(w=h.e.dataTransfer.getData("Text"))&&
Xa(w,m,m)}catch(E){}}));k(ia,"paste",function(){qb();ab()});k(la,"paste",function(){ab()});k(la,"cut",function(){ab()});var Zb;try{Zb=Ra.activeElement==la}catch(dc){}Zb?bb():Xb();var xa={getValue:function(){for(var h=[],m=0,o=N.length;m<o;++m)h.push(N[m].text);return h.join("\n")},setValue:z(Yb),getSelection:Kb,replaceSelection:z(ob),focus:function(){qb();bb();lb();ab()},setOption:function(h,m){ba[h]=m;if(h=="lineNumbers"||h=="gutter"){var o=ba.gutter||ba.lineNumbers;Ma.style.display=o?"":"none";
o?rb():va.parentNode.style.marginLeft=0}else h=="mode"||h=="indentUnit"?Lb():h=="readOnly"&&m=="nocursor"?la.blur():h=="theme"&&(ia.className=ia.className.replace(/cm-s-\w+/,"cm-s-"+m))},getOption:function(h){return ba[h]},undo:z(Wb),redo:z(Ub),indentLine:z(function(h){h>=0&&h<N.length&&Wa(h,"smart")}),historySize:function(){return{undo:Ba.done.length,redo:Ba.undone.length}},matchBrackets:z(function(){X(true)}),getTokenAt:function(h){h=oa(h);return N[h.line].getTokenAt(ta,x(h.line),h.ch)},getStateAfter:function(h){h=
Qa(h==null?N.length-1:h);return x(h+1)},cursorCoords:function(h){h==null&&(h=M.inverted);return ya(h?M.from:M.to)},charCoords:function(h){return ya(oa(h))},coordsChar:function(h){var m=f(Aa),o=Qa(Math.min(N.length-1,ra+Math.floor((h.y-m.top)/na())));return oa({line:o,ch:Ua(Qa(o),h.x-m.left)})},getSearchCursor:function(h,m,o){return new K(h,m,o)},markText:z(function(h,m,o){return z(Ta(h,m,o))}),setMarker:function(h,m,o){typeof h=="number"&&(h=N[Qa(h)]);h.gutterMarker={text:m,style:o};rb();return h},
clearMarker:function(h){typeof h=="number"&&(h=N[Qa(h)]);h.gutterMarker=null;rb()},setLineClass:z(function(h,m){if(typeof h=="number"){var o=h;h=N[Qa(h)]}else{o=a(N,h);if(o==-1)return null}h.className!=m&&(h.className=m,wa.push({from:o,to:o+1}));return h}),lineInfo:function(h){if(typeof h=="number"){var m=h;h=N[h];if(!h)return null}else{m=a(N,h);if(m==-1)return null}var o=h.gutterMarker;return{line:m,text:h.text,markerText:o&&o.text,markerClass:o&&o.style}},addWidget:function(h,m,o){h=Ja(oa(h),true);
m.style.top=ra*na()+h.yBot+Aa.offsetTop+"px";m.style.left=h.x+Aa.offsetLeft+"px";$a.appendChild(m);o&&Pb(h.x,h.yBot,h.x+m.offsetWidth,h.yBot+m.offsetHeight)},lineCount:function(){return N.length},getCursor:function(h){h==null&&(h=M.inverted);return{line:(h?M.from:M.to).line,ch:(h?M.from:M.to).ch}},somethingSelected:function(){return!e(M.from,M.to)},setCursor:z(function(h,m){m==null&&typeof h.line=="number"?fb(h.line,h.ch):fb(h,m)}),setSelection:z(function(h,m){Za(oa(h),oa(m||h))}),getLine:function(h){if(h>=
0&&h<N.length)return N[h].text},setLine:z(function(h,m){h>=0&&h<N.length&&Xa(m,{line:h,ch:0},{line:h,ch:N[h].text.length})}),removeLine:z(function(h){h>=0&&h<N.length&&Xa("",{line:h,ch:0},oa({line:h+1,ch:0}))}),replaceRange:z(Xa),getRange:function(h,m){return Rb(oa(h),oa(m))},operation:function(h){return z(h)()},refresh:function(){jb(true)},getInputField:function(){return la},getWrapperElement:function(){return Ca},getScrollerElement:function(){return ia}},Db=false,yb={"(":")>",")":"(<","[":"]>",
"]":"[<","{":"}>","}":"{<"},Gb=0;K.prototype={findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(h){function m(w){w={line:w,ch:0};o.pos={from:w,to:w};return o.atOccurrence=false}for(var o=this,s=oa(h?this.pos.from:this.pos.to);;){if(this.pos=this.matches(h,s)){this.atOccurrence=true;return this.pos.match||true}if(h){if(!s.line)return m(0);s={line:s.line-1,ch:N[s.line-1].text.length}}else{if(s.line==N.length-1)return m(N.length);s={line:s.line+
1,ch:0}}}},from:function(){if(this.atOccurrence)return{line:this.pos.from.line,ch:this.pos.from.ch}},to:function(){if(this.atOccurrence)return{line:this.pos.to.line,ch:this.pos.to.ch}}};for(var ub in ca)ca.propertyIsEnumerable(ub)&&!xa.propertyIsEnumerable(ub)&&(xa[ub]=ca[ub]);return xa}J.defaults={value:"",mode:null,theme:"default",indentUnit:2,indentWithTabs:false,tabMode:"classic",enterMode:"indent",electricChars:true,onKeyEvent:null,lineNumbers:false,gutter:false,firstLineNumber:1,readOnly:false,
onChange:null,onCursorActivity:null,onGutterClick:null,onHighlightComplete:null,onFocus:null,onBlur:null,onScroll:null,matchBrackets:false,workTime:100,workDelay:200,undoDepth:40,tabindex:null,document:window.document};var Q={},V={};J.defineMode=function(p,t){!J.defaults.mode&&p!="null"&&(J.defaults.mode=p);Q[p]=t};J.defineMIME=function(p,t){V[p]=t};J.getMode=function(p,t){typeof t=="string"&&V.hasOwnProperty(t)&&(t=V[t]);if(typeof t=="string")var K=t,z={};else if(t!=null){K=t.name;z=t}var O=Q[K];
if(!O){window.console&&console.warn("No mode "+K+" found, falling back to plain text.");return J.getMode(p,"text/plain")}return O(p,z||{})};J.listModes=function(){var p=[],t;for(t in Q)Q.propertyIsEnumerable(t)&&p.push(t);return p};J.listMIMEs=function(){var p=[],t;for(t in V)V.propertyIsEnumerable(t)&&p.push(t);return p};var ca={};J.defineExtension=function(p,t){ca[p]=t};J.fromTextArea=function(p,t){function K(){p.value=S.getValue()}t||(t={});t.value=p.value;!t.tabindex&&p.tabindex&&(t.tabindex=
p.tabindex);if(p.form){var z=k(p.form,"submit",K,true);if(typeof p.form.submit=="function"){var O=p.form.submit,aa=function(){K();p.form.submit=O;p.form.submit();p.form.submit=aa};p.form.submit=aa}}p.style.display="none";var S=J(function(ja){p.parentNode.insertBefore(ja,p.nextSibling)},t);S.save=K;S.toTextArea=function(){K();p.parentNode.removeChild(S.getWrapperElement());p.style.display="";p.form&&(z(),typeof p.form.submit=="function"&&(p.form.submit=O))};return S};J.startState=y;J.copyState=H;R.prototype=
{eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==0},peek:function(){return this.string.charAt(this.pos)},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(p){var t=this.string.charAt(this.pos);if(typeof p=="string"?t==p:t&&(p.test?p.test(t):p(t))){++this.pos;return t}},eatWhile:function(p){for(var t=this.start;this.eat(p););return this.pos>t},eatSpace:function(){for(var p=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;
return this.pos>p},skipToEnd:function(){this.pos=this.string.length},skipTo:function(p){p=this.string.indexOf(p,this.pos);if(p>-1){this.pos=p;return true}},backUp:function(p){this.pos-=p},column:function(){return g(this.string,this.start)},indentation:function(){return g(this.string)},match:function(p,t,K){if(typeof p!="string"){(p=this.string.slice(this.pos).match(p))&&t!==false&&(this.pos+=p[0].length);return p}if((K?this.string.toLowerCase():this.string).indexOf(K?p.toLowerCase():p,this.pos)==
this.pos){t!==false&&(this.pos+=p.length);return true}},current:function(){return this.string.slice(this.start,this.pos)}};J.StringStream=R;P.prototype={replace:function(p,t,K){var z=[],O=this.marked;G(0,p,this.styles,z);K&&z.push(K,null);G(t,this.text.length,this.styles,z);this.styles=z;this.text=this.text.slice(0,p)+K+this.text.slice(t);this.stateAfter=null;if(O){p=K.length-(t-p);K=this.text.length;for(z=0;z<O.length;++z){var aa=O[z],S=false;aa.from>=K?S=true:(aa.from=aa.from<=Math.min(t,t+p)?aa.from:
aa.from+p,aa.to!=null&&(aa.to=aa.to<=Math.min(t,t+p)?aa.to:aa.to+p));if(S||aa.from>=aa.to){O.splice(z,1);z--}}}},split:function(p,t){var K=[t,null];G(p,this.text.length,this.styles,K);return new P(t+this.text.slice(p),K)},addMark:function(p,t,K){p={from:p,to:t,style:K};this.marked==null&&(this.marked=[]);this.marked.push(p);this.marked.sort(function(z,O){return z.from-O.from});return p},removeMark:function(p){var t=this.marked;if(t)for(var K=0;K<t.length;++K)if(t[K]==p){t.splice(K,1);break}},highlight:function(p,
t){var K=new R(this.text),z=this.styles,O=0,aa=false,S=z[0],ja;for(this.text==""&&p.blankLine&&p.blankLine(t);!K.eol();){var x=p.token(K,t),U=this.text.slice(K.start,K.pos);K.start=K.pos;O&&z[O-1]==x?z[O-2]+=U:U&&(!aa&&(z[O+1]!=x||O&&z[O-2]!=ja)&&(aa=true),z[O++]=U,z[O++]=x,ja=S,S=z[O]);if(K.pos>5E3){z[O++]=this.text.slice(K.pos);z[O++]=null;break}}z.length!=O&&(z.length=O,aa=true);O&&z[O-2]!=ja&&(aa=true);return aa||z.length<5&&this.text.length<10},getTokenAt:function(p,t,K){for(var z=new R(this.text);z.pos<
K&&!z.eol();){z.start=z.pos;var O=p.token(z,t)}return{start:z.start,end:z.pos,string:z.current(),className:O||null,state:t}},indentation:function(){return g(this.text)},getHTML:function(p,t,K,z){function O(Va,Ta){!Va||(Ta?aa.push('<span class="cm-',Ta,'">',b(Va),"</span>"):aa.push(b(Va)))}var aa=[];K&&aa.push(this.className?'<pre class="'+this.className+'">':"<pre>");var S=this.styles,ja=this.text,x=this.marked;p==t&&(p=null);var U=ja.length;z!=null&&(U=Math.min(z,U));if(!ja&&z==null)O(" ",p!=null&&
t==null?"CodeMirror-selected":null);else if(!x&&p==null)for(p=z=0;p<U;z+=2){t=S[z];var X=t.length;p+X>U&&(t=t.slice(0,U-p));p+=X;O(t,S[z+1])}else{z=ja=0;var Z="",pa=-1,ha=null,na=function(){x&&(pa+=1,ha=pa<x.length?x[pa]:null)};for(na();ja<U;){var ya=U,Ja="";if(p!=null)if(p>ja)ya=p;else if(t==null||t>ja){Ja=" CodeMirror-selected";t!=null&&(ya=Math.min(ya,t))}for(;ha&&ha.to!=null&&ha.to<=ja;)na();for(ha&&(ha.from>ja?ya=Math.min(ya,ha.from):(Ja+=" "+ha.style,ha.to!=null&&(ya=Math.min(ya,ha.to))));;){var Ua=
ja+Z.length,gb=X;Ja&&(gb=X?X+Ja:Ja);O(Ua>ya?Z.slice(0,ya-ja):Z,gb);if(Ua>=ya){Z=Z.slice(ya-ja);ja=ya;break}ja=Ua;Z=S[z++];X=S[z++]}}p!=null&&t==null&&O(" ","CodeMirror-selected")}K&&aa.push("</pre>");return aa.join("")}};v.prototype={addChange:function(p,t,K){this.undone.length=0;var z=+new Date,O=this.done[this.done.length-1];if(z-this.time>400||!O||O.start>p+t||O.start+O.added<p-O.added+O.old.length)this.done.push({start:p,added:t,old:K});else{var aa=0;if(p<O.start){for(var S=O.start-p-1;S>=0;--S)O.old.unshift(K[S]);
O.added+=O.start-p;O.start=p}else O.start<p&&(aa=p-O.start,t+=aa);S=O.added-aa;for(p=K.length;S<p;++S)O.old.push(K[S]);O.added<t&&(O.added=t)}this.time=z}};l.prototype={stop:function(){q.call(this.e)},target:function(){return this.e.target||this.e.srcElement},button:function(){if(this.e.which)return this.e.which;if(this.e.button&1)return 1;if(this.e.button&2)return 3;if(this.e.button&4)return 2},pageX:function(){if(this.e.pageX!=null)return this.e.pageX;var p=this.target().ownerDocument;return this.e.clientX+
p.body.scrollLeft+p.documentElement.scrollLeft},pageY:function(){if(this.e.pageY!=null)return this.e.pageY;var p=this.target().ownerDocument;return this.e.clientY+p.body.scrollTop+p.documentElement.scrollTop}};j.prototype={set:function(p,t){clearTimeout(this.id);this.id=setTimeout(t,p)}};var B=function(){var p=document.createElement("pre");p.innerHTML=" ";return!p.innerHTML}(),L=/gecko\/\d{7}/i.test(navigator.userAgent),u=/MSIE \d/.test(navigator.userAgent),A=/Apple Computer/.test(navigator.vendor),
$="\n";(function(){var p=document.createElement("textarea");p.value="foo\nbar";p.value.indexOf("\r")>-1&&($="\r\n")})();for(var ga=8,ma=/Mac/.test(navigator.platform),T={},Y=35;Y<=40;++Y)T[Y]=T["c"+Y]=true;J.htmlEscape=b;var da="\n\nb".split(/\n/).length!=3?function(p){for(var t=0,K,z=[];(K=p.indexOf("\n",t))>-1;){z.push(p.slice(t,p.charAt(K-1)=="\r"?K-1:K));t=K+1}z.push(p.slice(t));return z}:function(p){return p.split(/\r?\n/)};J.splitLines=da;if(window.getSelection)var fa=function(p){try{return{start:p.selectionStart,
end:p.selectionEnd}}catch(t){return null}},qa=A?function(p,t,K){t==K?p.setSelectionRange(t,K):(p.setSelectionRange(t,K-1),window.getSelection().modify("extend","forward","character"))}:function(p,t,K){try{p.setSelectionRange(t,K)}catch(z){}};else{fa=function(p){try{var t=p.ownerDocument.selection.createRange()}catch(K){return null}if(!t||t.parentElement()!=p)return null;var z=p.value,O=z.length,aa=p.createTextRange();aa.moveToBookmark(t.getBookmark());var S=p.createTextRange();S.collapse(false);if(aa.compareEndPoints("StartToEnd",
S)>-1)return{start:O,end:O};p=-aa.moveStart("character",-O);for(t=z.indexOf("\r");t>-1&&t<p;t=z.indexOf("\r",t+1),p++);if(aa.compareEndPoints("EndToEnd",S)>-1)return{start:p,end:O};O=-aa.moveEnd("character",-O);for(t=z.indexOf("\r");t>-1&&t<O;t=z.indexOf("\r",t+1),O++);return{start:p,end:O}};qa=function(p,t,K){var z=p.createTextRange();z.collapse(true);var O=z.duplicate(),aa=0;p=p.value;for(var S=p.indexOf("\n");S>-1&&S<t;S=p.indexOf("\n",S+1))++aa;for(z.move("character",t-aa);S>-1&&S<K;S=p.indexOf("\n",
S+1))++aa;O.move("character",K-aa);z.setEndPoint("EndToEnd",O);z.select()}}J.defineMode("null",function(){return{token:function(p){p.skipToEnd()}}});J.defineMIME("text/plain","null");return J}();
CodeMirror.overlayParser=function(a,b,d){return{startState:function(){return{base:CodeMirror.startState(a),overlay:CodeMirror.startState(b),basePos:0,baseCur:null,overlayPos:0,overlayCur:null}},copyState:function(e){return{base:CodeMirror.copyState(a,e.base),overlay:CodeMirror.copyState(b,e.overlay),basePos:e.basePos,baseCur:null,overlayPos:e.overlayPos,overlayCur:null}},token:function(e,f){e.start==f.basePos&&(f.baseCur=a.token(e,f.base),f.basePos=e.pos);e.start==f.overlayPos&&(e.pos=e.start,f.overlayCur=
b.token(e,f.overlay),f.overlayPos=e.pos);e.pos=Math.min(f.basePos,f.overlayPos);e.eol()&&(f.basePos=f.overlayPos=0);if(f.overlayCur==null)return f.baseCur;return f.baseCur!=null&&d?f.baseCur+" "+f.overlayCur:f.overlayCur},indent:function(e,f){return a.indent(e.base,f)},electricChars:a.electricChars}};
CodeMirror.runMode=function(a,b,d){b=CodeMirror.getMode({indentUnit:2},b);var e=d.nodeType==1;if(e){var f=d,g=[];d=function(v,G){v=="\n"?g.push("<br>"):G?g.push('<span class="cm-'+CodeMirror.htmlEscape(G)+'">'+CodeMirror.htmlEscape(v)+"</span>"):g.push(CodeMirror.htmlEscape(v))}}a=CodeMirror.splitLines(a);for(var j=CodeMirror.startState(b),k=0,l=a.length;k<l;++k){k&&d("\n");for(var n=new CodeMirror.StringStream(a[k]);!n.eol();){var q=b.token(n,j);d(n.current(),q);n.start=n.pos}}e&&(f.innerHTML=g.join(""))};
CodeMirror.defineMode("javascript",function(a,b){function d(x,U){if(x=="variable"){u(U);return A()}}function e(x,U){if(x=="variable"){u(U);return A(e)}if(x=="(")return A(ca(")"),L,v(d,")"),V,J,B)}function f(x){x!=")"&&A(H)}function g(x,U){if(x==";")return A(f);if(U=="in")return A(H);return A(H,Q(";"),f)}function j(x,U){if(U=="in")return A(H);return A(y,g)}function k(x){if(x=="var")return A(n,g);if(x==";")return $(g);if(x=="variable")return A(j);return $(g)}function l(x,U){if(U=="=")return A(H,l);
if(x==",")return A(n)}function n(x,U){if(x=="variable"){u(U);return A(l)}return A()}function q(x){if(x=="}")return A();return $(J,q)}function v(x,U){function X(Z){if(Z==",")return A(x,X);if(Z==U)return A();return A(Q(U))}return function(Z){return Z==U?A():$(x,X)}}function G(x){x=="variable"&&(S.marked="property");if(aa.hasOwnProperty(x))return A(Q(":"),H)}function P(x){if(x=="variable"){S.marked="property";return A()}}function R(x){if(x==":")return A(V,J);return $(y,Q(";"),V)}function y(x,U){if(x==
"operator"&&/\+\+|--/.test(U))return A(y);if(x=="operator")return A(H);if(x!=";"){if(x=="(")return A(ca(")"),v(H,")"),V,y);if(x==".")return A(P,y);if(x=="[")return A(ca("]"),H,Q("]"),V,y)}}function H(x){if(aa.hasOwnProperty(x))return A(y);if(x=="function")return A(e);if(x=="keyword c")return A(H);if(x=="(")return A(ca(")"),H,Q(")"),V,y);if(x=="operator")return A(H);if(x=="[")return A(ca("]"),v(H,"]"),V,y);if(x=="{")return A(ca("}"),v(G,"}"),V,y);return A()}function J(x){if(x=="var")return A(ca("vardef"),
n,Q(";"),V);if(x=="keyword a")return A(ca("form"),H,J,V);if(x=="keyword b")return A(ca("form"),J,V);if(x=="{")return A(ca("}"),q,V);if(x==";")return A();if(x=="function")return A(e);if(x=="for")return A(ca("form"),Q("("),ca(")"),k,Q(")"),V,J,V);if(x=="variable")return A(ca("stat"),R);if(x=="switch")return A(ca("form"),H,ca("}","switch"),Q("{"),q,V,V);if(x=="case")return A(H,Q(":"));if(x=="default")return A(Q(":"));if(x=="catch")return A(ca("form"),L,Q("("),d,Q(")"),J,V,B);return $(ca("stat"),H,Q(";"),
V)}function Q(x){return function(U){return U==x?A():x==";"?$():A(arguments.callee)}}function V(){var x=S.state;x.lexical.prev&&(x.lexical.type==")"&&(x.indented=x.lexical.indented),x.lexical=x.lexical.prev)}function ca(x,U){var X=function(){var Z=S.state;Z.lexical=new ga(Z.indented,S.stream.column(),x,null,Z.lexical,U)};X.lex=true;return X}function B(){S.state.localVars=S.state.context.vars;S.state.context=S.state.context.prev}function L(){S.state.context||(S.state.localVars=ja);S.state.context={prev:S.state.context,
vars:S.state.localVars}}function u(x){var U=S.state;if(U.context){S.marked="def";for(var X=U.localVars;X;X=X.next)if(X.name==x)return;U.localVars={name:x,next:U.localVars}}}function A(){$.apply(null,arguments);return true}function $(){for(var x=arguments.length-1;x>=0;x--)S.cc.push(arguments[x])}function ga(x,U,X,Z,pa,ha){this.indented=x;this.column=U;this.type=X;this.prev=pa;this.info=ha;Z!=null&&(this.align=Z)}function ma(x,U){for(var X=false,Z;Z=x.next();){if(Z=="/"&&X){U.tokenize=Y;break}X=Z==
"*"}return da("comment","comment")}function T(x){return function(U,X){fa(U,x)||(X.tokenize=Y);return da("string","string")}}function Y(x,U){var X=x.next();if(X=='"'||X=="'"){X=T(X);U.tokenize=X;return X(x,U)}if(/[\[\]{}\(\),;\:\.]/.test(X))return da(X);if(X=="0"&&x.eat(/x/i)){x.eatWhile(/[\da-f]/i);return da("number","atom")}if(/\d/.test(X)){x.match(/^\d*(?:\.\d*)?(?:e[+\-]?\d+)?/);return da("number","atom")}if(X=="/"){if(x.eat("*")){X=ma;U.tokenize=X;return X(x,U)}if(x.eat("/")){x.skipToEnd();return da("comment",
"comment")}if(U.reAllowed){fa(x,"/");x.eatWhile(/[gimy]/);return da("regexp","string")}x.eatWhile(K);return da("operator",null,x.current())}if(K.test(X)){x.eatWhile(K);return da("operator",null,x.current())}x.eatWhile(/[\w\$_]/);X=x.current();var Z=t.propertyIsEnumerable(X)&&t[X];return Z?da(Z.type,Z.style,X):da("variable","variable",X)}function da(x,U,X){z=x;O=X;return U}function fa(x,U){for(var X=false,Z;(Z=x.next())!=null;){if(Z==U&&!X)return false;X=!X&&Z=="\\"}return X}var qa=a.indentUnit,p=
b.json,t=function(){function x(na){return{type:na,style:"keyword"}}var U=x("keyword a"),X=x("keyword b"),Z=x("keyword c"),pa=x("operator"),ha={type:"atom",style:"atom"};return{"if":U,"while":U,"with":U,"else":X,"do":X,"try":X,"finally":X,"return":Z,"break":Z,"continue":Z,"new":Z,"delete":Z,"throw":Z,"var":x("var"),"function":x("function"),"catch":x("catch"),"for":x("for"),"switch":x("switch"),"case":x("case"),"default":x("default"),"in":pa,"typeof":pa,"instanceof":pa,"true":ha,"false":ha,"null":ha,
undefined:ha,NaN:ha,Infinity:ha}}(),K=/[+\-*&%=<>!?|]/,z,O,aa={atom:true,number:true,variable:true,string:true,regexp:true},S={state:null,column:null,marked:null,cc:null},ja={name:"this",next:{name:"arguments"}};V.lex=true;return{startState:function(x){return{tokenize:Y,reAllowed:true,cc:[],lexical:new ga((x||0)-qa,0,"block",false),localVars:null,context:null,indented:0}},token:function(x,U){x.sol()&&(U.lexical.hasOwnProperty("align")||(U.lexical.align=false),U.indented=x.indentation());if(x.eatSpace())return null;
var X=U.tokenize(x,U);if(z=="comment")return X;U.reAllowed=z=="operator"||z=="keyword c"||z.match(/^[\[{}\(,;:]$/);var Z;a:{var pa=z,ha=O,na=U.cc;S.state=U;S.stream=x;S.marked=null;S.cc=na;for(U.lexical.hasOwnProperty("align")||(U.lexical.align=true);;)if((na.length?na.pop():p?H:J)(pa,ha)){for(;na.length&&na[na.length-1].lex;)na.pop()();if(S.marked){Z=S.marked;break a}if(Z=pa=="variable")b:{for(Z=U.localVars;Z;Z=Z.next)if(Z.name==ha){Z=true;break b}Z=void 0}if(Z){Z="variable-2";break a}Z=X;break a}}return Z},
indent:function(x,U){if(x.tokenize!=Y)return 0;var X=U&&U.charAt(0),Z=x.lexical,pa=Z.type,ha=X==pa;return pa=="vardef"?Z.indented+4:pa=="form"&&X=="{"?Z.indented:pa=="stat"||pa=="form"?Z.indented+qa:Z.info=="switch"&&!ha?Z.indented+(/^(?:case|default)\b/.test(U)?qa:2*qa):Z.align?Z.column+(ha?0:1):Z.indented+(ha?0:qa)},electricChars:":{}"}});CodeMirror.defineMIME("text/javascript","javascript");CodeMirror.defineMIME("application/json",{name:"javascript",json:true});
CodeMirror.defineMode("xml",function(a,b){function d(B){if(B=="word"&&y.allowUnquoted){ca="string";return l()}if(B=="string")return l();return n()}function e(B){if(B=="word"){ca="attribute";return l(e)}if(B=="equals")return l(d,e);return n()}function f(B){return function(L){B&&(ca="error");if(L=="endTag")return l();return n()}}function g(B){return function(L){if(L=="selfcloseTag"||L=="endTag"&&y.autoSelfClosers.hasOwnProperty(V.tagName.toLowerCase()))return l();if(L=="endTag"){k(V.tagName,B);return l()}return l()}}
function j(B){if(B=="openTag"){V.tagName=J;return l(e,g(V.startOfLine))}if(B=="closeTag"){B=false;if(V.context){B=V.context.tagName!=J;V.context&&(V.context=V.context.prev)}else B=true;B&&(ca="error");return l(f(B))}if(B=="string"){(!V.context||V.context.name!="!cdata")&&k("!cdata");if(V.tokenize==P)V.context&&(V.context=V.context.prev);return l()}return l()}function k(B,L){var u=y.doNotIndent.hasOwnProperty(B)||V.context&&V.context.noIndent;V.context={prev:V.context,tagName:B,indent:V.indented,startOfLine:L,
noIndent:u}}function l(){n.apply(null,arguments);return true}function n(){for(var B=arguments.length-1;B>=0;B--)V.cc.push(arguments[B])}function q(B,L){return function(u,A){for(;!u.eol();){if(u.match(L)){A.tokenize=P;break}u.next()}return B}}function v(B){return function(L,u){for(;!L.eol();)if(L.next()==B){u.tokenize=G;break}return"string"}}function G(B,L){var u=B.next();if(u==">"||u=="/"&&B.eat(">")){L.tokenize=P;Q=u==">"?"endTag":"selfcloseTag";return"tag"}if(u=="="){Q="equals";return null}if(/[\'\"]/.test(u)){L.tokenize=
v(u);return L.tokenize(B,L)}B.eatWhile(/[^\s\u00a0=<>\"\'\/?]/);return"word"}function P(B,L){function u($){L.tokenize=$;return $(B,L)}var A=B.next();if(A=="<"){if(B.eat("!")){if(B.eat("["))return B.match("CDATA[")?u(q("atom","]]\>")):null;if(B.match("--"))return u(q("comment","--\>"));if(B.match("DOCTYPE")){B.eatWhile(/[\w\._\-]/);return u(q("meta",">"))}return null}if(B.eat("?")){B.eatWhile(/[\w\._\-]/);L.tokenize=q("meta","?>");return"meta"}Q=B.eat("/")?"closeTag":"openTag";B.eatSpace();for(J="";A=
B.eat(/[^\s\u00a0=<>\"\'\/?]/);)J+=A;L.tokenize=G;return"tag"}if(A=="&"){B.eatWhile(/[^;]/);B.eat(";");return"atom"}B.eatWhile(/[^&<]/);return null}var R=a.indentUnit,y=b.htmlMode?{autoSelfClosers:{br:true,img:true,hr:true,link:true,input:true,meta:true,col:true,frame:true,base:true,area:true},doNotIndent:{pre:true,"!cdata":true},allowUnquoted:true}:{autoSelfClosers:{},doNotIndent:{"!cdata":true},allowUnquoted:false},H=b.alignCDATA,J,Q,V,ca;return{startState:function(){return{tokenize:P,cc:[],indented:0,
startOfLine:true,tagName:null,context:null}},token:function(B,L){B.sol()&&(L.startOfLine=true,L.indented=B.indentation());if(B.eatSpace())return null;ca=Q=J=null;var u=L.tokenize(B,L);if((u||Q)&&u!="xml-comment")for(V=L;;)if((L.cc.pop()||j)(Q||u))break;L.startOfLine=false;return ca||u},indent:function(B,L){var u=B.context;if(u&&u.noIndent)return 0;if(H&&/<!\[CDATA\[/.test(L))return 0;for(u&&/^<\//.test(L)&&(u=u.prev);u&&!u.startOfLine;)u=u.prev;return u?u.indent+R:0},compareStates:function(B,L){if(B.indented!=
L.indented||B.tagName!=L.tagName)return false;for(var u=B.context,A=L.context;;u=u.prev,A=A.prev){if(!u||!A)return u==A;if(u.tagName!=A.tagName)return false}},electricChars:"/"}});CodeMirror.defineMIME("application/xml","xml");CodeMirror.defineMIME("text/html",{name:"xml",htmlMode:true});
CodeMirror.defineMode("css",function(a){function b(l){return function(n,q){for(var v=false,G;(G=n.next())!=null;){if(G==l&&!v)break;v=!v&&G=="\\"}v||(q.tokenize=f);return g("string","string")}}function d(l,n){for(var q=0,v;(v=l.next())!=null;){if(q>=2&&v==">"){n.tokenize=f;break}q=v=="-"?q+1:0}return g("comment","comment")}function e(l,n){for(var q=false,v;(v=l.next())!=null;){if(q&&v=="/"){n.tokenize=f;break}q=v=="*"}return g("comment","comment")}function f(l,n){var q=l.next();if(q=="@"){l.eatWhile(/\w/);
return g("meta",l.current())}if(q=="/"&&l.eat("*")){n.tokenize=e;return e(l,n)}if(q=="<"&&l.eat("!")){n.tokenize=d;return d(l,n)}if(q=="=")g(null,"compare");else{if(q!="~"&&q!="|"||!l.eat("=")){if(q=='"'||q=="'"){n.tokenize=b(q);return n.tokenize(l,n)}if(q=="#"){l.eatWhile(/\w/);return g("atom","hash")}if(q=="!"){l.match(/^\s*\w*/);return g("keyword","important")}if(/\d/.test(q)){l.eatWhile(/[\w.%]/);return g("number","unit")}if(/[,.+>*\/]/.test(q))return g(null,"select-op");if(/[;{}:\[\]]/.test(q))return g(null,
q);l.eatWhile(/[\w\\\-_]/);return g("variable","variable")}return g(null,"compare")}}function g(l,n){k=n;return l}var j=a.indentUnit,k;return{startState:function(l){return{tokenize:f,baseIndent:l||0,stack:[]}},token:function(l,n){if(l.eatSpace())return null;var q=n.tokenize(l,n),v=n.stack[n.stack.length-1];if(k=="hash"&&v=="rule")q="atom";else if(q=="variable")if(v=="rule")q="number";else if(!v||v=="@media{")q="tag";v=="rule"&&/^[\{\};]$/.test(k)&&n.stack.pop();k=="{"?v=="@media"?n.stack[n.stack.length-
1]="@media{":n.stack.push("{"):k=="}"?n.stack.pop():k=="@media"?n.stack.push("@media"):v=="{"&&k!="comment"&&n.stack.push("rule");return q},indent:function(l,n){var q=l.stack.length;/^\}/.test(n)&&(q-=l.stack[l.stack.length-1]=="rule"?2:1);return l.baseIndent+q*j},electricChars:"}"}});CodeMirror.defineMIME("text/css","css");
CodeMirror.defineMode("htmlmixed",function(a){function b(l,n){if(l.match(/^<\/\s*style\s*>/i,false)){n.token=f;n.localState=null;return f(l,n)}return e(l,/<\/\s*style\s*>/,k.token(l,n.localState))}function d(l,n){if(l.match(/^<\/\s*script\s*>/i,false)){n.token=f;n.curState=null;return f(l,n)}return e(l,/<\/\s*script\s*>/,j.token(l,n.localState))}function e(l,n,q){var v=l.current();n=v.search(n);n>-1&&l.backUp(v.length-n);return q}function f(l,n){var q=g.token(l,n.htmlState);q=="tag"&&l.current()==
">"&&n.htmlState.context&&(/^script$/i.test(n.htmlState.context.tagName)?(n.token=d,n.localState=j.startState(g.indent(n.htmlState,""))):/^style$/i.test(n.htmlState.context.tagName)&&(n.token=b,n.localState=k.startState(g.indent(n.htmlState,""))));return q}var g=CodeMirror.getMode(a,{name:"xml",htmlMode:true}),j=CodeMirror.getMode(a,"javascript"),k=CodeMirror.getMode(a,"css");return{startState:function(){var l=g.startState();return{token:f,localState:null,htmlState:l}},copyState:function(l){if(l.localState)var n=
CodeMirror.copyState(l.token==b?k:j,l.localState);return{token:l.token,localState:n,htmlState:CodeMirror.copyState(g,l.htmlState)}},token:function(l,n){return n.token(l,n)},indent:function(l,n){return l.token==f||/^\s*<\//.test(n)?g.indent(l.htmlState,n):l.token==d?j.indent(l.localState,n):k.indent(l.localState,n)},electricChars:"/{}:"}});CodeMirror.defineMIME("text/html","htmlmixed");
CodeMirror.defineMode("clike",function(a,b){function d(B){return B.context=B.context.prev}function e(B,L,u){return B.context=new f(B.indented,L,u,null,B.context)}function f(B,L,u,A,$){this.indented=B;this.column=L;this.type=u;this.align=A;this.prev=$}function g(B,L){for(var u=false,A;A=B.next();){if(A=="/"&&u){L.tokenize=l;break}u=A=="*"}return n("comment","comment")}function j(B,L){for(var u;(u=B.next())!=null;)if(u=='"'&&!B.eat('"')){L.tokenize=l;break}return n("string","string")}function k(B){return function(L,
u){for(var A=false,$,ga=false;($=L.next())!=null;){if($==B&&!A){ga=true;break}A=!A&&$=="\\"}if(ga||!A&&!y)u.tokenize=l;return n("string","string")}}function l(B,L){var u=B.next();if(u=='"'||u=="'")return q(B,L,k(u));if(/[\[\]{}\(\),;\:\.]/.test(u))return n(u);if(u=="#"&&R&&L.startOfLine){B.skipToEnd();return n("directive","meta")}if(/\d/.test(u)){B.eatWhile(/[\w\.]/);return n("number","number")}if(u=="/"){if(B.eat("*"))return q(B,L,g);if(B.eat("/")){B.skipToEnd();return n("comment","comment")}B.eatWhile(V);
return n("operator")}if(V.test(u)){B.eatWhile(V);return n("operator")}if(Q&&u=="@"&&B.eat('"'))return q(B,L,j);if(J&&u=="@"){B.eatWhile(/[\w\$_]/);return n("annotation","meta")}if(H&&u=="$"){B.eatWhile(/[\w\$_]/);return n("word","variable")}B.eatWhile(/[\w\$_]/);u=B.current();if(G&&G.propertyIsEnumerable(u))return n("keyword","keyword");if(P&&P.propertyIsEnumerable(u))return n("atom","atom");return n("word")}function n(B,L){ca=B;return L}function q(B,L,u){L.tokenize=u;return u(B,L)}var v=a.indentUnit,
G=b.keywords,P=b.atoms,R=b.useCPP,y=b.multiLineStrings,H=b.$vars,J=b.atAnnotations,Q=b.atStrings,V=/[+\-*&%=<>!?|]/,ca;return{startState:function(B){return{tokenize:l,context:new f((B||0)-v,0,"top",false),indented:0,startOfLine:true}},token:function(B,L){var u=L.context;B.sol()&&(u.align==null&&(u.align=false),L.indented=B.indentation(),L.startOfLine=true);if(B.eatSpace())return null;var A=L.tokenize(B,L);if(ca=="comment")return A;u.align==null&&(u.align=true);ca!=";"&&ca!=":"||u.type!="statement"?
ca=="{"?e(L,B.column(),"}"):ca=="["?e(L,B.column(),"]"):ca=="("?e(L,B.column(),")"):ca=="}"?(u.type=="statement"&&(u=d(L)),u.type=="}"&&(u=d(L)),u.type=="statement"&&(u=d(L))):ca==u.type?d(L):(u.type=="}"||u.type=="top")&&e(L,B.column(),"statement"):d(L);L.startOfLine=false;return A},indent:function(B,L){if(B.tokenize!=l)return 0;var u=L&&L.charAt(0),A=B.context,$=u==A.type;return A.type=="statement"?A.indented+(u=="{"?0:v):A.align?A.column+($?0:1):A.indented+($?0:v)},electricChars:"{}"}});
(function(){function a(b){var d={};b=b.split(" ");for(var e=0;e<b.length;++e)d[b[e]]=true;return d}CodeMirror.defineMIME("text/x-csrc",{name:"clike",useCPP:true,keywords:a("auto if break int case long char register continue return default short do sizeof double static else struct entry switch extern typedef float union for unsigned goto while enum void const signed volatile"),atoms:a("null")});CodeMirror.defineMIME("text/x-c++src",{name:"clike",useCPP:true,keywords:a("auto if break int case long char register continue return default short do sizeof double static else struct entry switch extern typedef float union for unsigned goto while enum void const signed volatile asm dynamic_cast namespace reinterpret_cast try bool explicit new static_cast typeid catch operator template typename class friend private this using const_cast inline public throw virtual delete mutable protected wchar_t"),
atoms:a("true false null")});CodeMirror.defineMIME("text/x-java",{name:"clike",atAnnotations:true,keywords:a("abstract assert boolean break byte case catch char class const continue default do double else enum extends final finally float for goto if implements import instanceof int interface long native new package private protected public return short static strictfp super switch synchronized this throw throws transient try void volatile while"),atoms:a("true false null")});CodeMirror.defineMIME("text/x-csharp",
{name:"clike",atAnnotations:true,atStrings:true,keywords:a("abstract as base bool break byte case catch char checked class const continue decimal default delegate do double else enum event explicit extern finally fixed float for foreach goto if implicit in int interface internal is lock long namespace new object operator out override params private protected public readonly ref return sbyte sealed short sizeof stackalloc static string struct switch this throw try typeof uint ulong unchecked unsafe ushort using virtual void volatile while add alias ascending descending dynamic from get global group into join let orderby partial remove select set value var yield"),
atoms:a("true false null")})})();
CodeMirror.defineMode("python",function(a){function b(u,A){L=null;var $=A.tokenize(u,A),ga=u.current();if(ga==="."){$=A.tokenize(u,A);u.current();return $==="variable"?"variable":k}if(ga==="@"){$=A.tokenize(u,A);ga=u.current();return $==="variable"||ga==="@staticmethod"||ga==="@classmethod"?"meta":k}if(ga==="pass"||ga==="return")A.dedent+=1;(ga===":"&&!A.lambda&&A.scopes[0].type=="py"||L==="indent")&&e(u,A);var ma="[({".indexOf(ga);ma!==-1&&e(u,A,"])}".slice(ma,ma+1));if(L==="dedent"&&d(u,A))return k;
ma="])}".indexOf(ga);if(ma!==-1&&d(u,A))return k;A.dedent>0&&u.eol()&&A.scopes[0].type=="py"&&(A.scopes.length>1&&A.scopes.shift(),A.dedent-=1);return $}function d(u,A){if(A.scopes.length!=1){if(A.scopes[0].type==="py"){for(var $=u.indentation(),ga=-1,ma=0;ma<A.scopes.length;++ma)if($===A.scopes[ma].offset){ga=ma;break}if(ga===-1)return true;for(;A.scopes[0].offset!==$;)A.scopes.shift();return false}A.scopes.shift();return false}}function e(u,A,$){$=$||"py";var ga=0;if($==="py")for(u=0;u<A.scopes.length;++u){if(A.scopes[u].type===
"py"){ga=A.scopes[u].offset+a.indentUnit;break}}else ga=u.column()+u.current().length;A.scopes.unshift({offset:ga,type:$})}function f(u){for(;"rub".indexOf(u[0].toLowerCase())>=0;)u=u.substr(1);var A=RegExp(u),$=u.length==1,ga="string";return function(ma,T){for(;!ma.eol();){ma.eatWhile(/[^'"\\]/);if(ma.eat("\\")){ma.next();if($&&ma.eol())return ga}else{if(ma.match(A)){T.tokenize=g;return ga}ma.eat(/['"]/)}}$&&(a.mode.singleLineStringErrors?ga=k:T.tokenize=g);return ga}}function g(u,A){if(u.sol()){var $=
A.scopes[0].offset;if(u.eatSpace()){var ga=u.indentation();ga>$?L="indent":ga<$&&(L="dedent");return null}$>0&&d(u,A)}if(u.eatSpace())return null;if(u.peek()==="#"){u.skipToEnd();return"comment"}if(u.match(/^[0-9\.]/,false)){$=false;u.match(/^\d*\.\d+(e[\+\-]?\d+)?/i)&&($=true);u.match(/^\d+\.\d*/)&&($=true);u.match(/^\.\d+/)&&($=true);if($){u.eat(/J/i);return"number"}$=false;u.match(/^0x[0-9a-f]+/i)&&($=true);u.match(/^0b[01]+/i)&&($=true);u.match(/^0o[0-7]+/i)&&($=true);u.match(/^[1-9]\d*(e[\+\-]?\d+)?/)&&
(u.eat(/J/i),$=true);u.match(/^0(?![\dx])/i)&&($=true);if($){u.eat(/L/i);return"number"}}if(u.match(V)){A.tokenize=f(u.current());return A.tokenize(u,A)}if(u.match(G)||u.match(v))return null;if(u.match(q)||u.match(l)||u.match(R))return"operator";if(u.match(n))return null;if(u.match(B))return"builtin";if(u.match(ca))return"keyword";if(u.match(P))return"variable";u.next();return k}function j(u){return RegExp("^(("+u.join(")|(")+"))\\b")}var k="error",l=/^[\+\-\*\/%&|\^~<>!]/,n=/^[\(\)\[\]\{\}@,:`=;\.]/,
q=/^((==)|(!=)|(<=)|(>=)|(<>)|(<<)|(>>)|(\/\/)|(\*\*))/,v=/^((\+=)|(\-=)|(\*=)|(%=)|(\/=)|(&=)|(\|=)|(\^=))/,G=/^((\/\/=)|(>>=)|(<<=)|(\*\*=))/,P=/^[_A-Za-z][_A-Za-z0-9]*/,R=j(["and","or","not","is","in"]),y=["as","assert","break","class","continue","def","del","elif","else","except","finally","for","from","global","if","import","lambda","pass","raise","return","try","while","with","yield"],H=["bool","classmethod","complex","dict","enumerate","float","frozenset","int","list","object","property","reversed",
"set","slice","staticmethod","str","super","tuple","type"],J={types:["basestring","buffer","file","long","unicode","xrange"],keywords:["exec","print"]},Q={types:["bytearray","bytes","filter","map","memoryview","open","range","zip"],keywords:["nonlocal"]};if(!a.mode.version||parseInt(a.mode.version,10)!==3){y=y.concat(J.keywords);H=H.concat(J.types);var V=/^(([rub]|(ur)|(br))?('{3}|"{3}|['"]))/i}else{y=y.concat(Q.keywords);H=H.concat(Q.types);V=/^(([rb]|(br))?('{3}|"{3}|['"]))/i}var ca=j(y),B=j(H),
L=null;return{startState:function(u){return{tokenize:g,scopes:[{offset:u||0,type:"py"}],lastToken:null,lambda:false,dedent:0}},token:function(u,A){var $=b(u,A);A.lastToken={style:$,content:u.current()};u.eol()&&u.lambda&&(A.lambda=false);return $},indent:function(u){if(u.tokenize!=g)return 0;return u.scopes[0].offset}}});CodeMirror.defineMIME("text/x-python","python");
(function(){function a(d){var e={};d=d.split(" ");for(var f=0;f<d.length;++f)e[d[f]]=true;return e}var b={name:"clike",keywords:a("abstract and array as break case catch cfunction class clone const continue declare default do else elseif enddeclare endfor endforeach endif endswitch endwhile extends final for foreach function global goto if implements interface instanceof namespace new or private protected public static switch throw try use var while xor return"),multiLineStrings:true,$vars:true,atoms:a("true false null")};
CodeMirror.defineMode("php",function(d){function e(l,n){if(n.curMode==f){var q=f.token(l,n.curState);q=="meta"&&/^<\?/.test(l.current())?(n.curMode=k,n.curState=n.php,n.curClose=/^\?>/):q=="tag"&&l.current()==">"&&n.curState.context&&(/^script$/i.test(n.curState.context.tagName)?(n.curMode=g,n.curState=g.startState(f.indent(n.curState,"")),n.curClose=/^<\/\s*script\s*>/i):/^style$/i.test(n.curState.context.tagName)&&(n.curMode=j,n.curState=j.startState(f.indent(n.curState,"")),n.curClose=/^<\/\s*style\s*>/i));
return q}if(l.match(n.curClose,false)){n.curMode=f;n.curState=n.html;n.curClose=null;return e(l,n)}return n.curMode.token(l,n.curState)}var f=CodeMirror.getMode(d,"text/html"),g=CodeMirror.getMode(d,"text/javascript"),j=CodeMirror.getMode(d,"text/css"),k=CodeMirror.getMode(d,b);return{startState:function(){var l=f.startState();return{html:l,php:k.startState(),curMode:f,curState:l,curClose:null}},copyState:function(l){var n=l.html,q=CodeMirror.copyState(f,n),v=l.php,G=CodeMirror.copyState(k,v),P;l.curState==
n?P=q:l.curState==v?P=G:P=CodeMirror.copyState(l.curMode,l.curState);return{html:q,php:G,curMode:l.curMode,curState:P,curClose:l.curClose}},token:e,indent:function(l,n){if(l.curMode!=k&&/^\s*<\//.test(n)||l.curMode==k&&/^\?>/.test(n))return f.indent(l.html,n);return l.curMode.indent(l.curState,n)},electricChars:"/{}:"}});CodeMirror.defineMIME("application/x-httpd-php","php");CodeMirror.defineMIME("text/x-php",b)})();
CodeMirror.defineMode("haskell",function(){function a(y,H){if(y.eat("\\"))return f(y,H,b);y.next();H(e);return"error"}function b(y,H){for(;!y.eol();){var J=y.next();if(J=='"'){H(e);return"string"}if(J=="\\"){if(y.eol()||y.eat(P)){H(a);return"string"}y.eat("&")||y.next()}}H(e);return"error"}function d(y,H){if(H==0)return e;return function(J,Q){for(var V=H;!J.eol();){var ca=J.next();if(ca=="{"&&J.eat("-"))++V;else if(ca=="-"&&J.eat("}")){--V;if(V==0){Q(e);return y}}}Q(d(y,V));return y}}function e(y,
H){if(y.eatWhile(P))return null;var J=y.next();if(G.test(J)){if(J=="{"&&y.eat("-")){var Q="comment";y.eat("#")&&(Q="meta");return f(y,H,d(Q,1))}return null}if(J=="'"){y.eat("\\")?y.next():y.next();if(y.eat("'"))return"string";return"error"}if(J=='"')return f(y,H,b);if(j.test(J)){y.eatWhile(q);if(y.eat("."))return"qualifier";return"variable-2"}if(g.test(J)){y.eatWhile(q);return"variable"}if(k.test(J)){if(J=="0"){if(y.eat(/[xX]/)){y.eatWhile(l);return"integer"}if(y.eat(/[oO]/)){y.eatWhile(n);return"number"}}y.eatWhile(k);
Q="number";y.eat(".")&&(Q="number",y.eatWhile(k));y.eat(/[eE]/)&&(Q="number",y.eat(/[-+]/),y.eatWhile(k));return Q}if(v.test(J)){if(J=="-"&&y.eat(/-/)){y.eatWhile(/-/);if(!y.eat(v)){y.skipToEnd();return"comment"}}Q="variable";J==":"&&(Q="variable-2");y.eatWhile(v);return Q}return"error"}function f(y,H,J){H(J);return J(y,H)}var g=/[a-z_]/,j=/[A-Z]/,k=/[0-9]/,l=/[0-9A-Fa-f]/,n=/[0-7]/,q=/[a-z_A-Z0-9']/,v=/[-!#$%&*+.\/<=>?@\\^|~:]/,G=/[(),;[\]`{}]/,P=/[ \t\v\f]/,R=function(){function y(J){return function(){for(var Q=
0;Q<arguments.length;Q++)H[arguments[Q]]=J}}var H={};y("keyword")("case","class","data","default","deriving","do","else","foreign","if","import","in","infix","infixl","infixr","instance","let","module","newtype","of","then","type","where","_");y("keyword")("..",":","::","=","\\",'"',"<-","->","@","~","=>");y("builtin")("!!","$!","$","&&","+","++","-",".","/","/=","<","<=","=<<","==",">",">=",">>",">>=","^","^^","||","*","**");y("builtin")("Bool","Bounded","Char","Double","EQ","Either","Enum","Eq",
"False","FilePath","Float","Floating","Fractional","Functor","GT","IO","IOError","Int","Integer","Integral","Just","LT","Left","Maybe","Monad","Nothing","Num","Ord","Ordering","Rational","Read","ReadS","Real","RealFloat","RealFrac","Right","Show","ShowS","String","True");y("builtin")("abs","acos","acosh","all","and","any","appendFile","asTypeOf","asin","asinh","atan","atan2","atanh","break","catch","ceiling","compare","concat","concatMap","const","cos","cosh","curry","cycle","decodeFloat","div","divMod",
"drop","dropWhile","either","elem","encodeFloat","enumFrom","enumFromThen","enumFromThenTo","enumFromTo","error","even","exp","exponent","fail","filter","flip","floatDigits","floatRadix","floatRange","floor","fmap","foldl","foldl1","foldr","foldr1","fromEnum","fromInteger","fromIntegral","fromRational","fst","gcd","getChar","getContents","getLine","head","id","init","interact","ioError","isDenormalized","isIEEE","isInfinite","isNaN","isNegativeZero","iterate","last","lcm","length","lex","lines","log",
"logBase","lookup","map","mapM","mapM_","max","maxBound","maximum","maybe","min","minBound","minimum","mod","negate","not","notElem","null","odd","or","otherwise","pi","pred","print","product","properFraction","putChar","putStr","putStrLn","quot","quotRem","read","readFile","readIO","readList","readLn","readParen","reads","readsPrec","realToFrac","recip","rem","repeat","replicate","return","reverse","round","scaleFloat","scanl","scanl1","scanr","scanr1","seq","sequence","sequence_","show","showChar",
"showList","showParen","showString","shows","showsPrec","significand","signum","sin","sinh","snd","span","splitAt","sqrt","subtract","succ","sum","tail","take","takeWhile","tan","tanh","toEnum","toInteger","toRational","truncate","uncurry","undefined","unlines","until","unwords","unzip","unzip3","userError","words","writeFile","zip","zip3","zipWith","zipWith3");return H}();return{startState:function(){return{f:e}},copyState:function(y){return{f:y.f}},token:function(y,H){var J=H.f(y,function(V){H.f=
V}),Q=y.current();return Q in R?R[Q]:J}}});CodeMirror.defineMIME("text/x-haskell","haskell");CodeMirror.defineMode("diff",function(){return{token:function(a){var b=a.next();a.skipToEnd();if(b=="+")return"plus";if(b=="-")return"minus";if(b=="@")return"rangeinfo"}}});CodeMirror.defineMIME("text/x-diff","diff");
CodeMirror.defineMode("stex",function(){function a(j,k){var l=j.peek();if(l=="{"||l=="["){var n=f(k);n.openBracket(l);j.eat(l);k.f=d;return"bracket"}if(/[ \t\r]/.test(l)){j.eat(l);return null}k.f=d;(n=f(k))&&k.cmdState.length>0&&k.cmdState.pop().closeBracket();return d(j,k)}function b(j,k){j.skipToEnd();k.f=d;return"comment"}function d(j,k){if(j.match(/^\\[a-z]+/)){var l=j.current();l=l.substr(1,l.length-1);l=g[l];typeof l=="undefined"&&(l=g.DEFAULT);l=new l;k.cmdState.push(l);k.f=a;return l.style}var n=
j.next();if(n=="%"){k.f=b;return"comment"}if(n=="}"||n=="]"){if(l=f(k)){l.closeBracket(n);k.f=a}else return"error";return"bracket"}if(n=="{"||n=="["){l=g.DEFAULT;l=new l;k.cmdState.push(l);return"bracket"}if(/\d/.test(n)){j.eatWhile(/[\w.%]/);return"atom"}j.eatWhile(/[\w-_]/);a:{l=k.cmdState;for(n=l.length-1;n>=0;n--){var q=l[n];if(q.name!="DEFAULT"){l=q.styleIdentifier();break a}}l=null}return l}function e(j,k,l,n){return function(){this.name=j;this.bracketNo=0;this.style=k;this.styles=n;this.brackets=
l;this.styleIdentifier=function(){return this.bracketNo<=this.styles.length?this.styles[this.bracketNo-1]:null};this.openBracket=function(){this.bracketNo++;return"bracket"};this.closeBracket=function(){}}}function f(j){return j.cmdState.length>0?j.cmdState[j.cmdState.length-1]:null}var g=[];g.importmodule=e("importmodule","tag","{[",["string","builtin"]);g.documentclass=e("documentclass","tag","{[",["","atom"]);g.usepackage=e("documentclass","tag","[",["atom"]);g.begin=e("documentclass","tag","[",
["atom"]);g.end=e("documentclass","tag","[",["atom"]);g.DEFAULT=function(){this.name="DEFAULT";this.style="tag";this.styleIdentifier=function(){};this.openBracket=function(){};this.closeBracket=function(){}};return{startState:function(){return{f:d,cmdState:[]}},copyState:function(j){return{f:j.f,cmdState:j.cmdState.slice(0,j.cmdState.length)}},token:function(j,k){var l=k.f(j,k);j.current();return l}}});CodeMirror.defineMIME("text/x-stex","stex");
CodeMirror.defineMode("smalltalk",function(a){function b(q,v,G){return q.context=new d(q.indented,v,G,null,q.context)}function d(q,v,G,P,R){this.indented=q;this.column=v;this.type=G;this.align=P;this.prev=R}function e(q){return function(v,G){for(var P,R=false;(P=v.next())!=null;)if(P==q){R=true;break}R&&(G.tokenize=g);return j("comment","comment")}}function f(q){return function(v,G){for(var P=false,R,y=false;(R=v.next())!=null;){if(R==q&&!P){y=true;break}P=!P&&R=="\\"}if(y||!P)G.tokenize=g;return j("string",
"string")}}function g(q,v){var G=q.next();if(G=='"'){G=e(G);v.tokenize=G;return G(q,v)}if(G=="'"){G=f(G);v.tokenize=G;return G(q,v)}if(G=="#"){q.eatWhile(/[\w\$_]/);return j("string","string")}if(/\d/.test(G)){q.eatWhile(/[\w\.]/);return j("number","number")}if(/[\[\]()]/.test(G))return j(G,null);q.eatWhile(/[\w\$_]/);if(k&&k.propertyIsEnumerable(q.current()))return j("keyword","keyword");return j("word","variable")}function j(q,v){n=q;return v}var k={"true":1,"false":1,nil:1,self:1,"super":1,thisContext:1},
l=a.indentUnit,n;return{startState:function(q){return{tokenize:g,context:new d((q||0)-l,0,"top",false),indented:0,startOfLine:true}},token:function(q,v){var G=v.context;q.sol()&&(G.align==null&&(G.align=false),v.indented=q.indentation(),v.startOfLine=true);if(q.eatSpace())return null;var P=v.tokenize(q,v);if(n=="comment")return P;G.align==null&&(G.align=true);n=="["?b(v,q.column(),"]"):n=="("?b(v,q.column(),")"):n==G.type&&(v.context=v.context.prev);v.startOfLine=false;return P},indent:function(q,
v){if(q.tokenize!=g)return 0;var G=v&&v.charAt(0),P=q.context;G=G==P.type;return P.align?P.column+(G?0:1):P.indented+(G?0:l)},electricChars:"]"}});CodeMirror.defineMIME("text/x-stsrc",{name:"smalltalk"});
CodeMirror.defineMode("rst",function(a,b){function d(T,Y,da){if(T.eol()||T.eatSpace()){T.skipToEnd();return da}q(Y,T);return null}function e(T,Y){if(!G)return d(T,Y,"verbatim");if(T.sol()){T.eatSpace()||q(Y,T);return null}return G.token(T,Y.ctx.local)}function f(T,Y){return d(T,Y,"comment")}function g(T,Y){if(!Y.ctx.start||T.sol())return d(T,Y,"body");T.skipToEnd();Y.ctx={};return"body"}function j(T,Y){var da=null;if(T.match(y))da="directive";else if(T.match(H))da="hyperlink";else if(T.match(J))da=
"footnote";else if(T.match(Q))da="citation";else{T.eatSpace();if(T.eol()){q(Y,T);return null}T.skipToEnd();v(Y,f);return"comment"}v(Y,g,{start:true});return da}function k(T,Y){function da(p){Y.ctx.prev=p;return qa}var fa=T.next(),qa=Y.ctx.token;if(fa!=Y.ctx.ch)return da(fa);if(/\s/.test(Y.ctx.prev))return da(fa);if(Y.ctx.wide){fa=T.next();if(fa!=Y.ctx.ch)return da(fa)}if(!T.eol()&&!A.test(T.peek())){Y.ctx.wide&&T.backUp(1);return da(fa)}v(Y,l);q(Y,fa);return qa}function l(T,Y){function da(z){return qa||
!Y.ctx.back||z.test(Y.ctx.back)}var fa,qa,p;if(T.eat(/\\/)){fa=T.next();q(Y,fa);return null}if((qa=T.sol())&&(fa=T.eat(R))){for(p=0;T.eat(fa);p++);if(p>=3&&T.match(/^\s*$/)){q(Y,null);return"section"}T.backUp(p+1)}if(qa&&T.match(B)){T.eol()||v(Y,j);return"directive-marker"}if(T.match(L)){if(G){fa=G;v(Y,e,{mode:fa,local:fa.startState()})}else v(Y,e);return"verbatim-marker"}if(qa&&T.match(ma,false)){if(!P){v(Y,e);return"verbatim-marker"}fa=P;v(Y,e,{mode:fa,local:fa.startState()});return null}if(qa&&
(T.match($)||T.match(ga))){q(Y,T);return"list"}if(T.match(V)&&da(/\W/)&&(T.eol()||T.match(/\W/,false))){q(Y,T);return"footnote"}if(T.match(ca)&&da(/\W/)&&(T.eol()||T.match(/\W/,false))){q(Y,T);return"citation"}fa=T.next();if(da(u)){if((fa===":"||fa==="|")&&T.eat(/\S/)){var t;fa===":"?t="role":t="replacement";v(Y,k,{ch:fa,wide:false,prev:null,token:t});return t}if(fa==="*"||fa==="`"){p=fa;var K=false;fa=T.next();fa==p&&(K=true,fa=T.next());if(fa&&!/\s/.test(fa)){p==="*"?t=K?"strong":"emphasis":t=K?
"inline":"interpreted";v(Y,k,{ch:p,wide:K,prev:null,token:t});return t}}}q(Y,fa);return null}function n(T){if(T){var Y=CodeMirror.listModes(),da;for(da in Y)if(Y[da]==T)return true}return false}function q(T,Y){if(Y&&typeof Y!="string"){var da=Y.current();Y=da[da.length-1]}v(T,l,{back:Y})}function v(T,Y,da){T.fn=Y;T.ctx=da||{}}var G=n(b.verbatim)?CodeMirror.getMode(a,b.verbatim):null,P=n("python")?CodeMirror.getMode(a,"python"):null,R=/^[!"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~]/,y=/^\s*\w([-:.\w]*\w)?::(\s|$)/,
H=/^\s*_[\w-]+:(\s|$)/,J=/^\s*\[(\d+|#)\](\s|$)/,Q=/^\s*\[[A-Za-z][\w-]*\](\s|$)/,V=/^\[(\d+|#)\]_/,ca=/^\[[A-Za-z][\w-]*\]_/,B=/^\.\.(\s|$)/,L=/^::\s*$/,u=/^[-\s"([{</:]/,A=/^[-\s`'")\]}>/:.,;!?\\_]/,$=/^\s*((\d+|[A-Za-z#])[.)]|\((\d+|[A-Z-a-z#])\))\s/,ga=/^\s*[-\+\*]\s/,ma=/^\s+(>>>|In \[\d+\]:)\s/;return{startState:function(){return{fn:l,ctx:{}}},copyState:function(T){return{fn:T.fn,ctx:T.ctx}},token:function(T,Y){return Y.fn(T,Y)}}});CodeMirror.defineMIME("text/x-rst","rst");
CodeMirror.defineMode("plsql",function(a,b){function d(v,G){for(var P=false,R;R=v.next();){if(R=="/"&&P){G.tokenize=f;break}P=R=="*"}return"plsql-comment"}function e(v){return function(G,P){for(var R=false,y,H=false;(y=G.next())!=null;){if(y==v&&!R){H=true;break}R=!R&&y=="\\"}if(H||!R&&!n)P.tokenize=f;return"plsql-string"}}function f(v,G){var P=v.next();if(P=='"'||P=="'"){P=e(P);G.tokenize=P;return P(v,G)}if(!/[\[\]{}\(\),;\.]/.test(P)){if(/\d/.test(P)){v.eatWhile(/[\w\.]/);return"number"}if(P=="/"){if(v.eat("*")){P=
d;G.tokenize=P;return P(v,G)}v.eatWhile(q);return"operator"}if(P=="-"){if(v.eat("-")){v.skipToEnd();return"comment"}v.eatWhile(q);return"operator"}if(P=="@"||P=="$"){v.eatWhile(/[\w\d\$_]/);return"variable"}if(q.test(P)){v.eatWhile(q);return"operator"}v.eatWhile(/[\w\$_]/);if(g&&g.propertyIsEnumerable(v.current().toLowerCase()))return"keyword";if(j&&j.propertyIsEnumerable(v.current().toLowerCase()))return"builtin";if(k&&k.propertyIsEnumerable(v.current().toLowerCase()))return"variable-2";if(l&&l.propertyIsEnumerable(v.current().toLowerCase()))return"variable-3";
return"plsql-word"}}var g=b.keywords,j=b.functions,k=b.types,l=b.sqlplus,n=b.multiLineStrings,q=/[+\-*&%=<>!?:\/|]/;return{startState:function(){return{tokenize:f,startOfLine:true}},token:function(v,G){if(v.eatSpace())return null;return G.tokenize(v,G)}}});
(function(){function a(b){var d={};b=b.split(" ");for(var e=0;e<b.length;++e)d[b[e]]=true;return d}CodeMirror.defineMIME("text/x-plsql",{name:"plsql",keywords:a("abort accept access add all alter and any array arraylen as asc assert assign at attributes audit authorization avg base_table begin between binary_integer body boolean by case cast char char_base check close cluster clusters colauth column comment commit compress connect connected constant constraint crash create current currval cursor data_base database date dba deallocate debugoff debugon decimal declare default definition delay delete desc digits dispose distinct do drop else elsif enable end entry escape exception exception_init exchange exclusive exists exit external fast fetch file for force form from function generic goto grant group having identified if immediate in increment index indexes indicator initial initrans insert interface intersect into is key level library like limited local lock log logging long loop master maxextents maxtrans member minextents minus mislabel mode modify multiset new next no noaudit nocompress nologging noparallel not nowait number_base object of off offline on online only open option or order out package parallel partition pctfree pctincrease pctused pls_integer positive positiven pragma primary prior private privileges procedure public raise range raw read rebuild record ref references refresh release rename replace resource restrict return returning reverse revoke rollback row rowid rowlabel rownum rows run savepoint schema segment select separate session set share snapshot some space split sql start statement storage subtype successful synonym tabauth table tables tablespace task terminate then to trigger truncate type union unique unlimited unrecoverable unusable update use using validate value values variable view views when whenever where while with work"),functions:a("abs acos add_months ascii asin atan atan2 average bfilename ceil chartorowid chr concat convert cos cosh count decode deref dual dump dup_val_on_index empty error exp false floor found glb greatest hextoraw initcap instr instrb isopen last_day least lenght lenghtb ln lower lpad ltrim lub make_ref max min mod months_between new_time next_day nextval nls_charset_decl_len nls_charset_id nls_charset_name nls_initcap nls_lower nls_sort nls_upper nlssort no_data_found notfound null nvl others power rawtohex reftohex round rowcount rowidtochar rpad rtrim sign sin sinh soundex sqlcode sqlerrm sqrt stddev substr substrb sum sysdate tan tanh to_char to_date to_label to_multi_byte to_number to_single_byte translate true trunc uid upper user userenv variance vsize"),
types:a("bfile blob character clob dec float int integer mlslabel natural naturaln nchar nclob number numeric nvarchar2 real rowtype signtype smallint string varchar varchar2"),sqlplus:a("appinfo arraysize autocommit autoprint autorecovery autotrace blockterminator break btitle cmdsep colsep compatibility compute concat copycommit copytypecheck define describe echo editfile embedded escape exec execute feedback flagger flush heading headsep instance linesize lno loboffset logsource long longchunksize markup native newpage numformat numwidth pagesize pause pno recsep recsepchar release repfooter repheader serveroutput shiftinout show showmode size spool sqlblanklines sqlcase sqlcode sqlcontinue sqlnumber sqlpluscompatibility sqlprefix sqlprompt sqlterminator suffix tab term termout time timing trimout trimspool ttitle underline verify version wrap")})})();
CodeMirror.defineMode("lua",function(a,b){function d(R){return function(y,H){for(var J=false,Q;(Q=y.next())!=null;){if(Q==R&&!J)break;J=!J&&Q=="\\"}J||(H.cur=f);return"string"}}function e(R,y){return function(H,J){for(var Q=null,V;(V=H.next())!=null;)if(Q==null)V=="]"&&(Q=0);else if(V=="=")++Q;else{if(V=="]"&&Q==R){J.cur=f;break}Q=null}return y}}function f(R,y){var H=R.next();if(H=="-"&&R.eat("-")){if(R.eat("["))return(y.cur=e(g(R),"comment"))(R,y);R.skipToEnd();return"comment"}if(H=='"'||H=="'")return(y.cur=
d(H))(R,y);if(H=="["&&/[\[=]/.test(R.peek()))return(y.cur=e(g(R),"string"))(R,y);if(/\d/.test(H)){R.eatWhile(/[\w.%]/);return"number"}if(/[\w_]/.test(H)){R.eatWhile(/[\w\\\-_.]/);return"variable"}return null}function g(R){for(var y=0;R.eat("=");)++y;R.eat("[");return y}function j(R){return RegExp("^(?:"+R.join("|")+")$","i")}var k=a.indentUnit,l=j(b.specials||[]),n=j(["_G","_VERSION","assert","collectgarbage","dofile","error","getfenv","getmetatable","ipairs","load","loadfile","loadstring","module",
"next","pairs","pcall","print","rawequal","rawget","rawset","require","select","setfenv","setmetatable","tonumber","tostring","type","unpack","xpcall","coroutine.create","coroutine.resume","coroutine.running","coroutine.status","coroutine.wrap","coroutine.yield","debug.debug","debug.getfenv","debug.gethook","debug.getinfo","debug.getlocal","debug.getmetatable","debug.getregistry","debug.getupvalue","debug.setfenv","debug.sethook","debug.setlocal","debug.setmetatable","debug.setupvalue","debug.traceback",
"close","flush","lines","read","seek","setvbuf","write","io.close","io.flush","io.input","io.lines","io.open","io.output","io.popen","io.read","io.stderr","io.stdin","io.stdout","io.tmpfile","io.type","io.write","math.abs","math.acos","math.asin","math.atan","math.atan2","math.ceil","math.cos","math.cosh","math.deg","math.exp","math.floor","math.fmod","math.frexp","math.huge","math.ldexp","math.log","math.log10","math.max","math.min","math.modf","math.pi","math.pow","math.rad","math.random","math.randomseed",
"math.sin","math.sinh","math.sqrt","math.tan","math.tanh","os.clock","os.date","os.difftime","os.execute","os.exit","os.getenv","os.remove","os.rename","os.setlocale","os.time","os.tmpname","package.cpath","package.loaded","package.loaders","package.loadlib","package.path","package.preload","package.seeall","string.byte","string.char","string.dump","string.find","string.format","string.gmatch","string.gsub","string.len","string.lower","string.match","string.rep","string.reverse","string.sub","string.upper",
"table.concat","table.insert","table.maxn","table.remove","table.sort"]),q=j(["and","break","elseif","false","nil","not","or","return","true","function","end","if","then","else","do","while","repeat","until","for","in","local"]),v=j(["function","if","repeat","for","while","\\(","{"]),G=j(["end","until","\\)","}"]),P=/^(?:end|until|\)|}|else|elseif)/i;return{startState:function(R){return{basecol:R||0,indentDepth:0,cur:f}},token:function(R,y){if(R.eatSpace())return null;var H=y.cur(R,y),J=R.current();
H=="variable"&&(q.test(J)?H="keyword":n.test(J)?H="builtin":l.test(J)&&(H="variable-2"));v.test(J)?++y.indentDepth:G.test(J)&&--y.indentDepth;return H},indent:function(R,y){var H=P.test(y);return R.basecol+k*(R.indentDepth-(H?1:0))}}});CodeMirror.defineMIME("text/x-lua","lua");Ext.ns("Ext.ux.form");
Ext.ux.form.FileUploadField=Ext.extend(Ext.form.TextField,{readOnly:true,autoSize:Ext.emptyFn,iconClsSelectFile:"x-form-file-icon",iconClsClearFile:"x-form-file-clear-icon",iconClsDownloadFile:"x-form-file-download-icon",constructor:function(a,b){if(b){if(b.prefixUploadField)this.prefixUploadField=b.prefixUploadField;if(b.fileUrl)this.fileUrl=b.fileUrl;if(a.readOnly)this.readOnlyAll=true;if(b.possibleFileExtensions)this.possibleFileExtensions=b.possibleFileExtensions}Ext.ux.form.FileUploadField.superclass.constructor.call(this,
a,b)},initComponent:function(){Ext.ux.form.FileUploadField.superclass.initComponent.call(this);this.addEvents("fileselected")},onRender:function(a,b){Ext.ux.form.FileUploadField.superclass.onRender.call(this,a,b);this.value=this.getFileName();this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.createFileInput();var d=Ext.applyIf(this.buttonCfg||{},{iconCls:this.iconClsSelectFile});this.buttonFile=new Ext.Button(Ext.apply(d,{renderTo:this.wrap,
width:16,cls:"x-form-file-btn"+(d.iconCls?" x-btn-icon":""),tooltip:{text:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0444\u0430\u0439\u043b",width:150}}));this.buttonClear=new Ext.Button({renderTo:this.wrap,width:16,cls:"x-form-file-clear",iconCls:this.iconClsClearFile,handler:this.clickClearField,scope:this,hidden:this.value?false:true,tooltip:{text:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",width:65}});this.renderHelperBtn();this.bindListeners();this.resizeEl=this.positionEl=this.wrap;
if(this.readOnlyAll){this.buttonFile.setDisabled(true);this.buttonFile.getEl().setStyle("z-index",3);this.buttonClear.setDisabled(true);this.getHelperBtn()&&this.getHelperBtn().setDisabled(true)}},renderHelperBtn:function(){this.buttonDownload=new Ext.Button({renderTo:this.wrap,width:16,cls:"x-form-file-download",iconCls:this.iconClsDownloadFile,handler:this.clickDownload,scope:this,hidden:this.value?false:true,tooltip:{text:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c",width:65}})},getHelperBtn:function(){return this.buttonDownload},
bindListeners:function(){this.fileInput.on({scope:this,mouseenter:function(){this.buttonFile.addClass(["x-btn-over","x-btn-focus"])},mouseleave:function(){this.buttonFile.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},mousedown:function(){this.buttonFile.addClass("x-btn-click")},mouseup:function(){this.buttonFile.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},change:function(){if(this.isFileExtensionOK()){var a=this.fileInput.dom.value;this.setValue(a);this.fireEvent("fileselected",
this,a);if(a){this.fileUrl=null;if(!this.buttonClear.isVisible()){this.buttonClear.show();this.el.setWidth(this.el.getWidth()-this.buttonClear.getWidth())}}}else{Ext.Msg.show({title:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435",msg:"\u041d\u0435\u0432\u0435\u0440\u043d\u043e\u0435 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435 \u0444\u0430\u0439\u043b\u0430",buttons:Ext.Msg.OK,fn:Ext.emptyFn,animEl:"elId",icon:Ext.MessageBox.WARNING});this.reset()}}})},createFileInput:function(){this.fileInput=
this.wrap.createChild({id:this.getFileInputId(),name:(this.prefixUploadField||"")+this.name,cls:"x-form-file",tag:"input",type:"file",size:1,width:20});Ext.QuickTips.unregister(this.fileInput);Ext.QuickTips.register({target:this.fileInput,text:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0444\u0430\u0439\u043b",width:86,dismissDelay:1E4})},reset:function(){this.fileInput.remove();this.createFileInput();this.bindListeners();Ext.ux.form.FileUploadField.superclass.reset.call(this)},getFileInputId:function(){return this.id+
"-file"},onResize:function(a,b){Ext.ux.form.FileUploadField.superclass.onResize.call(this,a,b);this.wrap.setWidth(a);a=this.wrap.getWidth()-this.buttonFile.getEl().getWidth();var d=this.buttonClear.getWidth();if(d)a-=d;if(d=this.getHelperBtn()?this.getHelperBtn().getWidth():0)a-=d;Ext.isWebKit?this.el.setWidth(a+5):this.el.setWidth(a)},onDestroy:function(){Ext.ux.form.FileUploadField.superclass.onDestroy.call(this);Ext.QuickTips.unregister(this.fileInput);Ext.destroy(this.fileInput,this.buttonFile,
this.buttonClear,this.getHelperBtn(),this.wrap)},onDisable:function(){Ext.ux.form.FileUploadField.superclass.onDisable.call(this);this.doDisable(true)},onEnable:function(){Ext.ux.form.FileUploadField.superclass.onEnable.call(this);this.doDisable(false)},doDisable:function(a){this.fileInput.dom.disabled=a;this.buttonFile.setDisabled(a);this.buttonClear.setDisabled(a);this.getHelperBtn()&&this.getHelperBtn().setDisabled(a)},preFocus:Ext.emptyFn,alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,
"tl-tr",[2,0])},clickClearField:function(){this.reset();this.setValue("");var a=this.el.getWidth()+this.buttonClear.getWidth();if(this.getHelperBtn()){a+=this.getHelperBtn().isVisible()?this.getHelperBtn().getWidth():0;this.getHelperBtn().hide()}this.el.setWidth(a);this.buttonClear.hide()},getFileUrl:function(a){return document.location.protocol+"//"+document.location.host+"/"+a},clickDownload:function(){var a=this.getFileUrl(this.fileUrl);a&&window.open(a)},getFileName:function(){return this.value?
this.value.split("/").reverse()[0]:""},isFileExtensionOK:function(){var a=this.fileInput.dom.value.split(".");if(a.length>0)return this.possibleFileExtensions?this.possibleFileExtensions.split(",").indexOf(a[a.length-1].toLowerCase())!=-1:true;return false},setReadOnly:function(a){Ext.ux.form.FileUploadField.superclass.setReadOnly.call(this,a)}});Ext.reg("fileuploadfield",Ext.ux.form.FileUploadField);Ext.form.FileUploadField=Ext.ux.form.FileUploadField;Ext.ns("Ext.ux.form");
Ext.ux.form.ImageUploadField=Ext.extend(Ext.form.FileUploadField,{iconClsSelectFile:"x-form-image-icon",iconClsClearFile:"x-form-image-clear-icon",iconClsPreviewImage:"x-form-image-preview-icon",constructor:function(a,b){if(b){if(b.thumbnailWidth)this.thumbnailWidth=b.thumbnailWidth;if(b.thumbnailHeight)this.thumbnailHeight=b.thumbnailHeight;if(b.prefixThumbnailImg)this.prefixThumbnailImg=b.prefixThumbnailImg;if(b.thumbnail)this.thumbnail=b.thumbnail;if(b.fileUrl){var d=b.fileUrl.split("/"),e=d.slice(0,
d.length-1);d=d[d.length-1];var f=this.prefixThumbnailImg||"";e=String.format("{0}/{1}{2}",e.join("/"),f,d);this.previewTip=new Ext.QuickTip({id:"preview_tip_window",html:String.format('<a href="{0}" rel="lightbox"><image src="{1}" WIDTH={2} HEIGHT={3} OnClick=Ext.getCmp("preview_tip_window").hide()></a>',b.fileUrl,this.getFileUrl(e),this.thumbnailWidth,this.thumbnailHeight),autoHide:false,width:this.thumbnailWidth+10,height:this.thumbnailHeight+10})}}Ext.ux.form.ImageUploadField.superclass.constructor.call(this,
a,b)},renderHelperBtn:function(){if(this.thumbnail)this.buttonPreview=new Ext.Button({renderTo:this.wrap,width:16,cls:"x-form-file-download",iconCls:this.iconClsPreviewImage,handler:this.clickHelperBtn,scope:this,hidden:this.value?false:true,tooltip:{text:"\u041f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043f\u043e\u043a\u0430\u0437",width:140}})},getHelperBtn:function(){return this.buttonPreview},clickHelperBtn:function(){var a=this.getEl(),b=a.getXY();
this.previewTip.showAt([b[0],b[1]+a.getHeight()])},createFileInput:function(){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:(this.prefixUploadField||"")+this.name,cls:"x-form-file",tag:"input",type:"file",size:1,width:20});Ext.QuickTips.unregister(this.fileInput);Ext.QuickTips.register({target:this.fileInput,text:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435",width:130,dismissDelay:1E4})},onDestroy:function(){Ext.ux.form.ImageUploadField.superclass.onDestroy.call(this);
Ext.destroy(this.previewTip)}});Ext.ux.Lightbox.register("a[rel^=lightbox]");Ext.reg("imageuploadfield",Ext.ux.form.ImageUploadField);function createAdvancedTreeGrid(a,b){return new Ext.m3.AdvancedTreeGrid(a,b)}function createGridPanel(a,b){return a.editor?new Ext.m3.EditorGridPanel(a,b):new Ext.m3.GridPanel(a,b)}function createObjectGrid(a,b){return a.editor?new Ext.m3.EditorObjectGrid(a,b):new Ext.m3.ObjectGrid(a,b)}function createObjectTree(a,b){return new Ext.m3.ObjectTree(a,b)}
function createAdvancedComboBox(a,b){return new Ext.m3.AdvancedComboBox(a,b)}function createAdvancedDataField(a,b){return new Ext.m3.AdvancedDataField(a,b)}
Ext.onReady(function(){Ext.override(Ext.Window,{tmpModal:false,manager:new Ext.WindowGroup,constrain:true,activateChildWindow:function(){this.toFront()},listeners:{beforeshow:function(){var a=Ext.get(this.renderTo);a&&a.getHeight()<this.getHeight()&&this.setHeight(a.getHeight());if(this.parentWindow){this.parentWindow.setDisabled(true);this.parentWindow.el.removeClass("x-masked-relative");this.parentWindow.on("activate",this.activateChildWindow,this);this.modal=false;this.tmpModal=true;if(window.AppDesktop)(a=
AppDesktop.getDesktop().taskbar.tbPanel.getTabWin(this.parentWindow))&&a.mask()}if(this.modal){(a=Ext.get("ux-taskbar"))&&a.mask();(a=Ext.get("ux-toptoolbar"))&&a.mask()}},beforeclose:function(){if(this.tmpModal&&this.parentWindow){this.parentWindow.un("activate",this.activateChildWindow,this);this.parentWindow.setDisabled(false);this.parentWindow.toFront();if(window.AppDesktop){var a=AppDesktop.getDesktop().taskbar.tbPanel.getTabWin(this.parentWindow);a&&a.unmask()}}if(this.modal){(a=Ext.get("ux-taskbar"))&&
a.unmask();(a=Ext.get("ux-toptoolbar"))&&a.unmask()}},hide:function(){if(this.modal)if(!this.parentWindow){var a=Ext.get("ux-taskbar");a&&a.unmask();(a=Ext.get("ux-toptoolbar"))&&a.unmask()}}}})});
Ext.override(Ext.ux.tree.TreeGrid,{fitColumns:function(){var a=this.getInnerWidth()-Ext.num(this.scrollOffset,Ext.getScrollBarWidth()),b=this.getTotalColumnWidth(),d=this.getVisibleColumns(),e,f=0;for(e=0;e<d.length;e++){if(e==d.length-1){d[e].width=a-f-1;break}d[e].width=Math.floor(a/100*(d[e].width*100/b))-1;f+=d[e].width}this.updateColumnWidths()},onResize:function(a,b){Ext.ux.tree.TreeGrid.superclass.onResize.apply(this,arguments);var d=this.innerBody.dom,e=this.innerHd.dom;if(d){if(Ext.isNumber(b))d.style.height=
this.body.getHeight(true)-e.offsetHeight+"px";if(Ext.isNumber(a)){var f=Ext.num(this.scrollOffset,Ext.getScrollBarWidth());if(this.reserveScrollOffset||d.offsetWidth-d.clientWidth>10)this.setScrollOffset(f);else{var g=this;setTimeout(function(){g.setScrollOffset(d.offsetWidth-d.clientWidth>10?f:0)},10)}}this.fitColumns()}}});
Ext.override(Ext.tree.ColumnResizer,{onEnd:function(){var a=this.proxy.getWidth(),b=this.tree;this.proxy.remove();delete this.dragHd;b.columns[this.hdIndex].width=a;b.fitColumns();setTimeout(function(){b.headersDisabled=false},100)}});Ext.override(Ext.tree.TreeNodeUI,{onDblClick:function(a){a.preventDefault();if(!this.disabled)if(this.fireEvent("beforedblclick",this.node,a)!==false){this.checkbox&&this.toggleCheck();this.fireEvent("dblclick",this.node,a)}}});
Ext.override(Ext.form.Action.Submit,{run:function(){var a=this.options,b=this.getMethod(),d=b=="GET";if(a.clientValidation===false||this.form.isValid()){if(a.submitEmptyText===false){var e=[];this.form.items.each(function(f){if(f.el.getValue()==f.emptyText){e.push(f);f.el.dom.value=""}f instanceof Ext.form.CompositeField&&f.items.each(function(g){if(g.el.getValue()==g.emptyText){e.push(g);g.el.dom.value=""}})})}Ext.Ajax.request(Ext.apply(this.createCallback(a),{form:this.form.el.dom,url:this.getUrl(d),
method:b,headers:a.headers,params:!d?this.getParams():null,isUpload:this.form.fileUpload}));a.submitEmptyText===false&&Ext.each(e,function(f){f.applyEmptyText&&f.applyEmptyText()})}else if(a.clientValidation!==false){this.failureType=Ext.form.Action.CLIENT_INVALID;this.form.afterAction(this,false)}}});Ext.override(Ext.form.Checkbox,{onClick:function(a){if(this.readOnly){a.stopEvent();return false}this.el.dom.checked!=this.checked&&this.setValue(this.el.dom.checked)}});
Ext.override(Ext.PagingToolbar,{onPagingBlur:Ext.emptyFn});if(Ext.isIE7||Ext.isIE6)Ext.Panel.override({setAutoScroll:function(){if(this.rendered&&this.autoScroll){var a=this.body||this.el;if(a){a.setOverflow("auto");a.dom.style.position="relative"}}}});
Ext.override(Ext.ux.tree.TreeGridNodeUI,{renderElements:function(a,b,d,e){var f=a.getOwnerTree(),g=Ext.isBoolean(b.checked);g=Ext.isBoolean(b.checked);var j=f.columns,k=j[0],l,n,q;this.indentMarkup=a.parentNode?a.parentNode.ui.getChildIndent():"";n=['<tbody class="x-tree-node">','<tr ext:tree-node-id="',a.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',b.cls,'">','<td class="x-treegrid-col">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,
'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',b.icon||this.emptyIcon,'" class="x-tree-node-icon',b.icon?" x-tree-node-inline-icon":"",b.iconCls?" "+b.iconCls:"",'" unselectable="on" />',g?'<input class="x-tree-node-cb" type="checkbox" '+(b.checked?'checked="checked" />':"/>"):"",'<a hidefocus="on" class="x-tree-node-anchor" href="',b.href?b.href:"#",'" tabIndex="1" ',b.hrefTarget?' target="'+b.hrefTarget+'"':"",">",'<span unselectable="on">',k.tpl?k.tpl.apply(b):b[k.dataIndex]||k.text,"</span></a>",
"</td>"];l=1;for(q=j.length;l<q;l++){k=j[l];n.push('<td class="x-treegrid-col ',k.cls?k.cls:"",'">','<div unselectable="on" class="x-treegrid-text"',k.align?' style="text-align: '+k.align+';"':"",">",k.tpl?k.tpl.apply(b):b[k.dataIndex],"</div>","</td>")}n.push('</tr><tr class="x-tree-node-ct"><td colspan="',j.length,'">','<table class="x-treegrid-node-ct-table" cellpadding="0" cellspacing="0" style="table-layout: fixed; display: none; width: ',f.innerCt.getWidth(),'px;"><colgroup>');l=0;for(q=j.length;l<
q;l++)n.push('<col style="width: ',j[l].hidden?0:j[l].width,'px;" />');n.push("</colgroup></table></td></tr></tbody>");this.wrap=e!==true&&a.nextSibling&&a.nextSibling.ui.getEl()?Ext.DomHelper.insertHtml("beforeBegin",a.nextSibling.ui.getEl(),n.join("")):Ext.DomHelper.insertHtml("beforeEnd",d,n.join(""));this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1].firstChild.firstChild;a=this.elNode.firstChild.childNodes;this.indentNode=a[0];this.ecNode=a[1];this.iconNode=a[2];index=3;
if(g){this.checkbox=a[3];this.checkbox.defaultChecked=this.checkbox.checked;index++}this.anchor=a[index];this.textNode=a[index].firstChild}});Ext.override(Ext.ux.tree.TreeGrid,{getChecked:function(a,b){b=b||this.root;var d=[];b.cascade(function(){if(this.attributes.checked)d.push(!a?this:a=="id"?this.id:this.attributes[a])});return d}});
