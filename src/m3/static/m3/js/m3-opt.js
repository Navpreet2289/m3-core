Ext.ux.Reorderer=Ext.extend(Object,{defaults:{animate:true,animationDuration:0.2,defaultReorderable:false},constructor:function(a){Ext.apply(this,a||{},this.defaults)},init:function(a){this.target=a;this.initEvents();a=this.getItems();var b=a.length,d;for(d=0;d<b;d++)this.createIfReorderable(a[d])},reorder:function(a){var b=this.target;if(b.fireEvent("before-reorder",a,b,this)!==false){this.doReorder(a);b.fireEvent("reorder",a,b,this)}},doReorder:function(){throw Error("doReorder must be implemented in the Ext.ux.Reorderer subclass");
},createItemDD:function(){throw Error("createItemDD must be implemented in the Ext.ux.Reorderer subclass");},createItemDD:function(a){var b=a.getEl(),d=this.target,e=this;a.dd=new Ext.dd.DD(b,undefined,{isTarget:false});a.dd.constrainTo(d.getEl());a.dd.setYConstraint(0,0,0);Ext.apply(a.dd,{b4StartDrag:function(){this.startPosition=b.getXY();this.startZIndex=b.getStyle("zIndex");b.setStyle("zIndex",1E4);a.suspendEvents()},onDrag:function(){for(var g=b.getXY()[0],h=g-this.startPosition[0],k=d.items.items,
o=k.indexOf(a),w=0;w<k.length;w++){var A=k[w];if(A.reorderable&&A.id!=a.id){var B=A.getEl().getBox();B=(e.buttonXCache[A.id]||B.x)+B.width/2;A=o>w&&h<0&&g<B;B=o<w&&h>0&&g+b.getWidth()>B;if(A||B){e[A?"onMovedLeft":"onMovedRight"](a,w,o);break}}}},endDrag:function(){e.updateButtonXCache();b.moveTo(e.buttonXCache[a.id],undefined,{duration:e.animationDuration,scope:this,callback:function(){a.resumeEvents();d.fireEvent("reordered",a,d)}});b.setStyle("zIndex",this.startZIndex)}})},createIfReorderable:function(a){if(this.defaultReorderable&&
a.reorderable==undefined)a.reorderable=true;if(a.reorderable&&!a.dd)a.rendered?this.createItemDD(a):a.on("render",this.createItemDD.createDelegate(this,[a]),this,{single:true})},getItems:function(){return this.target.items.items},initEvents:function(){this.target.addEvents("before-reorder","reorder")}});
Ext.ux.HBoxReorderer=Ext.extend(Ext.ux.Reorderer,{init:function(a){this.buttonXCache={};a.on({scope:this,add:function(b,d){this.createIfReorderable(d)}});Ext.ux.HBoxReorderer.superclass.init.apply(this,arguments)},createItemDD:function(a){if(a.dd==undefined){var b=a.getEl(),d=this,e=d.target;a.dd=new Ext.dd.DD(b,undefined,{isTarget:false});b.applyStyles({position:"absolute"});var g=function(){return false};Ext.apply(a.dd,{b4StartDrag:function(){this.startPosition=b.getXY();this.startZIndex=b.getStyle("zIndex");
b.setStyle("zIndex",1E4);a.suspendEvents();a.menu&&a.menu.on("beforeshow",g,d)},startDrag:function(){this.constrainTo(e.getEl());this.setYConstraint(0,0,0)},onDrag:function(){var h=b.getXY()[0],k=h-this.startPosition[0],o=e.items.items,w=o.length,A=o.indexOf(a),B,J;for(B=0;B<w;B++){J=o[B];if(J.reorderable&&J.id!=a.id){var L=J.getEl().getBox();L=(d.buttonXCache[J.id]||L.x)+L.width/2;J=A>B&&k<0&&h<L;L=A<B&&k>0&&h+b.getWidth()>L;if(J||L){d[J?"onMovedLeft":"onMovedRight"](a,B,A);break}}}},endDrag:function(){d.updateButtonXCache();
b.moveTo(d.buttonXCache[a.id],b.getY(),{duration:d.animationDuration,scope:this,callback:function(){a.resumeEvents();a.menu&&a.menu.un("beforeshow",g,d);e.fireEvent("reordered",a,e)}});b.setStyle("zIndex",this.startZIndex)}})}},onMovedLeft:function(a,b,d){var e=this.target,g=e.items.items,h=g.length;if(b!=undefined&&b!=d){e.remove(a,false);e.insert(b,a);this.updateButtonXCache();for(b=0;b<h;b++){e=g[b];d=this.buttonXCache[e.id];if(a==e)a.dd.startPosition[0]=d;else{e=e.getEl();e.moveTo(d,e.getY(),
{duration:this.animationDuration})}}}},onMovedRight:function(){this.onMovedLeft.apply(this,arguments)},updateButtonXCache:function(){var a=this.target,b=a.items,d=a.getEl().getBox(true).x;b.each(function(e){this.buttonXCache[e.id]=d;d+=e.getEl().getWidth()},this)}});Ext.ns("Ext.ux.plugins.grid");
Ext.ux.plugins.grid.CellToolTips=function(a){var b;if(Ext.isArray(a)){b=a;a={}}else b=a.ajaxTips;Ext.ux.plugins.grid.CellToolTips.superclass.constructor.call(this,a);if(a.tipConfig)this.tipConfig=a.tipConfig;this.ajaxTips=b};
Ext.extend(Ext.ux.plugins.grid.CellToolTips,Ext.util.Observable,{version:1.3,ajaxTips:false,tipTpls:false,tipFns:false,tipUrls:"",tipConfig:{},request:false,init:function(a){if(this.ajaxTips){this.tipTpls={};this.tipFns={};this.tipAfterFns={};this.tipUrls={};Ext.each(this.ajaxTips,function(b){this.tipTpls[b.field]=new Ext.XTemplate(b.tpl);if(b.url)this.tipUrls[b.field]=b.url;if(b.fn)this.tipFns[b.field]=b.fn;if(b.afterFn)this.tipAfterFns[b.field]=b.afterFn;if(b.tipConfig)this.tipConfig=b.tipConfig},
this);delete this.ajaxTips;a.on("render",this.onGridRender.createDelegate(this))}},setFieldTpl:function(a,b){this.tipTpls[a]=Ext.isObject(b)?b:new Ext.XTemplate(b)},onGridRender:function(a){if(this.tipTpls){Ext.apply(this.tipConfig,{target:a.getView().mainBody,delegate:".x-grid3-cell-inner",renderTo:document.body,finished:false});Ext.applyIf(this.tipConfig,{trackMouse:true});this.tip=new Ext.ToolTip(this.tipConfig);this.tip.ctt=this;this.tip.on("beforeshow",this.beforeTipShow.createDelegate(this.tip,
[this,a],true));this.tip.on("hide",this.hideTip)}},beforeTipShow:function(a,b,d){var e=d.getView().findCellIndex(a.triggerElement);e=d.getColumnModel().getDataIndex(e);if(!b.tipTpls[e])return false;if(a.finished)a.body.dom.innerHTML=a.ctt.tipTpls[e].apply(a.tipdata);else{var g=typeof b.tipUrls[e]=="string",h=d.getView().findRowIndex(a.triggerElement),k=d.getStore().getAt(h);if(d.CellToolTipCondition&&d.CellToolTipCondition(h,k)===false)return false;h=k.copy().data;if(g){b.loadDetails(b.tipFns[e]?
b.tipFns[e](h):h,a,d,b,e);a.body.dom.innerHTML="Loading..."}else a.body.dom.innerHTML=b.tipTpls[e].apply(b.tipFns[e]?b.tipFns[e](k.data):k.data)}},hideTip:function(a){a.finished=false},loadDetails:function(a,b,d,e,g){Ext.Ajax.request({url:e.tipUrls[g],params:a,method:"POST",success:function(h){b.finished=true;b.tipdata=Ext.decode(h.responseText);if(e.tipAfterFns[g])b.tipdata=e.tipAfterFns[g](b.tipdata);b.show()}})}});Ext.namespace("Ext.ux.grid");
Ext.ux.grid.GridHeaderFilters=function(a){a&&Ext.apply(this,a)};
Ext.extend(Ext.ux.grid.GridHeaderFilters,Ext.util.Observable,{fieldHeight:22,fieldPadding:1,highlightOnFilter:true,highlightColor:"yellow",highlightCls:null,stateful:true,applyMode:"auto",filters:null,filtersInitMode:"replace",ensureFilteredVisible:true,cfgFilterInit:false,containerConfig:null,labelWidth:50,fcc:null,filterFields:null,filterContainers:null,filterContainerCls:"x-ghf-filter-container",inResizeProcess:false,init:function(a){this.grid=a;a=this.grid.getView();a.updateHeaders=a.updateHeaders.createSequence(function(){this.renderFilters.call(this)},
this).createInterceptor(function(){return true},this);this.grid.on({scope:this,render:this.onRender,resize:this.onResize,columnresize:this.onColResize,reconfigure:this.onReconfigure,beforedestroy:this.destroyFilters});if(this.stateful){this.grid.on("beforestatesave",this.saveFilters,this);this.grid.on("beforestaterestore",this.loadFilters,this)}this.grid.getColumnModel().on("hiddenchange",this.onColHidden,this);this.grid.addEvents("filterupdate");this.addEvents({render:true});this.cfgFilterInit=Ext.isDefined(this.filters)&&
this.filters!==null;if(!this.filters)this.filters={};this.configure(this.grid.getColumnModel());Ext.ux.grid.GridHeaderFilters.superclass.constructor.call(this);if(this.stateful){if(!Ext.isArray(this.grid.stateEvents))this.grid.stateEvents=[];this.grid.stateEvents.push("filterupdate")}Ext.apply(this.grid,{headerFilters:this,getHeaderFilter:function(b){if(!this.headerFilters)return null;return this.headerFilters.filters[b]},setHeaderFilter:function(b,d){if(this.headerFilters){var e={};e[b]=d;this.setHeaderFilters(e)}},
setHeaderFilters:function(b,d,e){if(this.headerFilters){d&&this.resetHeaderFilters(false);if(arguments.length<3)e=true;var g=false,h;for(h in b)if(this.headerFilters.filterFields[h]){g=this.headerFilters.filterFields[h];this.headerFilters.setFieldValue(g,b[h]);this.headerFilters.applyFilter(g,false);g=true}g&&e&&this.headerFilters.storeReload()}},getHeaderFilterField:function(b){if(this.headerFilters)return this.headerFilters.filterFields[b]?this.headerFilters.filterFields[b]:null},resetHeaderFilters:function(b){if(this.headerFilters){if(arguments.length==
0)b=true;for(var d in this.headerFilters.filterFields){var e=this.headerFilters.filterFields[d];Ext.isFunction(e.clearValue)?e.clearValue():this.headerFilters.setFieldValue(e,"");this.headerFilters.applyFilter(e,false)}b&&this.headerFilters.storeReload()}},applyHeaderFilters:function(b){if(arguments.length==0)b=true;this.headerFilters.applyFilters(b)}})},configure:function(a){a=a.getColumnsBy(function(o){return Ext.isObject(o.filter)||Ext.isArray(o.filter)?true:false});this.fcc={};for(var b=0;b<a.length;b++){var d=
a[b],e=d.filter;Ext.isArray(e)||(e=[e]);for(var g=0;g<e.length;g++){var h=Ext.apply({filterName:g>0?d.dataIndex+g:d.dataIndex},e[g]);Ext.apply(h,{columnId:d.id,dataIndex:d.dataIndex,hideLabel:true,anchor:"100%"});if(!this.cfgFilterInit&&!Ext.isEmpty(h.value))this.filters[h.filterName]=Ext.isFunction(h.filterEncoder)?h.filterEncoder.call(this,h.value):h.value;delete h.value;if(h.applyFilterEvent){h.listeners={scope:this};h.listeners[h.applyFilterEvent]=function(o){this.applyFilter(o)};delete h.applyFilterEvent}else if(this.applyMode===
"auto"||this.applyMode==="change"||Ext.isEmpty(this.applyMode))if(h.hasListener!=undefined){h.hasListener("change")||h.on("change",function(o){var w=o.getXType();w=="combo"||w=="datefield"||this.applyFilter(o)},this);h.hasListener("specialkey")||h.on("specialkey",function(o,w){w.stopPropagation();w.getKey()==w.ENTER&&o.el.dom.blur()},this);h.hasListener("select")||h.on("select",function(o){this.applyFilter(o)},this)}else h.listeners={change:function(o){var w=o.getXType();w=="combo"||w=="datefield"||
this.applyFilter(o)},select:function(o){this.applyFilter(o)},scope:this};else if(this.applyMode==="enter")h.listeners={specialkey:function(o,w){w.stopPropagation();w.getKey()==w.ENTER&&this.applyFilters()},scope:this};var k=this.fcc[h.columnId];if(!k){k={cls:this.filterContainerCls,border:false,bodyBorder:false,bodyStyle:"background-color: transparent",labelSeparator:"",labelWidth:this.labelWidth,layout:"hbox",style:{},items:[]};this.containerConfig&&Ext.apply(k,this.containerConfig);this.fcc[h.columnId]=
k}k.items.push({bodyStyle:"background-color: transparent",border:false,bodyBorder:false,layout:"form",padding:2,margins:"0 0 -4 0",flex:1,items:[h]})}}},renderFilterContainer:function(a,b){if(!this.filterContainers)this.filterContainers={};var d=this.grid.getColumnModel().getIndexById(a),e=this.grid.getView().getHeaderCell(d);e=Ext.get(e);if(Ext.isGecko)e.dom.style.MozUserSelect="text";e.dom.style.verticalAlign="top";b.width=e.getWidth()-3;d=new Ext.Container(b);d.render(e);this.filterContainers[a]=
d;e=0;if(!this.filterFields)this.filterFields={};var g=d.findBy(function(k){return!Ext.isEmpty(k.filterName)});if(!Ext.isEmpty(g))for(var h=0;h<g.length;h++){this.filterFields[g[h].filterName]=g[h];e+=g[h].getHeight()}return d},renderFilters:function(){if(this.fcc){for(var a in this.fcc)this.renderFilterContainer(a,this.fcc[a]);this.setFilters(this.filters);this.highlightFilters(this.isFiltered())}},onRender:function(){this.renderFilters();this.isFiltered()&&this.applyFilters(false);this.fireEvent("render",
this)},getFilterField:function(a){return this.filterFields?this.filterFields[a]:null},setFilters:function(a,b){if((this.filters=a)&&this.filterFields){for(var d in this.filters)this.filterFields[d]||delete this.filters[d];for(d in this.filterFields){var e=this.filterFields[d],g=this.filters[e.filterName];if(Ext.isEmpty(g))b&&this.setFieldValue(e,"");else this.setFieldValue(e,g)}}},onColResize:function(a,b){if(this.filterContainers){if(!this.inResizeProcess)if(this.grid.viewConfig&&this.grid.viewConfig.forceFit){this.onResize();
return}var d=this.filterContainers[this.grid.getColumnModel().getColumnId(a)];if(d){if(isNaN(b))b=0;d.setWidth(b<3?0:b-3);d.doLayout(false,true)}}},onResize:function(){this.inResizeProcess=true;for(var a=this.grid.getColumnModel().getColumnCount(),b=0;b<a;b++){var d=this.grid.getView().getHeaderCell(b);d=Ext.get(d);this.onColResize(b,d.getWidth())}this.inResizeProcess=false},onColHidden:function(a,b,d){if(!d){a=this.grid.getColumnModel().getColumnWidth(b);this.onColResize(b,a)}},onReconfigure:function(a,
b,d){this.destroyFilters();this.configure(d);this.renderFilters()},saveFilters:function(a,b){var d={},e;for(e in this.filters)d[e]=this.filters[e];b.gridHeaderFilters=d;return true},loadFilters:function(a,b){var d=b.gridHeaderFilters;if(d)if(this.cfgFilterInit)this.filtersInitMode==="merge"&&Ext.apply(d,this.filters);else this.filters=d},isFiltered:function(){for(var a in this.filters)if(!Ext.isEmpty(this.filters[a]))return true;return false},highlightFilters:function(a){if(this.highlightOnFilter)if(this.filterContainers)if(this.grid.getView().mainHd){var b=
a?this.highlightColor:"transparent",d;for(d in this.filterContainers){var e=this.filterContainers[d];if(e.rendered)if(Ext.isEmpty(this.highlightCls))e.getEl().setStyle("backgroundColor",b);else a?e.getEl().addClass(this.highlightCls):e.getEl().removeClass(this.highlightCls)}}},getFieldValue:function(a){return Ext.isFunction(a.filterEncoder)?a.filterEncoder.call(a,a.getValue()):a.getValue()},setFieldValue:function(a,b){if(Ext.isFunction(a.filterDecoder))b=a.filterDecoder.call(a,b);a.setValue(b)},applyFilter:function(a,
b){if(arguments.length<2)b=true;if(a)if(a.isValid())if(!(a.disabled&&!Ext.isDefined(this.grid.store.baseParams[a.filterName]))){var d=this.getFieldValue(a);if(a.disabled||Ext.isEmpty(d)){delete this.grid.store.baseParams[a.filterName];delete this.filters[a.filterName]}else{this.grid.store.baseParams[a.filterName]=d;this.filters[a.filterName]=d;if(this.ensureFilteredVisible){var e=this.grid.getColumnModel().getIndexById(a.columnId);e>=0&&this.grid.getColumnModel().isHidden(e)&&this.grid.getColumnModel().setHidden(e,
false)}}this.highlightFilters(this.isFiltered());this.grid.fireEvent("filterupdate",a.filterName,d,a);b&&this.storeReload()}},applyFilters:function(a){if(arguments.length<1)a=true;for(var b in this.filterFields)this.applyFilter(this.filterFields[b],false);a&&this.storeReload()},storeReload:function(){if(this.grid.store.lastOptions){var a={start:0};if(this.grid.store.lastOptions.params&&this.grid.store.lastOptions.params.limit)a.limit=this.grid.store.lastOptions.params.limit;this.grid.store.load({params:a})}},
getFilterContainer:function(a){return this.filterContainers?this.filterContainers[a]:null},destroyFilters:function(){if(this.filterFields)for(var a in this.filterFields){Ext.destroy(this.filterFields[a]);delete this.filterFields[a]}if(this.filterContainers)for(a in this.filterContainers){Ext.destroy(this.filterContainers[a]);delete this.filterContainers[a]}}});Ext.ns("Ext.ux.grid");
Ext.ux.grid.LockingHeaderGroupGridView=Ext.extend(Ext.grid.GridView,{lockText:"Lock",unlockText:"Unlock",rowBorderWidth:1,lockedBorderWidth:1,syncHeights:false,initTemplates:function(){var a=this.templates||{};if(!a.master)a.master=new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-locked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{lstyle}">{lockedHeader}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{lstyle}">{lockedBody}</div><div class="x-grid3-scroll-spacer"></div></div>',
"</div>",'<div class="x-grid3-viewport x-grid3-unlocked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{ostyle}">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{bstyle}">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',"</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>");if(!a.gcell)a.gcell=
new Ext.XTemplate('<td class="x-grid3-hd x-grid3-gcell x-grid3-td-{id} ux-grid-hd-group-row-{row} {cls}" style="{style}">','<div {tooltip} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"","{value}</div></td>");this.templates=a;this.hrowRe=/ux-grid-hd-group-row-(\d+)/;Ext.ux.grid.LockingHeaderGroupGridView.superclass.initTemplates.call(this)},getEditorParent:function(){return this.el.dom},initElements:function(){var a=
Ext.Element,b=this.grid.getGridEl().dom.firstChild,d=b.childNodes;this.el=new a(b);this.lockedWrap=new a(d[0]);this.lockedHd=new a(this.lockedWrap.dom.firstChild);this.lockedInnerHd=this.lockedHd.dom.firstChild;this.lockedScroller=new a(this.lockedWrap.dom.childNodes[1]);this.lockedBody=new a(this.lockedScroller.dom.firstChild);this.mainWrap=new a(d[1]);this.mainHd=new a(this.mainWrap.dom.firstChild);if(this.grid.hideHeaders){this.lockedHd.setDisplayed(false);this.mainHd.setDisplayed(false)}this.innerHd=
this.mainHd.dom.firstChild;this.scroller=new a(this.mainWrap.dom.childNodes[1]);this.forceFit&&this.scroller.setStyle("overflow-x","hidden");this.mainBody=new a(this.scroller.dom.firstChild);this.focusEl=new a(this.scroller.dom.childNodes[1]);this.resizeMarker=new a(d[2]);this.resizeProxy=new a(d[3]);this.focusEl.swallowEvent("click",true)},getLockedRows:function(){return this.hasRows()?this.lockedBody.dom.childNodes:[]},getLockedRow:function(a){return this.getLockedRows()[a]},getCell:function(a,
b){var d=this.cm.getLockedCount();if(b<d)return this.getLockedRow(a).getElementsByTagName("td")[b];return Ext.ux.grid.LockingHeaderGroupGridView.superclass.getCell.call(this,a,b-d)},getHeaderCell:function(a){var b=this.cm.getLockedCount();if(a<b)return this.lockedHd.dom.getElementsByTagName("td")[a];return this.mainHd.query(this.cellSelector)[a-b]},addRowClass:function(a,b){var d=this.getLockedRow(a);d&&this.fly(d).addClass(b);Ext.ux.grid.LockingHeaderGroupGridView.superclass.addRowClass.call(this,
a,b)},removeRowClass:function(a,b){var d=this.getLockedRow(a);d&&this.fly(d).removeClass(b);Ext.ux.grid.LockingHeaderGroupGridView.superclass.removeRowClass.call(this,a,b)},removeRow:function(a){Ext.removeNode(this.getLockedRow(a));Ext.ux.grid.LockingHeaderGroupGridView.superclass.removeRow.call(this,a)},removeRows:function(a,b){for(var d=this.lockedBody.dom,e=a;e<=b;e++)Ext.removeNode(d.childNodes[a]);Ext.ux.grid.LockingHeaderGroupGridView.superclass.removeRows.call(this,a,b)},syncScroll:function(a){this.lockedScroller.dom.scrollTop=
this.scroller.dom.scrollTop;Ext.ux.grid.LockingHeaderGroupGridView.superclass.syncScroll.call(this,a)},updateSortIcon:function(a,b){var d=this.sortClasses,e=this.lockedHd.select("td").removeClass(d),g=this.mainHd.select("td").removeClass(d),h=this.cm.getLockedCount();d=d[b=="DESC"?1:0];a<h?e.item(a).addClass(d):g.item(a-h).addClass(d)},updateAllColumnWidths:function(){var a=this.getTotalWidth(),b=this.cm.getColumnCount(),d=this.getLockedWidth(),e=this.cm.getLockedCount(),g=[],h,k;this.updateLockedWidth();
for(k=0;k<b;k++){g[k]=this.getColumnWidth(k);this.getHeaderCell(k).style.width=g[k]}var o=this.getLockedRows(),w=this.getRows(),A,B;k=0;for(h=w.length;k<h;k++){A=o[k];A.style.width=d;if(A.firstChild){A.firstChild.style.width=d;A=A.firstChild.rows[0];for(B=0;B<e;B++)A.childNodes[B].style.width=g[B]}A=w[k];A.style.width=a;if(A.firstChild){A.firstChild.style.width=a;A=A.firstChild.rows[0];for(B=e;B<b;B++)A.childNodes[B-e].style.width=g[B]}}this.updateGroupStyles();this.onAllColumnWidthsUpdated(g,a);
this.syncHeaderHeight()},onColumnWidthUpdated:function(){Ext.ux.grid.LockingHeaderGroupGridView.superclass.onColumnWidthUpdated.call(this,arguments);this.updateGroupStyles.call(this)},onAllColumnWidthsUpdated:function(){Ext.ux.grid.LockingHeaderGroupGridView.superclass.onAllColumnWidthsUpdated.call(this,arguments);this.updateGroupStyles.call(this)},updateColumnWidth:function(a){var b=this.getColumnWidth(a),d=this.cm.getLockedCount(),e,g,h;this.updateLockedWidth();if(a<d){e=this.getLockedRows();g=
this.getLockedWidth();d=a}else{e=this.getRows();g=this.getTotalWidth();d=a-d}this.getHeaderCell(a).style.width=b;for(var k=0,o=e.length;k<o;k++){h=e[k];h.style.width=g;if(h.firstChild){h.firstChild.style.width=g;h.firstChild.rows[0].childNodes[d].style.width=b}}this.onColumnWidthUpdated(a,b,this.getTotalWidth());this.syncHeaderHeight()},updateColumnHidden:function(a,b){var d=this.cm.getLockedCount(),e,g,h,k=b?"none":"";this.updateLockedWidth();if(a<d){e=this.getLockedRows();g=this.getLockedWidth();
d=a}else{e=this.getRows();g=this.getTotalWidth();d=a-d}this.getHeaderCell(a).style.display=k;for(var o=0,w=e.length;o<w;o++){h=e[o];h.style.width=g;if(h.firstChild){h.firstChild.style.width=g;h.firstChild.rows[0].childNodes[d].style.display=k}}this.onColumnHiddenUpdated(a,b,this.getTotalWidth());delete this.lastViewWidth;this.layout()},doRender:function(a,b,d,e,g,h){var k=this.templates,o=k.cell;k=k.row;for(var w=g-1,A="width:"+this.getTotalWidth()+";",B="width:"+this.getLockedWidth()+";",J=[],L=
[],V,M,O,N={},W={},R,ra=0,Ja=b.length;ra<Ja;ra++){R=b[ra];V=[];M=[];for(var Da=ra+e,la=0;la<g;la++){O=a[la];N.id=O.id;N.css=(la===0?"x-grid3-cell-first ":la==w?"x-grid3-cell-last ":"")+(this.cm.config[la].cellCls?" "+this.cm.config[la].cellCls:"");N.attr=N.cellAttr="";N.value=O.renderer(R.data[O.name],N,R,Da,la,d);N.style=O.style;if(Ext.isEmpty(N.value))N.value="&#160;";if(this.markDirty&&R.dirty&&Ext.isDefined(R.modified[O.name]))N.css+=" x-grid3-dirty-cell";if(O.locked)M[M.length]=o.apply(N);else V[V.length]=
o.apply(N)}O=[];if(h&&(Da+1)%2===0)O[0]="x-grid3-row-alt";if(R.dirty)O[1]=" x-grid3-dirty-row";W.cols=g;if(this.getRowClass)O[2]=this.getRowClass(R,Da,W,d);W.alt=O.join(" ");W.cells=V.join("");W.tstyle=A;J[J.length]=k.apply(W);W.cells=M.join("");W.tstyle=B;L[L.length]=k.apply(W)}return[J.join(""),L.join("")]},processRows:function(a,b){if(!(!this.ds||this.ds.getCount()<1)){var d=this.getRows(),e=this.getLockedRows(),g,h;b=b||!this.grid.stripeRows;a=a||0;for(var k=0,o=d.length;k<o;++k){g=d[k];h=e[k];
g.rowIndex=k;h.rowIndex=k;if(!b){g.className=g.className.replace(this.rowClsRe," ");h.className=h.className.replace(this.rowClsRe," ");if((k+1)%2===0){g.className+=" x-grid3-row-alt";h.className+=" x-grid3-row-alt"}}if(this.syncHeights){g=Ext.get(g);h=Ext.get(h);var w=g.getHeight(),A=h.getHeight();if(w>A)h.setHeight(w);else A>w&&g.setHeight(A)}}if(a===0){Ext.fly(d[0]).addClass(this.firstRowCls);Ext.fly(e[0]).addClass(this.firstRowCls)}Ext.fly(d[d.length-1]).addClass(this.lastRowCls);Ext.fly(e[e.length-
1]).addClass(this.lastRowCls)}},afterRender:function(){if(this.ds&&this.cm){var a=this.renderRows()||["&#160;","&#160;"];this.mainBody.dom.innerHTML=a[0];this.lockedBody.dom.innerHTML=a[1];this.processRows(0,true);this.deferEmptyText!==true&&this.applyEmptyText()}},renderUI:function(){var a=this.renderHeaders(),b=this.templates.body.apply({rows:"&#160;"});a=this.templates.master.apply({body:b,header:a[0],ostyle:"width:"+this.getOffsetWidth()+";",bstyle:"width:"+this.getTotalWidth()+";",lockedBody:b,
lockedHeader:a[1],lstyle:"width:"+this.getLockedWidth()+";"});b=this.grid;b.getGridEl().dom.innerHTML=a;this.initElements();Ext.fly(this.innerHd).on("click",this.handleHdDown,this);Ext.fly(this.lockedInnerHd).on("click",this.handleHdDown,this);this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.lockedHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.scroller.on("scroll",this.syncScroll,
this);if(b.enableColumnResize!==false){this.splitZone=new Ext.grid.GridView.SplitDragZone(b,this.mainHd.dom);this.splitZone.setOuterHandleElId(Ext.id(this.lockedHd.dom));this.splitZone.setOuterHandleElId(Ext.id(this.mainHd.dom))}if(b.enableColumnMove){this.columnDrag=new Ext.grid.GridView.ColumnDragZone(b,this.innerHd);this.columnDrag.setOuterHandleElId(Ext.id(this.lockedInnerHd));this.columnDrag.setOuterHandleElId(Ext.id(this.innerHd));this.columnDrop=new Ext.grid.HeaderDropZone(b,this.mainHd.dom)}if(b.enableHdMenu!==
false){this.hmenu=new Ext.menu.Menu({id:b.id+"-hctx"});this.hmenu.add({itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"});this.grid.enableColLock!==false&&this.hmenu.add("-",{itemId:"lock",text:this.lockText,cls:"xg-hmenu-lock"},{itemId:"unlock",text:this.unlockText,cls:"xg-hmenu-unlock"});if(b.enableColumnHide!==false){this.colMenu=new Ext.menu.Menu({id:b.id+"-hcols-menu"});this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,
itemclick:this.handleHdMenuClick});this.hmenu.add("-",{itemId:"columns",hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})}this.hmenu.on("itemclick",this.handleHdMenuClick,this)}if(b.trackMouseOver){this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut});this.lockedBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut})}if(b.enableDragDrop||b.enableDrag)this.dragZone=new Ext.grid.GridDragZone(b,{ddGroup:b.ddGroup||"GridDD"});this.updateHeaderSortState()},
splitZoneConfig:{allowHeaderDrag:function(a){return!a.getTarget(null,null,true).hasClass("ux-grid-hd-group-cell")}},columnDropConfig:{getTargetFromEvent:function(a){return this.view.findHeaderCell(Ext.lib.Event.getTarget(a))},positionIndicator:function(a,b,d){a=this.getDragDropData.call(this,a,b,d);if(a===false)return false;b=a.px+this.proxyOffsets[0];this.proxyTop.setLeftTop(b,a.r.top+this.proxyOffsets[1]);this.proxyTop.show();this.proxyBottom.setLeftTop(b,a.r.bottom);this.proxyBottom.show();return a.pt},
onNodeDrop:function(a,b,d,e){b=e.header;if(b!=a){a=this.getDragDropData.call(this,b,a,d);if(a===false)return false;d=this.grid.colModel;b=a.oldIndex<a.newIndex;e=d.rows;for(var g=a.row,h=e.length;g<h;g++){for(var k=e[g],o=k.length,w=0,A=1,B=o,J=0,L=0;J<o;J++){var V=k[J];if(a.oldIndex>=L&&a.oldIndex<L+V.colspan)w=J;if(a.oldIndex+a.colspan-1>=L&&a.oldIndex+a.colspan-1<L+V.colspan)A=J-w+1;if(a.newIndex>=L&&a.newIndex<L+V.colspan)B=J;L+=V.colspan}o=k.splice(w,A);e[g]=k.splice(0,B-(b?A:0)).concat(o).concat(k)}for(e=
0;e<a.colspan;e++){g=a.oldIndex+(b?0:e);h=a.newIndex+(b?-1:e);d.moveColumn(g,h);this.grid.fireEvent("columnmove",g,h)}return true}return false}},updateGroupStyles:function(a){for(var b=this.lockedHd.query(".x-grid3-header-offset > table"),d=this.getLockedWidth(),e=this.rows,g=[],h=0;h<b.length;h++){b[h].style.width=d;if(h<e.length){var k=b[h].firstChild.firstChild.childNodes;for(var o=g[h]=0,w=0;o<k.length;o++){var A=e[h][o];g[h]+=1;if(typeof a!="number"||a>=w&&a<w+A.colspan){var B=this.getGroupStyle.call(this,
A,w);k[o].style.width=B.width;k[o].style.display=B.hidden?"none":""}w+=A.colspan}}}b=this.mainHd.query(".x-grid3-header-offset > table");d=this.getTotalWidth();e=this.rows;for(h=0;h<b.length;h++){b[h].style.width=d;if(h<e.length){k=b[h].firstChild.firstChild.childNodes;o=0;for(w=this.cm.getLockedCount();o<k.length;o++){A=e[h][g[h]+o];if(typeof a!="number"||a>=w&&a<w+A.colspan){B=this.getGroupStyle.call(this,A,w);k[o].style.width=B.width;k[o].style.display=B.hidden?"none":""}w+=A.colspan}}}},getGroupRowIndex:function(a){if(a)if((a=
a.className.match(this.hrowRe))&&a[1])return parseInt(a[1],10);return this.cm.rows.length},layout:function(){if(this.mainBody){var a=this.grid,b=a.getGridEl().getSize(true),d=b.width;if(!(!a.hideHeaders&&(d<20||b.height<20))){this.syncHeaderHeight();if(a.autoHeight){this.scroller.dom.style.overflow="visible";this.lockedScroller.dom.style.overflow="visible";if(Ext.isWebKit){this.scroller.dom.style.position="static";this.lockedScroller.dom.style.position="static"}}else{this.el.setSize(b.width,b.height);
a=this.mainHd.getHeight();var e=b.height-a}this.updateLockedWidth();if(this.forceFit){if(this.lastViewWidth!=d){this.fitColumns(false,false);this.lastViewWidth=d}}else{this.autoExpand();this.syncHeaderScroll()}this.onLayout(d,e)}}},getGroupSpan:function(a,b){if(a<0)return{col:0,colspan:this.cm.getColumnCount()};var d=this.cm.rows[a];if(d){for(var e=0,g=0,h=d.length;e<h;e++){var k=d[e];if(b>=g&&b<g+k.colspan)return{col:g,colspan:k.colspan};g+=k.colspan}return{col:g,colspan:0}}return{col:b,colspan:1}},
getOffsetWidth:function(){return this.cm.getTotalWidth()-this.cm.getTotalLockedWidth()+this.getScrollOffset()+"px"},renderHeaders:function(){var a=this.cm,b=this.templates;b=b.hcell;for(var d=[],e=[],g={},h=a.getColumnCount(),k=h-1,o=0;o<h;o++){g.id=a.getColumnId(o);g.value=a.getColumnHeader(o)||"";g.style=this.getColumnStyle(o,true);g.tooltip=this.getColumnTooltip(o);g.css=(o===0?"x-grid3-cell-first ":o==k?"x-grid3-cell-last ":"")+(a.config[o].headerCls?" "+a.config[o].headerCls:"");if(a.config[o].align==
"right")g.istyle="padding-right:16px";else delete g.istyle;if(a.isLocked(o))e[e.length]=b.apply(g);else d[d.length]=b.apply(g)}b=this.templates;g=[];k=[];a=this.cm;for(var w=this.rows,A="width:"+this.getTotalWidth()+";",B=0,J=w.length;B<J;B++){var L=w[B],V=[],M=[],O=o=0;for(h=L.length;o<h;o++){var N=L[o];N.colspan=N.colspan||1;var W=this.getColumnId(N.dataIndex?a.findColumnIndex(N.dataIndex):O),R=this.getGroupStyle.call(this,N,O);W=b.gcell.apply({cls:"ux-grid-hd-group-cell",id:W,row:B,style:"width:"+
R.width+";"+(R.hidden?"display:none;":"")+(N.align?"text-align:"+N.align+";":""),tooltip:N.tooltip?(Ext.QuickTips.isEnabled()?"ext:qtip":"title")+'="'+N.tooltip+'"':"",istyle:N.align=="right"?"padding-right:16px":"",btn:this.grid.enableHdMenu&&N.header,value:N.header||"&nbsp;"});if(a.isLocked(N.dataIndex?a.findColumnIndex(N.dataIndex):O))M[o]=W;else V[o]=W;O+=N.colspan}g[B]=b.header.apply({tstyle:A,cells:V.join("")});k[B]=b.header.apply({tstyle:A,cells:M.join("")})}g.push(b.header.apply({cells:d.join(""),
tstyle:"width:"+this.getTotalWidth()+";"}));k.push(b.header.apply({cells:e.join(""),tstyle:"width:"+this.getLockedWidth()+";"}));return[g.join(""),k.join("")]},getGroupStyle:function(a,b){for(var d=0,e=true,g=b,h=b+a.colspan;g<h;g++)if(!this.cm.isHidden(g)){e=this.cm.getColumnWidth(g);if(typeof e=="number")d+=e;e=false}return{width:(Ext.isBorderBox||Ext.isWebKit&&!Ext.isSafari2?d:Math.max(d-this.borderWidth,0))+"px",hidden:e}},findHeaderCell:function(a){return a?this.fly(a).findParent("td.x-grid3-hd",
this.cellSelectorDepth):false},findHeaderIndex:function(a){return(a=this.findHeaderCell(a))?this.getCellIndex(a):false},updateHeaders:function(){var a=this.renderHeaders();this.innerHd.firstChild.innerHTML=a[0];this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=this.getTotalWidth();this.lockedInnerHd.firstChild.innerHTML=a[1];a=this.getLockedWidth();this.lockedInnerHd.firstChild.style.width=a;this.lockedInnerHd.firstChild.firstChild.style.width=
a},getResolvedXY:function(a){if(!a)return null;var b=a.cell;a=a.row;return b?Ext.fly(b).getXY():[this.scroller.getX(),Ext.fly(a).getY()]},syncFocusEl:function(a,b,d){Ext.ux.grid.LockingHeaderGroupGridView.superclass.syncFocusEl.call(this,a,b,b<this.cm.getLockedCount()?false:d)},ensureVisible:function(a,b,d){return Ext.ux.grid.LockingHeaderGroupGridView.superclass.ensureVisible.call(this,a,b,b<this.cm.getLockedCount()?false:d)},insertRows:function(a,b,d,e){a=a.getCount()-1;if(!e&&b===0&&d>=a)this.refresh();
else{e||this.fireEvent("beforerowsinserted",this,b,d);var g=this.renderRows(b,d),h=this.getRow(b);if(h){b===0&&this.removeRowClass(0,this.firstRowCls);Ext.DomHelper.insertHtml("beforeBegin",h,g[0]);h=this.getLockedRow(b);Ext.DomHelper.insertHtml("beforeBegin",h,g[1])}else{this.removeRowClass(a-1,this.lastRowCls);Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,g[0]);Ext.DomHelper.insertHtml("beforeEnd",this.lockedBody.dom,g[1])}if(e){if(b===0||b>=a)this.addRowClass(b,b===0?this.firstRowCls:
this.lastRowCls)}else{this.fireEvent("rowsinserted",this,b,d);this.processRows(b)}}this.syncFocusEl(b)},getColumnStyle:function(a,b){var d=!b?this.cm.config[a].cellStyle||this.cm.config[a].css||"":this.cm.config[a].headerStyle||"";d+="width:"+this.getColumnWidth(a)+";";if(this.cm.isHidden(a))d+="display:none;";var e=this.cm.config[a].align;if(e)d+="text-align:"+e+";";return d},getLockedWidth:function(){return this.cm.getTotalLockedWidth()+"px"},getTotalWidth:function(){return this.cm.getTotalWidth()-
this.cm.getTotalLockedWidth()+"px"},getColumnData:function(){for(var a=[],b=this.cm,d=b.getColumnCount(),e=0;e<d;e++){var g=b.getDataIndex(e);a[e]={name:!Ext.isDefined(g)?this.ds.fields.get(e).name:g,renderer:b.getRenderer(e),id:b.getColumnId(e),style:this.getColumnStyle(e),locked:b.isLocked(e)}}return a},renderBody:function(){var a=this.renderRows()||["&#160;","&#160;"];return[this.templates.body.apply({rows:a[0]}),this.templates.body.apply({rows:a[1]})]},refreshRow:function(a){Ext.ux.grid.LockingHeaderGroupGridView.superclass.refreshRow.call(this,
a);a=Ext.isNumber(a)?a:this.ds.indexOf(a);this.getLockedRow(a).rowIndex=a},refresh:function(a){this.fireEvent("beforerefresh",this);this.grid.stopEditing(true);var b=this.renderBody();this.mainBody.update(b[0]).setWidth(this.getTotalWidth());this.lockedBody.update(b[1]).setWidth(this.getLockedWidth());if(a===true){this.updateHeaders();this.updateHeaderSortState()}this.processRows(0,true);this.layout();this.applyEmptyText();this.fireEvent("refresh",this)},onDenyColumnLock:function(){},initData:function(a,
b){this.cm&&this.cm.un("columnlockchange",this.onColumnLock,this);Ext.ux.grid.LockingHeaderGroupGridView.superclass.initData.call(this,a,b);this.cm&&this.cm.on("columnlockchange",this.onColumnLock,this)},onColumnLock:function(){this.refresh(true)},handleHdMenuClick:function(a){var b=this.hdCtxIndex,d=this.cm,e=a.getItemId(),g=d.getLockedCount();switch(e){case "lock":if(d.getColumnCount(true)<=g+1){this.onDenyColumnLock();return}d.setLocked(b,true);if(g!=b){d.moveColumn(b,g);this.grid.fireEvent("columnmove",
b,g)}break;case "unlock":if(g-1!=b){d.setLocked(b,false,true);d.moveColumn(b,g-1);this.grid.fireEvent("columnmove",b,g-1)}else d.setLocked(b,false);break;default:return Ext.ux.grid.LockingHeaderGroupGridView.superclass.handleHdMenuClick.call(this,a)}return true},handleHdDown:function(a,b){var d=Ext.get(b);if(d.hasClass("x-grid3-hd-btn")){a.stopEvent();var e=this.findHeaderCell(b);Ext.fly(e).addClass("x-grid3-hd-menu-open");this.hdCtxIndex=d=this.getCellIndex(e);var g=this.hmenu.items,h=this.cm;g.get("asc").setDisabled(!h.isSortable(d));
g.get("desc").setDisabled(!h.isSortable(d));this.hmenu.on("hide",function(){Ext.fly(e).removeClass("x-grid3-hd-menu-open")},this,{single:true});this.hmenu.show(b,"tl-bl?")}else if(d.hasClass("ux-grid-hd-group-cell")||Ext.fly(b).up(".ux-grid-hd-group-cell"))a.stopEvent();if(this.grid.enableColLock!==false)if(Ext.fly(b).hasClass("x-grid3-hd-btn")){e=this.findHeaderCell(b);d=this.getCellIndex(e);g=this.hmenu.items;h=this.cm;g.get("lock").setDisabled(h.isLocked(d));g.get("unlock").setDisabled(!h.isLocked(d))}},
handleHdOver:function(a,b){var d=this.findHeaderCell(b);if(d&&!this.headersDisabled){this.activeHdRef=b;this.activeHdIndex=this.getCellIndex(d);var e=this.fly(d);this.activeHdRegion=e.getRegion();if(!(this.cm.isMenuDisabled(this.activeHdIndex)||e.hasClass("ux-grid-hd-group-cell"))){e.addClass("x-grid3-hd-over");if(this.activeHdBtn=e.child(".x-grid3-hd-btn"))this.activeHdBtn.dom.style.height=d.firstChild.offsetHeight-1+"px"}}},handleHdOut:function(a,b){var d=this.findHeaderCell(b);if(d&&(!Ext.isIE||
!a.within(d,true))){this.activeHdRef=null;this.fly(d).removeClass("x-grid3-hd-over");d.style.cursor=""}},syncHeaderHeight:function(){this.innerHd.firstChild.firstChild.style.height="auto";this.lockedInnerHd.firstChild.firstChild.style.height="auto";var a=this.innerHd.firstChild.firstChild.offsetHeight,b=this.lockedInnerHd.firstChild.firstChild.offsetHeight;a=(b>a?b:a)+"px";this.innerHd.firstChild.firstChild.style.height=a;this.lockedInnerHd.firstChild.firstChild.style.height=a},updateLockedWidth:function(){var a=
this.cm.getTotalLockedWidth(),b=this.cm.getTotalWidth()-a,d=this.grid.getGridEl().getSize(true),e=Ext.isBorderBox?0:this.lockedBorderWidth,g=Ext.isBorderBox?0:this.rowBorderWidth,h=d.width-a-e-g+"px",k=this.getScrollOffset();if(!this.grid.autoHeight){d=d.height-this.mainHd.getHeight()+"px";this.lockedScroller.dom.style.height=d;this.scroller.dom.style.height=d}this.lockedWrap.dom.style.width=a+g+"px";this.scroller.dom.style.width=h;this.mainWrap.dom.style.left=a+e+g+"px";if(this.innerHd){this.lockedInnerHd.firstChild.style.width=
a+"px";this.lockedInnerHd.firstChild.firstChild.style.width=a+"px";this.innerHd.style.width=h;this.innerHd.firstChild.style.width=b+g+k+"px";this.innerHd.firstChild.firstChild.style.width=b+"px"}if(this.mainBody){this.lockedBody.dom.style.width=a+g+"px";this.mainBody.dom.style.width=b+g+"px"}}});
Ext.ux.grid.LockingGroupColumnModel=Ext.extend(Ext.grid.ColumnModel,{isLocked:function(a){return this.config[a].locked===true},setLocked:function(a,b,d){if(this.isLocked(a)!=b){this.config[a].locked=b;d||this.fireEvent("columnlockchange",this,a,b)}},getTotalLockedWidth:function(){for(var a=0,b=0,d=this.config.length;b<d;b++)if(this.isLocked(b)&&!this.isHidden(b))a+=this.getColumnWidth(b);return a},getLockedCount:function(){for(var a=this.config.length,b=0;b<a;b++)if(!this.isLocked(b))return b;return a},
moveColumn:function(a,b){var d=this.isLocked(a),e=this.isLocked(b);if(a<b&&d&&!e)this.setLocked(a,false,true);else a>b&&!d&&e&&this.setLocked(a,true,true);Ext.ux.grid.LockingGroupColumnModel.superclass.moveColumn.apply(this,arguments)}});Ext.namespace("Ext.ux.Ribbon");
Ext.ux.Ribbon=Ext.extend(Ext.TabPanel,{titleId:null,constructor:function(a){this.titleId=[];Ext.apply(a,{baseCls:"x-plain ui-ribbon",margins:"0 0 0 0",plain:true,border:false,deferredRender:false,layoutOnTabChange:true,title:"",activeTab:0,listeners:{beforetabchange:function(d){d.expand()},afterrender:{scope:this,fn:function(){if(this.titleId.length>0)for(var d=0;d<this.titleId.length;d++)(r=Ext.get(this.titleId[d].id))&&r.on("click",this.titleId[d].fn)}}}});Ext.apply(this,Ext.apply(this.initialConfig,
a));if(a.items)for(var b=0;b<a.items.length;b++)this.initRibbon(a.items[b],b);Ext.ux.Ribbon.superclass.constructor.apply(this,arguments)},initRibbon:function(a){for(var b=[],d=0;d<a.ribbon.length;d++){c={xtype:"buttongroup",cls:"x-btn-group-ribbonstyle",defaults:{scale:"small",iconAlign:"left",minWidth:40},items:a.ribbon[d].items};title=a.ribbon[d].title||"";topTitle=a.ribbon[d].topTitle||false;if(onTitleClick=a.ribbon[d].onTitleClick||false){titleId="ux-ribbon-"+Ext.id();title='<span id="'+titleId+
'" style="cursor:pointer;">'+title+"</span>";this.titleId.push({id:titleId,fn:onTitleClick})}if(title!=="")topTitle?Ext.apply(c,{title:title}):Ext.apply(c,{footerCfg:{cls:"x-btn-group-header x-unselectable",tag:"span",html:title}});if(cfg=a.ribbon[d].cfg||null){Ext.applyIf(c,a.ribbon[d].cfg);cfg.defaults&&Ext.apply(c.defaults,cfg.defaults)}b.push(c)}Ext.apply(a,{baseCls:"x-plain",tbar:b})}});
Ext.ux.ToolbarDroppable=Ext.extend(Object,{constructor:function(a){Ext.apply(this,a,{})},init:function(a){this.toolbar=a;this.toolbar.on({scope:this,render:this.createDropTarget})},createDropTarget:function(){this.dropTarget=new Ext.dd.DropTarget(this.toolbar.getEl(),{notifyOver:this.notifyOver.createDelegate(this),notifyDrop:this.notifyDrop.createDelegate(this)})},addDDGroup:function(a){this.dropTarget!=undefined&&this.dropTarget.addToGroup(a)},calculateEntryIndex:function(a){var b=0,d=this.toolbar,
e=d.items.items,g=e.length;d=d.getEl().getXY()[0];a=a.getXY()[0]-d;for(var h=0;h<g;h++){b=e[h].getEl().getWidth();var k=d+b/2;d+=b;if(a<k){b=h;break}else b=h+1}return b},canDrop:function(){return true},notifyOver:function(){return this.canDrop.apply(this,arguments)?this.dropTarget.dropAllowed:this.dropTarget.dropNotAllowed},notifyDrop:function(a,b,d){a=this.canDrop(a,b,d);var e=this.toolbar;if(a){b=this.calculateEntryIndex(b);e.insert(b,this.createItem(d));e.doLayout();this.afterLayout()}return a},
createItem:function(){throw Error("The createItem method must be implemented in the ToolbarDroppable plugin");},afterLayout:Ext.emptyFn});
Ext.ux.ToolbarReorderer=Ext.extend(Ext.ux.Reorderer,{init:function(a){this.buttonXCache={};a.on({scope:this,add:function(b,d){this.createIfReorderable(d)}});Ext.ux.ToolbarReorderer.superclass.init.apply(this,arguments)},createItemDD:function(a){if(a.dd==undefined){var b=a.getEl(),d=this.target,e=this;a.dd=new Ext.dd.DD(b,undefined,{isTarget:false});var g=function(){return false};Ext.apply(a.dd,{b4StartDrag:function(){this.startPosition=b.getXY();this.startZIndex=b.getStyle("zIndex");b.setStyle("zIndex",
1E4);a.suspendEvents();a.menu&&a.menu.on("beforeshow",g,e)},startDrag:function(){this.constrainTo(d.getEl());this.setYConstraint(0,0,0)},onDrag:function(){for(var h=b.getXY()[0],k=h-this.startPosition[0],o=d.items.items,w=o.indexOf(a),A=0;A<o.length;A++){var B=o[A];if(B.reorderable&&B.id!=a.id){var J=B.getEl().getBox();J=(e.buttonXCache[B.id]||J.x)+J.width/2;B=w>A&&k<0&&h<J;J=w<A&&k>0&&h+b.getWidth()>J;if(B||J){e[B?"onMovedLeft":"onMovedRight"](a,A,w);break}}}},endDrag:function(){e.updateButtonXCache();
b.moveTo(e.buttonXCache[a.id],b.getY(),{duration:e.animationDuration,scope:this,callback:function(){a.resumeEvents();a.menu&&a.menu.un("beforeshow",g,e);d.fireEvent("reordered",a,d)}});b.setStyle("zIndex",this.startZIndex)}})}},onMovedLeft:function(a,b,d){var e=this.target,g=e.items.items;if(b!=undefined&&b!=d){e.remove(a,false);e.insert(b,a);this.updateButtonXCache();for(b=0;b<g.length;b++){e=g[b];d=this.buttonXCache[e.id];if(a==e)a.dd.startPosition[0]=d;else{e=e.getEl();e.moveTo(d,e.getY(),{duration:this.animationDuration})}}}},
onMovedRight:function(){this.onMovedLeft.apply(this,arguments)},updateButtonXCache:function(){var a=this.target,b=a.items,d=a.getEl().getBox(true).x;b.each(function(e){this.buttonXCache[e.id]=d;d+=e.getEl().getWidth()},this)}});Ext.ux.Mask=function(a){Ext.apply(this,{mask:a})};
Ext.extend(Ext.ux.Mask,Object,{init:function(a){this.LetrasL="abcdefghijklmnopqrstuvwxyz";this.LetrasU=Ext.util.Format.uppercase(this.LetrasL);this.Letras=this.LetrasL+this.LetrasU;this.Numeros="0123456789";this.Fixos="().-:/ ";this.Charset=" !\"#$%&'()*+,-./0123456789:;<=>?@"+this.LetrasU+"[]^_/`"+this.LetrasL+"{|}~";a.enableKeyEvents=true;a.on("keypress",function(b,d){return this.press(b,d)},this)},press:function(a,b){var d=a.getValue(),e=b.getKey(),g=this.mask,h=a.el.dom;if(b){if(h.selectionEnd-
h.selectionStart>0)return true;if(h.selectionStart>0&&h.selectionStart<h.textLength)return true;var k=this.Charset.substr(e-32,1);if(e<32||b.isNavKeyPress()||e==b.BACKSPACE)return true;if(Ext.isGecko||Ext.isGecko2||Ext.isGecko3)if(b.charCode==0&&b.keyCode==46||b.isSpecialKey())return true;e=d.length;if(e>=g.length){a.setValue(d);b.stopEvent();return false}for(e=g.substr(e,1);this.Fixos.indexOf(e)!=-1;){d+=e;e=d.length;if(e>=g.length){b.stopEvent();return false}e=g.substr(e,1)}switch(e){case "#":if(this.Numeros.indexOf(k)==
-1){b.stopEvent();return false}break;case "A":k=k.toUpperCase();if(this.LetrasU.indexOf(k)==-1){b.stopEvent();return false}break;case "a":k=k.toLowerCase();if(this.LetrasL.indexOf(k)==-1){b.stopEvent();return false}break;case "Z":if(this.Letras.indexOf(k)==-1){b.stopEvent();return false}break;case "*":a.setValue(d+k);break;default:a.setValue(d)}}a.setValue(d+k);h.selectionEnd=h.selectionStart;b.stopEvent();return false}});Ext.ns("Ext.ux");
Ext.ux.Lightbox=function(){var a={},b=[],d,e=false,g=[];return{overlayOpacity:0.85,animate:true,resizeSpeed:8,borderSize:10,labelImage:"Image",labelOf:"of",init:function(){this.resizeDuration=this.animate?(11-this.resizeSpeed)*0.15:0;this.overlayDuration=this.animate?0.2:0;if(!e){Ext.apply(this,Ext.util.Observable.prototype);Ext.util.Observable.constructor.call(this);this.addEvents("open","close");this.initMarkup();this.initEvents();e=true}},initMarkup:function(){a.shim=Ext.DomHelper.append(document.body,
{tag:"iframe",id:"ux-lightbox-shim"},true);a.overlay=Ext.DomHelper.append(document.body,{id:"ux-lightbox-overlay"},true);var h=new Ext.Template(this.getTemplate());a.lightbox=h.append(document.body,{},true);Ext.each(["outerImageContainer","imageContainer","image","hoverNav","navPrev","navNext","loading","loadingLink","outerDataContainer","dataContainer","data","details","caption","imageNumber","bottomNav","navClose"],function(k){a[k]=Ext.get("ux-lightbox-"+k)});Ext.each([a.overlay,a.lightbox,a.shim],
function(k){k.setVisibilityMode(Ext.Element.DISPLAY);k.hide()});h=(this.animate?250:1)+"px";a.outerImageContainer.setStyle({width:h,height:h})},getTemplate:function(){return['<div id="ux-lightbox">','<div id="ux-lightbox-outerImageContainer">','<div id="ux-lightbox-imageContainer">','<img id="ux-lightbox-image">','<div id="ux-lightbox-hoverNav">','<a href="#" id="ux-lightbox-navPrev"></a>','<a href="#" id="ux-lightbox-navNext"></a>',"</div>",'<div id="ux-lightbox-loading">','<a id="ux-lightbox-loadingLink"></a>',
"</div>","</div>","</div>",'<div id="ux-lightbox-outerDataContainer">','<div id="ux-lightbox-dataContainer">','<div id="ux-lightbox-data">','<div id="ux-lightbox-details">','<span id="ux-lightbox-caption"></span>','<span id="ux-lightbox-imageNumber"></span>',"</div>",'<div id="ux-lightbox-bottomNav">','<a href="#" id="ux-lightbox-navClose"></a>',"</div>","</div>","</div>","</div>","</div>"]},initEvents:function(){var h=function(k){k.preventDefault();this.close()};a.overlay.on("click",h,this);a.loadingLink.on("click",
h,this);a.navClose.on("click",h,this);a.lightbox.on("click",function(k){k.getTarget().id=="ux-lightbox"&&this.close()},this);a.navPrev.on("click",function(k){k.preventDefault();this.setImage(d-1)},this);a.navNext.on("click",function(k){k.preventDefault();this.setImage(d+1)},this)},register:function(h,k){if(g.indexOf(h)===-1){g.push(h);Ext.fly(document).on("click",function(o){var w=o.getTarget(h);if(w){o.preventDefault();this.open(w,h,k)}},this)}},open:function(h,k,o){o=o||false;this.setViewSize();
a.overlay.fadeIn({duration:this.overlayDuration,endOpacity:this.overlayOpacity,callback:function(){b=[];var w=0;if(o){var A=Ext.query(k);for(Ext.each(A,function(J){J.href&&b.push([J.href,J.title])});b[w][0]!=h.href;)w++}else b.push([h.href,h.title]);A=Ext.fly(document).getScroll();var B=A.top+Ext.lib.Dom.getViewportHeight()/10;a.lightbox.setStyle({top:B+"px",left:A.left+"px"}).show();this.setImage(w);this.fireEvent("open",b[w])},scope:this})},setViewSize:function(){var h=this.getViewSize();a.overlay.setStyle({width:h[0]+
"px",height:h[1]+"px"});a.shim.setStyle({width:h[0]+"px",height:h[1]+"px"}).show()},setImage:function(h){d=h;this.disableKeyNav();this.animate&&a.loading.show();a.image.hide();a.hoverNav.hide();a.navPrev.hide();a.navNext.hide();a.dataContainer.setOpacity(1.0E-4);a.imageNumber.hide();var k=new Image;k.onload=function(){a.image.dom.src=b[d][0];this.resizeImage(k.width,k.height)}.createDelegate(this);k.src=b[d][0]},resizeImage:function(h,k){var o=a.outerImageContainer.getWidth(),w=a.outerImageContainer.getHeight(),
A=h+this.borderSize*2,B=k+this.borderSize*2;o=o-A;var J=function(){a.hoverNav.setWidth(a.imageContainer.getWidth()+"px");a.navPrev.setHeight(k+"px");a.navNext.setHeight(k+"px");a.outerDataContainer.setWidth(A+"px");this.showImage()};w-B!=0||o!=0?a.outerImageContainer.shift({height:B,width:A,duration:this.resizeDuration,scope:this,callback:J,delay:50}):J.call(this)},showImage:function(){a.loading.hide();a.image.fadeIn({duration:this.resizeDuration,scope:this,callback:function(){this.updateDetails()}});
this.preloadImages()},updateDetails:function(){var h=a.data.getWidth(true)-a.navClose.getWidth()-10;a.details.setWidth((h>0?h:0)+"px");a.caption.update(b[d][1]);a.caption.show();if(b.length>1){a.imageNumber.update(this.labelImage+" "+(d+1)+" "+this.labelOf+"  "+b.length);a.imageNumber.show()}a.dataContainer.fadeIn({duration:this.resizeDuration/2,scope:this,callback:function(){var k=this.getViewSize();a.overlay.setHeight(k[1]+"px");this.updateNav()}})},updateNav:function(){this.enableKeyNav();a.hoverNav.show();
d>0&&a.navPrev.show();d<b.length-1&&a.navNext.show()},enableKeyNav:function(){Ext.fly(document).on("keydown",this.keyNavAction,this)},disableKeyNav:function(){Ext.fly(document).un("keydown",this.keyNavAction,this)},keyNavAction:function(h){h=h.getKey();if(h==88||h==67||h==27)this.close();else if(h==80||h==37)d!=0&&this.setImage(d-1);else if(h==78||h==39)d!=b.length-1&&this.setImage(d+1)},preloadImages:function(){var h;if(b.length>d+1){h=new Image;h.src=b[d+1][0]}if(d>0){h=new Image;h.src=b[d-1][0]}},
close:function(){this.disableKeyNav();a.lightbox.hide();a.overlay.fadeOut({duration:this.overlayDuration});a.shim.hide();this.fireEvent("close",d)},getViewSize:function(){return[Ext.lib.Dom.getViewWidth(),Ext.lib.Dom.getViewHeight()]}}}();Ext.onReady(Ext.ux.Lightbox.init,Ext.ux.Lightbox);Ext.QuickTips.init();if(typeof console=="undefined")var console={log:function(){}};Ext.namespace("Ext.m3");var SOFTWARE_NAME="\u041f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0430 \u041c3";
function assert(a,b){if(!a){console.error(b);throw Error(b);}}
function smart_eval(a){if(a!=undefined)if(a.substring(0,1)=="{"){if(a=Ext.util.JSON.decode(a))if(a.code){var b=a.code();b&&b instanceof Ext.Window&&typeof AppDesktop!="undefined"&&AppDesktop&&AppDesktop.getDesktop().createWindow(b);return b}else if(a.message&&a.message!="")Ext.Msg.show({title:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435",msg:a.message,buttons:Ext.Msg.OK,icon:a.success!=undefined&&!a.success?Ext.Msg.WARNING:Ext.Msg.Info})}else{try{b=eval(a)}catch(d){Ext.Msg.show({title:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435",
msg:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043d\u0435\u043f\u0440\u0435\u0434\u0432\u0438\u0434\u0435\u043d\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430!",buttons:Ext.Msg.OK,fn:Ext.emptyFn,animEl:"elId",icon:Ext.MessageBox.WARNING});throw d;}b&&b instanceof Ext.Window&&typeof AppDesktop!="undefined"&&AppDesktop&&AppDesktop.getDesktop().createWindow(b);return b}}Ext.ns("Ext.app.form");
Ext.app.form.SearchField=Ext.extend(Ext.form.TwinTriggerField,{initComponent:function(){Ext.app.form.SearchField.superclass.initComponent.call(this);this.on("specialkey",function(a,b){b.getKey()==b.ENTER&&this.onTrigger2Click()},this)},validationEvent:false,validateOnBlur:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:true,width:180,hasSearch:false,paramName:"filter",paramId:"id",nodeId:"-1",onTrigger1Click:function(){if(this.hasSearch){this.el.dom.value=
"";var a=this.getComponentForSearch();if(a instanceof Ext.grid.GridPanel){var b=a.getStore();b.baseParams=b.baseParams||{};b.baseParams[this.paramName]="";b.baseParams[this.paramId]=this.nodeId||"";b.reload({params:{start:0}})}else if(a instanceof Ext.ux.tree.TreeGrid){this.el.dom.value="";b=a.getLoader();b.baseParams=b.baseParams||{};b.baseParams[this.paramName]="";a=a.getRootNode();b.load(a);a.expand()}this.triggers[0].hide();this.hasSearch=false}},onTrigger2Click:function(){var a=this.getRawValue(),
b=this.getComponentForSearch();if(b instanceof Ext.grid.GridPanel){var d=b.getStore();d.baseParams=d.baseParams||{};d.baseParams[this.paramName]=a;d.baseParams[this.paramId]=this.nodeId||"";d.reload({params:{start:0}})}else if(b instanceof Ext.ux.tree.TreeGrid){d=b.getLoader();d.baseParams=d.baseParams||{};d.baseParams[this.paramName]=a;b=b.getRootNode();d.load(b);b.expand()}if(a){this.hasSearch=true;this.triggers[0].show()}},clear:function(){this.onTrigger1Click()},search:function(){this.onTrigger2Click()}});
Ext.override(Ext.form.Field,{isEdit:true,isModified:false,updateLabel:function(){this.setFieldLabel(this.fieldLabel)},setFieldLabel:function(a){if(a!=undefined){if(this.rendered){var b=a+":";if(this.isModified)b='<span style="color:darkmagenta;">'+b+"</span>";var d=this.el.up(".x-form-item",10,true);d&&d.child(".x-form-item-label").update(b)}this.fieldLabel=a}},fireKey:function(a){if(a.isSpecialKey()){a.getKey()==a.ENTER&&this.onBlur();this.fireEvent("specialkey",this,a)}}});
Ext.app.TitlePanel=Ext.extend(Ext.Panel,{titleItems:null,addTitleItem:function(a){a=Ext.ComponentMgr.create(a);var b=Ext.DomHelper.append(this.header,{tag:"div",style:"float:right;margin-top:-4px;margin-left:3px;"},true);a.render(b)},onRender:function(){Ext.app.TitlePanel.superclass.onRender.apply(this,arguments);if(this.titleItems!=null){if(Ext.isArray(this.titleItems))for(var a=this.titleItems.length-1;a>=0;a--)this.addTitleItem(this.titleItems[a]);else this.addTitleItems(this.titleItems);this.header&&
this.header.removeClass("x-unselectable")}},getChildByName:function(a){if(this.items)for(var b=0;b<this.items.length;b++)if(this.items.items[b].name==a)return this.items.items[b];if(this.titleItems)for(b=0;b<this.titleItems.length;b++)if(this.titleItems[b].name==a)return this.titleItems[b];return null}});
function uiFailureResponseOnFormSubmit(a){if(a.action.failureType=="server"){obj=Ext.util.JSON.decode(a.action.response.responseText);Ext.Msg.show({title:a.title,msg:obj.error_msg,buttons:Ext.Msg.OK,icon:Ext.Msg.WARNING})}else Ext.Msg.alert(a.title,a.message)}
function uiAjaxFailMessage(a,b){if(Ext.isEmpty(a))Ext.Msg.alert(SOFTWARE_NAME,"\u0418\u0437\u0432\u0438\u043d\u0438\u0442\u0435, \u0441\u0435\u0440\u0432\u0435\u0440 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043d\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d.");else if(b.failureType==="server")b&&b.response&&b.response.responseText&&smart_eval(b.response.responseText);else{var d=Ext.getBody().getViewSize(),e=d.width<500?d.width-50:500;d=d.height<300?d.height-50:300;if(!a.responseText&&
b&&b.response)a=b.response;(new Ext.Window({modal:true,width:e,height:d,title:"Request Failure",layout:"fit",maximizable:true,maximized:true,listeners:{maximize:{fn:function(g){var h=Ext.getBody().getViewSize();g.setSize(h.width,h.height)},scope:this},resize:{fn:function(g){var h=Ext.getCmp("__ErrorMessageEditor");g=g.body.getViewSize();h.setSize(g.width,g.height-42)}}},items:new Ext.form.FormPanel({baseCls:"x-plain",layout:"absolute",defaultType:"label",items:[{x:5,y:5,html:'<div class="x-window-dlg"><div class="ext-mb-error" style="width:32px;height:32px"></div></div>'},
{x:42,y:6,html:"<b>Status Code: </b>"},{x:125,y:6,text:a.status},{x:42,y:25,html:"<b>Status Text: </b>"},{x:125,y:25,text:a.statusText},{x:0,y:42,id:"__ErrorMessageEditor",xtype:"htmleditor",value:a.responseText,readOnly:true,enableAlignments:false,enableColors:false,enableFont:false,enableFontSize:false,enableFormat:false,enableLinks:false,enableLists:false,enableSourceEdit:false,listeners:{push:{fn:function(){(function(g){try{for(var h=g.getElementsByTagName("script"),k=0;k<h.length;k++)h[k].innerText?
this.eval(h[k].innerText):this.eval(h[k].textContent);this.hideAll(this.getElementsByClassName(g,"table","vars"));this.hideAll(this.getElementsByClassName(g,"ol","pre-context"));this.hideAll(this.getElementsByClassName(g,"ol","post-context"));this.hideAll(this.getElementsByClassName(g,"div","pastebin"))}catch(o){}}).call(this.iframe.contentWindow,this.iframe.contentDocument)}}}}]})})).show()}}
function uiShowErrorMessage(a){obj=Ext.util.JSON.decode(a.responseText);obj.error_msg&&Ext.Msg.alert(SOFTWARE_NAME,obj.error_msg);return obj.success}function sendRequest(a,b,d){var e=new Ext.LoadMask(Ext.getBody());e.show();Ext.Ajax.request({params:d,url:a,method:"POST",success:function(g){try{smart_eval(g.responseText)}finally{e.hide()}},failure:function(){uiAjaxFailMessage.apply(this,arguments);e.hide()}})}
function thousandCurrencyRenderer(a){if(typeof a!="number"){var b=a;try{b=parseFloat(a.replace(/,+/,".").replace(/\s+/g,""))}catch(d){b=NaN}if(isNaN(b))return a;else a=b}b="";var e=a.toFixed(2).split(".");a=e[0];e=e[1];var g=0,h=0,k=a.length%3;if(k!=0){for(;h<k;h++)b+=a.charAt(h);b+=" "}for(;h<a.length;h++){if(g%3==0&&g!=0)b+=" ";b+=a.charAt(h);g++}if(e)b+=","+e;return b=b.replace(/\s,/,",")}function includeInArr(a,b){return a.indexOf(b)!=-1}
function showMessage(a,b,d){b=b||"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435";a=a||"";d=d||Ext.MessageBox.INFO;Ext.Msg.show({title:b,msg:a,buttons:Ext.Msg.OK,icon:d})}function showWarning(a,b){showMessage(a,b,Ext.MessageBox.WARNING)}Ext.m3.ComboBox=Ext.extend(Ext.form.ComboBox,{getText:function(){return this.lastSelectionText}});
Ext.m3.GridPanel=Ext.extend(Ext.grid.GridPanel,{constructor:function(a,b){var d=b.selModel,e=b.colModel||[];d&&d instanceof Ext.grid.CheckboxSelectionModel&&e.columns.unshift(d);var g;g=b.menus.contextMenu&&b.menus.contextMenu instanceof Ext.menu.Menu?function(w){w.stopEvent();b.menus.contextMenu.showAt(w.getXY())}:Ext.emptyFn;var h;h=b.menus.rowContextMenu&&b.menus.rowContextMenu instanceof Ext.menu.Menu?function(w,A,B){B.stopEvent();this.getSelectionModel().isSelected(A)||this.getSelectionModel().selectRow(A);
b.menus.rowContextMenu.showAt(B.getXY())}:Ext.emptyFn;var k=b.plugins||[],o=b.bundedColumns;o&&o instanceof Array&&o.length>0&&k.push(new Ext.ux.grid.ColumnHeaderGroup({rows:o}));a.listeners=Ext.applyIf({contextmenu:g,rowcontextmenu:h,beforerender:function(){var w=this.getBottomToolbar();if(w&&w instanceof Ext.PagingToolbar){var A=this.getStore();A.setBaseParam("start",0);A.setBaseParam("limit",w.pageSize);w.bind(A)}}},a.listeners||{});d=Ext.applyIf({sm:d,colModel:e,plugins:k},a);Ext.m3.GridPanel.superclass.constructor.call(this,
d)},initComponent:function(){Ext.m3.GridPanel.superclass.initComponent.call(this);this.getStore().on("exception",this.storeException,this)},storeException:function(a,b,d,e,g){uiAjaxFailMessage(g,e)}});
Ext.m3.EditorGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{constructor:function(a,b){var d=b.selModel,e=b.colModel||[];d&&d instanceof Ext.grid.CheckboxSelectionModel&&e.unshift(d);var g;g=b.menus.contextMenu&&b.menus.contextMenu instanceof Ext.menu.Menu?function(w){w.stopEvent();b.menus.contextMenu.showAt(w.getXY())}:Ext.emptyFn;var h;h=b.menus.rowContextMenu&&b.menus.contextMenu instanceof Ext.menu.Menu?function(w,A,B){B.stopEvent();this.getSelectionModel().selectRow(A);b.menus.rowContextMenu.showAt(B.getXY())}:
Ext.emptyFn;var k=b.plugins||[],o=b.bundedColumns;o&&o instanceof Array&&o.length>0&&k.push(new Ext.ux.grid.ColumnHeaderGroup({rows:o}));a.listeners=Ext.applyIf({contextmenu:g,rowcontextmenu:h,beforerender:function(){var w=this.getBottomToolbar();if(w&&w instanceof Ext.PagingToolbar){var A=this.getStore();A.setBaseParam("start",0);A.setBaseParam("limit",w.pageSize);w.bind(A)}}},a.listeners||{});d=Ext.applyIf({sm:d,colModel:e,plugins:k},a);Ext.m3.EditorGridPanel.superclass.constructor.call(this,d)},
initComponent:function(){Ext.m3.EditorGridPanel.superclass.initComponent.call(this);this.getStore().on("exception",this.storeException,this)},storeException:function(a,b,d,e,g){if(b=="remote"&&d!=Ext.data.Api.actions.read)g.raw.message&&Ext.Msg.show({title:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!",msg:g.raw.message,buttons:Ext.Msg.CANCEL,icon:Ext.Msg.WARNING});else uiAjaxFailMessage(g,e)}});
Ext.version=="3.0"&&Ext.override(Ext.grid.GridView,{ensureVisible:function(a,b,d){if((a=this.resolveCell(a,b,d))&&a.row){var e=a.row,g=a.cell;b=this.scroller.dom;var h=0,k=e,o=this.el.dom;k=e;for(o=this.el.dom;k&&k!=o;){h+=k.offsetTop;k=k.offsetParent}h-=this.mainHd.dom.offsetHeight;e=h+e.offsetHeight;k=b.clientHeight;o=parseInt(b.scrollTop,10);var w=o+k;if(h<o)b.scrollTop=h;else if(e>w)b.scrollTop=e-k;if(d!==false){d=parseInt(g.offsetLeft,10);g=d+g.offsetWidth;h=parseInt(b.scrollLeft,10);o=h+b.clientWidth;
if(d<h)b.scrollLeft=d;else if(g>o)b.scrollLeft=g-b.clientWidth}return this.getResolvedXY(a)}}});Ext.namespace("Ext.ux.maximgb.tg");
Ext.ux.maximgb.tg.AbstractTreeStore=Ext.extend(Ext.data.Store,{leaf_field_name:"_is_leaf",page_offset:0,active_node:null,constructor:function(a){Ext.ux.maximgb.tg.AbstractTreeStore.superclass.constructor.call(this,a);if(!this.paramNames.active_node)this.paramNames.active_node="anode";this.addEvents("beforeexpandnode","expandnode","expandnodefailed","beforecollapsenode","collapsenode","beforeactivenodechange","activenodechange")},remove:function(a){a===this.active_node&&this.setActiveNode(null);this.removeNodeDescendants(a);
Ext.ux.maximgb.tg.AbstractTreeStore.superclass.remove.call(this,a)},removeNodeDescendants:function(a){var b,d=this.getNodeChildren(a);a=0;for(b=d.length;a<b;a++)this.remove(d[a])},load:function(a){if(a)if(a.params){if(a.params[this.paramNames.active_node]===undefined)a.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null}else{a.params={};a.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null}else{a={params:{}};a.params[this.paramNames.active_node]=
this.active_node?this.active_node.id:null}if(a.params[this.paramNames.active_node]!==null)a.add=true;return Ext.ux.maximgb.tg.AbstractTreeStore.superclass.load.call(this,a)},loadRecords:function(a,b,d){if(!a||d===false){d!==false&&this.fireEvent("load",this,[],b);if(b.callback)b.callback.call(b.scope||this,[],b,false)}else{d=a.records;var e=a.totalRecords||d.length,g=this.getPageOffsetFromOptions(b);a=this.getLoadedNodeIdFromOptions(b);var h,k,o=this;if(!b||b.add!==true){if(this.pruneModifiedRecords)this.modified=
[];h=0;for(a=d.length;h<a;h++)d[h].join(this);if(this.snapshot){this.data=this.snapshot;delete this.snapshot}this.data.clear();this.data.addAll(d);this.page_offset=g;this.totalLength=e;this.applySort();this.fireEvent("datachanged",this)}else{if(a)h=this.getById(a);if(h){this.setNodeLoaded(h,true);this.setNodeChildrenOffset(h,g);this.setNodeChildrenTotalCount(h,Math.max(e,d.length));this.removeNodeDescendants(h)}this.suspendEvents();g={};h=0;for(a=d.length;h<a;h++){e=d[h];k=this.indexOfId(e.id);if(k==
-1){g[e.id]=false;this.add(e)}else{g[e.id]=true;k=this.getAt(k);k.reject();k.data=e.data;d[h]=k}}this.applySort();this.resumeEvents();d.sort(function(w,A){var B=o.data.indexOf(w),J=o.data.indexOf(A);return B>J?1:-1});h=0;for(a=d.length;h<a;h++){e=d[h];g[e.id]==true?this.fireEvent("update",this,e,Ext.data.Record.COMMIT):this.fireEvent("add",this,[e],this.data.indexOf(e))}}this.fireEvent("load",this,d,b);if(b.callback)b.callback.call(b.scope||this,d,b,true)}},sort:function(a,b){if(this.remoteSort){this.setActiveNode(null);
if(this.lastOptions){this.lastOptions.add=false;if(this.lastOptions.params)this.lastOptions.params[this.paramNames.active_node]=null}}return Ext.ux.maximgb.tg.AbstractTreeStore.superclass.sort.call(this,a,b)},applySort:function(){if(this.sortInfo&&!this.remoteSort){var a=this.sortInfo;this.sortData(a.field,a.direction)}else this.applyTreeSort()},sortData:function(a,b){b=b||"ASC";var d=this.fields.get(a).sortType,e=function(g,h){var k=d(g.data[a]),o=d(h.data[a]);return k>o?1:k<o?-1:0};this.data.sort(b,
e);this.snapshot&&this.snapshot!=this.data&&this.snapshot.sort(b,e);this.applyTreeSort()},applyTreeSort:function(){var a,b,d,e=[],g=this.getRootNodes();a=0;for(b=g.length;a<b;a++){d=g[a];e.push(d);this.collectNodeChildrenTreeSorted(e,d)}if(e.length>0){this.data.clear();this.data.addAll(e)}if(this.snapshot&&this.snapshot!==this.data){a=this.data;this.data=this.snapshot;this.snapshot=null;this.applyTreeSort();this.snapshot=this.data;this.data=a}},collectNodeChildrenTreeSorted:function(a,b){var d,e,
g,h=this.getNodeChildren(b);d=0;for(e=h.length;d<e;d++){g=h[d];a.push(g);this.collectNodeChildrenTreeSorted(a,g)}},getActiveNode:function(){return this.active_node},setActiveNode:function(a){if(this.active_node!==a)if(a)if(this.data.indexOf(a)!=-1){if(this.fireEvent("beforeactivenodechange",this,this.active_node,a)!==false){this.active_node=a;this.fireEvent("activenodechange",this,this.active_node,a)}}else throw"Given record is not from the store.";else if(this.fireEvent("beforeactivenodechange",
this,this.active_node,a)!==false){this.active_node=a;this.fireEvent("activenodechange",this,this.active_node,a)}},isExpandedNode:function(a){return a.ux_maximgb_tg_expanded===true},setNodeExpanded:function(a,b){a.ux_maximgb_tg_expanded=b},isVisibleNode:function(a){var b,d=this.getNodeAncestors(a),e=true;a=0;for(b=d.length;a<b;a++){e=e&&this.isExpandedNode(d[a]);if(!e)break}return e},isLeafNode:function(a){return a.get(this.leaf_field_name)==true},isLoadedNode:function(a){return a.ux_maximgb_tg_loaded!==
undefined?a.ux_maximgb_tg_loaded:this.isLeafNode(a)||this.hasChildNodes(a)?true:false},setNodeLoaded:function(a,b){a.ux_maximgb_tg_loaded=b},getNodeChildrenOffset:function(a){return a.ux_maximgb_tg_offset||0},setNodeChildrenOffset:function(a,b){a.ux_maximgb_tg_offset=b},getNodeChildrenTotalCount:function(a){return a.ux_maximgb_tg_total||0},setNodeChildrenTotalCount:function(a,b){a.ux_maximgb_tg_total=b},collapseNode:function(a){if(this.isExpandedNode(a)&&this.fireEvent("beforecollapsenode",this,a)!==
false){this.setNodeExpanded(a,false);this.fireEvent("collapsenode",this,a)}},expandNode:function(a){var b;if(!this.isExpandedNode(a)&&this.fireEvent("beforeexpandnode",this,a)!==false)if(this.isLoadedNode(a)){this.setNodeExpanded(a,true);this.fireEvent("expandnode",this,a)}else{b={};b[this.paramNames.active_node]=a.id;this.load({add:true,params:b,callback:this.expandNodeCallback,scope:this})}},expandNodeCallback:function(a,b,d){a=this.getById(b.params[this.paramNames.active_node]);if(d&&a){this.setNodeExpanded(a,
true);this.fireEvent("expandnode",this,a)}else this.fireEvent("expandnodefailed",this,b.params[this.paramNames.active_node],a)},expandAll:function(){var a,b,d,e=this.data.getRange();this.suspendEvents();b=0;for(d=e.length;b<d;b++){a=e[b];this.isExpandedNode(a)||this.expandNode(a)}this.resumeEvents();this.fireEvent("datachanged",this)},collapseAll:function(){var a,b,d,e=this.data.getRange();this.suspendEvents();b=0;for(d=e.length;b<d;b++){a=e[b];this.isExpandedNode(a)&&this.collapseNode(a)}this.resumeEvents();
this.fireEvent("datachanged",this)},getLoadedNodeIdFromOptions:function(a){var b=null;if(a&&a.params&&a.params[this.paramNames.active_node])b=a.params[this.paramNames.active_node];return b},getPageOffsetFromOptions:function(a){var b=0;if(a&&a.params&&a.params[this.paramNames.start]){b=parseInt(a.params[this.paramNames.start],10);if(isNaN(b))b=0}return b},hasNextSiblingNode:function(a){return this.getNodeNextSibling(a)!==null},hasPrevSiblingNode:function(a){return this.getNodePrevSibling(a)!==null},
hasChildNodes:function(a){return this.getNodeChildrenCount(a)>0},getNodeAncestors:function(a){var b=[];for(a=this.getNodeParent(a);a;){b.push(a);a=this.getNodeParent(a)}return b},getNodeChildrenCount:function(a){return this.getNodeChildren(a).length},getNodeNextSibling:function(a){var b,d=null;b=(b=this.getNodeParent(a))?this.getNodeChildren(b):this.getRootNodes();a=b.indexOf(a);if(a<b.length-1)d=b[a+1];return d},getNodePrevSibling:function(a){var b,d=null;b=(b=this.getNodeParent(a))?this.getNodeChildren(b):
this.getRootNodes();a=b.indexOf(a);if(a>0)d=b[a-1];return d},getRootNodes:function(){throw"Abstract method call";},getNodeDepth:function(){throw"Abstract method call";},getNodeParent:function(){throw"Abstract method call";},getNodeChildren:function(){throw"Abstract method call";},addToNode:function(){throw"Abstract method call";},removeFromNode:function(){throw"Abstract method call";},getPageOffset:function(){return this.page_offset},getActiveNodePageOffset:function(){return this.active_node?this.getNodeChildrenOffset(this.active_node):
this.getPageOffset()},getActiveNodeCount:function(){return this.active_node?this.getNodeChildrenCount(this.active_node):this.getRootNodes().length},getActiveNodeTotalCount:function(){return this.active_node?this.getNodeChildrenTotalCount(this.active_node):this.getTotalCount()}});
Ext.ux.maximgb.tg.AdjacencyListStore=Ext.extend(Ext.ux.maximgb.tg.AbstractTreeStore,{parent_id_field_name:"_parent",getRootNodes:function(){var a,b,d=[],e=this.data.getRange();a=0;for(b=e.length;a<b;a++)e[a].get(this.parent_id_field_name)==null&&d.push(e[a]);return d},getNodeDepth:function(a){return this.getNodeAncestors(a).length},getNodeParent:function(a){return this.getById(a.get(this.parent_id_field_name))},getNodeChildren:function(a){var b,d,e=[],g=this.data.getRange();b=0;for(d=g.length;b<d;b++)g[b].get(this.parent_id_field_name)==
a.id&&e.push(g[b]);return e},addToNode:function(a,b){b.set(this.parent_id_field_name,a.id);this.addSorted(b)},removeFromNode:function(a,b){this.remove(b)}});Ext.reg("Ext.ux.maximgb.tg.AdjacencyListStore",Ext.ux.maximgb.tg.AdjacencyListStore);
Ext.ux.maximgb.tg.NestedSetStore=Ext.extend(Ext.ux.maximgb.tg.AbstractTreeStore,{left_field_name:"_lft",right_field_name:"_rgt",level_field_name:"_level",root_node_level:1,getRootNodes:function(){var a,b,d=[],e=this.data.getRange();a=0;for(b=e.length;a<b;a++)e[a].get(this.level_field_name)==this.root_node_level&&d.push(e[a]);return d},getNodeDepth:function(a){return a.get(this.level_field_name)-this.root_node_level},getNodeParent:function(a){var b=null,d=this.data.getRange(),e,g,h,k,o,w,A,B;h=a.get(this.left_field_name);
o=a.get(this.right_field_name);A=a.get(this.level_field_name);e=0;for(g=d.length;e<g;e++){a=d[e];k=a.get(this.left_field_name);w=a.get(this.right_field_name);B=a.get(this.level_field_name);if(B==A-1&&k<h&&w>o){b=a;break}}return b},getNodeChildren:function(a){var b,d,e,g,h,k,o,w=[];k=this.data.getRange();b=a.get(this.left_field_name);d=a.get(this.right_field_name);g=a.get(this.level_field_name);i=0;for(len=k.length;i<len;i++){o=k[i];a=o.get(this.left_field_name);e=o.get(this.right_field_name);h=o.get(this.level_field_name);
h==g+1&&a>b&&e<d&&w.push(o)}return w}});
Ext.ux.maximgb.tg.GridView=Ext.extend(Ext.grid.GridView,{expanded_icon_class:"ux-maximgb-tg-elbow-minus",last_expanded_icon_class:"ux-maximgb-tg-elbow-end-minus",collapsed_icon_class:"ux-maximgb-tg-elbow-plus",last_collapsed_icon_class:"ux-maximgb-tg-elbow-end-plus",skip_width_update_class:"ux-maximgb-tg-skip-width-update",initTemplates:function(){var a=this.templates||{};if(!a.row)a.row=new Ext.Template('<div class="x-grid3-row ux-maximgb-tg-level-{level} {alt}" style="{tstyle} {display_style}">','<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',
"<tbody>","<tr>{cells}</tr>",this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':"","</tbody>","</table>","</div>");if(!a.mastercell)a.mastercell=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="ux-maximgb-tg-mastercell-wrap">',"{treeui}",'<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',
"</div>","</td>");if(!a.treeui)a.treeui=new Ext.Template('<div class="ux-maximgb-tg-uiwrap" style="width: {wrap_width}px">',"{elbow_line}",'<div style="left: {left}px" class="{cls}">&#160;</div>',"</div>");if(!a.elbow_line)a.elbow_line=new Ext.Template('<div style="left: {left}px" class="{cls}">&#160;</div>');this.templates=a;Ext.ux.maximgb.tg.GridView.superclass.initTemplates.call(this)},doRender:function(a,b,d,e,g,h){for(var k=this.templates,o=k.cell,w=k.row,A=g-1,B=[],J,L={},V={tstyle:"width:"+
this.getTotalWidth()+";"},M,O=0,N=b.length;O<N;O++){M=b[O];J=[];var W=O+e,R=this.renderRow(M,W,g,d,this.cm.getTotalWidth());if(R===false)for(R=0;R<g;R++){o=a[R];L.id=o.id;L.css=R==0?"x-grid3-cell-first ":R==A?"x-grid3-cell-last ":"";L.attr=L.cellAttr="";L.value=o.renderer.call(o.scope,M.data[o.name],L,M,W,R,d);L.style=o.style;if(Ext.isEmpty(L.value))L.value="&#160;";if(this.markDirty&&M.dirty&&typeof M.modified[o.name]!=="undefined")L.css+=" x-grid3-dirty-cell";if(o.id==this.grid.master_column_id){L.treeui=
this.renderCellTreeUI(M,d);o=k.mastercell}else o=k.cell;J[J.length]=o.apply(L)}else J.push(R);R=[];if(h&&(W+1)%2==0)R[0]="x-grid3-row-alt";if(M.dirty)R[1]=" x-grid3-dirty-row";V.cols=g;if(this.getRowClass)R[2]=this.getRowClass(M,W,V,d);V.alt=R.join(" ");V.cells=J.join("");V.display_style=d.isVisibleNode(M)?"":"display: none;";V.level=d.getNodeDepth(M);B[B.length]=w.apply(V)}return B.join("")},renderCellTreeUI:function(a,b){var d=this.templates.treeui,e=this.templates.elbow_line,g={},h,k,o=level=b.getNodeDepth(a);
g.wrap_width=(o+1)*16;if(level>0){g.elbow_line="";h=a;for(left=0;level--;){if(k=b.getNodeParent(h))g.elbow_line=b.hasNextSiblingNode(k)?e.apply({left:level*16,cls:"ux-maximgb-tg-elbow-line"})+g.elbow_line:e.apply({left:level*16,cls:"ux-maximgb-tg-elbow-empty"})+g.elbow_line;else throw["Tree inconsistency can't get level ",level+1," node(id=",h.id,") parent."].join("");h=k}}if(b.isLeafNode(a))g.cls=b.hasNextSiblingNode(a)?"ux-maximgb-tg-elbow":"ux-maximgb-tg-elbow-end";else{g.cls="ux-maximgb-tg-elbow-active ";
g.cls+=b.isExpandedNode(a)?b.hasNextSiblingNode(a)?this.expanded_icon_class:this.last_expanded_icon_class:b.hasNextSiblingNode(a)?this.collapsed_icon_class:this.last_collapsed_icon_class}g.left=1+o*16;return d.apply(g)},renderRow:function(){return false},afterRender:function(){Ext.ux.maximgb.tg.GridView.superclass.afterRender.call(this);this.updateAllColumnWidths()},updateAllColumnWidths:function(){var a=this.getTotalWidth(),b=this.cm.getColumnCount(),d=[],e,g;for(g=0;g<b;g++)d[g]=this.getColumnWidth(g);
this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=a;this.mainBody.dom.style.width=a;for(g=0;g<b;g++)this.getHeaderCell(g).style.width=d[g];var h=this.getRows(),k;g=0;for(e=h.length;g<e;g++){k=h[g];k.style.width=a;if(k.firstChild){k.firstChild.style.width=a;k=k.firstChild.rows[0];for(var o=0;o<b&&o<k.childNodes.length;o++)if(!Ext.fly(k.childNodes[o]).hasClass(this.skip_width_update_class))k.childNodes[o].style.width=d[o]}}this.onAllColumnWidthsUpdated(d,
a)},updateColumnWidth:function(a){var b=this.getColumnWidth(a),d=this.getTotalWidth();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=d;this.mainBody.dom.style.width=d;this.getHeaderCell(a).style.width=b;for(var e=this.getRows(),g,h=0,k=e.length;h<k;h++){g=e[h];g.style.width=d;if(g.firstChild){g.firstChild.style.width=d;if(a<g.firstChild.rows[0].childNodes.length)if(!Ext.fly(g.firstChild.rows[0].childNodes[a]).hasClass(this.skip_width_update_class))g.firstChild.rows[0].childNodes[a].style.width=
b}}this.onColumnWidthUpdated(a,b,d)},updateColumnHidden:function(a,b){var d=this.getTotalWidth();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=d;this.mainBody.dom.style.width=d;var e=b?"none":"";this.getHeaderCell(a).style.display=e;for(var g=this.getRows(),h,k=0,o=g.length;k<o;k++){h=g[k];h.style.width=d;if(h.firstChild){h.firstChild.style.width=d;if(a<h.firstChild.rows[0].childNodes.length)if(!Ext.fly(h.firstChild.rows[0].childNodes[a]).hasClass(this.skip_width_update_class))h.firstChild.rows[0].childNodes[a].style.display=
e}}this.onColumnHiddenUpdated(a,b,d);delete this.lastViewWidth;this.layout()},processRows:function(a,b){var d=0;if(!(this.ds.getCount()<1)){b=!this.grid.stripeRows;var e=this.getRows();d=0;Ext.each(e,function(g,h){g.rowIndex=h;g.className=g.className.replace(this.rowClsRe," ");if(g.style.display!="none"){if(!b&&(d+1)%2===0)g.className+=" x-grid3-row-alt";d++}},this);Ext.fly(e[0]).addClass(this.firstRowCls);Ext.fly(e[e.length-1]).addClass(this.lastRowCls)}},ensureVisible:function(a,b,d){var e,g=this.ds.getAt(a);
if(!this.ds.isVisibleNode(g))for(e=this.ds.getNodeAncestors(g);e.length>0;){g=e.shift();this.ds.isExpandedNode(g)||this.ds.expandNode(g)}return Ext.ux.maximgb.tg.GridView.superclass.ensureVisible.call(this,a,b,d)},expandRow:function(a,b){var d=this.ds,e,g,h,k,o;if(typeof a=="number"){e=a;a=d.getAt(e)}else e=d.indexOf(a);b=b||false;h=this.getRow(e);if(e=Ext.fly(h).child(".ux-maximgb-tg-elbow-active"))if(d.hasNextSiblingNode(a)){e.removeClass(this.collapsed_icon_class);e.removeClass(this.last_collapsed_icon_class);
e.addClass(this.expanded_icon_class)}else{e.removeClass(this.collapsed_icon_class);e.removeClass(this.last_collapsed_icon_class);e.addClass(this.last_expanded_icon_class)}if(d.isVisibleNode(a)){k=d.getNodeChildren(a);e=0;for(g=k.length;e<g;e++){o=d.indexOf(k[e]);h=this.getRow(o);h.style.display="block";d.isExpandedNode(k[e])&&this.expandRow(o,true)}}b||this.processRows(0)},collapseRow:function(a,b){var d=this.ds,e,g,h,k,o;if(typeof a=="number"){e=a;a=d.getAt(e)}else e=d.indexOf(a);b=b||false;k=this.getRow(e);
if(pmel=Ext.fly(k).child(".ux-maximgb-tg-elbow-active"))if(d.hasNextSiblingNode(a)){pmel.removeClass(this.expanded_icon_class);pmel.removeClass(this.last_expanded_icon_class);pmel.addClass(this.collapsed_icon_class)}else{pmel.removeClass(this.expanded_icon_class);pmel.removeClass(this.last_expanded_icon_class);pmel.addClass(this.last_collapsed_icon_class)}h=d.getNodeChildren(a);e=0;for(g=h.length;e<g;e++){o=d.indexOf(h[e]);k=this.getRow(o);if(k.style.display!="none"){k.style.display="none";this.collapseRow(o,
true)}}b||this.processRows(0)},initData:function(a,b){Ext.ux.maximgb.tg.GridView.superclass.initData.call(this,a,b);if(this.ds){this.ds.un("expandnode",this.onStoreExpandNode,this);this.ds.un("collapsenode",this.onStoreCollapseNode,this)}if(a){a.on("expandnode",this.onStoreExpandNode,this);a.on("collapsenode",this.onStoreCollapseNode,this)}},onLoad:function(a,b,d){if(d&&d.params&&(d.params[a.paramNames.active_node]===null||a.indexOfId(d.params[a.paramNames.active_node])==-1))Ext.ux.maximgb.tg.GridView.superclass.onLoad.call(this,
a,b,d)},onAdd:function(a,b,d){Ext.ux.maximgb.tg.GridView.superclass.onAdd.call(this,a,b,d);this.mainWrap&&this.processRows(0)},onRemove:function(a,b,d,e){Ext.ux.maximgb.tg.GridView.superclass.onRemove.call(this,a,b,d,e);e!==true&&this.mainWrap&&this.processRows(0)},onUpdate:function(a,b){Ext.ux.maximgb.tg.GridView.superclass.onUpdate.call(this,a,b);this.mainWrap&&this.processRows(0)},onStoreExpandNode:function(a,b){this.expandRow(b)},onStoreCollapseNode:function(a,b){this.collapseRow(b)}});
Ext.ux.maximgb.tg.GridPanel=Ext.extend(Ext.m3.GridPanel,{master_column_id:0,tg_cls:"ux-maximgb-tg-panel",initComponent:function(){this.initComponentPreOverride();Ext.ux.maximgb.tg.GridPanel.superclass.initComponent.call(this);this.getSelectionModel().on("selectionchange",this.onTreeGridSelectionChange,this);this.initComponentPostOverride()},initComponentPreOverride:Ext.emptyFn,initComponentPostOverride:Ext.emptyFn,onRender:function(a,b){Ext.ux.maximgb.tg.GridPanel.superclass.onRender.call(this,a,
b);this.el.addClass(this.tg_cls)},getView:function(){if(!this.view)this.view=new Ext.ux.maximgb.tg.GridView(this.viewConfig);return this.view},onClick:function(a){var b=a.getTarget(),d=this.getView().findRowIndex(b),e=this.getStore();this.getSelectionModel();var g=true;if(d!==false)if(Ext.fly(b).hasClass("ux-maximgb-tg-elbow-active")){b=e.getAt(d);e.isExpandedNode(b)?e.collapseNode(b):e.expandNode(b);g=false}g&&Ext.ux.maximgb.tg.GridPanel.superclass.onClick.call(this,a)},onMouseDown:function(a){var b=
a.getTarget();Ext.fly(b).hasClass("ux-maximgb-tg-elbow-active")||Ext.ux.maximgb.tg.GridPanel.superclass.onMouseDown.call(this,a)},onTreeGridSelectionChange:function(a,b){var d,e=this.getStore();if(a.getSelected){d=a.getSelected();e.setActiveNode(d)}else if(a.getSelectedCell&&b){d=b.record;e.setActiveNode(d)}if(d)if(!e.isVisibleNode(d))for(d=e.getNodeAncestors(d);d.length>0;)e.expandNode(d.pop())}});
Ext.ux.maximgb.tg.EditorGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{master_column_id:0,initComponent:function(){this.initComponentPreOverride();Ext.ux.maximgb.tg.EditorGridPanel.superclass.initComponent.call(this);this.getSelectionModel().on("selectionchange",this.onTreeGridSelectionChange,this);this.initComponentPostOverride()},initComponentPreOverride:Ext.emptyFn,initComponentPostOverride:Ext.emptyFn,onRender:function(a,b){Ext.ux.maximgb.tg.EditorGridPanel.superclass.onRender.call(this,a,b);
this.el.addClass("ux-maximgb-tg-panel")},getView:function(){if(!this.view)this.view=new Ext.ux.maximgb.tg.GridView(this.viewConfig);return this.view},onClick:function(a){var b=a.getTarget(),d=this.getView().findRowIndex(b),e=this.getStore();this.getSelectionModel();var g=true;if(d!==false)if(Ext.fly(b).hasClass("ux-maximgb-tg-elbow-active")){b=e.getAt(d);e.isExpandedNode(b)?e.collapseNode(b):e.expandNode(b);g=false}g&&Ext.ux.maximgb.tg.EditorGridPanel.superclass.onClick.call(this,a)},onMouseDown:function(a){var b=
a.getTarget();Ext.fly(b).hasClass("ux-maximgb-tg-elbow-active")||Ext.ux.maximgb.tg.EditorGridPanel.superclass.onMouseDown.call(this,a)},onTreeGridSelectionChange:function(a,b){var d,e=this.getStore();if(a.getSelected){d=a.getSelected();e.setActiveNode(d)}else if(a.getSelectedCell&&b){d=b.record;e.setActiveNode(d)}if(d)if(!e.isVisibleNode(d))for(d=e.getNodeAncestors(d);d.length>0;)e.expandNode(d.pop())}});
Ext.ux.maximgb.tg.PagingToolbar=Ext.extend(Ext.PagingToolbar,{onRender:function(a,b){Ext.ux.maximgb.tg.PagingToolbar.superclass.onRender.call(this,a,b);this.updateUI()},getPageData:function(){var a=0,b=0;if(this.store){b=this.store.getActiveNodePageOffset();a=this.store.getActiveNodeTotalCount()}return{total:a,activePage:Math.ceil((b+this.pageSize)/this.pageSize),pages:a<this.pageSize?1:Math.ceil(a/this.pageSize)}},updateInfo:function(){var a=0,b=0,d=0;if(this.displayItem){if(this.store){b=this.store.getActiveNodePageOffset();
a=this.store.getActiveNodeCount();d=this.store.getActiveNodeTotalCount()}a=a==0?this.emptyMsg:String.format(this.displayMsg,b+1,b+a,d);this.displayItem.setText(a)}},updateUI:function(){var a=this.getPageData(),b=a.activePage,d=a.pages;this.afterTextItem.setText(String.format(this.afterPageText,a.pages));this.inputItem.setValue(b);this.first.setDisabled(b==1);this.prev.setDisabled(b==1);this.next.setDisabled(b==d);this.last.setDisabled(b==d);this.refresh.enable();this.updateInfo()},bindStore:function(a,
b){!b&&this.store&&this.store.un("activenodechange",this.onStoreActiveNodeChange,this);a&&a.on("activenodechange",this.onStoreActiveNodeChange,this);Ext.ux.maximgb.tg.PagingToolbar.superclass.bindStore.call(this,a,b)},beforeLoad:function(a,b){var d=this.getParams();Ext.ux.maximgb.tg.PagingToolbar.superclass.beforeLoad.call(this,a,b);if(b&&b.params){if(b.params[d.start]===undefined)b.params[d.start]=0;if(b.params[d.limit]===undefined)b.params[d.limit]=this.pageSize}},moveFirst:function(){this.doLoad(0)},
movePrevious:function(){var a=this.store;a=a?a.getActiveNodePageOffset():0;this.doLoad(Math.max(0,a-this.pageSize))},moveNext:function(){var a=this.store;this.doLoad((a?a.getActiveNodePageOffset():0)+this.pageSize)},moveLast:function(){var a=this.store;a&&a.getActiveNodePageOffset();a=a?a.getActiveNodeTotalCount():0;var b=a%this.pageSize;this.doLoad(b?a-b:a-this.pageSize)},onStoreActiveNodeChange:function(){this.rendered&&this.updateUI()}});Ext.reg("Ext.ux.maximgb.tg.GridPanel",Ext.ux.maximgb.tg.GridPanel);
Ext.reg("Ext.ux.maximgb.tg.EditorGridPanel",Ext.ux.maximgb.tg.EditorGridPanel);Ext.reg("Ext.ux.maximgb.tg.PagingToolbar",Ext.ux.maximgb.tg.PagingToolbar);
Ext.m3.Window=Ext.extend(Ext.Window,{constructor:function(a,b){this.actionContextJson=this.parentWindow=null;if(b&&b.parentWindowID)this.parentWindow=Ext.getCmp(b.parentWindowID);if(b&&b.helpTopic)this.m3HelpTopic=b.helpTopic;if(b&&b.contextJson)this.actionContextJson=b.contextJson;Ext.m3.Window.superclass.constructor.call(this,a)},initTools:function(){if(this.m3HelpTopic){var a=this.m3HelpTopic;this.addTool({id:"help",handler:function(){showHelpWindow(a)}})}Ext.m3.Window.superclass.initTools.call(this)}});
Ext.m3.AdvancedTreeGrid=Ext.extend(Ext.ux.maximgb.tg.GridPanel,{constructor:function(a,b){assert(b.storeParams.url,"\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043e \u0437\u0430\u0434\u0430\u043d\u043e url. \t\t\turl="+b.storeParams.url);var d=b.columnsToRecord||[];d.push({name:"_id",type:"int"},{name:"_level",type:"int"},{name:"_lft",type:"int"},{name:"_rgt",type:"int"},{name:"_is_leaf",type:"bool"},{name:"_parent",type:"int"});d=new Ext.ux.maximgb.tg.AdjacencyListStore({autoLoad:true,
url:b.storeParams.url,reader:new Ext.data.JsonReader({id:"_id",root:b.storeParams.root,totalProperty:"total",successProperty:"success"},Ext.data.Record.create(d))});var e;if(b.bbar)e=new Ext.ux.maximgb.tg.PagingToolbar({store:d,displayInfo:true,pageSize:b.bbar.pageSize});e=Ext.applyIf({store:d,bbar:e},a);Ext.m3.AdvancedTreeGrid.superclass.constructor.call(this,e,b)}});
Ext.m3.AddrField=Ext.extend(Ext.Container,{constructor:function(a,b){var d=b.items||[],e=new Ext.data.JsonStore({url:b.kladr_url,idProperty:"code",root:"rows",totalProperty:"total",fields:[{name:"code"},{name:"display_name"},{name:"socr"},{name:"zipcode"},{name:"gni"},{name:"uno"},{name:"okato"},{name:"addr_name"}]});if(b.place_record!=""&&b.place_record!=undefined){var g=Ext.util.JSON.decode(b.place_record);e.loadData({total:1,rows:[g]})}var h=b.read_only?"m3-grey-field":"";this.place=new Ext.form.ComboBox({name:b.place_field_name,
fieldLabel:b.place_label,allowBlank:b.place_allow_blank,readOnly:b.read_only,cls:h,hideTrigger:true,minChars:2,emptyText:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0430\u0441\u0435\u043b\u0435\u043d\u043d\u044b\u0439 \u043f\u0443\u043d\u043a\u0442...",queryParam:"filter",store:e,resizable:true,displayField:"display_name",valueField:"code",mode:"remote",hiddenName:b.place_field_name,valueNotFoundText:"",invalidClass:b.invalid_class});this.place.setValue(b.place_value);this.zipcode=new Ext.form.TextField({name:b.zipcode_field_name,
value:b.zipcode_value,emptyText:"\u0438\u043d\u0434\u0435\u043a\u0441",readOnly:b.read_only,cls:h,width:55,maskRe:/[0-9]/});if(b.level>1){e=new Ext.data.JsonStore({url:b.street_url,idProperty:"code",root:"rows",totalProperty:"total",fields:[{name:"code"},{name:"display_name"},{name:"socr"},{name:"zipcode"},{name:"gni"},{name:"uno"},{name:"okato"},{name:"name"}]});if(b.street_record!=""&&b.street_record!=undefined){g=Ext.util.JSON.decode(b.street_record);e.loadData({total:1,rows:[g]})}this.street=
new Ext.form.ComboBox({name:b.street_field_name,fieldLabel:b.street_label,allowBlank:b.street_allow_blank,readOnly:b.read_only,cls:h,hideTrigger:true,minChars:2,emptyText:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0443\u043b\u0438\u0446\u0443...",queryParam:"filter",store:e,resizable:true,displayField:"display_name",valueField:"code",mode:"remote",hiddenName:b.street_field_name,valueNotFoundText:"",invalidClass:b.invalid_class});this.street.setValue(b.street_value);if(b.level>2){this.house=new Ext.form.TextField({name:b.house_field_name,
allowBlank:b.house_allow_blank,readOnly:b.read_only,cls:h,fieldLabel:b.house_label,value:b.house_value,emptyText:"",width:40,invalidClass:b.invalid_class});if(b.level>3)this.flat=new Ext.form.TextField({name:b.flat_field_name,fieldLabel:b.flat_label,value:b.flat_value,allowBlank:b.flat_allow_blank,readOnly:b.read_only,cls:h,emptyText:"",width:40,invalidClass:b.invalid_class})}}if(b.addr_visible)this.addr=new Ext.form.TextArea({name:b.addr_field_name,anchor:"100%",fieldLabel:b.addr_label,value:b.addr_value,
readOnly:true,cls:h,height:36});if(b.view_mode==1){this.place.flex=1;g=b.level>2?[this.place,this.zipcode]:[this.place];if(b.level>1){this.street.flex=1;this.street.fieldLabel=b.place_label;g.push({xtype:"label",style:{padding:"3px"},text:b.street_label+":"},this.street);if(b.level>2){this.house.fieldLabel=b.place_label;g.push({xtype:"label",style:{padding:"3px"},text:b.house_label+":"},this.house);if(b.level>3){this.flat.fieldLabel=b.place_label;g.push({xtype:"label",style:{padding:"3px"},text:b.flat_label+
":"},this.flat)}}}g={xtype:"compositefield",anchor:"100%",fieldLabel:b.place_label,items:g,invalidClass:b.invalid_composite_field_class};d.push(g);b.addr_visible&&d.push(this.addr)}if(b.view_mode==2){if(b.level>2){this.place.flex=1;g={xtype:"compositefield",anchor:"100%",fieldLabel:b.place_label,items:[this.place,this.zipcode],invalidClass:b.invalid_composite_field_class};d.push(g)}else{this.place.anchor="100%";d.push(this.place)}if(b.level>1){this.street.flex=1;g=[this.street];if(b.level>2){this.house.fieldLabel=
b.street_label;g.push({xtype:"label",style:{padding:"3px"},text:b.house_label+":"},this.house);if(b.level>3){this.flat.fieldLabel=b.street_label;g.push({xtype:"label",style:{padding:"3px"},text:b.flat_label+":"},this.flat)}}g={xtype:"compositefield",anchor:"100%",fieldLabel:b.street_label,items:g,invalidClass:b.invalid_composite_field_class};d.push(g)}b.addr_visible&&d.push(this.addr)}if(b.view_mode==3){if(b.level>2){this.place.flex=1;g={xtype:"compositefield",anchor:"100%",fieldLabel:b.place_label,
items:[this.place,this.zipcode],invalidClass:b.invalid_composite_field_class};d.push(g)}else{this.place.anchor="100%";d.push(this.place)}if(b.level>1){this.street.anchor="100%";d.push(this.street);if(b.level>2){g=[{xtype:"container",layout:"form",items:this.house,style:{overflow:"hidden"}}];b.level>3&&g.push({xtype:"container",layout:"form",style:{padding:"0px 0px 0px 5px",overflow:"hidden"},items:this.flat});g=new Ext.Container({anchor:"100%",layout:"column",items:g,style:{overflow:"hidden"}});d.push(g)}}b.addr_visible&&
d.push(this.addr)}d=Ext.applyIf({items:d,get_addr_url:b.get_addr_url,level:b.level,addr_visible:b.addr_visible,style:{overflow:"hidden"}},a);Ext.Container.superclass.constructor.call(this,d)},beforeStreetQuery:function(){this.street.getStore().baseParams.place_code=this.place.value},clearStreet:function(){this.street.setValue("")},afterRenderAddr:function(){this.addr_visible&&this.addr.getEl().on("dblclick",this.onDblClickAddr,this)},initComponent:function(){Ext.m3.AddrField.superclass.initComponent.call(this);
this.mon(this.place,"change",this.onChangePlace,this);if(this.level>1){this.mon(this.street,"change",this.onChangeStreet,this);if(this.level>2){this.mon(this.house,"change",this.onChangeHouse,this);this.mon(this.zipcode,"change",this.onChangeZipcode,this);this.level>3&&this.mon(this.flat,"change",this.onChangeFlat,this)}}this.mon(this.place,"beforequery",this.beforePlaceQuery,this);this.level>1&&this.mon(this.street,"beforequery",this.beforeStreetQuery,this);this.addr_visible&&this.addr.on("afterrender",
this.afterRenderAddr,this);this.addEvents("change","change_place","change_street","change_house","change_flat","change_zipcode","before_query_place")},getNewAddr:function(){var a;if(this.place!=undefined)a=this.place.getValue();var b;if(this.street!=undefined)b=this.street.getValue();var d;if(this.house!=undefined)d=this.house.getValue();var e;if(this.flat!=undefined)e=this.flat.getValue();var g;if(this.zipcode!=undefined)g=this.zipcode.getValue();var h=null;a=this.place.getStore().data.get(a);if(a!=
undefined)h=a.data;a=null;b=this.street.getStore().data.get(b);if(b!=undefined)a=b.data;d=this.generateTextAddr(h,a,d,e,g);this.addr!=undefined&&this.addr.setValue(d)},generateTextAddr:function(a,b,d,e,g){var h="";h=b!=undefined?a.addr_name+", "+b.socr+" "+b.name:a.addr_name;if(g!="")h=g+", "+h;if(d!=""&&d!=undefined)h=h+", \u0434. "+d;if(e!=""&&e!=undefined)h=h+", \u043a. "+e;return h},setNewAddr:function(a){if(this.addr!=undefined)this.addr.value=a},onChangePlace:function(){var a=this.place.getValue(),
b=this.place.getStore().data.get(a);if(b!=undefined){b=b.data;b.zipcode&&this.zipcode.setValue(b.zipcode)}else this.place.setValue("");this.clearStreet();this.fireEvent("change_place",this,a,b);this.addr_visible&&this.getNewAddr()},onChangeStreet:function(){var a=this.street.getValue(),b=this.street.getStore().data.get(a);if(b!=undefined){b=b.data;b.zipcode&&this.zipcode.setValue(b.zipcode)}else this.clearStreet();this.fireEvent("change_street",this,a,b);this.addr_visible&&this.getNewAddr()},onChangeHouse:function(){this.fireEvent("change_house",
this,this.house.getValue());this.addr_visible&&this.getNewAddr()},onChangeFlat:function(){this.fireEvent("change_flat",this,this.flat.getValue());this.addr_visible&&this.getNewAddr()},onChangeZipcode:function(){this.fireEvent("change_zipcode",this,this.zipcode.getValue());this.addr_visible&&this.getNewAddr()},beforePlaceQuery:function(a){this.fireEvent("before_query_place",this,a)},onDblClickAddr:function(){this.addr_visible&&this.addr.setReadOnly(false)}});
Ext.m3.AdvancedComboBox=Ext.extend(Ext.m3.ComboBox,{constructor:function(a,b){this.askBeforeDeleting=true;this.actionContextJson=this.actionEditUrl=this.actionSelectUrl=null;this.hideBaseTrigger=false;this.defaultText=this.defaultValue=null;this.hideTriggerClear=b.hideClearTrigger||false;this.hideTriggerDropDown=false;this.hideTriggerDictSelect=b.hideDictSelectTrigger||false;this.hideTriggerDictEdit=true;if(!b.hideEditTrigger)this.hideTriggerDictEdit=b.hideEditTrigger;this.defaultLimit=50;this.triggerClearClass=
"x-form-clear-trigger";this.triggerSelectClass="x-form-select-trigger";this.triggerEditClass="x-form-edit-trigger";assert(b.actions,"params.actions is undefined");if(b.actions.actionSelectUrl)this.actionSelectUrl=b.actions.actionSelectUrl;if(b.actions.actionEditUrl)this.actionEditUrl=b.actions.actionEditUrl;this.askBeforeDeleting=b.askBeforeDeleting;this.actionContextJson=b.actions.contextJson;this.hideBaseTrigger=false;if(a.hideTrigger){delete a.hideTrigger;this.hideBaseTrigger=true}this.defaultValue=
b.defaultValue;this.defaultText=b.defaultText;this.baseTriggers=[{iconCls:"x-form-clear-trigger",handler:null,hide:null},{iconCls:"",handler:null,hide:null},{iconCls:"x-form-select-trigger",handler:null,hide:null},{iconCls:"x-form-edit-trigger",handler:null,hide:true}];this.allTriggers=[].concat(this.baseTriggers);b.customTriggers&&Ext.each(b.customTriggers,function(d){this.allTriggers.push(d)},this);Ext.m3.AdvancedComboBox.superclass.constructor.call(this,a)},initComponent:function(){Ext.m3.AdvancedComboBox.superclass.initComponent.call(this);
this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",cn:[]};Ext.each(this.allTriggers,function(a){this.triggerConfig.cn.push({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+a.iconCls})},this);if(!this.actionSelectUrl)this.hideTriggerDictSelect=true;if(!this.actionEditUrl)this.hideTriggerDictEdit=true;if(this.hideBaseTrigger)this.hideTriggerDropDown=true;this.defaultValue&&this.defaultText&&this.addRecordToStore(this.defaultValue,this.defaultText);this.initBaseTrigger();this.addEvents("beforerequest",
"afterselect","changed");this.getStore().baseParams=Ext.applyIf({start:0,limit:this.defaultLimit},this.getStore().baseParams)},getTrigger:function(a){return this.triggers[a]},initTrigger:function(){var a=this.trigger.select(".x-form-trigger",true),b=this;a.each(function(d,e,g){var h="Trigger"+(g+1);d.hide=function(){var k=b.wrap.getWidth();this.dom.style.display="none";b.el.setWidth(k-b.trigger.getWidth());this["hidden"+h]=true};d.show=function(){var k=b.wrap.getWidth();this.dom.style.display="";
b.el.setWidth(k-b.trigger.getWidth());this["hidden"+h]=false};if(this.allTriggers[g].hide){d.dom.style.display="none";this["hidden"+h]=true}if(this.disabled)this.mun(d,"click",this.allTriggers[g].handler,this,{preventDefault:true});else{this.mon(d,"click",this.allTriggers[g].handler,this,{preventDefault:true});d.addClassOnOver("x-form-trigger-over");d.addClassOnClick("x-form-trigger-click")}},this);this.triggers=a.elements},initBaseTrigger:function(){this.baseTriggers[0].handler=this.onTriggerClearClick;
this.baseTriggers[1].handler=this.onTriggerDropDownClick;this.baseTriggers[2].handler=this.onTriggerDictSelectClick;this.baseTriggers[3].handler=this.onTriggerDictEditClick;this.baseTriggers[0].hide=this.hideTriggerClear;this.baseTriggers[1].hide=this.hideTriggerDropDown;this.baseTriggers[2].hide=this.hideTriggerDictSelect;this.baseTriggers[3].hide=this.hideTriggerDictEdit;if(!this.getValue()){this.baseTriggers[0].hide=true;this.baseTriggers[3].hide=true}},getTriggerWidth:function(){var a=0;Ext.each(this.triggers,
function(b,d){var e="Trigger"+(d+1),g=b.getWidth();a+=g===0&&!this["hidden"+e]?this.defaultTriggerWidth:g},this);return a},onDestroy:function(){Ext.destroy(this.triggers);Ext.destroy(this.allTriggers);Ext.destroy(this.baseTriggers);Ext.m3.AdvancedComboBox.superclass.onDestroy.call(this)},onTriggerDropDownClick:function(){if(this.fireEvent("beforerequest",this)){if(this.isExpanded())this.collapse();else{this.getStore().load();this.onFocus({});this.doQuery(this.allQuery,true)}this.el.focus()}},onTriggerDictSelectClick:function(){this.onSelectInDictionary()},
onTriggerClearClick:function(){if(this.askBeforeDeleting){var a=this;Ext.Msg.show({title:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435",msg:"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435?",icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,
fn:function(b){b=="yes"&&a.clearValue()}})}else this.clearValue()},onTriggerDictEditClick:function(){this.onEditBtn()},onSelect:function(a,b){if(this.fireEvent("afterselect",this,a.data[this.valueField],a.data[this.displayField])){Ext.m3.AdvancedComboBox.superclass.onSelect.call(this,a,b);this.showClearBtn();this.showEditBtn();this.fireEvent("change",this,a.data[this.valueField||this.displayField]);this.fireEvent("changed",this)}},showClearBtn:function(){if(!this.hideTriggerClear){this.el.parent().setOverflow("hidden");
this.getTrigger(0).show()}},hideClearBtn:function(){this.el.parent().setOverflow("auto");this.getTrigger(0).hide()},showEditBtn:function(){if(this.actionEditUrl&&!this.hideTriggerDictEdit&&this.getValue()){this.el.parent().setOverflow("hidden");this.getTrigger(3).show()}},hideEditBtn:function(){if(this.actionEditUrl){this.el.parent().setOverflow("auto");this.getTrigger(3).hide()}},clearValue:function(){var a=this.getValue();Ext.m3.AdvancedComboBox.superclass.clearValue.call(this);this.hideClearBtn();
this.hideEditBtn();this.fireEvent("change",this,"",a);this.fireEvent("changed",this)},setValue:function(a){Ext.m3.AdvancedComboBox.superclass.setValue.call(this,a);if(a)if(this.rendered){this.showClearBtn();this.showEditBtn()}else this.hideTrigger4=this.hideTrigger1=true},onSelectInDictionary:function(){assert(this.actionSelectUrl,"actionSelectUrl is undefined");if(this.fireEvent("beforerequest",this)){var a=this;Ext.Ajax.request({url:this.actionSelectUrl,method:"POST",params:this.actionContextJson,
success:function(b){(b=smart_eval(b.responseText))&&b.on("closed_ok",function(d,e){a.fireEvent("afterselect",a,d,e)&&a.addRecordToStore(d,e)})},failure:function(){uiAjaxFailMessage.apply(this,arguments)}})}},addRecordToStore:function(a,b){var d=new Ext.data.Record;d.id=a;d[this.displayField]=b;this.getStore().loadData({total:1,rows:[d]});d=this.getValue();this.setValue(a);this.collapse();this.fireEvent("change",this,a,d);this.fireEvent("changed",this)},onEditBtn:function(){assert(this.actionEditUrl,
"actionEditUrl is undefined");var a=this.getValue();assert(a,"Value not selected but edit window called");Ext.Ajax.request({url:this.actionEditUrl,method:"POST",params:Ext.applyIf({id:a},this.actionContextJson),success:function(b){smart_eval(b.responseText)},failure:function(){uiAjaxFailMessage()}})},triggerBlur:function(){this.focusClass&&this.el.removeClass(this.focusClass);this.wrap&&this.wrap.removeClass(this.wrapFocusClass);!this.getValue()&&this.lastQuery&&this.setRawValue("");this.validate()}});
Ext.m3.AdvancedDataField=Ext.extend(Ext.form.DateField,{constructor:function(a,b){this.baseTriggers=[{iconCls:"x-form-date-trigger",handler:null,hide:null},{iconCls:"x-form-current-date-trigger",handler:null,hide:null}];this.hideTriggerToday=false;if(b.hideTriggerToday)this.hideTriggerToday=true;Ext.m3.AdvancedDataField.superclass.constructor.call(this,a)},initComponent:function(){Ext.m3.AdvancedDataField.superclass.initComponent.call(this);this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",
cn:[]};Ext.each(this.baseTriggers,function(a){this.triggerConfig.cn.push({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+a.iconCls})},this);this.initBaseTrigger()},initTrigger:function(){var a=this.trigger.select(".x-form-trigger",true),b=this;a.each(function(d,e,g){var h="Trigger"+(g+1);d.hide=function(){var k=b.wrap.getWidth();this.dom.style.display="none";b.el.setWidth(k-b.trigger.getWidth());this["hidden"+h]=true};d.show=function(){var k=b.wrap.getWidth();this.dom.style.display="";b.el.setWidth(k-
b.trigger.getWidth());this["hidden"+h]=false};if(this.baseTriggers[g].hide){d.dom.style.display="none";this["hidden"+h]=true}this.mon(d,"click",this.baseTriggers[g].handler,this,{preventDefault:true});d.addClassOnOver("x-form-trigger-over");d.addClassOnClick("x-form-trigger-click")},this);this.triggers=a.elements},initBaseTrigger:function(){this.baseTriggers[0].handler=this.onTriggerClick;this.baseTriggers[1].handler=function(){var a=new Date;this.setValue(a);this.fireEvent("select",this,a)};this.baseTriggers[1].hide=
this.hideTriggerToday}});Ext.ns("Ext.m3.CodeEditorConfig");Ext.apply(Ext.m3.CodeEditorConfig,{cssPath:"m3static/vendor/codemirror/css/",jsPath:"m3static/vendor/codemirror/js/"});
Ext.apply(Ext.m3.CodeEditorConfig,{parser:{python:{parserfile:["parsepython.js"],stylesheet:Ext.m3.CodeEditorConfig.cssPath+"pythoncolors.css"},css:{parserfile:["parsecss.js"],stylesheet:Ext.m3.CodeEditorConfig.cssPath+"csscolors.css"},html:{parserfile:["parsexml.js","parsecss.js","tokenizejavascript.js","parsejavascript.js","parsehtmlmixed.js"],stylesheet:[Ext.m3.CodeEditorConfig.cssPath+"xmlcolors.css",Ext.m3.CodeEditorConfig.cssPath+"javascriptcolors.css",Ext.m3.CodeEditorConfig.cssPath+"csscolors.css"]},
javascript:{parserfile:["tokenizejavascript.js","parsejavascript.js"],stylesheet:Ext.m3.CodeEditorConfig.cssPath+"javascriptcolors.css"},sql:{parserfile:["parsesql.js"],stylesheet:Ext.m3.CodeEditorConfig.cssPath+"sqlcolors.css"}}});
Ext.m3.CodeEditor=Ext.extend(Ext.Panel,{sourceCode:"/*Default code*/ ",readOnly:false,constructor:function(a){Ext.m3.CodeEditor.superclass.constructor.call(this,a)},initComponent:function(){this.contentChanged=false;Ext.apply(this,{items:[{xtype:"textarea",readOnly:this.readOnly,hidden:true,value:this.sourceCode,enableKeyEvents:true}]});this.addEvents("editorkeyevent");Ext.m3.CodeEditor.superclass.initComponent.apply(this,arguments)},onRender:function(){Ext.m3.CodeEditor.superclass.onRender.apply(this,
arguments);this.oldSourceCode=this.sourceCode;this.on("afterlayout",this.triggerCodeEditor,this,{single:true})},fireKeyEvent:function(a,b){this.fireEvent("editorkeyevent",a,b)},triggerCodeEditor:function(){var a=this,b=this.findByType("textarea")[0],d=Ext.applyIf(this.codeMirrorEditor||{},{height:"100%",width:"100%",lineNumbers:true,textWrapping:false,content:b.getValue(),indentUnit:4,tabMode:"shift",readOnly:b.readOnly,basefiles:["codemirror_base.js"],path:Ext.m3.CodeEditorConfig.jsPath,autoMatchParens:true,
onKeyEvent:this.fireKeyEvent.createDelegate(this),initCallback:function(e){e.win.document.body.lastChild.scrollIntoView();try{var g=Ext.state.Manager.get("edcmr_"+a.itemId+"_lnmbr")!==undefined?Ext.state.Manager.get("edcmr_"+a.itemId+"_lnmbr"):1;e.jumpToLine(g)}catch(h){}Ext.fly(e.win.document.body).on("keydown",function(k){if(k.ctrlKey&&k.keyCode==83){a.fireEvent("save");k.stopEvent()}})},onChange:function(){}});this.codeMirrorEditor=new CodeMirror.fromTextArea(Ext.getDom(b.id),d)},getCode:function(){return typeof this.codeMirrorEditor!=
"undefined"?this.codeMirrorEditor.getCode():""},setTitleClass:function(a){this.contentChanged=a!==true},getTextArea:function(){return this.findByType("textarea")[0]}});Ext.reg("uxCodeEditor",Ext.m3.CodeEditor);
Ext.m3.EditWindow=Ext.extend(Ext.m3.Window,{constructor:function(a,b){this.formUrl=this.formId=null;this.changesCount=0;this.originalTitle=null;if(b)if(b.form){if(b.form.id)this.formId=b.form.id;if(b.form.url)this.formUrl=b.form.url}Ext.m3.EditWindow.superclass.constructor.call(this,a,b)},initComponent:function(){Ext.m3.EditWindow.superclass.initComponent.call(this);this.items.each(function(a){this.setFieldOnChange(a,this)},this);this.addEvents("beforesubmit","closing_canceled")},getForm:function(){assert(this.formId,
"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d formId \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u044b");return Ext.getCmp(this.formId).getForm()},submitForm:function(a,b,d){assert(this.formUrl,"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d url \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u044b");if((a=Ext.getCmp(this.formId).getForm())&&!a.isValid())Ext.Msg.show({title:"\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0444\u043e\u0440\u043c\u044b",msg:"\u041d\u0430 \u0444\u043e\u0440\u043c\u0435 \u0438\u043c\u0435\u044e\u0442\u0441\u044f \u043d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435 \u043f\u043e\u043b\u044f",
buttons:Ext.Msg.OK,icon:Ext.Msg.WARNING});else{var e=this,g=new Ext.LoadMask(this.body,{msg:"\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435..."});d={url:this.formUrl,submitEmptyText:false,params:Ext.applyIf(d||{},this.actionContextJson||{}),success:function(h,k){e.fireEvent("closed_ok",k.response.responseText);e.close(true);try{smart_eval(k.response.responseText)}finally{g.hide();e.disableToolbars(false)}},failure:function(){uiAjaxFailMessage.apply(e,arguments);g.hide();e.disableToolbars(false)}};
if(e.fireEvent("beforesubmit",d)){this.disableToolbars(true);g.show();a.submit(d)}}},onChangeFieldValue:function(a,b,d,e){if(a.originalValue!==b){a.isModified||e.changesCount++;a.isModified=true}else{a.isModified&&e.changesCount--;a.isModified=false}e.updateTitle();a.updateLabel()},setFieldOnChange:function(a,b){if(a){a instanceof Ext.form.Field&&a.isEdit&&a.on("change",function(e,g,h){b.onChangeFieldValue(e,g,h,b)});if(a.items)if(a.items instanceof Array)for(var d=0;d<a.items.length;d++)b.setFieldOnChange(a.items[d],
b);else a.items.each(function(e){b.setFieldOnChange(e,b)});if(a.titleItems)for(d=0;d<a.titleItems.length;d++)b.setFieldOnChange(a.titleItems[d],b)}},updateTitle:function(){if(this.title!==this.originalTitle&&this.originalTitle===null)this.originalTitle=this.title;this.changesCount!==0?this.setTitle("*"+this.originalTitle):this.setTitle(this.originalTitle)},close:function(a){if(this.changesCount!==0&&!a){var b=this;Ext.Msg.show({title:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435",msg:"\u0414\u0430\u043d\u043d\u044b\u0435 \u0431\u044b\u043b\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u044b! C\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f?",
buttons:Ext.Msg.YESNOCANCEL,fn:function(d){if(d==="yes")this.submitForm();else d==="no"?Ext.m3.EditWindow.superclass.close.call(b):b.fireEvent("closing_canceled")},animEl:"elId",icon:Ext.MessageBox.QUESTION,scope:this})}else Ext.m3.EditWindow.superclass.close.call(this)},disableToolbars:function(a){for(var b=[this.getTopToolbar(),this.getFooterToolbar(),this.getBottomToolbar()],d=0;d<b.length;d++)b[d]&&b[d].setDisabled(a)}});Ext.ns("Ext.ux.grid");
Ext.ux.grid.Exporter=Ext.extend(Ext.util.Observable,{title:"",sendDatFromStore:true,constructor:function(){Ext.ux.grid.Exporter.superclass.constructor.call(this)},init:function(a){if(a instanceof Ext.grid.GridPanel){this.grid=a;this.grid.on("afterrender",this.onRender,this)}this.dataUrl=this.grid.dataUrl},onRender:function(){if(!this.grid.tbar){this.grid.elements+=",tbar";tbar=new Ext.Toolbar;this.grid.tbar=tbar;this.grid.add(tbar);this.grid.doLayout()}this.grid.tbar.insert(0,new Ext.Button({text:"\u042d\u043a\u0441\u043f\u043e\u0440\u0442",
iconCls:"icon-application-go",listeners:{scope:this,click:this.exportData}}))},exportData:function(){console.log(this.grid.store);columns=[];Ext.each(this.grid.colModel.config,function(a){columns.push({data_index:a.dataIndex,header:a.header,id:a.id,is_column:a.isCoumn,sortable:a.sortable,width:a.width})});data=[];this.sendDatFromStore&&Ext.each(this.grid.store.data.items,function(a){data.push(a.data)});params={columns:Ext.encode(columns),title:this.title||this.grid.title||this.grid.id,data:Ext.encode(data)};
Ext.Ajax.request({url:"/ui/exportgrid-export",success:function(a){location.href=a.responseText},failure:function(){},params:params})}});Ext.m3.HelpWindow=Ext.extend(Ext.Window,{constructor:function(a){this.title="\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f";this.minimizable=this.maximizable=this.maximized=true;this.width=800;this.height=550;Ext.m3.HelpWindow.superclass.constructor.call(this,a)}});
function showHelpWindow(a){window.open(a)}
Ext.m3.ObjectGrid=Ext.extend(Ext.m3.GridPanel,{constructor:function(a,b){assert(b.allowPaging!==undefined,"allowPaging is undefined");assert(b.rowIdName!==undefined,"rowIdName is undefined");assert(b.actions!==undefined,"actions is undefined");this.allowPaging=b.allowPaging;this.rowIdName=b.rowIdName;this.columnParamName=b.columnParamName;this.actionNewUrl=b.actions.newUrl;this.actionEditUrl=b.actions.editUrl;this.actionDeleteUrl=b.actions.deleteUrl;this.actionDataUrl=b.actions.dataUrl;this.actionContextJson=
b.actions.contextJson;Ext.m3.ObjectGrid.superclass.constructor.call(this,a,b)},initComponent:function(){Ext.m3.ObjectGrid.superclass.initComponent.call(this);var a=this.getStore();a.baseParams=Ext.applyIf(a.baseParams||{},this.actionContextJson||{});this.addEvents("beforenewrequest","afternewrequest","beforeeditrequest","aftereditrequest","beforedeleterequest","afterdeleterequest")},onNewRecord:function(){assert(this.actionNewUrl,"actionNewUrl is not define");var a=new Ext.LoadMask(this.body),b={url:this.actionNewUrl,
params:this.actionContextJson||{},success:function(e,g){if(d.fireEvent("afternewrequest",d,e,g)){try{var h=d.childWindowOpenHandler(e,g)}finally{a.hide();d.disableToolbars(false)}return h}a.hide();d.disableToolbars(false)},failure:function(){uiAjaxFailMessage.apply(this,arguments);a.hide();d.disableToolbars(false)}};if(this.fireEvent("beforenewrequest",this,b)){var d=this;this.disableToolbars(true);a.show();Ext.Ajax.request(b)}},onEditRecord:function(){assert(this.actionEditUrl,"actionEditUrl is not define");
assert(this.rowIdName,"rowIdName is not define");if(this.getSelectionModel().hasSelection()){var a={},b=this.getSelectionModel();if(b instanceof Ext.grid.RowSelectionModel)if(b.singleSelect)a[this.rowIdName]=b.getSelected().id;else{b=b.getSelections();for(var d=[],e=0,g=b.length;e<g;e++)d.push(b[e].id);a[this.rowIdName]=d.join()}else if(b instanceof Ext.grid.CellSelectionModel){assert(this.columnParamName,"columnParamName is not define");if(b=b.getSelectedCell()){d=this.getStore().getAt(b[0]);a[this.rowIdName]=
d.id;a[this.columnParamName]=this.getColumnModel().getDataIndex(b[1])}}var h=new Ext.LoadMask(this.body);a={url:this.actionEditUrl,params:Ext.applyIf(a,this.actionContextJson||{}),success:function(o,w){if(k.fireEvent("aftereditrequest",k,o,w)){try{var A=k.childWindowOpenHandler(o,w)}finally{h.hide();k.disableToolbars(false)}return A}h.hide();k.disableToolbars(false)},failure:function(){uiAjaxFailMessage.apply(this,arguments);h.hide();k.disableToolbars(false)}};if(this.fireEvent("beforeeditrequest",
this,a)){var k=this;this.disableToolbars(true);h.show();Ext.Ajax.request(a)}}},onDeleteRecord:function(){assert(this.actionDeleteUrl,"actionDeleteUrl is not define");assert(this.rowIdName,"rowIdName is not define");var a=this;a.getSelectionModel().hasSelection()&&Ext.Msg.show({title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438",msg:"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c?",
icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,fn:function(b){if(b=="yes"){b={};var d=a.getSelectionModel();if(d instanceof Ext.grid.RowSelectionModel)if(d.singleSelect)b[a.rowIdName]=d.getSelected().id;else{d=d.getSelections();for(var e=[],g=0,h=d.length;g<h;g++)e.push(d[g].id);b[a.rowIdName]=e.join()}else if(d instanceof Ext.grid.CellSelectionModel){assert(a.columnParamName,"columnParamName is not define");if(d=d.getSelectedCell()){e=a.getStore().getAt(d[0]);b[a.rowIdName]=e.id;b[a.columnParamName]=
a.getColumnModel().getDataIndex(d[1])}}var k=new Ext.LoadMask(a.body);b={url:a.actionDeleteUrl,params:Ext.applyIf(b,a.actionContextJson||{}),success:function(o,w){if(a.fireEvent("afterdeleterequest",a,o,w)){try{var A=a.deleteOkHandler(o,w)}finally{k.hide();a.disableToolbars(false)}return A}k.hide();a.disableToolbars(false)},failure:function(){uiAjaxFailMessage.apply(this,arguments);k.hide();a.disableToolbars(false)}};if(a.fireEvent("beforedeleterequest",a,b)){a.disableToolbars(true);k.show();Ext.Ajax.request(b)}}}})},
childWindowOpenHandler:function(a){if(a=smart_eval(a.responseText)){var b=this;a.on("closed_ok",function(){return b.refreshStore()})}},deleteOkHandler:function(a){smart_eval(a.responseText);this.refreshStore()},refreshStore:function(){if(this.allowPaging){var a=this.getBottomToolbar();a&&a instanceof Ext.PagingToolbar&&a.changePage(Math.ceil((a.cursor+a.pageSize)/a.pageSize))}else this.getStore().load()},disableToolbars:function(a){for(var b=[this.getTopToolbar(),this.getFooterToolbar(),this.getBottomToolbar()],
d=0;d<b.length;d++)b[d]&&b[d].setDisabled(a)}});
Ext.m3.EditorObjectGrid=Ext.extend(Ext.m3.EditorGridPanel,{constructor:function(a,b){assert(b.allowPaging!==undefined,"allowPaging is undefined");assert(b.rowIdName!==undefined,"rowIdName is undefined");assert(b.actions!==undefined,"actions is undefined");this.allowPaging=b.allowPaging;this.rowIdName=b.rowIdName;this.columnParamName=b.columnParamName;this.actionNewUrl=b.actions.newUrl;this.actionEditUrl=b.actions.editUrl;this.actionDeleteUrl=b.actions.deleteUrl;this.actionDataUrl=b.actions.dataUrl;
this.actionContextJson=b.actions.contextJson;Ext.m3.EditorObjectGrid.superclass.constructor.call(this,a,b)},initComponent:function(){Ext.m3.EditorObjectGrid.superclass.initComponent.call(this);var a=this.getStore();a.baseParams=Ext.applyIf(a.baseParams||{},this.actionContextJson||{});this.addEvents("beforenewrequest","afternewrequest","beforeeditrequest","aftereditrequest","beforedeleterequest","afterdeleterequest")},onNewRecord:function(){assert(this.actionNewUrl,"actionNewUrl is not define");var a=
{url:this.actionNewUrl,params:this.actionContextJson||{},success:function(d,e){if(b.fireEvent("afternewrequest",b,d,e))return b.childWindowOpenHandler(d,e)},failure:Ext.emptyFn};if(this.fireEvent("beforenewrequest",this,a)){var b=this;Ext.Ajax.request(a)}},onEditRecord:function(){assert(this.actionEditUrl,"actionEditUrl is not define");assert(this.rowIdName,"rowIdName is not define");if(this.getSelectionModel().hasSelection()){var a={},b=this.getSelectionModel();if(b instanceof Ext.grid.RowSelectionModel)if(b.singleSelect)a[this.rowIdName]=
b.getSelected().id;else{b=b.getSelections();for(var d=[],e=0,g=b.length;e<g;e++)d.push(b[e].id);a[this.rowIdName]=d}else if(b instanceof Ext.grid.CellSelectionModel){assert(this.columnParamName,"columnParamName is not define");if(b=b.getSelectedCell()){d=this.getStore().getAt(b[0]);a[this.rowIdName]=d.id;a[this.columnParamName]=this.getColumnModel().getDataIndex(b[1])}}a={url:this.actionEditUrl,params:Ext.applyIf(a,this.actionContextJson||{}),success:function(k,o){if(h.fireEvent("aftereditrequest",
h,k,o))return h.childWindowOpenHandler(k,o)},failure:Ext.emptyFn};if(this.fireEvent("beforeeditrequest",this,a)){var h=this;Ext.Ajax.request(a)}}},onDeleteRecord:function(){assert(this.actionDeleteUrl,"actionDeleteUrl is not define");assert(this.rowIdName,"rowIdName is not define");var a=this;a.getSelectionModel().hasSelection()&&Ext.Msg.show({title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438",msg:"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c?",
icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,fn:function(b){if(b=="yes"){b={};var d=a.getSelectionModel();if(d instanceof Ext.grid.RowSelectionModel)if(d.singleSelect)b[a.rowIdName]=d.getSelected().id;else{d=d.getSelections();for(var e=[],g=0,h=d.length;g<h;g++)e.push(d[g].id);b[a.rowIdName]=e}else if(d instanceof Ext.grid.CellSelectionModel){assert(a.columnParamName,"columnParamName is not define");if(d=d.getSelectedCell()){e=a.getStore().getAt(d[0]);b[a.rowIdName]=e.id;b[a.columnParamName]=a.getColumnModel().getDataIndex(d[1])}}b=
{url:a.actionDeleteUrl,params:Ext.applyIf(b,a.actionContextJson||{}),success:function(k,o){if(a.fireEvent("afterdeleterequest",a,k,o))return a.deleteOkHandler(k,o)},failure:Ext.emptyFn};a.fireEvent("beforedeleterequest",a,b)&&Ext.Ajax.request(b)}}})},childWindowOpenHandler:function(a){if(a=smart_eval(a.responseText)){var b=this;a.on("closed_ok",function(){return b.refreshStore()})}},deleteOkHandler:function(a){smart_eval(a.responseText);this.refreshStore()},refreshStore:function(){if(this.allowPaging){var a=
this.getBottomToolbar();a&&a instanceof Ext.PagingToolbar&&a.changePage(Math.ceil((a.cursor+a.pageSize)/a.pageSize))}else this.getStore().load()}});
Ext.m3.ObjectTree=Ext.extend(Ext.m3.AdvancedTreeGrid,{constructor:function(a,b){assert(b.allowPaging!==undefined,"allowPaging is undefined");assert(b.rowIdName!==undefined,"rowIdName is undefined");assert(b.actions!==undefined,"actions is undefined");this.allowPaging=b.allowPaging;this.rowIdName=b.rowIdName;this.actionNewUrl=b.actions.newUrl;this.actionEditUrl=b.actions.editUrl;this.actionDeleteUrl=b.actions.deleteUrl;this.actionDataUrl=b.actions.dataUrl;this.actionContextJson=b.actions.contextJson;
Ext.m3.ObjectTree.superclass.constructor.call(this,a,b)},initComponent:function(){Ext.m3.AdvancedTreeGrid.superclass.initComponent.call(this);var a=this.getStore();a.baseParams=Ext.applyIf(a.baseParams||{},this.actionContextJson||{})},onNewRecord:function(){assert(this.actionNewUrl,"actionNewUrl is not define");var a=this;Ext.Ajax.request({url:this.actionNewUrl,params:this.actionContextJson||{},success:function(b,d){return a.childWindowOpenHandler(b,d)},failure:Ext.emptyFn})},onNewRecordChild:function(){assert(this.actionNewUrl,
"actionNewUrl is not define");if(this.getSelectionModel().getSelected()){var a={};a[this.rowIdName]=this.getSelectionModel().getSelected().get("_parent");var b=this;Ext.Ajax.request({url:this.actionNewUrl,params:Ext.applyIf(a,this.actionContextJson||{}),success:function(d,e){return b.childWindowOpenHandler(d,e)},failure:Ext.emptyFn})}else Ext.Msg.show({title:"\u041d\u043e\u0432\u044b\u0439",msg:"\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d",buttons:Ext.Msg.OK,
icon:Ext.MessageBox.INFO})},onEditRecord:function(){assert(this.actionEditUrl,"actionEditUrl is not define");assert(this.rowIdName,"rowIdName is not define");if(this.getSelectionModel().hasSelection()){var a={};a[this.rowIdName]=this.getSelectionModel().getSelected().id;var b=this;Ext.Ajax.request({url:this.actionEditUrl,params:Ext.applyIf(a,this.actionContextJson||{}),success:function(d,e){return b.childWindowOpenHandler(d,e)},failure:Ext.emptyFn})}},onDeleteRecord:function(){assert(this.actionDeleteUrl,
"actionDeleteUrl is not define");assert(this.rowIdName,"rowIdName is not define");var a=this;Ext.Msg.show({title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438",msg:"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c?",icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,
fn:function(b){if(b=="yes")if(a.getSelectionModel().hasSelection()){b={};b[a.rowIdName]=a.getSelectionModel().getSelected().id;Ext.Ajax.request({url:a.actionDeleteUrl,params:Ext.applyIf(b,a.actionContextJson||{}),success:function(d,e){return a.deleteOkHandler(d,e)},failure:Ext.emptyFn})}}})},childWindowOpenHandler:function(a){if(a=smart_eval(a.responseText)){var b=this;a.on("closed_ok",function(){return b.refreshStore()})}},deleteOkHandler:function(a){smart_eval(a.responseText);this.refreshStore()},
refreshStore:function(){if(this.allowPaging){var a=this.getBottomToolbar();a&&a instanceof Ext.PagingToolbar&&a.changePage(Math.ceil((a.cursor+a.pageSize)/a.pageSize))}else this.getStore().load()}});Ext.namespace("Ext.ux");
Ext.ux.OnDemandLoad=function(){loadComponent=function(a,b){var d=a.substring(a.lastIndexOf(".")),e=document.getElementsByTagName("head")[0],g=false;if(d===".js"){var h=document.createElement("script");h.setAttribute("type","text/javascript");h.setAttribute("src",a);h.onload=h.onreadystatechange=function(){if(!g){g=true;typeof b=="function"&&b();e.removeChild(h)}}}else if(d===".css"){h=document.createElement("link");h.setAttribute("type","text/css");h.setAttribute("rel","stylesheet");h.setAttribute("href",
a)}typeof h!="undefined"&&e.appendChild(h)};return{load:function(a,b){loadComponent(a,b)}}}();
var CodeMirror=function(){function a(m,p){function D(f){ma=null;var j={line:0,ch:0};G(j,{line:C.length-1,ch:C[C.length-1].text.length},Sa(f),j,j);ma=new k}function y(){if(H.readOnly!="nocursor"){!za&&H.onFocus&&H.onFocus(ea);za=true;$();if(na.className.search(/\bCodeMirror-focused\b/)==-1)na.className+=" CodeMirror-focused";Eb()}}function E(){za&&H.onBlur&&H.onBlur(ea);clearInterval(nb);sa=null;za=false;na.className=na.className.replace(" CodeMirror-focused","")}function G(f,j,l,n,q){if(ma){for(var t=
[],u=f.line,s=j.line+1;u<s;++u)t.push(C[u].text);for(ma.addChange(f.line,l.length,t);ma.done.length>H.undoDepth;)ma.done.shift()}ga(f,j,l,n,q);if(l.length<5){j=f.line;f=f.line+l.length;l=ob(j);for(j=j;j<f;++j){n=C[j];n.highlight(ba,l);n.stateAfter=b(ba,l)}}}function I(f,j){var l=f.pop();if(l){for(var n=[],q=l.start+l.added,t=l.start;t<q;++t)n.push(C[t].text);j.push({start:l.start,added:l.old.length,old:n});t=l.start+l.old.length-1;n=n[n.length-1];var u=l.old[l.old.length-1];if(u)if(n){for(var s=n.length,
x=u.length;s>=0&&x>=0;--s,--x)if(n.charAt(s)!=u.charAt(x))break;n=x+1}else n=u.length;else n=n?n.length:0;t=X({line:t,ch:n});ga({line:l.start,ch:0},{line:q-1,ch:C[q-1].text.length},l.old,t,t)}}function S(){I(ma.done,ma.undone)}function ca(){I(ma.undone,ma.done)}function ga(f,j,l,n,q){for(var t=false,u=Ta.length,s=f.line;s<=j.line;++s)if(C[s].text.length==u){t=true;break}var x=j.line-f.line;s=C[f.line];var v=C[j.line];if(s==v)if(l.length==1)s.replace(f.ch,j.ch,l[0]);else{v=s.split(j.ch,l[l.length-
1]);var F=[f.line+1,x];s.replace(f.ch,s.text.length,l[0]);s=1;for(var K=l.length-1;s<K;++s)F.push(new g(l[s]));F.push(v);C.splice.apply(C,F)}else if(l.length==1){s.replace(f.ch,s.text.length,l[0]+v.text.slice(j.ch));C.splice(f.line+1,x)}else{F=[f.line+1,x-1];s.replace(f.ch,s.text.length,l[0]);v.replace(0,j.ch,l[l.length-1]);s=1;for(K=l.length-1;s<K;++s)F.push(new g(l[s]));C.splice.apply(C,F)}s=f.line;for(K=s+l.length;s<K;++s){v=C[s].text;if(v.length>u){Ta=v;u=v.length;t=false}}if(t){u=0;Ta="";s=0;
for(K=C.length;s<K;++s){v=C[s].text;if(v.length>u){u=v.length;Ta=v}}}t=[];x=l.length-x-1;s=0;for(v=ta.length;s<v;++s){u=ta[s];if(u<f.line)t.push(u);else u>j.line&&t.push(u+x)}l.length&&t.push(f.line);ta=t;pb(100);fa.push({from:f.line,to:j.line+1,diff:x});qb={from:f,to:j,text:l};Ka(n,q,z.from.line<=Math.min(j.line,j.line+x)?z.from.line:z.from.line+x,z.to.line<=Math.min(j.line,j.line+x)?z.to.line:z.to.line+x);La.style.height=C.length*pa()+2*ha.offsetTop+"px"}function ia(f,j,l){function n(t){if(O(t,
j))return t;if(!O(l,t))return q;var u=t.line+f.length-(l.line-j.line)-1,s=t.ch;if(t.line==l.line)s+=f[f.length-1].length-(l.ch-(l.line==j.line?j.ch:0));return{line:u,ch:s}}j=X(j);l=l?X(l):j;f=Sa(f);var q;Ma(f,j,l,function(t){q=t;return{from:n(z.from),to:n(z.to)}});return q}function qa(f,j){Ma(Sa(f),z.from,z.to,function(l){return j=="end"?{from:l,to:l}:j=="start"?{from:z.from,to:z.from}:{from:z.from,to:l}})}function Ma(f,j,l,n){n=n({line:j.line+f.length-1,ch:f.length==1?f[0].length+j.ch:f[f.length-
1].length});G(j,l,f,n.from,n.to)}function ja(f,j){var l=f.line,n=j.line;if(l==n)return C[l].text.slice(f.ch,j.ch);var q=[C[l].text.slice(f.ch)];for(l=l+1;l<n;++l)q.push(C[l].text);q.push(C[n].text.slice(0,j.ch));return q.join("\n")}function Ua(){return ja(z.from,z.to)}function $(){rb||sb.set(2E3,function(){tb();Na();za&&$();ub()})}function oa(f){function j(){tb();var n=Na();if(n=="moved"&&f)ab[f]=true;if(!n&&!l){l=true;sb.set(80,j)}else{rb=false;$()}ub()}var l=false;rb=true;sb.set(20,j)}function Na(){function f(ua,
Y){for(var Va=0;;){var Ea=l.indexOf("\n",Va);if(Ea==-1||(l.charAt(Ea-1)=="\r"?Ea-1:Ea)>=ua)return{line:Y,ch:ua-Va};++Y;Va=Ea+1}}if(!bb){var j=false,l=U.value,n=vb(U);if(!n)return false;j=aa.text!=l;var q=Fa,t=j||n.start!=aa.start||n.end!=(q?aa.start:aa.end);if(!t&&!q)return false;if(j){sa=Fa=null;if(H.readOnly){va=true;return"changed"}}var u=f(n.start,aa.from),s=f(n.end,aa.from);if(q){var x=n.start==q.anchor?s:u;s=sa?z.to:n.start==q.anchor?u:s;if(z.inverted=O(x,s)){u=x;s=s}else{Fa=null;u=s;s=x}}if(u.line==
s.line&&u.line==z.from.line&&u.line==z.to.line&&!sa)va=false;if(j){x=0;q=l.length;for(var v=Math.min(q,aa.text.length),F,K=aa.from,T=-1;x<v&&(F=l.charAt(x))==aa.text.charAt(x);){++x;if(F=="\n"){K++;T=x}}v=T>-1?x-T:x;for(var wa=aa.to-1,ka=aa.text.length;;){F=aa.text.charAt(ka);if(l.charAt(q)!=F){++q;++ka;break}F=="\n"&&wa--;if(ka<=x||q<=x)break;--q;--ka}T=aa.text.lastIndexOf("\n",ka-1);G({line:K,ch:v},{line:wa,ch:T==-1?ka:ka-T-1},Sa(l.slice(x,q)),u,s);if(K!=wa||u.line!=K)va=true}else Ka(u,s);aa.text=
l;aa.start=n.start;aa.end=n.end;return j?"changed":t?"moved":false}}function Ga(){for(var f=[],j=Math.max(0,z.from.line-1),l=Math.min(C.length,z.to.line+2),n=j;n<l;++n)f.push(C[n].text);f=U.value=f.join(cb);var q=z.from.ch,t=z.to.ch;for(n=j;n<z.from.line;++n)q+=cb.length+C[n].text.length;for(n=j;n<z.to.line;++n)t+=cb.length+C[n].text.length;aa={text:f,from:j,to:l,start:q,end:t};db(U,q,Fa?q:t)}function Aa(){H.readOnly!="nocursor"&&U.focus()}function Wa(){var f=wb(z.inverted?z.from:z.to);return Fb(f.x,
f.y,f.x,f.yBot)}function Fb(f,j,l,n){var q=ha.offsetLeft,t=ha.offsetTop,u=pa();j+=t;n+=t;f+=q;l+=q;var s=P.clientHeight,x=P.scrollTop;q=false;t=true;if(j<x){P.scrollTop=Math.max(0,j-2*u);q=true}else if(n>x+s){P.scrollTop=n+u-s;q=true}j=P.clientWidth;n=P.scrollLeft;if(f<n){if(f<50)f=0;P.scrollLeft=Math.max(0,f-10);q=true}else if(l>j+n){P.scrollLeft=l+10-j;q=true;if(l>La.clientWidth)t=false}q&&H.onScroll&&H.onScroll(ea);return t}function Gb(){var f=pa(),j=P.scrollTop-ha.offsetTop;return{from:Math.min(C.length,
Math.max(0,Math.floor(j/f))),to:Math.min(C.length,Math.ceil((j+P.clientHeight)/f))}}function eb(f){if(P.clientWidth){for(var j=f===true?[]:[{from:Z,to:ya,domStart:0}],l=0,n=f.length||0;l<n;++l){for(var q=f[l],t=[],u=q.diff||0,s=0,x=j.length;s<x;++s){var v=j[s];if(q.to<=v.from)t.push({from:v.from+u,to:v.to+u,domStart:v.domStart});else if(v.to<=q.from)t.push(v);else{q.from>v.from&&t.push({from:v.from,to:q.from,domStart:v.domStart});q.to<v.to&&t.push({from:q.to+u,to:v.to+u,domStart:v.domStart+(q.to-
v.from)})}}j=t}u=Gb();q=Math.min(Z,Math.max(u.from-3,0));t=Math.min(C.length,Math.max(ya,u.to+3));f=[];s=0;x=ya-Z;var F=q,K=0;l=0;for(n=j.length;l<n;++l){v=j[l];if(!(v.to<=q)){if(v.from>=t)break;if(v.domStart>s||v.from>F){f.push({from:F,to:v.from,domSize:v.domStart-s,domStart:s});K+=v.from-F}F=v.to;s=v.domStart+(v.to-v.from)}}if(s!=x||F!=t){K+=Math.abs(t-F);f.push({from:F,to:t,domSize:x-s,domStart:s})}if(f.length){da.style.display="none";if(K>(u.to-u.from)*0.3){v=q=Math.max(u.from-10,0);j=t=Math.min(u.to+
7,C.length);l=[];n={line:v,ch:0};n=O(z.from,n)&&!O(z.to,n);for(v=v;v<j;++v){s=u=null;if(n){u=0;if(z.to.line==v){n=false;s=z.to.ch}}else if(z.from.line==v)if(z.to.line==v){u=z.from.ch;s=z.to.ch}else{n=true;u=z.from.ch}l.push(C[v].getHTML(u,s,true))}da.innerHTML=l.join("")}else{j=z.from.line;l=z.to.line;n=0;v=Da&&Ha.createElement("div");u=0;for(s=f.length;u<s;++u){x=f[u];F=x.to-x.from-x.domSize;K=da.childNodes[x.domStart+x.domSize+n]||null;if(Da)for(var T=Math.max(-F,x.domSize);T>0;--T)da.removeChild(K?
K.previousSibling:da.lastChild);else if(F){for(T=Math.max(0,F);T>0;--T)da.insertBefore(Ha.createElement("pre"),K);for(T=Math.max(0,-F);T>0;--T)da.removeChild(K?K.previousSibling:da.lastChild)}var wa=da.childNodes[x.domStart+n],ka=j<x.from&&l>=x.from;for(T=x.from;T<x.to;++T){var ua=null,Y=null;if(ka){ua=0;if(l==T){ka=false;Y=z.to.ch}}else if(j==T)if(l==T){ua=z.from.ch;Y=z.to.ch}else{ka=true;ua=z.from.ch}if(Da){v.innerHTML=C[T].getHTML(ua,Y,true);da.insertBefore(v.firstChild,K)}else{wa.innerHTML=C[T].getHTML(ua,
Y,false);wa.className=C[T].className||"";wa=wa.nextSibling}}n+=F}}da.style.display="";j=q!=Z||t!=ya||Hb!=P.clientHeight;Z=q;ya=t;xb.style.top=q*pa()+"px";if(j){Hb=P.clientHeight;La.style.height=C.length*pa()+2*ha.offsetTop+"px";fb()}q=Ib(Ta);ha.style.width=q>P.clientWidth?q+"px":"";if(da.childNodes.length!=ya-Z)throw Error("BAD PATCH! "+JSON.stringify(f)+" size="+(ya-Z)+" nodes="+da.childNodes.length);Jb()}}else Z=ya=0}function fb(){if(H.gutter||H.lineNumbers){var f=xb.offsetHeight,j=P.clientHeight;
Ba.style.height=(f-j<2?j:f)+"px";f=[];for(j=Z;j<Math.max(ya,Z+1);++j){var l=C[j].gutterMarker,n=H.lineNumbers?j+H.firstLineNumber:null;if(l&&l.text)n=l.text.replace("%N%",n!=null?n:"");else if(n==null)n="\u00a0";f.push(l&&l.style?'<pre class="'+l.style+'">':"<pre>",n,"</pre>")}Ba.style.display="none";gb.innerHTML=f.join("");f=String(C.length).length;j=gb.firstChild;l=j.textContent||j.innerText||j.nodeValue||"";for(n="";l.length+n.length<f;)n+="\u00a0";n&&j.insertBefore(Ha.createTextNode(n),j.firstChild);
Ba.style.display="";ha.style.marginLeft=Ba.offsetWidth+"px"}}function Jb(){var f=z.inverted?z.from:z.to,j=pa(),l=Kb(f.line,f.ch)+"px",n=(f.line-Z)*j+"px";Lb.style.top=f.line*j-P.scrollTop+"px";if(M(z.from,z.to)){Ia.style.top=n;Ia.style.left=l;Ia.style.display=""}else Ia.style.display="none"}function Oa(f,j){var l=sa&&X(sa);if(l)if(O(l,f))f=l;else if(O(j,l))j=l;Ka(f,j)}function Ka(f,j,l,n){if(!(M(z.from,f)&&M(z.to,j))){if(O(j,f)){var q=j;j=f;f=q}if(M(f,j))z.inverted=false;else if(M(f,z.to))z.inverted=
false;else if(M(j,z.from))z.inverted=true;if(l==null){l=z.from.line;n=z.to.line}if(M(f,j))M(z.from,z.to)||fa.push({from:l,to:n+1});else if(M(z.from,z.to))fa.push({from:f.line,to:j.line+1});else{M(f,z.from)||(f.line<l?fa.push({from:f.line,to:Math.min(j.line,l)+1}):fa.push({from:l,to:Math.min(n,f.line)+1}));M(j,z.to)||(j.line<n?fa.push({from:Math.max(l,f.line),to:n+1}):fa.push({from:Math.max(f.line,n),to:j.line+1}))}z.from=f;z.to=j;Ca=true}}function Xa(f,j,l){f=X({line:f,ch:j||0});(l?Oa:Ka)(f,f)}function Pa(f){return Math.max(0,
Math.min(f,C.length-1))}function X(f){if(f.line<0)return{line:0,ch:0};if(f.line>=C.length)return{line:C.length-1,ch:C[C.length-1].text.length};var j=f.ch,l=C[f.line].text.length;return j==null||j>l?{line:f.line,ch:l}:j<0?{line:f.line,ch:0}:f}function Xb(f){Oa({line:f,ch:0},{line:f,ch:C[f].text.length})}function Qa(f,j){if(j=="smart")if(ba.indent)var l=ob(f);else j="prev";var n=C[f],q=n.indentation(),t=n.text.match(/^\s*/)[0],u;if(j=="prev")u=f?C[f-1].indentation():0;else if(j=="smart")u=ba.indent(l,
n.text.slice(t.length));else if(j=="add")u=q+H.indentUnit;else if(j=="subtract")u=q-H.indentUnit;u=Math.max(0,u);if(u-q){q="";l=0;if(H.indentWithTabs)for(n=Math.floor(u/hb);n;--n){l+=hb;q+="\t"}for(;l<u;){++l;q+=" "}}else{if(z.from.line!=f&&z.to.line!=f)return;q=t}ia(q,{line:f,ch:0},{line:f,ch:t.length})}function Mb(){ba=a.getMode(H,H.mode);for(var f=0,j=C.length;f<j;++f)C[f].stateAfter=null;ta=[0];pb()}function yb(f,j,l){function n(s,x,v,F){s=C[s];x=s.addMark(x,v,F);x.line=s;q.push(x)}f=X(f);j=X(j);
var q=[];if(f.line==j.line)n(f.line,f.ch,j.ch,l);else{n(f.line,f.ch,null,l);for(var t=f.line+1,u=j.line;t<u;++t)n(t,0,null,l);n(j.line,0,j.ch,l)}fa.push({from:f.line,to:j.line+1});return function(){for(var s,x,v=0;v<q.length;++v){var F=q[v],K=W(C,F.line);F.line.removeMark(F);if(K>-1){if(s==null)s=K;x=K}}s!=null&&fa.push({from:s,to:x+1})}}function Ib(f){xa.innerHTML="<pre><span>x</span></pre>";xa.firstChild.firstChild.firstChild.nodeValue=f;return xa.firstChild.firstChild.offsetWidth||10}function Kb(f,
j){if(j==0)return 0;xa.innerHTML="<pre><span>"+C[f].getHTML(null,null,false,j)+"</span></pre>";return xa.firstChild.firstChild.offsetWidth}function Nb(f,j){function l(F){xa.innerHTML="<pre><span>"+n.getHTML(null,null,false,F)+"</span></pre>";return xa.firstChild.firstChild.offsetWidth}if(j<=0)return 0;for(var n=C[f],q=0,t=0,u=n.text.length,s,x=Math.min(u,Math.ceil(j/Ib("x")));;){var v=l(x);if(v<=j&&x<u)x=Math.min(u,Math.ceil(x*1.2));else{s=v;u=x;break}}if(j>s)return u;x=Math.floor(u*0.8);v=l(x);if(v<
j){q=x;t=v}for(;;){if(u-q<=1)return s-j>j-t?q:u;x=Math.ceil((q+u)/2);v=l(x);if(v>j){u=x;s=v}else{q=x;t=v}}}function wb(f,j){var l=pa(),n=f.line-(j?Z:0);return{x:Kb(f.line,f.ch),y:n*l,yBot:(n+1)*l}}function Ob(f){f=wb(f,true);var j=V(ha);return{x:j.left+f.x,y:j.top+f.y,yBot:j.top+f.yBot}}function pa(){var f=da.childNodes.length;if(f)return da.offsetHeight/f||1;xa.innerHTML="<pre>x</pre>";return xa.firstChild.offsetHeight||1}function Ra(f,j){var l=V(P,true),n=f.e.clientX,q=f.e.clientY;if(!j&&(n-l.left>
P.clientWidth||q-l.top>P.clientHeight))return null;l=V(ha,true);q=Z+Math.floor((q-l.top)/pa());return X({line:q,ch:Nb(Pa(q),n-l.left)})}function Pb(f){function j(){U.value!=q&&Q(qa)(U.value,"end");U.style.cssText=n;bb=false;Ga();$()}var l=Ra(f);if(!(!l||window.opera)){if(M(z.from,z.to)||O(l,z.from)||!O(l,z.to))Xa(l.line,l.ch);var n=U.style.cssText;U.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(f.pageY()-1)+"px; left: "+(f.pageX()-1)+"px; z-index: 1000; background: white; border-width: 0; outline: none; overflow: hidden; opacity: .05;";
var q=U.value=Ua();Aa();db(U,0,U.value.length);bb=true;if(la){f.stop();var t=B(window,"mouseup",function(){t();setTimeout(j,20)},true)}else setTimeout(j,50)}}function Eb(){clearInterval(nb);var f=true;Ia.style.visibility="";nb=setInterval(function(){Ia.style.visibility=(f=!f)?"":"hidden"},650)}function Qb(f){function j(Y,Va,Ea){if(Y.text){var Ya=Y.styles;Y=u?0:Y.text.length-1;for(var zb,Za=u?0:Ya.length-2,Yb=u?Ya.length:-2;Za!=Yb;Za+=2*s){var ib=Ya[Za];if(Ya[Za+1]!=null&&Ya[Za+1]!=K)Y+=s*ib.length;
else for(var Ab=u?0:ib.length-1,Zb=u?ib.length:-1;Ab!=Zb;Ab+=s,Y+=s)if(Y>=Va&&Y<Ea&&wa.test(zb=ib.charAt(Ab))){var Rb=Bb[zb];if(Rb.charAt(1)==">"==u)T.push(zb);else if(T.pop()!=Rb.charAt(0))return{pos:Y,match:false};else if(!T.length)return{pos:Y,match:true}}}}}var l=z.inverted?z.from:z.to,n=C[l.line],q=l.ch-1,t=q>=0&&Bb[n.text.charAt(q)]||Bb[n.text.charAt(++q)];if(t){t.charAt(0);var u=t.charAt(1)==">",s=u?1:-1,x=n.styles,v=q+1;t=0;for(var F=x.length;t<F;t+=2)if((v-=x[t].length)<=0){var K=x[t+1];
break}var T=[n.text.charAt(q)],wa=/[(){}[\]]/;t=l.line;for(F=u?Math.min(t+50,C.length):Math.max(-1,t-50);t!=F;t+=s){n=C[t];x=t==l.line;if(n=j(n,x&&u?q+1:0,x&&!u?q:n.text.length)){K=n.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";var ka=yb({line:l.line,ch:q},{line:l.line,ch:q+1},K),ua=yb({line:t,ch:n.pos},{line:t,ch:n.pos+1},K);l=Q(function(){ka();ua()});if(f)setTimeout(l,800);else jb=l;break}}}}function Sb(f){var j,l,n=f;for(f=f-40;n>f;--n){if(n==0)return 0;var q=C[n-1];if(q.stateAfter)return n;
q=q.indentation();if(l==null||j>q){l=n;j=q}}return l}function ob(f){var j=Sb(f),l=j&&C[j-1].stateAfter;l=l?b(ba,l):d(ba);for(j=j;j<f;++j){var n=C[j];n.highlight(ba,l);n.stateAfter=b(ba,l)}C[f].stateAfter||ta.push(f);return l}function $b(){for(var f=+new Date+H.workTime,j=ta.length;ta.length;){var l=C[Z].stateAfter?ta.pop():Z;if(!(l>=C.length)){var n=Sb(l),q=n&&C[n-1].stateAfter;q=q?b(ba,q):d(ba);var t=0;n=n;for(var u=C.length;n<u;++n){var s=C[n],x=s.stateAfter;if(+new Date>f){ta.push(n);pb(H.workDelay);
fa.push({from:l,to:n});return}var v=s.highlight(ba,q);s.stateAfter=b(ba,q);if(v||!x)t=0;else if(++t>3)break}fa.push({from:l,to:n})}}j&&H.onHighlightComplete&&H.onHighlightComplete(ea)}function pb(f){ta.length&&ac.set(f,Q($b))}function tb(){va=null;fa=[];qb=Ca=false}function ub(){var f=false;if(Ca)f=!Wa();if(fa.length)eb(fa);else Ca&&Jb();f&&Wa();Ca&&Eb();if(!bb&&(va===true||va!==false&&Ca))Ga();Ca&&H.matchBrackets&&setTimeout(Q(function(){if(jb){jb();jb=null}Qb(false)}),20);f=qb;Ca&&H.onCursorActivity&&
H.onCursorActivity(ea);f&&H.onChange&&ea&&H.onChange(ea,f)}function Q(f){return function(){Tb++||tb();try{var j=f.apply(this,arguments)}finally{--Tb||ub()}return j}}function Ub(f,j,l){this.atOccurrence=false;if(l==null)l=typeof f=="string"&&f==f.toLowerCase();j=j&&typeof j=="object"?X(j):{line:0,ch:0};this.pos={from:j,to:j};if(typeof f!="string")this.matches=function(t,u){if(t)for(var s=C[u.line].text.slice(0,u.ch),x=s.match(f),v=0;x;){var F=s.indexOf(x[0]);v+=F;s=s.slice(F+1);if(F=s.match(f))x=F;
else break;v++}else{s=C[u.line].text.slice(u.ch);v=(x=s.match(f))&&u.ch+s.indexOf(x[0])}if(x)return{from:{line:u.line,ch:v},to:{line:u.line,ch:v+x[0].length},match:x}};else{if(l)f=f.toLowerCase();var n=l?function(t){return t.toLowerCase()}:function(t){return t},q=f.split("\n");this.matches=q.length==1?function(t,u){var s=n(C[u.line].text),x=f.length,v;if(t?u.ch>=x&&(v=s.lastIndexOf(f,u.ch-x))!=-1:(v=s.indexOf(f,u.ch))!=-1)return{from:{line:u.line,ch:v},to:{line:u.line,ch:v+x}}}:function(t,u){var s=
u.line,x=t?q.length-1:0,v=q[x],F=n(C[s].text),K=t?F.indexOf(v)+v.length:F.lastIndexOf(v);if(!(t?K>=u.ch||K!=v.length:K<=u.ch||K!=F.length-v.length))for(;;){if(t?!s:s==C.length-1)break;F=n(C[s+=t?-1:1].text);v=q[t?--x:++x];if(x>0&&x<q.length-1)if(F!=v)break;else continue;x=t?F.lastIndexOf(v):F.indexOf(v)+v.length;if(t?x!=F.length-v.length:x!=v.length)break;v={line:u.line,ch:K};s={line:s,ch:x};return{from:t?s:v,to:t?v:s}}}}}var H={},Cb=a.defaults,$a;for($a in Cb)if(Cb.hasOwnProperty($a))H[$a]=(p&&p.hasOwnProperty($a)?
p:Cb)[$a];var Ha=H.document,na=Ha.createElement("div");na.className="CodeMirror";na.innerHTML='<div style="overflow: hidden; position: relative; width: 1px; height: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off"></textarea></div><div class="CodeMirror-scroll cm-s-'+H.theme+'"><div style="position: relative"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"></div><div style="position: relative"><div class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative"><pre class="CodeMirror-cursor">&#160;</pre><div></div></div></div></div></div></div>';
m.appendChild?m.appendChild(na):m(na);var Lb=na.firstChild,U=Lb.firstChild,P=na.lastChild,La=P.firstChild,xa=La.firstChild,xb=xa.nextSibling,Ba=xb.firstChild,gb=Ba.firstChild,ha=Ba.nextSibling.firstChild,Ia=ha.firstChild,da=Ia.nextSibling;if(H.tabindex!=null)U.tabindex=H.tabindex;if(!H.gutter&&!H.lineNumbers)Ba.style.display="none";var sb=new J,ac=new J,nb,ba,C=[new g("")],ta,ma=new k,za;Mb();var z={from:{line:0,ch:0},to:{line:0,ch:0},inverted:false},sa,Fa,Db,va,fa,qb,Ca,bb,Z=0,ya=0,Hb=0,kb=null,
aa,jb,Ta="";Q(function(){D(H.value||"");va=false})();setTimeout(Ga,20);B(P,"mousedown",Q(function(f){function j(v){var F=Ra(v,true);if(F&&!M(F,t)){za||y();t=F;Oa(q,F);va=false;var K=Gb();if(F.line>=K.to||F.line<K.from)u=setTimeout(Q(function(){j(v)}),150)}}var l=Db;Db=null;for(var n=f.target();n!=na;n=n.parentNode)if(n.parentNode==gb){H.onGutterClick&&H.onGutterClick(ea,W(gb.childNodes,n)+Z);return f.stop()}la&&f.button()==3&&Pb(f);if(f.button()==1){var q=Ra(f),t=q,u;if(q){za||y();f.stop();if(l&&
+new Date-l<400)return Xb(q.line);Xa(q.line,q.ch,true);var s=B(Ha,"mousemove",Q(function(v){clearTimeout(u);v.stop();j(v)}),true),x=B(Ha,"mouseup",Q(function(v){clearTimeout(u);var F=Ra(v);F&&Oa(q,F);v.stop();Aa();va=true;s();x()}),true)}else f.target()==P&&f.stop()}}));la||B(P,"contextmenu",Q(Pb));B(La,"dblclick",Q(function(f){var j=Ra(f);if(j){for(var l=C[j.line].text,n=j.ch,q=j.ch;n>0&&/\w/.test(l.charAt(n-1));)--n;for(;q<l.length&&/\w/.test(l.charAt(q));)++q;Oa({line:j.line,ch:n},{line:j.line,
ch:q});f.stop();Db=+new Date}}));B(P,"scroll",function(){eb([]);H.onScroll&&H.onScroll(ea)});B(window,"resize",function(){eb(true)});B(U,"keyup",Q(function(f){if(!(H.onKeyEvent&&H.onKeyEvent(ea,w(f.e)))){if(Fa){Fa=null;va=true}if(f.e.keyCode==16)sa=null}}));B(U,"keydown",Q(function(f){za||y();var j=f.e.keyCode;if(bc&&j==27)f.e.returnValue=false;var l=(Vb?f.e.metaKey:f.e.ctrlKey)&&!f.e.altKey,n=f.e.ctrlKey||f.e.altKey||f.e.metaKey;sa=j==16||f.e.shiftKey?sa||(z.inverted?z.to:z.from):null;if(!(H.onKeyEvent&&
H.onKeyEvent(ea,w(f.e)))){if(j==33||j==34){j=j==34;l=Math.floor(P.clientHeight/pa());n=z.inverted?z.from:z.to;Xa(n.line+Math.max(l-1,1)*(j?1:-1),n.ch,true);return f.stop()}if(l&&(j==36||j==35||Vb&&(j==38||j==40))){j=j==36||j==38?{line:0,ch:0}:{line:C.length-1,ch:C[C.length-1].text.length};Oa(j,j);return f.stop()}if(l&&j==65){j=C.length-1;Ka({line:0,ch:0},{line:j,ch:C[j].text.length});return f.stop()}if(!H.readOnly){if(!n&&j==13)return;if(n=!n){if(n=j==9)a:{n=f.e.shiftKey;sa=null;switch(H.tabMode){case "default":n=
false;break a;case "indent":for(var q=z.from.line,t=z.to.line;q<=t;++q)Qa(q,"smart");break;case "classic":if(M(z.from,z.to)){n?Qa(z.from.line,"smart"):qa("\t","end");break}case "shift":q=z.from.line;for(t=z.to.line;q<=t;++q)Qa(q,n?"subtract":"add")}n=true}n=n}if(n)return f.stop();if(l&&j==90){S();return f.stop()}if(l&&(f.e.shiftKey&&j==90||j==89)){ca();return f.stop()}}kb=(l?"c":"")+j;if(z.inverted&&ab.hasOwnProperty(kb))if(f=vb(U)){Fa={anchor:f.start};db(U,f.start,f.start)}oa(kb)}}));B(U,"keypress",
Q(function(f){if(!(H.onKeyEvent&&H.onKeyEvent(ea,w(f.e)))){if(H.electricChars&&ba.electricChars){var j=String.fromCharCode(f.e.charCode==null?f.e.keyCode:f.e.charCode);ba.electricChars.indexOf(j)>-1&&setTimeout(Q(function(){Qa(z.to.line,"smart")}),50)}j=f.e.keyCode;if(j==13){if(!H.readOnly){qa("\n","end");if(H.enterMode!="flat")Qa(z.from.line,H.enterMode=="keep"?"prev":"smart")}f.stop()}else!f.e.ctrlKey&&!f.e.altKey&&!f.e.metaKey&&j==9&&H.tabMode!="default"?f.stop():oa(kb)}}));B(U,"focus",y);B(U,
"blur",E);B(P,"dragenter",function(f){f.stop()});B(P,"dragover",function(f){f.stop()});B(P,"drop",Q(function(f){var j=Ra(f,true),l=f.e.dataTransfer.files;if(!(!j||H.readOnly))if(l&&l.length&&window.FileReader&&window.File){var n=l.length,q=Array(n),t=0;for(f=0;f<n;++f)u(l[f],f);var u=function(x,v){var F=new FileReader;F.onload=function(){q[v]=F.result;++t==n&&ia(q.join(""),X(j),X(j))};F.readAsText(x)}}else try{(q=f.e.dataTransfer.getData("Text"))&&ia(q,j,j)}catch(s){}}));B(P,"paste",function(){Aa();
oa()});B(U,"paste",function(){oa()});B(U,"cut",function(){oa()});var Wb;try{Wb=Ha.activeElement==U}catch(dc){}Wb?y():E();var ea={getValue:function(){for(var f=[],j=0,l=C.length;j<l;++j)f.push(C[j].text);return f.join("\n")},setValue:Q(D),getSelection:Ua,replaceSelection:Q(qa),focus:function(){Aa();y();Ga();oa()},setOption:function(f,j){H[f]=j;if(f=="lineNumbers"||f=="gutter"){var l=H.gutter||H.lineNumbers;Ba.style.display=l?"":"none";if(l)fb();else da.parentNode.style.marginLeft=0}else if(f=="mode"||
f=="indentUnit")Mb();else if(f=="readOnly"&&j=="nocursor")U.blur();else if(f=="theme")P.className=P.className.replace(/cm-s-\w+/,"cm-s-"+j)},getOption:function(f){return H[f]},undo:Q(S),redo:Q(ca),indentLine:Q(function(f){f>=0&&f<C.length&&Qa(f,"smart")}),historySize:function(){return{undo:ma.done.length,redo:ma.undone.length}},matchBrackets:Q(function(){Qb(true)}),getTokenAt:function(f){f=X(f);return C[f.line].getTokenAt(ba,ob(f.line),f.ch)},cursorCoords:function(f){if(f==null)f=z.inverted;return Ob(f?
z.from:z.to)},charCoords:function(f){return Ob(X(f))},coordsChar:function(f){var j=V(ha),l=Pa(Math.min(C.length-1,Z+Math.floor((f.y-j.top)/pa())));return X({line:l,ch:Nb(Pa(l),f.x-j.left)})},getSearchCursor:function(f,j,l){return new Ub(f,j,l)},markText:Q(function(f,j,l){return Q(yb(f,j,l))}),setMarker:function(f,j,l){if(typeof f=="number")f=C[Pa(f)];f.gutterMarker={text:j,style:l};fb();return f},clearMarker:function(f){if(typeof f=="number")f=C[Pa(f)];f.gutterMarker=null;fb()},setLineClass:Q(function(f,
j){if(typeof f=="number"){var l=f;f=C[Pa(f)]}else{l=W(C,f);if(l==-1)return null}if(f.className!=j){f.className=j;fa.push({from:l,to:l+1})}return f}),lineInfo:function(f){if(typeof f=="number"){var j=f;f=C[f];if(!f)return null}else{j=W(C,f);if(j==-1)return null}var l=f.gutterMarker;return{line:j,text:f.text,markerText:l&&l.text,markerClass:l&&l.style}},addWidget:function(f,j,l){f=wb(X(f),true);j.style.top=Z*pa()+f.yBot+ha.offsetTop+"px";j.style.left=f.x+ha.offsetLeft+"px";La.appendChild(j);l&&Fb(f.x,
f.yBot,f.x+j.offsetWidth,f.yBot+j.offsetHeight)},lineCount:function(){return C.length},getCursor:function(f){if(f==null)f=z.inverted;return{line:(f?z.from:z.to).line,ch:(f?z.from:z.to).ch}},somethingSelected:function(){return!M(z.from,z.to)},setCursor:Q(function(f,j){j==null&&typeof f.line=="number"?Xa(f.line,f.ch):Xa(f,j)}),setSelection:Q(function(f,j){Ka(X(f),X(j||f))}),getLine:function(f){if(f>=0&&f<C.length)return C[f].text},setLine:Q(function(f,j){f>=0&&f<C.length&&ia(j,{line:f,ch:0},{line:f,
ch:C[f].text.length})}),removeLine:Q(function(f){f>=0&&f<C.length&&ia("",{line:f,ch:0},X({line:f+1,ch:0}))}),replaceRange:Q(ia),getRange:function(f,j){return ja(X(f),X(j))},operation:function(f){return Q(f)()},refresh:function(){eb(true)},getInputField:function(){return U},getWrapperElement:function(){return na}},rb=false,Bb={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"},Tb=0;Ub.prototype={findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(f){function j(q){q=
{line:q,ch:0};l.pos={from:q,to:q};return l.atOccurrence=false}for(var l=this,n=X(f?this.pos.from:this.pos.to);;){if(this.pos=this.matches(f,n)){this.atOccurrence=true;return this.pos.match||true}if(f){if(!n.line)return j(0);n={line:n.line-1,ch:C[n.line-1].text.length}}else{if(n.line==C.length-1)return j(C.length);n={line:n.line+1,ch:0}}}},from:function(){if(this.atOccurrence)return{line:this.pos.from.line,ch:this.pos.from.ch}},to:function(){if(this.atOccurrence)return{line:this.pos.to.line,ch:this.pos.to.ch}}};
for(var lb in Ja)if(Ja.propertyIsEnumerable(lb)&&!ea.propertyIsEnumerable(lb))ea[lb]=Ja[lb];return ea}function b(m,p){if(p===true)return p;if(m.copyState)return m.copyState(p);var D={},y;for(y in p){var E=p[y];if(E instanceof Array)E=E.concat([]);D[y]=E}return D}function d(m,p,D){return m.startState?m.startState(p,D):true}function e(m){this.pos=this.start=0;this.string=m}function g(m,p){this.styles=p||[m,null];this.stateAfter=null;this.text=m;this.marked=this.gutterMarker=this.className=null}function h(m,
p,D,y){for(var E=0,G=0,I=0;G<p;E+=2){var S=D[E],ca=G+S.length;if(I==0){ca>m&&y.push(S.slice(m-G,Math.min(S.length,p-G)),D[E+1]);if(ca>=m)I=1}else if(I==1)ca>p?y.push(S.slice(0,p-G),D[E+1]):y.push(S,D[E+1]);G=ca}}function k(){this.time=0;this.done=[];this.undone=[]}function o(){if(this.preventDefault){this.preventDefault();this.stopPropagation()}else{this.returnValue=false;this.cancelBubble=true}}function w(m){if(!m.stop)m.stop=o;return m}function A(m){this.e=m}function B(m,p,D,y){function E(G){D(new A(G||
window.event))}if(typeof m.addEventListener=="function"){m.addEventListener(p,E,false);if(y)return function(){m.removeEventListener(p,E,false)}}else{m.attachEvent("on"+p,E);if(y)return function(){m.detachEvent("on"+p,E)}}}function J(){this.id=null}function L(m,p){if(p==null){p=m.search(/[^\s\u00a0]/);if(p==-1)p=m.length}for(var D=0,y=0;D<p;++D)if(m.charAt(D)=="\t")y+=hb-y%hb;else++y;return y}function V(m,p){for(var D=m.ownerDocument.body,y=0,E=0,G=false,I=m;I;I=I.offsetParent){y+=I.offsetLeft;E+=
I.offsetTop;if(I==D)G=true}D=p&&G?null:D;for(I=m.parentNode;I!=D;I=I.parentNode)if(I.scrollLeft!=null){y-=I.scrollLeft;E-=I.scrollTop}return{left:y,top:E}}function M(m,p){return m.line==p.line&&m.ch==p.ch}function O(m,p){return m.line<p.line||m.line==p.line&&m.ch<p.ch}function N(m){return m.replace(/[<>&]/g,function(p){return p=="&"?"&amp;":p=="<"?"&lt;":"&gt;"})}function W(m,p){if(m.indexOf)return m.indexOf(p);for(var D=0,y=m.length;D<y;++D)if(m[D]==p)return D;return-1}a.defaults={value:"",mode:null,
theme:"default",indentUnit:2,indentWithTabs:false,tabMode:"classic",enterMode:"indent",electricChars:true,onKeyEvent:null,lineNumbers:false,gutter:false,firstLineNumber:1,readOnly:false,onChange:null,onCursorActivity:null,onGutterClick:null,onHighlightComplete:null,onFocus:null,onBlur:null,onScroll:null,matchBrackets:false,workTime:100,workDelay:200,undoDepth:40,tabindex:null,document:window.document};var R={},ra={};a.defineMode=function(m,p){if(!a.defaults.mode&&m!="null")a.defaults.mode=m;R[m]=
p};a.defineMIME=function(m,p){ra[m]=p};a.getMode=function(m,p){if(typeof p=="string"&&ra.hasOwnProperty(p))p=ra[p];if(typeof p=="string")var D=p,y={};else if(p!=null){D=p.name;y=p}var E=R[D];if(!E){window.console&&console.warn("No mode "+D+" found, falling back to plain text.");return a.getMode(m,"text/plain")}return E(m,y||{})};a.listModes=function(){var m=[],p;for(p in R)R.propertyIsEnumerable(p)&&m.push(p);return m};a.listMIMEs=function(){var m=[],p;for(p in ra)ra.propertyIsEnumerable(p)&&m.push(p);
return m};var Ja={};a.defineExtension=function(m,p){Ja[m]=p};a.fromTextArea=function(m,p){function D(){m.value=I.getValue()}p||(p={});p.value=m.value;if(!p.tabindex&&m.tabindex)p.tabindex=m.tabindex;if(m.form){var y=B(m.form,"submit",D,true);if(typeof m.form.submit=="function"){var E=m.form.submit,G=function(){D();m.form.submit=E;m.form.submit();m.form.submit=G};m.form.submit=G}}m.style.display="none";var I=a(function(S){m.parentNode.insertBefore(S,m.nextSibling)},p);I.save=D;I.toTextArea=function(){D();
m.parentNode.removeChild(I.getWrapperElement());m.style.display="";if(m.form){y();if(typeof m.form.submit=="function")m.form.submit=E}};return I};a.startState=d;a.copyState=b;e.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==0},peek:function(){return this.string.charAt(this.pos)},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(m){var p=this.string.charAt(this.pos);if(typeof m=="string"?p==m:p&&(m.test?
m.test(p):m(p))){++this.pos;return p}},eatWhile:function(m){for(var p=this.start;this.eat(m););return this.pos>p},eatSpace:function(){for(var m=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>m},skipToEnd:function(){this.pos=this.string.length},skipTo:function(m){m=this.string.indexOf(m,this.pos);if(m>-1){this.pos=m;return true}},backUp:function(m){this.pos-=m},column:function(){return L(this.string,this.start)},indentation:function(){return L(this.string)},match:function(m,
p,D){if(typeof m=="string"){if((D?this.string.toLowerCase():this.string).indexOf(D?m.toLowerCase():m,this.pos)==this.pos){if(p!==false)this.pos+=m.length;return true}}else{if((m=this.string.slice(this.pos).match(m))&&p!==false)this.pos+=m[0].length;return m}},current:function(){return this.string.slice(this.start,this.pos)}};a.StringStream=e;g.prototype={replace:function(m,p,D){var y=[],E=this.marked;h(0,m,this.styles,y);D&&y.push(D,null);h(p,this.text.length,this.styles,y);this.styles=y;this.text=
this.text.slice(0,m)+D+this.text.slice(p);this.stateAfter=null;if(E){m=D.length-(p-m);D=this.text.length;for(y=0;y<E.length;++y){var G=E[y],I=false;if(G.from>=D)I=true;else{G.from=G.from<=Math.min(p,p+m)?G.from:G.from+m;if(G.to!=null)G.to=G.to<=Math.min(p,p+m)?G.to:G.to+m}if(I||G.from>=G.to){E.splice(y,1);y--}}}},split:function(m,p){var D=[p,null];h(m,this.text.length,this.styles,D);return new g(p+this.text.slice(m),D)},addMark:function(m,p,D){m={from:m,to:p,style:D};if(this.marked==null)this.marked=
[];this.marked.push(m);this.marked.sort(function(y,E){return y.from-E.from});return m},removeMark:function(m){var p=this.marked;if(p)for(var D=0;D<p.length;++D)if(p[D]==m){p.splice(D,1);break}},highlight:function(m,p){var D=new e(this.text),y=this.styles,E=0,G=false,I=y[0],S;for(this.text==""&&m.blankLine&&m.blankLine(p);!D.eol();){var ca=m.token(D,p),ga=this.text.slice(D.start,D.pos);D.start=D.pos;if(E&&y[E-1]==ca)y[E-2]+=ga;else if(ga){if(!G&&(y[E+1]!=ca||E&&y[E-2]!=S))G=true;y[E++]=ga;y[E++]=ca;
S=I;I=y[E]}if(D.pos>5E3){y[E++]=this.text.slice(D.pos);y[E++]=null;break}}if(y.length!=E){y.length=E;G=true}if(E&&y[E-2]!=S)G=true;return G||y.length<5&&this.text.length<10},getTokenAt:function(m,p,D){for(var y=new e(this.text);y.pos<D&&!y.eol();){y.start=y.pos;var E=m.token(y,p)}return{start:y.start,end:y.pos,string:y.current(),className:E||null,state:p}},indentation:function(){return L(this.text)},getHTML:function(m,p,D,y){function E(Aa,Wa){if(Aa)Wa?G.push('<span class="cm-',Wa,'">',N(Aa),"</span>"):
G.push(N(Aa))}var G=[];if(D)G.push(this.className?'<pre class="'+this.className+'">':"<pre>");var I=this.styles,S=this.text,ca=this.marked;if(m==p)m=null;var ga=S.length;if(y!=null)ga=Math.min(y,ga);if(!S&&y==null)E(" ",m!=null&&p==null?"CodeMirror-selected":null);else if(!ca&&m==null)for(m=y=0;m<ga;y+=2){p=I[y];var ia=p.length;if(m+ia>ga)p=p.slice(0,ga-m);m+=ia;E(p,I[y+1])}else{y=S=0;var qa="",Ma=-1,ja=null,Ua=function(){if(ca){Ma+=1;ja=Ma<ca.length?ca[Ma]:null}};for(Ua();S<ga;){var $=ga,oa="";if(m!=
null)if(m>S)$=m;else if(p==null||p>S){oa=" CodeMirror-selected";if(p!=null)$=Math.min($,p)}for(;ja&&ja.to!=null&&ja.to<=S;)Ua();if(ja)if(ja.from>S)$=Math.min($,ja.from);else{oa+=" "+ja.style;if(ja.to!=null)$=Math.min($,ja.to)}for(;;){var Na=S+qa.length,Ga=ia;if(oa)Ga=ia?ia+oa:oa;E(Na>$?qa.slice(0,$-S):qa,Ga);if(Na>=$){qa=qa.slice($-S);S=$;break}S=Na;qa=I[y++];ia=I[y++]}}m!=null&&p==null&&E(" ","CodeMirror-selected")}D&&G.push("</pre>");return G.join("")}};k.prototype={addChange:function(m,p,D){this.undone.length=
0;var y=+new Date,E=this.done[this.done.length-1];if(y-this.time>400||!E||E.start>m+p||E.start+E.added<m-E.added+E.old.length)this.done.push({start:m,added:p,old:D});else{var G=0;if(m<E.start){for(var I=E.start-m-1;I>=0;--I)E.old.unshift(D[I]);E.added+=E.start-m;E.start=m}else if(E.start<m){G=m-E.start;p+=G}I=E.added-G;for(m=D.length;I<m;++I)E.old.push(D[I]);if(E.added<p)E.added=p}this.time=y}};A.prototype={stop:function(){o.call(this.e)},target:function(){return this.e.target||this.e.srcElement},
button:function(){if(this.e.which)return this.e.which;else if(this.e.button&1)return 1;else if(this.e.button&2)return 3;else if(this.e.button&4)return 2},pageX:function(){if(this.e.pageX!=null)return this.e.pageX;var m=this.target().ownerDocument;return this.e.clientX+m.body.scrollLeft+m.documentElement.scrollLeft},pageY:function(){if(this.e.pageY!=null)return this.e.pageY;var m=this.target().ownerDocument;return this.e.clientY+m.body.scrollTop+m.documentElement.scrollTop}};J.prototype={set:function(m,
p){clearTimeout(this.id);this.id=setTimeout(p,m)}};var Da=function(){var m=document.createElement("pre");m.innerHTML=" ";return!m.innerHTML}(),la=/gecko\/\d{7}/i.test(navigator.userAgent),bc=/MSIE \d/.test(navigator.userAgent),cc=/Apple Computer/.test(navigator.vendor),cb="\n";(function(){var m=document.createElement("textarea");m.value="foo\nbar";if(m.value.indexOf("\r")>-1)cb="\r\n"})();for(var hb=8,Vb=/Mac/.test(navigator.platform),ab={},mb=35;mb<=40;++mb)ab[mb]=ab["c"+mb]=true;a.htmlEscape=N;
var Sa="\n\nb".split(/\n/).length!=3?function(m){for(var p=0,D,y=[];(D=m.indexOf("\n",p))>-1;){y.push(m.slice(p,m.charAt(D-1)=="\r"?D-1:D));p=D+1}y.push(m.slice(p));return y}:function(m){return m.split(/\r?\n/)};a.splitLines=Sa;if(window.getSelection)var vb=function(m){try{return{start:m.selectionStart,end:m.selectionEnd}}catch(p){return null}},db=cc?function(m,p,D){if(p==D)m.setSelectionRange(p,D);else{m.setSelectionRange(p,D-1);window.getSelection().modify("extend","forward","character")}}:function(m,
p,D){try{m.setSelectionRange(p,D)}catch(y){}};else{vb=function(m){try{var p=m.ownerDocument.selection.createRange()}catch(D){return null}if(!p||p.parentElement()!=m)return null;var y=m.value,E=y.length,G=m.createTextRange();G.moveToBookmark(p.getBookmark());var I=m.createTextRange();I.collapse(false);if(G.compareEndPoints("StartToEnd",I)>-1)return{start:E,end:E};m=-G.moveStart("character",-E);for(p=y.indexOf("\r");p>-1&&p<m;p=y.indexOf("\r",p+1),m++);if(G.compareEndPoints("EndToEnd",I)>-1)return{start:m,
end:E};E=-G.moveEnd("character",-E);for(p=y.indexOf("\r");p>-1&&p<E;p=y.indexOf("\r",p+1),E++);return{start:m,end:E}};db=function(m,p,D){var y=m.createTextRange();y.collapse(true);var E=y.duplicate(),G=0;m=m.value;for(var I=m.indexOf("\n");I>-1&&I<p;I=m.indexOf("\n",I+1))++G;for(y.move("character",p-G);I>-1&&I<D;I=m.indexOf("\n",I+1))++G;E.move("character",D-G);y.setEndPoint("EndToEnd",E);y.select()}}a.defineMode("null",function(){return{token:function(m){m.skipToEnd()}}});a.defineMIME("text/plain",
"null");return a}();Ext.ns("Ext.ux.form");
Ext.ux.form.FileUploadField=Ext.extend(Ext.form.TextField,{readOnly:true,autoSize:Ext.emptyFn,iconClsSelectFile:"x-form-file-icon",iconClsClearFile:"x-form-file-clear-icon",iconClsDownloadFile:"x-form-file-download-icon",constructor:function(a,b){if(b){if(b.prefixUploadField)this.prefixUploadField=b.prefixUploadField;if(b.fileUrl)this.fileUrl=b.fileUrl;if(a.readOnly)this.readOnlyAll=true;this.possibleFileExtensions=b.possibleFileExtensions?b.possibleFileExtensions:""}Ext.ux.form.FileUploadField.superclass.constructor.call(this,
a,b)},initComponent:function(){Ext.ux.form.FileUploadField.superclass.initComponent.call(this);this.addEvents("fileselected")},onRender:function(a,b){Ext.ux.form.FileUploadField.superclass.onRender.call(this,a,b);this.value=this.getFileName();this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.createFileInput();var d=Ext.applyIf(this.buttonCfg||{},{iconCls:this.iconClsSelectFile});this.buttonFile=new Ext.Button(Ext.apply(d,{renderTo:this.wrap,
width:16,cls:"x-form-file-btn"+(d.iconCls?" x-btn-icon":""),tooltip:{text:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0444\u0430\u0439\u043b",width:150}}));this.buttonClear=new Ext.Button({renderTo:this.wrap,width:16,cls:"x-form-file-clear",iconCls:this.iconClsClearFile,handler:this.clickClearField,scope:this,hidden:this.value?false:true,tooltip:{text:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",width:65}});this.renderHelperBtn();this.bindListeners();this.resizeEl=this.positionEl=this.wrap;
if(this.readOnlyAll){this.buttonFile.setDisabled(true);this.buttonFile.getEl().setStyle("z-index",3);this.buttonClear.setDisabled(true);this.getHelperBtn()&&this.getHelperBtn().setDisabled(true)}},renderHelperBtn:function(){this.buttonDownload=new Ext.Button({renderTo:this.wrap,width:16,cls:"x-form-file-download",iconCls:this.iconClsDownloadFile,handler:this.clickDownload,scope:this,hidden:this.value?false:true,tooltip:{text:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c",width:65}})},getHelperBtn:function(){return this.buttonDownload},
bindListeners:function(){this.fileInput.on({scope:this,mouseenter:function(){this.buttonFile.addClass(["x-btn-over","x-btn-focus"])},mouseleave:function(){this.buttonFile.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},mousedown:function(){this.buttonFile.addClass("x-btn-click")},mouseup:function(){this.buttonFile.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},change:function(){if(this.isFileExtensionOK()){var a=this.fileInput.dom.value;this.setValue(a);this.fireEvent("fileselected",
this,a);if(a){this.fileUrl=null;if(!this.buttonClear.isVisible()){this.buttonClear.show();this.el.setWidth(this.el.getWidth()-this.buttonClear.getWidth())}}}else{Ext.Msg.show({title:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435",msg:"\u041d\u0435\u0432\u0435\u0440\u043d\u043e\u0435 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435 \u0444\u0430\u0439\u043b\u0430",buttons:Ext.Msg.OK,fn:Ext.emptyFn,animEl:"elId",icon:Ext.MessageBox.WARNING});this.reset()}}})},createFileInput:function(){this.fileInput=
this.wrap.createChild({id:this.getFileInputId(),name:(this.prefixUploadField||"")+this.name,cls:"x-form-file",tag:"input",type:"file",size:1,width:20});Ext.QuickTips.unregister(this.fileInput);Ext.QuickTips.register({target:this.fileInput,text:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0444\u0430\u0439\u043b",width:86,dismissDelay:1E4})},reset:function(){this.fileInput.remove();this.createFileInput();this.bindListeners();Ext.ux.form.FileUploadField.superclass.reset.call(this)},getFileInputId:function(){return this.id+
"-file"},onResize:function(a,b){Ext.ux.form.FileUploadField.superclass.onResize.call(this,a,b);this.wrap.setWidth(a);a=this.wrap.getWidth()-this.buttonFile.getEl().getWidth();var d=this.buttonClear.getWidth();if(d)a-=d;if(d=this.getHelperBtn()?this.getHelperBtn().getWidth():0)a-=d;Ext.isWebKit?this.el.setWidth(a+5):this.el.setWidth(a)},onDestroy:function(){Ext.ux.form.FileUploadField.superclass.onDestroy.call(this);Ext.QuickTips.unregister(this.fileInput);Ext.destroy(this.fileInput,this.buttonFile,
this.buttonClear,this.getHelperBtn(),this.wrap)},onDisable:function(){Ext.ux.form.FileUploadField.superclass.onDisable.call(this);this.doDisable(true)},onEnable:function(){Ext.ux.form.FileUploadField.superclass.onEnable.call(this);this.doDisable(false)},doDisable:function(a){this.fileInput.dom.disabled=a;this.buttonFile.setDisabled(a);this.buttonClear.setDisabled(a);this.getHelperBtn()&&this.getHelperBtn().setDisabled(a)},preFocus:Ext.emptyFn,alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,
"tl-tr",[2,0])},clickClearField:function(){this.reset();this.setValue("");var a=this.el.getWidth()+this.buttonClear.getWidth();if(this.getHelperBtn()){a+=this.getHelperBtn().isVisible()?this.getHelperBtn().getWidth():0;this.getHelperBtn().hide()}this.el.setWidth(a);this.buttonClear.hide()},getFileUrl:function(a){return document.location.protocol+"//"+document.location.host+"/"+a},clickDownload:function(){var a=this.getFileUrl(this.fileUrl);a&&window.open(a)},getFileName:function(){return this.value.split("/").reverse()[0]},
isFileExtensionOK:function(){var a=this.fileInput.dom.value.split(".");if(a.length>0)return this.possibleFileExtensions.split(",").indexOf(a[a.length-1].toLowerCase())!=-1;return false},setReadOnly:function(a){Ext.ux.form.FileUploadField.superclass.setReadOnly.call(this,a)}});Ext.reg("fileuploadfield",Ext.ux.form.FileUploadField);Ext.form.FileUploadField=Ext.ux.form.FileUploadField;Ext.ns("Ext.ux.form");
Ext.ux.form.ImageUploadField=Ext.extend(Ext.form.FileUploadField,{iconClsSelectFile:"x-form-image-icon",iconClsClearFile:"x-form-image-clear-icon",iconClsPreviewImage:"x-form-image-preview-icon",constructor:function(a,b){if(b){if(b.thumbnailWidth)this.thumbnailWidth=b.thumbnailWidth;if(b.thumbnailHeight)this.thumbnailHeight=b.thumbnailHeight;if(b.prefixThumbnailImg)this.prefixThumbnailImg=b.prefixThumbnailImg;if(b.thumbnail)this.thumbnail=b.thumbnail;if(b.fileUrl){var d=b.fileUrl.split("/"),e=d.slice(0,
d.length-1);d=d[d.length-1];var g=this.prefixThumbnailImg||"";e=String.format("{0}/{1}{2}",e.join("/"),g,d);this.previewTip=new Ext.QuickTip({id:"preview_tip_window",html:String.format('<a href="{0}" rel="lightbox"><image src="{1}" WIDTH={2} HEIGHT={3} OnClick=Ext.getCmp("preview_tip_window").hide()></a>',b.fileUrl,this.getFileUrl(e),this.thumbnailWidth,this.thumbnailHeight),autoHide:false,width:this.thumbnailWidth+10,height:this.thumbnailHeight+10})}}Ext.ux.form.ImageUploadField.superclass.constructor.call(this,
a,b)},renderHelperBtn:function(){if(this.thumbnail)this.buttonPreview=new Ext.Button({renderTo:this.wrap,width:16,cls:"x-form-file-download",iconCls:this.iconClsPreviewImage,handler:this.clickHelperBtn,scope:this,hidden:this.value?false:true,tooltip:{text:"\u041f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043f\u043e\u043a\u0430\u0437",width:140}})},getHelperBtn:function(){return this.buttonPreview},clickHelperBtn:function(){var a=this.getEl(),b=a.getXY();
this.previewTip.showAt([b[0],b[1]+a.getHeight()])},createFileInput:function(){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:(this.prefixUploadField||"")+this.name,cls:"x-form-file",tag:"input",type:"file",size:1,width:20});Ext.QuickTips.unregister(this.fileInput);Ext.QuickTips.register({target:this.fileInput,text:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435",width:130,dismissDelay:1E4})},onDestroy:function(){Ext.ux.form.ImageUploadField.superclass.onDestroy.call(this);
Ext.destroy(this.previewTip)}});Ext.ux.Lightbox.register("a[rel^=lightbox]");Ext.reg("imageuploadfield",Ext.ux.form.ImageUploadField);function createAdvancedTreeGrid(a,b){return new Ext.m3.AdvancedTreeGrid(a,b)}function createGridPanel(a,b){return a.editor?new Ext.m3.EditorGridPanel(a,b):new Ext.m3.GridPanel(a,b)}function createObjectGrid(a,b){return a.editor?new Ext.m3.EditorObjectGrid(a,b):new Ext.m3.ObjectGrid(a,b)}function createObjectTree(a,b){return new Ext.m3.ObjectTree(a,b)}
function createAdvancedComboBox(a,b){return new Ext.m3.AdvancedComboBox(a,b)}function createAdvancedDataField(a,b){return new Ext.m3.AdvancedDataField(a,b)}
Ext.onReady(function(){Ext.override(Ext.Window,{tmpModal:false,manager:new Ext.WindowGroup,constrain:true,activateChildWindow:function(){this.toFront()},listeners:{beforeshow:function(){var a=Ext.get(this.renderTo);a&&a.getHeight()<this.getHeight()&&this.setHeight(a.getHeight());if(this.parentWindow){this.parentWindow.setDisabled(true);this.parentWindow.el.removeClass("x-masked-relative");this.parentWindow.on("activate",this.activateChildWindow,this);this.modal=false;this.tmpModal=true;if(window.AppDesktop)(a=
AppDesktop.getDesktop().taskbar.tbPanel.getTabWin(this.parentWindow))&&a.mask()}if(this.modal){(a=Ext.get("ux-taskbar"))&&a.mask();(a=Ext.get("ux-toptoolbar"))&&a.mask()}},beforeclose:function(){if(this.tmpModal&&this.parentWindow){this.parentWindow.un("activate",this.activateChildWindow,this);this.parentWindow.setDisabled(false);this.parentWindow.toFront();if(window.AppDesktop){var a=AppDesktop.getDesktop().taskbar.tbPanel.getTabWin(this.parentWindow);a&&a.unmask()}}if(this.modal){(a=Ext.get("ux-taskbar"))&&
a.unmask();(a=Ext.get("ux-toptoolbar"))&&a.unmask()}},hide:function(){if(this.modal)if(!this.parentWindow){var a=Ext.get("ux-taskbar");a&&a.unmask();(a=Ext.get("ux-toptoolbar"))&&a.unmask()}}}})});
Ext.override(Ext.ux.tree.TreeGrid,{fitColumns:function(){var a=this.getInnerWidth()-Ext.num(this.scrollOffset,Ext.getScrollBarWidth()),b=this.getTotalColumnWidth(),d=this.getVisibleColumns(),e,g=0;for(e=0;e<d.length;e++){if(e==d.length-1){d[e].width=a-g-1;break}d[e].width=Math.floor(a/100*(d[e].width*100/b))-1;g+=d[e].width}this.updateColumnWidths()},onResize:function(a,b){Ext.ux.tree.TreeGrid.superclass.onResize.apply(this,arguments);var d=this.innerBody.dom,e=this.innerHd.dom;if(d){if(Ext.isNumber(b))d.style.height=
this.body.getHeight(true)-e.offsetHeight+"px";if(Ext.isNumber(a)){var g=Ext.num(this.scrollOffset,Ext.getScrollBarWidth());if(this.reserveScrollOffset||d.offsetWidth-d.clientWidth>10)this.setScrollOffset(g);else{var h=this;setTimeout(function(){h.setScrollOffset(d.offsetWidth-d.clientWidth>10?g:0)},10)}}this.fitColumns()}}});
Ext.override(Ext.tree.ColumnResizer,{onEnd:function(){var a=this.proxy.getWidth(),b=this.tree;this.proxy.remove();delete this.dragHd;b.columns[this.hdIndex].width=a;b.fitColumns();setTimeout(function(){b.headersDisabled=false},100)}});Ext.override(Ext.tree.TreeNodeUI,{onDblClick:function(a){a.preventDefault();if(!this.disabled)if(this.fireEvent("beforedblclick",this.node,a)!==false){this.checkbox&&this.toggleCheck();this.fireEvent("dblclick",this.node,a)}}});
Ext.override(Ext.form.Action.Submit,{run:function(){var a=this.options,b=this.getMethod(),d=b=="GET";if(a.clientValidation===false||this.form.isValid()){if(a.submitEmptyText===false){var e=[];this.form.items.each(function(g){if(g.el.getValue()==g.emptyText){e.push(g);g.el.dom.value=""}g instanceof Ext.form.CompositeField&&g.items.each(function(h){if(h.el.getValue()==h.emptyText){e.push(h);h.el.dom.value=""}})})}Ext.Ajax.request(Ext.apply(this.createCallback(a),{form:this.form.el.dom,url:this.getUrl(d),
method:b,headers:a.headers,params:!d?this.getParams():null,isUpload:this.form.fileUpload}));a.submitEmptyText===false&&Ext.each(e,function(g){g.applyEmptyText&&g.applyEmptyText()})}else if(a.clientValidation!==false){this.failureType=Ext.form.Action.CLIENT_INVALID;this.form.afterAction(this,false)}}});Ext.override(Ext.PagingToolbar,{onPagingBlur:Ext.emptyFn});
if(Ext.isIE7||Ext.isIE6)Ext.Panel.override({setAutoScroll:function(){if(this.rendered&&this.autoScroll){var a=this.body||this.el;if(a){a.setOverflow("auto");a.dom.style.position="relative"}}}});
Ext.override(Ext.ux.tree.TreeGridNodeUI,{renderElements:function(a,b,d,e){var g=a.getOwnerTree(),h=Ext.isBoolean(b.checked);h=Ext.isBoolean(b.checked);var k=g.columns,o=k[0],w,A,B;this.indentMarkup=a.parentNode?a.parentNode.ui.getChildIndent():"";A=['<tbody class="x-tree-node">','<tr ext:tree-node-id="',a.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',b.cls,'">','<td class="x-treegrid-col">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,
'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',b.icon||this.emptyIcon,'" class="x-tree-node-icon',b.icon?" x-tree-node-inline-icon":"",b.iconCls?" "+b.iconCls:"",'" unselectable="on" />',h?'<input class="x-tree-node-cb" type="checkbox" '+(b.checked?'checked="checked" />':"/>"):"",'<a hidefocus="on" class="x-tree-node-anchor" href="',b.href?b.href:"#",'" tabIndex="1" ',b.hrefTarget?' target="'+b.hrefTarget+'"':"",">",'<span unselectable="on">',o.tpl?o.tpl.apply(b):b[o.dataIndex]||o.text,"</span></a>",
"</td>"];w=1;for(B=k.length;w<B;w++){o=k[w];A.push('<td class="x-treegrid-col ',o.cls?o.cls:"",'">','<div unselectable="on" class="x-treegrid-text"',o.align?' style="text-align: '+o.align+';"':"",">",o.tpl?o.tpl.apply(b):b[o.dataIndex],"</div>","</td>")}A.push('</tr><tr class="x-tree-node-ct"><td colspan="',k.length,'">','<table class="x-treegrid-node-ct-table" cellpadding="0" cellspacing="0" style="table-layout: fixed; display: none; width: ',g.innerCt.getWidth(),'px;"><colgroup>');w=0;for(B=k.length;w<
B;w++)A.push('<col style="width: ',k[w].hidden?0:k[w].width,'px;" />');A.push("</colgroup></table></td></tr></tbody>");this.wrap=e!==true&&a.nextSibling&&a.nextSibling.ui.getEl()?Ext.DomHelper.insertHtml("beforeBegin",a.nextSibling.ui.getEl(),A.join("")):Ext.DomHelper.insertHtml("beforeEnd",d,A.join(""));this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1].firstChild.firstChild;a=this.elNode.firstChild.childNodes;this.indentNode=a[0];this.ecNode=a[1];this.iconNode=a[2];index=3;
if(h){this.checkbox=a[3];this.checkbox.defaultChecked=this.checkbox.checked;index++}this.anchor=a[index];this.textNode=a[index].firstChild}});Ext.override(Ext.ux.tree.TreeGrid,{getChecked:function(a,b){b=b||this.root;var d=[];b.cascade(function(){if(this.attributes.checked)d.push(!a?this:a=="id"?this.id:this.attributes[a])});return d}});
