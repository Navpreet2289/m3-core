Ext.ns("Ext.ux.plugins.grid");Ext.ux.plugins.grid.CellToolTips=function(a){var b;if(Ext.isArray(a)){b=a;a={}}else b=a.ajaxTips;Ext.ux.plugins.grid.CellToolTips.superclass.constructor.call(this,a);if(a.tipConfig)this.tipConfig=a.tipConfig;this.ajaxTips=b};
Ext.extend(Ext.ux.plugins.grid.CellToolTips,Ext.util.Observable,{version:1.3,ajaxTips:false,tipTpls:false,tipFns:false,tipUrls:"",tipConfig:{},request:false,init:function(a){if(this.ajaxTips){this.tipTpls={};this.tipFns={};this.tipAfterFns={};this.tipUrls={};Ext.each(this.ajaxTips,function(b){this.tipTpls[b.field]=new Ext.XTemplate(b.tpl);if(b.url)this.tipUrls[b.field]=b.url;if(b.fn)this.tipFns[b.field]=b.fn;if(b.afterFn)this.tipAfterFns[b.field]=b.afterFn;if(b.tipConfig)this.tipConfig=b.tipConfig},
this);delete this.ajaxTips;a.on("render",this.onGridRender.createDelegate(this))}},setFieldTpl:function(a,b){this.tipTpls[a]=Ext.isObject(b)?b:new Ext.XTemplate(b)},onGridRender:function(a){if(this.tipTpls){Ext.apply(this.tipConfig,{target:a.getView().mainBody,delegate:".x-grid3-cell-inner",renderTo:document.body,finished:false});Ext.applyIf(this.tipConfig,{trackMouse:true});this.tip=new Ext.ToolTip(this.tipConfig);this.tip.ctt=this;this.tip.on("beforeshow",this.beforeTipShow.createDelegate(this.tip,
[this,a],true));this.tip.on("hide",this.hideTip)}},beforeTipShow:function(a,b,e){var f=e.getView().findCellIndex(a.triggerElement);f=e.getColumnModel().getDataIndex(f);if(!b.tipTpls[f])return false;if(a.finished)a.body.dom.innerHTML=a.ctt.tipTpls[f].apply(a.tipdata);else{var g=typeof b.tipUrls[f]=="string",h=e.getView().findRowIndex(a.triggerElement),j=e.getStore().getAt(h);if(e.CellToolTipCondition&&e.CellToolTipCondition(h,j)===false)return false;h=j.copy().data;if(g){b.loadDetails(b.tipFns[f]?
b.tipFns[f](h):h,a,e,b,f);a.body.dom.innerHTML="Loading..."}else a.body.dom.innerHTML=b.tipTpls[f].apply(b.tipFns[f]?b.tipFns[f](j.data):j.data)}},hideTip:function(a){a.finished=false},loadDetails:function(a,b,e,f,g){Ext.Ajax.request({url:f.tipUrls[g],params:a,method:"POST",success:function(h){b.finished=true;b.tipdata=Ext.decode(h.responseText);if(f.tipAfterFns[g])b.tipdata=f.tipAfterFns[g](b.tipdata);b.show()}})}});Ext.ns("Ext.calendar");
(function(){Ext.apply(Ext.calendar,{Date:{diffDays:function(a,b){day=864E5;diff=b.clearTime(true).getTime()-a.clearTime(true).getTime();return Math.ceil(diff/day)},copyTime:function(a,b){var e=b.clone();e.setHours(a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds());return e},compare:function(a,b,e){if(e!==true){a=a.clone();a.setMilliseconds(0);b=b.clone();b.setMilliseconds(0)}return b.getTime()-a.getTime()},maxOrMin:function(a,b){for(var e=a?0:Number.MAX_VALUE,f=0,g=b.length;f<g;f++)e=
Math[a?"max":"min"](e,b[f].getTime());return new Date(e)},max:function(){return this.maxOrMin.apply(this,[true,arguments])},min:function(){return this.maxOrMin.apply(this,[false,arguments])}}})})();
Ext.calendar.DayHeaderTemplate=function(a){Ext.apply(this,a);this.allDayTpl=new Ext.calendar.BoxLayoutTemplate(a);this.allDayTpl.compile();Ext.calendar.DayHeaderTemplate.superclass.constructor.call(this,'<div class="ext-cal-hd-ct">','<table class="ext-cal-hd-days-tbl" cellspacing="0" cellpadding="0">',"<tbody>","<tr>",'<td class="ext-cal-gutter"></td>','<td class="ext-cal-hd-days-td"><div class="ext-cal-hd-ad-inner">{allDayTpl}</div></td>','<td class="ext-cal-gutter-rt"></td>',"</tr>","</tobdy>",
"</table>","</div>")};Ext.extend(Ext.calendar.DayHeaderTemplate,Ext.XTemplate,{applyTemplate:function(a){return Ext.calendar.DayHeaderTemplate.superclass.applyTemplate.call(this,{allDayTpl:this.allDayTpl.apply(a)})}});Ext.calendar.DayHeaderTemplate.prototype.apply=Ext.calendar.DayHeaderTemplate.prototype.applyTemplate;
Ext.calendar.DayBodyTemplate=function(a){Ext.apply(this,a);Ext.calendar.DayBodyTemplate.superclass.constructor.call(this,'<table class="ext-cal-bg-tbl" cellspacing="0" cellpadding="0">',"<tbody>",'<tr height="1">','<td class="ext-cal-gutter"></td>','<td colspan="{dayCount}">','<div class="ext-cal-bg-rows">','<div class="ext-cal-bg-rows-inner">','<tpl for="times">','<div class="ext-cal-bg-row">','<div class="ext-cal-bg-row-div ext-row-{[xindex]}"></div>',"</div>","</tpl>","</div>","</div>","</td>",
"</tr>","<tr>",'<td class="ext-cal-day-times">','<tpl for="times">','<div class="ext-cal-bg-row">','<div class="ext-cal-day-time-inner">{.}</div>',"</div>","</tpl>","</td>",'<tpl for="days">','<td class="ext-cal-day-col">','<div class="ext-cal-day-col-inner">','<div id="{[this.id]}-day-col-{.:date("Ymd")}" class="ext-cal-day-col-gutter"></div>',"</div>","</td>","</tpl>","</tr>","</tbody>","</table>")};
Ext.extend(Ext.calendar.DayBodyTemplate,Ext.XTemplate,{applyTemplate:function(a){this.today=(new Date).clearTime();this.dayCount=this.dayCount||1;var b=0,e=[];a=a.viewStart.clone();for(var f;b<this.dayCount;b++)e[b]=a.add(Date.DAY,b);f=[];a=(new Date).clearTime();for(b=0;b<24;b++){f.push(a.format("ga"));a=a.add(Date.HOUR,1)}return Ext.calendar.DayBodyTemplate.superclass.applyTemplate.call(this,{days:e,dayCount:e.length,times:f})}});Ext.calendar.DayBodyTemplate.prototype.apply=Ext.calendar.DayBodyTemplate.prototype.applyTemplate;
Ext.calendar.DayViewTemplate=function(a){Ext.apply(this,a);this.headerTpl=new Ext.calendar.DayHeaderTemplate(a);this.headerTpl.compile();this.bodyTpl=new Ext.calendar.DayBodyTemplate(a);this.bodyTpl.compile();Ext.calendar.DayViewTemplate.superclass.constructor.call(this,'<div class="ext-cal-inner-ct">',"{headerTpl}","{bodyTpl}","</div>")};
Ext.extend(Ext.calendar.DayViewTemplate,Ext.XTemplate,{applyTemplate:function(a){return Ext.calendar.DayViewTemplate.superclass.applyTemplate.call(this,{headerTpl:this.headerTpl.apply(a),bodyTpl:this.bodyTpl.apply(a)})}});Ext.calendar.DayViewTemplate.prototype.apply=Ext.calendar.DayViewTemplate.prototype.applyTemplate;
Ext.calendar.BoxLayoutTemplate=function(a){Ext.apply(this,a);Ext.calendar.BoxLayoutTemplate.superclass.constructor.call(this,'<tpl for="weeks">','<div id="{[this.id]}-wk-{[xindex-1]}" class="ext-cal-wk-ct" style="top:{[this.getRowTop(xindex, xcount)]}%; height:{[this.getRowHeight(xcount)]}%;">',this.showWeekLinks?'<div id="{weekLinkId}" class="ext-cal-week-link">{weekNum}</div>':"",'<table class="ext-cal-bg-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for=".">','<td id="{[this.id]}-day-{date:date("Ymd")}" class="{cellCls}">&nbsp;</td>',
"</tpl>","</tr>","</tbody>","</table>",'<table class="ext-cal-evt-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for=".">','<td id="{[this.id]}-ev-day-{date:date("Ymd")}" class="{titleCls}"><div>{title}</div></td>',"</tpl>","</tr>","</tbody>","</table>","</div>","</tpl>",{getRowTop:function(b,e){return(b-1)*(100/e)},getRowHeight:function(b){return 100/b}})};
Ext.extend(Ext.calendar.BoxLayoutTemplate,Ext.XTemplate,{applyTemplate:function(a){Ext.apply(this,a);a=0;var b="";b=true;for(var e=false,f=false,g=false,h=false,j=[[]],l=(new Date).clearTime(),k=this.viewStart.clone(),m=this.startDate.getMonth();a<this.weekCount||this.weekCount==-1;a++){if(k>this.viewEnd)break;j[a]=[];for(var n=0;n<this.dayCount;n++){e=k.getTime()===l.getTime();f=b||k.getDate()==1;g=k.getMonth()<m&&this.weekCount==-1;h=k.getMonth()>m&&this.weekCount==-1;if(k.getDay()==1){j[a].weekNum=
this.showWeekNumbers?k.format("W"):"&nbsp;";j[a].weekLinkId="ext-cal-week-"+k.format("Ymd")}if(f)b=e?this.getTodayText():k.format(this.dayCount==1?"l, F j, Y":b?"M j, Y":"M j");else{b=a==0&&this.showHeader!==true?"D j":"j";b=e?this.getTodayText():k.format(b)}j[a].push({title:b,date:k.clone(),titleCls:"ext-cal-dtitle "+(e?" ext-cal-dtitle-today":"")+(a==0?" ext-cal-dtitle-first":"")+(g?" ext-cal-dtitle-prev":"")+(h?" ext-cal-dtitle-next":""),cellCls:"ext-cal-day "+(e?" ext-cal-day-today":"")+(n==0?
" ext-cal-day-first":"")+(g?" ext-cal-day-prev":"")+(h?" ext-cal-day-next":"")});k=k.add(Date.DAY,1);b=false}}return Ext.calendar.BoxLayoutTemplate.superclass.applyTemplate.call(this,{weeks:j})},getTodayText:function(){var a=(new Date).format("l, F j, Y"),b=this.showTodayText!==false?this.todayText:"",e=this.showTime!==false?' <span id="'+this.id+'-clock" class="ext-cal-dtitle-time">'+(new Date).format("g:i a")+"</span>":"",f=b.length>0||e.length>0?" &mdash; ":"";if(this.dayCount==1)return a+f+b+
e;fmt=this.weekCount==1?"D j":"j";return b.length>0?b+e:(new Date).format(fmt)+e}});Ext.calendar.BoxLayoutTemplate.prototype.apply=Ext.calendar.BoxLayoutTemplate.prototype.applyTemplate;
Ext.calendar.MonthViewTemplate=function(a){Ext.apply(this,a);this.weekTpl=new Ext.calendar.BoxLayoutTemplate(a);this.weekTpl.compile();Ext.calendar.MonthViewTemplate.superclass.constructor.call(this,'<div class="ext-cal-inner-ct {extraClasses}">','<div class="ext-cal-hd-ct ext-cal-month-hd">',this.showWeekLinks?'<div class="ext-cal-week-link-hd">&nbsp;</div>':"",'<table class="ext-cal-hd-days-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for="days">','<th class="ext-cal-hd-day{[xindex==1 ? " ext-cal-day-first" : ""]}" title="{.:date("l, F j, Y")}">{.:date("D")}</th>',
"</tpl>","</tr>","</tbody>","</table>","</div>",'<div class="ext-cal-body-ct">{weeks}</div>',"</div>")};Ext.extend(Ext.calendar.MonthViewTemplate,Ext.XTemplate,{applyTemplate:function(a){var b=[],e=this.weekTpl.apply(a);a=a.viewStart;for(var f=0;f<7;f++)b.push(a.add(Date.DAY,f));a=this.showHeader===true?"":"ext-cal-noheader";if(this.showWeekLinks)a+=" ext-cal-week-links";return Ext.calendar.MonthViewTemplate.superclass.applyTemplate.call(this,{days:b,weeks:e,extraClasses:a})}});
Ext.calendar.MonthViewTemplate.prototype.apply=Ext.calendar.MonthViewTemplate.prototype.applyTemplate;
Ext.dd.ScrollManager=function(){var a=Ext.dd.DragDropMgr,b={},e=null,f={},g=function(){a.dragCurrent&&a.refreshCache(a.dragCurrent.groups)},h=function(){if(a.dragCurrent){var k=Ext.dd.ScrollManager,m=f.el.ddScrollConfig?f.el.ddScrollConfig.increment:k.increment;if(k.animate)f.el.scroll(f.dir,m,true,k.animDuration,g);else f.el.scroll(f.dir,m)&&g()}},j=function(){f.id&&clearInterval(f.id);f.id=0;f.el=null;f.dir=""},l=function(k,m){j();f.el=k;f.dir=m;var n=k.ddScrollConfig&&k.ddScrollConfig.frequency?
k.ddScrollConfig.frequency:Ext.dd.ScrollManager.frequency,p=k.ddScrollConfig?k.ddScrollConfig.ddGroup:undefined;if(p===undefined||a.dragCurrent.ddGroup==p)f.id=setInterval(h,n)};a.fireEvents=a.fireEvents.createSequence(function(k,m){if(!(m||!a.dragCurrent)){var n=Ext.dd.ScrollManager;if(!e||e!=a.dragCurrent){e=a.dragCurrent;n.refreshCache()}var p=Ext.lib.Event.getXY(k);p=new Ext.lib.Point(p[0],p[1]);var t,s,u,o;for(t in b)if(b.hasOwnProperty(t)){s=b[t];u=s._region;o=s.ddScrollConfig?s.ddScrollConfig:
n;if(u&&u.contains(p)&&s.isScrollable())if(u.bottom-p.y<=o.vthresh){f.el!=s&&l(s,"down");return}else if(u.right-p.x<=o.hthresh){f.el!=s&&l(s,"left");return}else if(p.y-u.top<=o.vthresh){f.el!=s&&l(s,"up");return}else if(p.x-u.left<=o.hthresh){f.el!=s&&l(s,"right");return}}j()}},a);a.stopDrag=a.stopDrag.createSequence(function(){e=null;j()},a);return{register:function(k){if(Ext.isArray(k))for(var m=0,n=k.length;m<n;m++)this.register(k[m]);else{k=Ext.get(k);b[k.id]=k}},unregister:function(k){if(Ext.isArray(k))for(var m=
0,n=k.length;m<n;m++)this.unregister(k[m]);else{k=Ext.get(k);delete b[k.id]}},vthresh:25,hthresh:25,increment:100,frequency:500,animate:true,animDuration:0.4,refreshCache:function(){for(var k in b)if(b.hasOwnProperty(k))if(typeof b[k]=="object")b[k]._region=b[k].getRegion()}}}();
Ext.calendar.StatusProxy=function(a){Ext.apply(this,a);this.id=this.id||Ext.id();this.el=new Ext.Layer({dh:{id:this.id,cls:"ext-dd-drag-proxy x-dd-drag-proxy "+this.dropNotAllowed,cn:[{cls:"x-dd-drop-icon"},{cls:"ext-dd-ghost-ct",cn:[{cls:"x-dd-drag-ghost"},{cls:"ext-dd-msg"}]}]},shadow:!a||a.shadow!==false});this.ghost=Ext.get(this.el.dom.childNodes[1].childNodes[0]);this.message=Ext.get(this.el.dom.childNodes[1].childNodes[1]);this.dropStatus=this.dropNotAllowed};
Ext.extend(Ext.calendar.StatusProxy,Ext.dd.StatusProxy,{moveEventCls:"ext-cal-dd-move",addEventCls:"ext-cal-dd-add",update:function(a){if(typeof a=="string")this.ghost.update(a);else{this.ghost.update("");a.style.margin="0";this.ghost.dom.appendChild(a)}if(a=this.ghost.dom.firstChild){Ext.fly(a).setStyle("float","none").setHeight("auto");Ext.getDom(a).id+="-ddproxy"}},updateMsg:function(a){this.message.update(a)}});
Ext.calendar.DragZone=Ext.extend(Ext.dd.DragZone,{ddGroup:"CalendarDD",eventSelector:".ext-cal-evt",constructor:function(a,b){if(!Ext.calendar._statusProxyInstance)Ext.calendar._statusProxyInstance=new Ext.calendar.StatusProxy;this.proxy=Ext.calendar._statusProxyInstance;Ext.calendar.DragZone.superclass.constructor.call(this,a,b)},getDragData:function(a){var b=a.getTarget(this.eventSelector,3);if(b){a=this.view.getEventRecordFromEl(b);return{type:"eventdrag",ddel:b,eventStart:a.data[Ext.calendar.EventMappings.StartDate.name],
eventEnd:a.data[Ext.calendar.EventMappings.EndDate.name],proxy:this.proxy}}b=this.view.getDayAt(a.getPageX(),a.getPageY());if(b.el)return{type:"caldrag",start:b.date,proxy:this.proxy};return null},onInitDrag:function(a,b){if(this.dragData.ddel){var e=this.dragData.ddel.cloneNode(true),f=Ext.fly(e).child("dl");Ext.fly(e).setWidth("auto");f&&f.setHeight("auto");this.proxy.update(e);this.onStartDrag(a,b)}else this.dragData.start&&this.onStartDrag(a,b);this.view.onInitDrag();return true},afterRepair:function(){if(Ext.enableFx&&
this.dragData.ddel)Ext.Element.fly(this.dragData.ddel).highlight(this.hlColor||"c3daf9");this.dragging=false},getRepairXY:function(){if(this.dragData.ddel)return Ext.Element.fly(this.dragData.ddel).getXY()},afterInvalidDrop:function(){Ext.select(".ext-dd-shim").hide()}});
Ext.calendar.DropZone=Ext.extend(Ext.dd.DropZone,{ddGroup:"CalendarDD",eventSelector:".ext-cal-evt",shims:[],getTargetFromEvent:function(a){var b=this.dragOffset||0;b=a.getPageY()-b;a=this.view.getDayAt(a.getPageX(),b);return a.el?a:null},onNodeOver:function(a,b,e,f){b=Ext.calendar.Date;e=f.type=="eventdrag"?a.date:b.min(f.start,a.date);a=f.type=="eventdrag"?a.date.add(Date.DAY,b.diffDays(f.eventStart,f.eventEnd)):b.max(f.start,a.date);if(!this.dragStartDate||!this.dragEndDate||b.diffDays(e,this.dragStartDate)!=
0||b.diffDays(a,this.dragEndDate)!=0){this.dragStartDate=e;this.dragEndDate=a.clearTime().add(Date.DAY,1).add(Date.MILLI,-1);this.shim(e,a);var g=e.format("n/j");if(b.diffDays(e,a)>0)g+="-"+a.format("n/j");a=String.format(f.type=="eventdrag"?this.moveText:this.createText,g);f.proxy.updateMsg(a)}return this.dropAllowed},shim:function(a,b){this.currWeek=-1;var e=a.clone(),f=0,g,h,j=Ext.calendar.Date.diffDays(e,b)+1;for(Ext.each(this.shims,function(k){if(k)k.isActive=false});f++<j;){if(h=this.view.getDayEl(e)){var l=
this.view.getWeekIndex(e);g=this.shims[l];if(!g){g=this.createShim();this.shims[l]=g}if(l!=this.currWeek){g.boxInfo=h.getBox();this.currWeek=l}else{h=h.getBox();g.boxInfo.right=h.right;g.boxInfo.width=h.right-g.boxInfo.x}g.isActive=true}e=e.add(Date.DAY,1)}Ext.each(this.shims,function(k){if(k)if(k.isActive){k.show();k.setBox(k.boxInfo)}else k.isVisible()&&k.hide()})},createShim:function(){if(!this.shimCt){this.shimCt=Ext.get("ext-dd-shim-ct");if(!this.shimCt){this.shimCt=document.createElement("div");
this.shimCt.id="ext-dd-shim-ct";Ext.getBody().appendChild(this.shimCt)}}var a=document.createElement("div");a.className="ext-dd-shim";this.shimCt.appendChild(a);return new Ext.Layer({shadow:false,useDisplay:true,constrain:false},a)},clearShims:function(){Ext.each(this.shims,function(a){a&&a.hide()})},onContainerOver:function(){return this.dropAllowed},onCalendarDragComplete:function(){delete this.dragStartDate;delete this.dragEndDate;this.clearShims()},onNodeDrop:function(a,b,e,f){if(a&&f){if(f.type==
"eventdrag"){b=this.view.getEventRecordFromEl(f.ddel);a=Ext.calendar.Date.copyTime(b.data[Ext.calendar.EventMappings.StartDate.name],a.date);this.view.onEventDrop(b,a);this.onCalendarDragComplete();return true}if(f.type=="caldrag"){this.view.onCalendarEndDrag(this.dragStartDate,this.dragEndDate,this.onCalendarDragComplete.createDelegate(this));return true}}this.onCalendarDragComplete();return false},onContainerDrop:function(){this.onCalendarDragComplete();return false},destroy:function(){Ext.calendar.DropZone.superclass.destroy.call(this);
Ext.destroy(this.shimCt)}});
Ext.calendar.DayViewDragZone=Ext.extend(Ext.calendar.DragZone,{ddGroup:"DayViewDD",resizeSelector:".ext-evt-rsz",getDragData:function(a){var b=a.getTarget(this.resizeSelector,2,true);if(b){b=b.parent(this.eventSelector);a=this.view.getEventRecordFromEl(b);return{type:"eventresize",ddel:b.dom,eventStart:a.data[Ext.calendar.EventMappings.StartDate.name],eventEnd:a.data[Ext.calendar.EventMappings.EndDate.name],proxy:this.proxy}}if(b=a.getTarget(this.eventSelector,3)){a=this.view.getEventRecordFromEl(b);return{type:"eventdrag",
ddel:b,eventStart:a.data[Ext.calendar.EventMappings.StartDate.name],eventEnd:a.data[Ext.calendar.EventMappings.EndDate.name],proxy:this.proxy}}b=this.view.getDayAt(a.getPageX(),a.getPageY());if(b.el)return{type:"caldrag",dayInfo:b,proxy:this.proxy};return null}});
Ext.calendar.DayViewDropZone=Ext.extend(Ext.calendar.DropZone,{ddGroup:"DayViewDD",onNodeOver:function(a,b,e,f){var g,h,j;b=this.createText;if(f.type=="caldrag"){if(!this.dragStartMarker){this.dragStartMarker=a.el.parent().createChild({style:"position:absolute;"});this.dragStartMarker.setBox(a.timeBox);this.dragCreateDt=a.date}h=this.dragStartMarker.getBox();h.height=Math.ceil(Math.abs(e.xy[1]-h.y)/a.timeBox.height)*a.timeBox.height;if(e.xy[1]<h.y){h.height+=a.timeBox.height;h.y=h.y-h.height+a.timeBox.height;
j=this.dragCreateDt.add(Date.MINUTE,30)}else a.date=a.date.add(Date.MINUTE,30);this.shim(this.dragCreateDt,h);a=Ext.calendar.Date.copyTime(a.date,this.dragCreateDt);this.dragStartDate=Ext.calendar.Date.min(this.dragCreateDt,a);this.dragEndDate=j||Ext.calendar.Date.max(this.dragCreateDt,a);g=this.dragStartDate.format("g:ia-")+this.dragEndDate.format("g:ia")}else{h=Ext.get(f.ddel);j=h.parent().parent();h=h.getBox();h.width=j.getWidth();if(f.type=="eventdrag"){if(this.dragOffset===undefined){this.dragOffset=
a.timeBox.y-h.y;h.y=a.timeBox.y-this.dragOffset}else h.y=a.timeBox.y;g=a.date.format("n/j g:ia");h.x=a.el.getLeft();this.shim(a.date,h);b=this.moveText}if(f.type=="eventresize"){if(!this.resizeDt)this.resizeDt=a.date;h.x=j.getLeft();h.height=Math.ceil(Math.abs(e.xy[1]-h.y)/a.timeBox.height)*a.timeBox.height;if(e.xy[1]<h.y)h.y-=h.height;else a.date=a.date.add(Date.MINUTE,30);this.shim(this.resizeDt,h);a=Ext.calendar.Date.copyTime(a.date,this.resizeDt);e=Ext.calendar.Date.min(f.eventStart,a);a=Ext.calendar.Date.max(f.eventStart,
a);f.resizeDates={StartDate:e,EndDate:a};g=e.format("g:ia-")+a.format("g:ia");b=this.resizeText}}f.proxy.updateMsg(String.format(b,g));return this.dropAllowed},shim:function(a,b){Ext.each(this.shims,function(f){if(f){f.isActive=false;f.hide()}});var e=this.shims[0];if(!e){e=this.createShim();this.shims[0]=e}e.isActive=true;e.show();e.setBox(b)},onNodeDrop:function(a,b,e,f){if(a&&f){if(f.type=="eventdrag"){b=this.view.getEventRecordFromEl(f.ddel);this.view.onEventDrop(b,a.date);this.onCalendarDragComplete();
delete this.dragOffset;return true}if(f.type=="eventresize"){b=this.view.getEventRecordFromEl(f.ddel);this.view.onEventResize(b,f.resizeDates);this.onCalendarDragComplete();delete this.resizeDt;return true}if(f.type=="caldrag"){Ext.destroy(this.dragStartMarker);delete this.dragStartMarker;delete this.dragCreateDt;this.view.onCalendarEndDrag(this.dragStartDate,this.dragEndDate,this.onCalendarDragComplete.createDelegate(this));return true}}this.onCalendarDragComplete();return false}});
Ext.calendar.EventMappings={EventId:{name:"EventId",mapping:"id",type:"int"},CalendarId:{name:"CalendarId",mapping:"cid",type:"int"},Title:{name:"Title",mapping:"title",type:"string"},StartDate:{name:"StartDate",mapping:"start",type:"date",dateFormat:"c"},EndDate:{name:"EndDate",mapping:"end",type:"date",dateFormat:"c"},Location:{name:"Location",mapping:"loc",type:"string"},Notes:{name:"Notes",mapping:"notes",type:"string"},Url:{name:"Url",mapping:"url",type:"string"},IsAllDay:{name:"IsAllDay",mapping:"ad",
type:"boolean"},Reminder:{name:"Reminder",mapping:"rem",type:"string"},IsNew:{name:"IsNew",mapping:"n",type:"boolean"}};
(function(){var a=Ext.calendar.EventMappings;Ext.calendar.EventRecord=Ext.data.Record.create([a.EventId,a.CalendarId,a.Title,a.StartDate,a.EndDate,a.Location,a.Notes,a.Url,a.IsAllDay,a.Reminder,a.IsNew]);Ext.calendar.EventRecord.reconfigure=function(){Ext.calendar.EventRecord=Ext.data.Record.create([a.EventId,a.CalendarId,a.Title,a.StartDate,a.EndDate,a.Location,a.Notes,a.Url,a.IsAllDay,a.Reminder,a.IsNew])}})();
Ext.calendar.MonthDayDetailView=Ext.extend(Ext.BoxComponent,{initComponent:function(){Ext.calendar.CalendarView.superclass.initComponent.call(this);this.addEvents({eventsrendered:true});if(!this.el)this.el=document.createElement("div")},afterRender:function(){this.tpl=this.getTemplate();Ext.calendar.MonthDayDetailView.superclass.afterRender.call(this);this.el.on({click:this.view.onClick,mouseover:this.view.onMouseOver,mouseout:this.view.onMouseOut,scope:this.view})},getTemplate:function(){if(!this.tpl)this.tpl=
new Ext.XTemplate('<div class="ext-cal-mdv x-unselectable">','<table class="ext-cal-mvd-tbl" cellpadding="0" cellspacing="0">',"<tbody>",'<tpl for=".">','<tr><td class="ext-cal-ev">{markup}</td></tr>',"</tpl>","</tbody>","</table>","</div>");this.tpl.compile();return this.tpl},update:function(a){this.date=a;this.refresh()},refresh:function(){if(this.rendered){var a=this.view.getEventTemplate(),b=[];evts=this.store.queryBy(function(e){var f=this.date.clearTime(true).getTime(),g=e.data[Ext.calendar.EventMappings.StartDate.name].clearTime(true).getTime(),
h=f==g,j=false;if(!h){e=e.data[Ext.calendar.EventMappings.EndDate.name].clearTime(true).getTime();j=g<f&&e>=f}return h||j},this);evts.each(function(e){e=e.data;var f=Ext.calendar.EventMappings;e._renderAsAllDay=e[f.IsAllDay.name]||Ext.calendar.Date.diffDays(e[f.StartDate.name],e[f.EndDate.name])>0;e.spanLeft=Ext.calendar.Date.diffDays(e[f.StartDate.name],this.date)>0;e.spanRight=Ext.calendar.Date.diffDays(this.date,e[f.EndDate.name])>0;e.spanCls=e.spanLeft?e.spanRight?"ext-cal-ev-spanboth":"ext-cal-ev-spanleft":
e.spanRight?"ext-cal-ev-spanright":"";b.push({markup:a.apply(this.getTemplateEventData(e))})},this);this.tpl.overwrite(this.el,b);this.fireEvent("eventsrendered",this,this.date,evts.getCount())}},getTemplateEventData:function(a){a=this.view.getTemplateEventData(a);a._elId="dtl-"+a._elId;return a}});Ext.reg("monthdaydetailview",Ext.calendar.MonthDayDetailView);
Ext.calendar.CalendarPicker=Ext.extend(Ext.form.ComboBox,{fieldLabel:"Calendar",valueField:"CalendarId",displayField:"Title",triggerAction:"all",mode:"local",forceSelection:true,width:200,initComponent:function(){Ext.calendar.CalendarPicker.superclass.initComponent.call(this);this.tpl=this.tpl||'<tpl for="."><div class="x-combo-list-item ext-color-{'+this.valueField+'}"><div class="ext-cal-picker-icon">&nbsp;</div>{'+this.displayField+"}</div></tpl>"},afterRender:function(){Ext.calendar.CalendarPicker.superclass.afterRender.call(this);
this.wrap=this.el.up(".x-form-field-wrap");this.wrap.addClass("ext-calendar-picker");this.icon=Ext.DomHelper.append(this.wrap,{tag:"div",cls:"ext-cal-picker-icon ext-cal-picker-mainicon"})},setValue:function(a){this.wrap.removeClass("ext-color-"+this.getValue());if(!a&&this.store!==undefined)a=this.store.getAt(0).data.CalendarId;Ext.calendar.CalendarPicker.superclass.setValue.call(this,a);this.wrap.addClass("ext-color-"+a)}});Ext.reg("calendarpicker",Ext.calendar.CalendarPicker);
Ext.calendar.WeekEventRenderer=function(){var a=function(b,e,f){var g;if(b=Ext.get(b+"-wk-"+e)){b=b.child(".ext-cal-evt-tbl",true);(g=b.tBodies[0].childNodes[f+1])||(g=Ext.DomHelper.append(b.tBodies[0],"<tr></tr>"))}return Ext.get(g)};return{render:function(b){for(var e=0,f=b.eventGrid,g=b.viewStart.clone(),h=b.tpl,j=b.maxEventsPerDay!=undefined?b.maxEventsPerDay:999,l=b.weekCount<1?6:b.weekCount,k=b.weekCount==1?b.dayCount:7,m;e<l;e++)if(!f[e]||f[e].length==0){if(l==1){n=a(b.id,e,0);m={tag:"td",
cls:"ext-cal-ev",id:b.id+"-empty-0-day-"+g.format("Ymd"),html:"&nbsp;"};if(k>1)m.colspan=k;Ext.DomHelper.append(n,m)}g=g.add(Date.DAY,7)}else for(var n,p=0,t=f[e],s=g.clone(),u=s.add(Date.DAY,k).add(Date.MILLI,-1);p<k;p++){if(t[p]){for(var o=emptyCells=skipped=0,v=t[p],w=v.length;o<w;o++)if(v[o]){if(emptyCells>0&&o-emptyCells<j){n=a(b.id,e,o-emptyCells);m={tag:"td",cls:"ext-cal-ev",id:b.id+"-empty-"+w+"-day-"+g.format("Ymd")};if(emptyCells>1&&j-o>emptyCells)m.rowspan=Math.min(emptyCells,j-o);Ext.DomHelper.append(n,
m);emptyCells=0}if(o>=j)skipped++;else{m=v[o];if(!m.isSpan||m.isSpanStart){var q=m.data||m.event.data;q._weekIndex=e;q._renderAsAllDay=q[Ext.calendar.EventMappings.IsAllDay.name]||m.isSpanStart;q.spanLeft=q[Ext.calendar.EventMappings.StartDate.name].getTime()<s.getTime();q.spanRight=q[Ext.calendar.EventMappings.EndDate.name].getTime()>u.getTime();q.spanCls=q.spanLeft?q.spanRight?"ext-cal-ev-spanboth":"ext-cal-ev-spanleft":q.spanRight?"ext-cal-ev-spanright":"";n=a(b.id,e,o);m={tag:"td",cls:"ext-cal-ev",
cn:h.apply(b.templateDataFn(q))};q=Ext.calendar.Date.diffDays(g,q[Ext.calendar.EventMappings.EndDate.name])+1;q=Math.min(q,k-p);if(q>1)m.colspan=q;Ext.DomHelper.append(n,m)}}}else emptyCells++;if(o>j){n=a(b.id,e,j);Ext.DomHelper.append(n,{tag:"td",cls:"ext-cal-ev-more",id:"ext-cal-ev-more-"+g.format("Ymd"),cn:{tag:"a",html:"+"+skipped+" more..."}})}if(w<b.evtMaxCount[e])if(n=a(b.id,e,w)){m={tag:"td",cls:"ext-cal-ev",id:b.id+"-empty-"+(w+1)+"-day-"+g.format("Ymd")};o=b.evtMaxCount[e]-w;if(o>1)m.rowspan=
o;Ext.DomHelper.append(n,m)}}else if(n=a(b.id,e,0)){m={tag:"td",cls:"ext-cal-ev",id:b.id+"-empty-day-"+g.format("Ymd")};if(b.evtMaxCount[e]>1)m.rowSpan=b.evtMaxCount[e];Ext.DomHelper.append(n,m)}g=g.add(Date.DAY,1)}}}}();
Ext.calendar.CalendarView=Ext.extend(Ext.BoxComponent,{startDay:0,spansHavePriority:false,trackMouseOver:true,enableFx:true,enableAddFx:true,enableUpdateFx:false,enableRemoveFx:true,enableDD:true,monitorResize:true,ddCreateEventText:"Create event for {0}",ddMoveEventText:"Move event to {0}",ddResizeEventText:"Update event to {0}",weekCount:1,dayCount:1,eventSelector:".ext-cal-evt",eventOverClass:"ext-evt-over",eventElIdDelimiter:"-evt-",dayElIdDelimiter:"-day-",getEventBodyMarkup:Ext.emptyFn,getEventTemplate:Ext.emptyFn,
initComponent:function(){this.setStartDate(this.startDate||new Date);Ext.calendar.CalendarView.superclass.initComponent.call(this);this.addEvents({eventsrendered:true,eventclick:true,eventover:true,eventout:true,datechange:true,rangeselect:true,eventmove:true,initdrag:true,dayover:true,dayout:true})},afterRender:function(){Ext.calendar.CalendarView.superclass.afterRender.call(this);this.renderTemplate();this.store&&this.setStore(this.store,true);this.el.on({mouseover:this.onMouseOver,mouseout:this.onMouseOut,
click:this.onClick,resize:this.onResize,scope:this});this.el.unselectable();this.enableDD&&this.initDD&&this.initDD();this.on("eventsrendered",this.forceSize);this.forceSize.defer(100,this)},forceSize:function(){if(this.el&&this.el.child){var a=this.el.child(".ext-cal-hd-ct"),b=this.el.child(".ext-cal-body-ct");if(!(b==null||a==null)){a=a.getHeight();var e=this.el.parent().getSize();b.setHeight(e.height-a)}}},refresh:function(){this.prepareData();this.renderTemplate();this.renderItems()},getWeekCount:function(){var a=
Ext.calendar.Date.diffDays(this.viewStart,this.viewEnd);return Math.ceil(a/this.dayCount)},prepareData:function(){var a=this.startDate.getLastDateOfMonth(),b=0,e=this.viewStart.clone(),f=this.weekCount<1?6:this.weekCount;this.eventGrid=[[]];this.allDayGrid=[[]];this.evtMaxCount=[];for(var g=this.store.queryBy(function(j){return this.isEventVisible(j.data)},this);b<f;b++){this.evtMaxCount[b]=0;if(this.weekCount==-1&&e>a)break;this.eventGrid[b]=this.eventGrid[b]||[];this.allDayGrid[b]=this.allDayGrid[b]||
[];for(d=0;d<this.dayCount;d++){if(g.getCount()>0){var h=g.filterBy(function(j){var l=e.getTime()==j.data[Ext.calendar.EventMappings.StartDate.name].clearTime(true).getTime();j=b==0&&d==0&&e>j.data[Ext.calendar.EventMappings.StartDate.name];return l||j},this);this.sortEventRecordsForDay(h);this.prepareEventGrid(h,b,d)}e=e.add(Date.DAY,1)}}this.currentWeekCount=b},prepareEventGrid:function(a,b,e){var f=0;this.viewStart.clone();var g=this.maxEventsPerDay?this.maxEventsPerDay:999;a.each(function(h){var j=
Ext.calendar.EventMappings,l=Ext.calendar.Date.diffDays(Ext.calendar.Date.max(this.viewStart,h.data[j.StartDate.name]),Ext.calendar.Date.min(this.viewEnd,h.data[j.EndDate.name]))+1;if(l>1||Ext.calendar.Date.diffDays(h.data[j.StartDate.name],h.data[j.EndDate.name])>1){this.prepareEventGridSpans(h,this.eventGrid,b,e,l);this.prepareEventGridSpans(h,this.allDayGrid,b,e,l,true)}else{f=this.findEmptyRowIndex(b,e);this.eventGrid[b][e]=this.eventGrid[b][e]||[];this.eventGrid[b][e][f]=h;if(h.data[j.IsAllDay.name]){f=
this.findEmptyRowIndex(b,e,true);this.allDayGrid[b][e]=this.allDayGrid[b][e]||[];this.allDayGrid[b][e][f]=h}}if(this.evtMaxCount[b]<this.eventGrid[b][e].length)this.evtMaxCount[b]=Math.min(g+1,this.eventGrid[b][e].length);return true},this)},prepareEventGridSpans:function(a,b,e,f,g,h){var j=e,l=f;h=this.findEmptyRowIndex(e,f,h);var k=this.viewStart.clone(),m={event:a,isSpan:true,isSpanStart:true,spanLeft:false,spanRight:f==6};b[e][f]=b[e][f]||[];for(b[e][f][h]=m;--g;){k=k.add(Date.DAY,1);if(k>this.viewEnd)break;
if(++l>6){l=0;j++;h=this.findEmptyRowIndex(j,0)}b[j]=b[j]||[];b[j][l]=b[j][l]||[];b[j][l][h]={event:a,isSpan:true,isSpanStart:l==0,spanLeft:j>e&&l%7==0,spanRight:l==6&&g>1}}},findEmptyRowIndex:function(a,b,e){e=e?this.allDayGrid:this.eventGrid;a=e[a]?e[a][b]||[]:[];b=0;for(e=a.length;b<e;b++)if(a[b]==null)return b;return e},renderTemplate:function(){if(this.tpl){this.tpl.overwrite(this.el,this.getParams());this.lastRenderStart=this.viewStart.clone();this.lastRenderEnd=this.viewEnd.clone()}},disableStoreEvents:function(){this.monitorStoreEvents=
false},enableStoreEvents:function(a){this.monitorStoreEvents=true;a===true&&this.refresh()},onResize:function(){this.refresh()},onInitDrag:function(){this.fireEvent("initdrag",this)},onEventDrop:function(a,b){if(Ext.calendar.Date.compare(a.data[Ext.calendar.EventMappings.StartDate.name],b)!==0){var e=b.getTime()-a.data[Ext.calendar.EventMappings.StartDate.name].getTime();a.set(Ext.calendar.EventMappings.StartDate.name,b);a.set(Ext.calendar.EventMappings.EndDate.name,a.data[Ext.calendar.EventMappings.EndDate.name].add(Date.MILLI,
e));this.fireEvent("eventmove",this,a)}},onCalendarEndDrag:function(a,b,e){this.dragPending=true;var f={};f[Ext.calendar.EventMappings.StartDate.name]=a;f[Ext.calendar.EventMappings.EndDate.name]=b;this.fireEvent("rangeselect",this,f,this.onCalendarEndDragComplete.createDelegate(this,[e]))},onCalendarEndDragComplete:function(a){a();this.dragPending=false},onUpdate:function(a,b,e){if(this.monitorStoreEvents!==false)if(e==Ext.data.Record.COMMIT){this.refresh();this.enableFx&&this.enableUpdateFx&&this.doUpdateFx(this.getEventEls(b.data[Ext.calendar.EventMappings.EventId.name]),
{scope:this})}},doUpdateFx:function(a,b){this.highlightEvent(a,null,b)},onAdd:function(a,b){if(this.monitorStoreEvents!==false){var e=b[0];this.tempEventId=e.id;this.refresh();this.enableFx&&this.enableAddFx&&this.doAddFx(this.getEventEls(e.data[Ext.calendar.EventMappings.EventId.name]),{scope:this})}},doAddFx:function(a,b){a.fadeIn(Ext.apply(b,{duration:2}))},onRemove:function(a,b){if(this.monitorStoreEvents!==false)if(this.enableFx&&this.enableRemoveFx)this.doRemoveFx(this.getEventEls(b.data[Ext.calendar.EventMappings.EventId.name]),
{remove:true,scope:this,callback:this.refresh});else{this.getEventEls(b.data[Ext.calendar.EventMappings.EventId.name]).remove();this.refresh()}},doRemoveFx:function(a,b){a.fadeOut(b)},highlightEvent:function(a,b,e){if(this.enableFx){var f;!(Ext.isIE||Ext.isOpera)?a.highlight(b,e):a.each(function(g){g.highlight(b,Ext.applyIf({attr:"color"},e));(f=g.child(".ext-cal-evm"))&&f.highlight(b,e)},this)}},getEventIdFromEl:function(a){a=Ext.get(a);a=a.id.split(this.eventElIdDelimiter)[1];if(a.indexOf("-")>
-1)a=a.split("-")[0];return a},getEventId:function(a){if(a===undefined&&this.tempEventId)a=this.tempEventId;return a},getEventSelectorCls:function(a,b){return(b?".":"")+this.id+this.eventElIdDelimiter+this.getEventId(a)},getEventEls:function(a){a=Ext.select(this.getEventSelectorCls(this.getEventId(a),true),false,this.el.id);return new Ext.CompositeElement(a)},isToday:function(){var a=(new Date).clearTime().getTime();return this.viewStart.getTime()<=a&&this.viewEnd.getTime()>=a},onDataChanged:function(){this.refresh()},
isEventVisible:function(a){var b=this.viewStart.getTime(),e=this.viewEnd.getTime(),f=Ext.calendar.EventMappings,g=(a.data?a.data[f.StartDate.name]:a[f.StartDate.name]).getTime();f=(a.data?a.data[f.EndDate.name]:a[f.EndDate.name]).add(Date.SECOND,-1).getTime();a=f>=b&&f<=e;f=g<b&&f>e;return g>=b&&g<=e||a||f},isOverlapping:function(a,b){var e=a.data?a.data:a,f=b.data?b.data:b,g=Ext.calendar.EventMappings,h=e[g.StartDate.name].getTime(),j=e[g.EndDate.name].add(Date.SECOND,-1).getTime();e=f[g.StartDate.name].getTime();
f=f[g.EndDate.name].add(Date.SECOND,-1).getTime();if(j<h)j=h;if(f<e)f=e;g=j>=e&&j<=f;j=h<e&&j>f;return h>=e&&h<=f||g||j},getDayEl:function(a){return Ext.get(this.getDayId(a))},getDayId:function(a){if(Ext.isDate(a))a=a.format("Ymd");return this.id+this.dayElIdDelimiter+a},getStartDate:function(){return this.startDate},setStartDate:function(a,b){this.startDate=a.clearTime();this.setViewBounds(a);this.store.load({params:{start:this.viewStart.format("m-d-Y"),end:this.viewEnd.format("m-d-Y")}});b===true&&
this.refresh();this.fireEvent("datechange",this,this.startDate,this.viewStart,this.viewEnd)},setViewBounds:function(a){a=a||this.startDate;var b=a.getDay()-this.startDay;switch(this.weekCount){case 0:case 1:this.viewStart=this.dayCount<7?a:a.add(Date.DAY,-b).clearTime(true);this.viewEnd=this.viewStart.add(Date.DAY,this.dayCount||7).add(Date.SECOND,-1);break;case -1:a=a.getFirstDateOfMonth();b=a.getDay()-this.startDay;this.viewStart=a.add(Date.DAY,-b).clearTime(true);a=a.add(Date.MONTH,1).add(Date.SECOND,
-1);this.viewEnd=a.add(Date.DAY,6-a.getDay());break;default:this.viewStart=a.add(Date.DAY,-b).clearTime(true);this.viewEnd=this.viewStart.add(Date.DAY,this.weekCount*7).add(Date.SECOND,-1)}},getViewBounds:function(){return{start:this.viewStart,end:this.viewEnd}},sortEventRecordsForDay:function(a){a.length<2||a.sort("ASC",function(b,e){var f=b.data,g=e.data,h=Ext.calendar.EventMappings;if(f[h.IsAllDay.name])return-1;else if(g[h.IsAllDay.name])return 1;if(this.spansHavePriority){var j=Ext.calendar.Date.diffDays;
if(j(f[h.StartDate.name],f[h.EndDate.name])>0){if(j(g[h.StartDate.name],g[h.EndDate.name])>0){if(f[h.StartDate.name].getTime()==g[h.StartDate.name].getTime())return g[h.EndDate.name].getTime()-f[h.EndDate.name].getTime();return f[h.StartDate.name].getTime()-g[h.StartDate.name].getTime()}return-1}else if(j(g[h.StartDate.name],g[h.EndDate.name])>0)return 1}return f[h.StartDate.name].getTime()-g[h.StartDate.name].getTime()}.createDelegate(this))},moveTo:function(a,b){if(Ext.isDate(a)){this.setStartDate(a);
b!==false&&this.refresh();return this.startDate}return a},moveNext:function(){return this.moveTo(this.viewEnd.add(Date.DAY,1))},movePrev:function(a){return this.moveDays(-(Ext.calendar.Date.diffDays(this.viewStart,this.viewEnd)+1),a)},moveMonths:function(a,b){return this.moveTo(this.startDate.add(Date.MONTH,a),b)},moveWeeks:function(a,b){return this.moveTo(this.startDate.add(Date.DAY,a*7),b)},moveDays:function(a,b){return this.moveTo(this.startDate.add(Date.DAY,a),b)},moveToday:function(a){return this.moveTo(new Date,
a)},setStore:function(a,b){if(!b&&this.store){this.store.un("datachanged",this.onDataChanged,this);this.store.un("add",this.onAdd,this);this.store.un("remove",this.onRemove,this);this.store.un("update",this.onUpdate,this);this.store.un("clear",this.refresh,this)}if(a){a.on("datachanged",this.onDataChanged,this);a.on("add",this.onAdd,this);a.on("remove",this.onRemove,this);a.on("update",this.onUpdate,this);a.on("clear",this.refresh,this)}(this.store=a)&&a.getCount()>0&&this.refresh()},getEventRecord:function(a){return this.store.getAt(this.store.find(Ext.calendar.EventMappings.EventId.name,
a))},getEventRecordFromEl:function(a){return this.getEventRecord(this.getEventIdFromEl(a))},getParams:function(){return{viewStart:this.viewStart,viewEnd:this.viewEnd,startDate:this.startDate,dayCount:this.dayCount,weekCount:this.weekCount,title:this.getTitle()}},getTitle:function(){return this.startDate.format("F Y")},onClick:function(a){if(a=a.getTarget(this.eventSelector,5)){this.fireEvent("eventclick",this,this.getEventRecord(this.getEventIdFromEl(a)),a);return true}},onMouseOver:function(a,b){if(this.trackMouseOver!==
false&&(this.dragZone==undefined||!this.dragZone.dragging))this.handleEventMouseEvent(a,b,"over")||this.handleDayMouseEvent(a,b,"over")},onMouseOut:function(a,b){if(this.trackMouseOver!==false&&(this.dragZone==undefined||!this.dragZone.dragging))this.handleEventMouseEvent(a,b,"out")||this.handleDayMouseEvent(a,b,"out")},handleEventMouseEvent:function(a,b,e){b=a.getTarget(this.eventSelector,5,true);var f;if(b){a=Ext.get(a.getRelatedTarget());if(b==a||b.contains(a))return true;f=this.getEventIdFromEl(b);
if(this.eventOverClass!=""){a=this.getEventEls(f);a[e=="over"?"addClass":"removeClass"](this.eventOverClass)}this.fireEvent("event"+e,this,this.getEventRecord(f),b);return true}return false},getDateFromId:function(a,b){var e=a.split(b);return e[e.length-1]},handleDayMouseEvent:function(a,b,e){if(b=a.getTarget("td",3))if(b.id&&b.id.indexOf(this.dayElIdDelimiter)>-1){b=this.getDateFromId(b.id,this.dayElIdDelimiter);a=Ext.get(a.getRelatedTarget());var f;if(a)f=(f=a.is("td")?a:a.up("td",3))&&f.id?this.getDateFromId(f.id,
this.dayElIdDelimiter):"";if(!a||b!=f){if((f=this.getDayEl(b))&&this.dayOverClass!="")f[e=="over"?"addClass":"removeClass"](this.dayOverClass);this.fireEvent("day"+e,this,Date.parseDate(b,"Ymd"),f)}}},renderItems:function(){throw"This method must be implemented by a subclass";}});
Ext.calendar.MonthView=Ext.extend(Ext.calendar.CalendarView,{showTime:true,showTodayText:true,todayText:"Today",showHeader:false,showWeekLinks:false,showWeekNumbers:false,weekLinkOverClass:"ext-week-link-over",daySelector:".ext-cal-day",moreSelector:".ext-cal-ev-more",weekLinkSelector:".ext-cal-week-link",weekCount:-1,dayCount:7,moreElIdDelimiter:"-more-",weekLinkIdDelimiter:"ext-cal-week-",initComponent:function(){Ext.calendar.MonthView.superclass.initComponent.call(this);this.addEvents({dayclick:true,
weekclick:true,dayover:true,dayout:true})},initDD:function(){var a={view:this,createText:this.ddCreateEventText,moveText:this.ddMoveEventText,ddGroup:"MonthViewDD"};this.dragZone=new Ext.calendar.DragZone(this.el,a);this.dropZone=new Ext.calendar.DropZone(this.el,a)},onDestroy:function(){Ext.destroy(this.ddSelector);Ext.destroy(this.dragZone);Ext.destroy(this.dropZone);Ext.calendar.MonthView.superclass.onDestroy.call(this)},afterRender:function(){if(!this.tpl)this.tpl=new Ext.calendar.MonthViewTemplate({id:this.id,
showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime,showHeader:this.showHeader,showWeekLinks:this.showWeekLinks,showWeekNumbers:this.showWeekNumbers});this.tpl.compile();this.addClass("ext-cal-monthview ext-cal-ct");Ext.calendar.MonthView.superclass.afterRender.call(this)},onResize:function(){if(this.monitorResize){this.maxEventsPerDay=this.getMaxEventsPerDay();this.refresh()}},forceSize:function(){if(this.showWeekLinks&&this.el&&this.el.child){var a=this.el.select(".ext-cal-hd-days-tbl"),
b=this.el.select(".ext-cal-bg-tbl"),e=this.el.select(".ext-cal-evt-tbl"),f=this.el.child(".ext-cal-week-link").getWidth();f=this.el.getWidth()-f;a.setWidth(f);b.setWidth(f);e.setWidth(f)}Ext.calendar.MonthView.superclass.forceSize.call(this)},initClock:function(){if(Ext.fly(this.id+"-clock")!==null){this.prevClockDay=(new Date).getDay();this.clockTask&&Ext.TaskMgr.stop(this.clockTask);this.clockTask=Ext.TaskMgr.start({run:function(){var a=Ext.fly(this.id+"-clock"),b=new Date;if(b.getDay()==this.prevClockDay)a&&
a.update(b.format("g:i a"));else{this.prevClockDay=b.getDay();this.moveTo(b)}},scope:this,interval:1E3})}},getEventBodyMarkup:function(){if(!this.eventBodyMarkup)this.eventBodyMarkup='{Title}<tpl if="_isReminder"><i class="ext-cal-ic ext-cal-ic-rem">&nbsp;</i></tpl><tpl if="_isRecurring"><i class="ext-cal-ic ext-cal-ic-rcr">&nbsp;</i></tpl><tpl if="spanLeft"><i class="ext-cal-spl">&nbsp;</i></tpl><tpl if="spanRight"><i class="ext-cal-spr">&nbsp;</i></tpl>';return this.eventBodyMarkup},getEventTemplate:function(){if(!this.eventTpl){var a;
a=this.getEventBodyMarkup();a=!(Ext.isIE||Ext.isOpera)?new Ext.XTemplate('<div id="{_elId}" class="{_selectorCls} {_colorCls} {values.spanCls} ext-cal-evt ext-cal-evr">',a,"</div>"):new Ext.XTemplate('<tpl if="_renderAsAllDay">','<div id="{_elId}" class="{_selectorCls} {values.spanCls} {_colorCls} ext-cal-evt ext-cal-evo">','<div class="ext-cal-evm">','<div class="ext-cal-evi">',"</tpl>",'<tpl if="!_renderAsAllDay">','<div id="{_elId}" class="{_selectorCls} {_colorCls} ext-cal-evt ext-cal-evr">',
"</tpl>",a,'<tpl if="_renderAsAllDay">',"</div>","</div>","</tpl>","</div>");a.compile();this.eventTpl=a}return this.eventTpl},getTemplateEventData:function(a){var b=Ext.calendar.EventMappings,e=this.getEventSelectorCls(a[b.EventId.name]),f=a[b.Title.name];return Ext.applyIf({_selectorCls:e,_colorCls:"ext-color-"+(a[b.CalendarId.name]?a[b.CalendarId.name]:"default")+(a._renderAsAllDay?"-ad":""),_elId:e+"-"+a._weekIndex,_isRecurring:a.Recurrence&&a.Recurrence!="",_isReminder:a[b.Reminder.name]&&a[b.Reminder.name]!=
"",Title:(a[b.IsAllDay.name]?"":a[b.StartDate.name].format("g:ia "))+(!f||f.length==0?"(No title)":f)},a)},refresh:function(){this.detailPanel&&this.detailPanel.hide();Ext.calendar.MonthView.superclass.refresh.call(this);this.showTime!==false&&this.initClock()},renderItems:function(){Ext.calendar.WeekEventRenderer.render({eventGrid:this.allDayOnly?this.allDayGrid:this.eventGrid,viewStart:this.viewStart,tpl:this.getEventTemplate(),maxEventsPerDay:this.maxEventsPerDay,id:this.id,templateDataFn:this.getTemplateEventData.createDelegate(this),
evtMaxCount:this.evtMaxCount,weekCount:this.weekCount,dayCount:this.dayCount});this.fireEvent("eventsrendered",this)},getDayEl:function(a){return Ext.get(this.getDayId(a))},getDayId:function(a){if(Ext.isDate(a))a=a.format("Ymd");return this.id+this.dayElIdDelimiter+a},getWeekIndex:function(a){a=this.getDayEl(a).up(".ext-cal-wk-ct");return parseInt(a.id.split("-wk-")[1],10)},getDaySize:function(a){var b=this.el.getBox(),e=b.width/this.dayCount;b=b.height/this.getWeekCount();if(a)b=(a=this.el.select(".ext-cal-dtitle").first().parent("tr"))?
b-a.getHeight(true):b;return{height:b,width:e}},getEventHeight:function(){if(!this.eventHeight){var a=this.el.select(".ext-cal-evt").first();this.eventHeight=a?a.parent("tr").getHeight():18}return this.eventHeight},getMaxEventsPerDay:function(){var a=this.getDaySize(true).height,b=this.getEventHeight();return Math.max(Math.floor((a-b)/b),0)},getDayAt:function(a,b){var e=this.el.getBox(),f=this.getDaySize();e=this.viewStart.add(Date.DAY,Math.floor((b-e.y)/f.height)*7+Math.floor((a-e.x)/f.width));return{date:e,
el:this.getDayEl(e)}},moveNext:function(){return this.moveMonths(1)},movePrev:function(){return this.moveMonths(-1)},onInitDrag:function(){Ext.calendar.MonthView.superclass.onInitDrag.call(this);Ext.select(this.daySelector).removeClass(this.dayOverClass);this.detailPanel&&this.detailPanel.hide()},onMoreClick:function(a){if(this.detailPanel)this.detailPanel.setTitle(a.format("F j"));else this.detailPanel=new Ext.Panel({id:this.id+"-details-panel",title:a.format("F j"),layout:"fit",floating:true,renderTo:Ext.getBody(),
tools:[{id:"close",handler:function(b,e,f){f.hide()}}],items:{xtype:"monthdaydetailview",id:this.id+"-details-view",date:a,view:this,store:this.store,listeners:{eventsrendered:this.onDetailViewUpdated.createDelegate(this)}}});this.detailPanel.getComponent(this.id+"-details-view").update(a)},onDetailViewUpdated:function(a,b,e){a=this.detailPanel;var f=a.getFrameHeight(),g=this.getEventHeight();e=f+e*g+3;b=this.getDayEl(b);f=b.getBox();a.updateBox(f);a.setHeight(e);a.setWidth(Math.max(f.width,220));
a.show();a.getPositionEl().alignTo(b,"t-t?")},onHide:function(){Ext.calendar.MonthView.superclass.onHide.call(this);this.detailPanel&&this.detailPanel.hide()},onClick:function(a){this.detailPanel&&this.detailPanel.hide();if(!Ext.calendar.MonthView.superclass.onClick.apply(this,arguments)){this.dropZone&&this.dropZone.clearShims();var b=a.getTarget(this.weekLinkSelector,3);if(b){b=b.id.split(this.weekLinkIdDelimiter)[1];this.fireEvent("weekclick",this,Date.parseDate(b,"Ymd"))}else if(b=a.getTarget(this.moreSelector,
3)){b=b.id.split(this.moreElIdDelimiter)[1];this.onMoreClick(Date.parseDate(b,"Ymd"))}else if(b=a.getTarget("td",3))if(b.id&&b.id.indexOf(this.dayElIdDelimiter)>-1){b=b.id.split(this.dayElIdDelimiter);b=b[b.length-1];this.fireEvent("dayclick",this,Date.parseDate(b,"Ymd"),false,Ext.get(this.getDayId(b)))}}},handleDayMouseEvent:function(a,b,e){var f=a.getTarget(this.weekLinkSelector,3,true);f?f[e=="over"?"addClass":"removeClass"](this.weekLinkOverClass):Ext.calendar.MonthView.superclass.handleDayMouseEvent.apply(this,
arguments)}});Ext.reg("monthview",Ext.calendar.MonthView);
Ext.calendar.DayHeaderView=Ext.extend(Ext.calendar.MonthView,{weekCount:1,dayCount:1,allDayOnly:true,monitorResize:false,afterRender:function(){if(!this.tpl)this.tpl=new Ext.calendar.DayHeaderTemplate({id:this.id,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime});this.tpl.compile();this.addClass("ext-cal-day-header");Ext.calendar.DayHeaderView.superclass.afterRender.call(this)},forceSize:Ext.emptyFn,refresh:function(){Ext.calendar.DayHeaderView.superclass.refresh.call(this);this.recalcHeaderBox()},
recalcHeaderBox:function(){var a=this.el.child(".ext-cal-evt-tbl").getHeight();this.el.setHeight(a+7);Ext.isIE&&Ext.isStrict&&this.el.child(".ext-cal-hd-ad-inner").setHeight(a+4)},moveNext:function(a){this.moveDays(this.dayCount,a)},movePrev:function(a){this.moveDays(-this.dayCount,a)},onClick:function(a){var b=a.getTarget("td",3);if(b)if(b.id&&b.id.indexOf(this.dayElIdDelimiter)>-1){b=b.id.split(this.dayElIdDelimiter);b=b[b.length-1];this.fireEvent("dayclick",this,Date.parseDate(b,"Ymd"),true,Ext.get(this.getDayId(b)));
return}Ext.calendar.DayHeaderView.superclass.onClick.apply(this,arguments)}});Ext.reg("dayheaderview",Ext.calendar.DayHeaderView);
Ext.calendar.DayBodyView=Ext.extend(Ext.calendar.CalendarView,{dayColumnElIdDelimiter:"-day-col-",initComponent:function(){Ext.calendar.DayBodyView.superclass.initComponent.call(this);this.addEvents({eventresize:true,dayclick:true})},initDD:function(){var a={createText:this.ddCreateEventText,moveText:this.ddMoveEventText,resizeText:this.ddResizeEventText};this.el.ddScrollConfig={vthresh:Ext.isIE||Ext.isOpera?100:40,hthresh:-1,frequency:50,increment:100,ddGroup:"DayViewDD"};this.dragZone=new Ext.calendar.DayViewDragZone(this.el,
Ext.apply({view:this,containerScroll:true},a));this.dropZone=new Ext.calendar.DayViewDropZone(this.el,Ext.apply({view:this},a))},refresh:function(){var a=this.el.getScroll().top;this.prepareData();this.renderTemplate();this.renderItems();this.scrollReady&&this.scrollTo(a)},scrollTo:function(a,b){if(b=b||Ext.isIE||Ext.isOpera)(function(){this.el.scrollTo("top",a);this.scrollReady=true}).defer(10,this);else{this.el.scrollTo("top",a);this.scrollReady=true}},afterRender:function(){if(!this.tpl)this.tpl=
new Ext.calendar.DayBodyTemplate({id:this.id,dayCount:this.dayCount,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime});this.tpl.compile();this.addClass("ext-cal-body-ct");Ext.calendar.DayBodyView.superclass.afterRender.call(this);this.scrollTo(294)},forceSize:Ext.emptyFn,onEventResize:function(a,b){var e=Ext.calendar.Date,f=Ext.calendar.EventMappings.StartDate.name,g=Ext.calendar.EventMappings.EndDate.name;if(!(e.compare(a.data[f],b.StartDate)===0&&e.compare(a.data[g],
b.EndDate)===0)){a.set(f,b.StartDate);a.set(g,b.EndDate);this.fireEvent("eventresize",this,a)}},getEventBodyMarkup:function(){if(!this.eventBodyMarkup)this.eventBodyMarkup='{Title}<tpl if="_isReminder"><i class="ext-cal-ic ext-cal-ic-rem">&nbsp;</i></tpl><tpl if="_isRecurring"><i class="ext-cal-ic ext-cal-ic-rcr">&nbsp;</i></tpl>';return this.eventBodyMarkup},getEventTemplate:function(){if(!this.eventTpl){this.eventTpl=!(Ext.isIE||Ext.isOpera)?new Ext.XTemplate('<div id="{_elId}" class="{_selectorCls} {_colorCls} ext-cal-evt ext-cal-evr" style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">',
'<div class="ext-evt-bd">',this.getEventBodyMarkup(),"</div>",'<div class="ext-evt-rsz"><div class="ext-evt-rsz-h">&nbsp;</div></div>',"</div>"):new Ext.XTemplate('<div id="{_elId}" class="ext-cal-evt {_selectorCls} {_colorCls}-x" style="left: {_left}%; width: {_width}%; top: {_top}px;">','<div class="ext-cal-evb">&nbsp;</div>','<dl style="height: {_height}px;" class="ext-cal-evdm">','<dd class="ext-evt-bd">',this.getEventBodyMarkup(),"</dd>",'<div class="ext-evt-rsz"><div class="ext-evt-rsz-h">&nbsp;</div></div>',
"</dl>",'<div class="ext-cal-evb">&nbsp;</div>',"</div>");this.eventTpl.compile()}return this.eventTpl},getEventAllDayTemplate:function(){if(!this.eventAllDayTpl){var a;a=this.getEventBodyMarkup();a=!(Ext.isIE||Ext.isOpera)?new Ext.XTemplate('<div id="{_elId}" class="{_selectorCls} {_colorCls} {values.spanCls} ext-cal-evt ext-cal-evr" style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">',a,"</div>"):new Ext.XTemplate('<div id="{_elId}" class="ext-cal-evt" style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">',
'<div class="{_selectorCls} {values.spanCls} {_colorCls} ext-cal-evo">','<div class="ext-cal-evm">','<div class="ext-cal-evi">',a,"</div>","</div>","</div></div>");a.compile();this.eventAllDayTpl=a}return this.eventAllDayTpl},getTemplateEventData:function(a){var b=this.getEventSelectorCls(a[Ext.calendar.EventMappings.EventId.name]),e={},f=Ext.calendar.EventMappings;this.getTemplateEventBox(a);e._selectorCls=b;e._colorCls="ext-color-"+a[f.CalendarId.name]+(a._renderAsAllDay?"-ad":"");e._elId=b+(a._weekIndex?
"-"+a._weekIndex:"");e._isRecurring=a.Recurrence&&a.Recurrence!="";e._isReminder=a[f.Reminder.name]&&a[f.Reminder.name]!="";b=a[f.Title.name];e.Title=(a[f.IsAllDay.name]?"":a[f.StartDate.name].format("g:ia "))+(!b||b.length==0?"(No title)":b);return Ext.applyIf(e,a)},getTemplateEventBox:function(a){var b=a[Ext.calendar.EventMappings.StartDate.name],e=a[Ext.calendar.EventMappings.EndDate.name];b=b.getHours()*60+b.getMinutes();e=e.getHours()*60+e.getMinutes()-b;a._left=0;a._width=100;a._top=Math.round(b*
0.7)+1;a._height=Math.max(e*0.7-2,15)},renderItems:function(){for(var a=0,b=[],e,f,g,h;a<this.dayCount;a++){e=emptyCells=skipped=0;for(g=(f=this.eventGrid[0][a])?f.length:0;e<g;e++)if(evt=f[e]){h=evt.data||evt.event.data;if(!h._renderAsAllDay){Ext.apply(h,{cls:"ext-cal-ev",_positioned:true});b.push({data:this.getTemplateEventData(h),date:this.viewStart.add(Date.DAY,a)})}}}a=f=0;for(e=b.length;a<e;a++){evt=b[a].data;evt2=null;for(g=0;g<e;g++)if(a!=g){evt2=b[g].data;if(this.isOverlapping(evt,evt2)){evt._overlap=
evt._overlap==undefined?1:evt._overlap+1;if(a<g){if(evt._overcol===undefined)evt._overcol=0;evt2._overcol=evt._overcol+1;f=Math.max(f,evt2._overcol)}}}}for(a=0;a<e;a++){evt=b[a].data;if(evt._overlap!==undefined){g=100/(f+1);evt._width=g;evt._left=g*evt._overcol}g=this.getEventTemplate().apply(evt);h=this.id+"-day-col-"+b[a].date.format("Ymd");Ext.DomHelper.append(h,g)}this.fireEvent("eventsrendered",this)},getDayEl:function(a){return Ext.get(this.getDayId(a))},getDayId:function(a){if(Ext.isDate(a))a=
a.format("Ymd");return this.id+this.dayColumnElIdDelimiter+a},getDaySize:function(){var a=this.el.child(".ext-cal-day-col-inner").getBox();return{height:a.height,width:a.width}},getDayAt:function(a,b){var e=this.el.child(".ext-cal-day-times").getWidth(),f=this.el.getBox(),g=this.getDaySize(false),h=Math.floor((a-f.x-e)/g.width);e=this.el.getScroll();var j=this.el.child(".ext-cal-bg-row").getHeight()/2,l=Math.max(0,Math.ceil((b-f.y-j+e.top)/j)),k=l*30;h=this.viewStart.add(Date.DAY,h).add(Date.MINUTE,
k);k=this.getDayEl(h);var m=a;if(k)m=k.getLeft();return{date:h,el:k,timeBox:{x:m,y:l*21+f.y-e.top,width:g.width,height:j}}},onClick:function(a){if(!(this.dragPending||Ext.calendar.DayBodyView.superclass.onClick.apply(this,arguments)))if(a.getTarget(".ext-cal-day-times",3)===null){var b=a.getTarget("td",3);if(b)if(b.id&&b.id.indexOf(this.dayElIdDelimiter)>-1){b=this.getDateFromId(b.id,this.dayElIdDelimiter);this.fireEvent("dayclick",this,Date.parseDate(b,"Ymd"),true,Ext.get(this.getDayId(b,true)));
return}(b=this.getDayAt(a.xy[0],a.xy[1]))&&b.date&&this.fireEvent("dayclick",this,b.date,false,null)}}});Ext.reg("daybodyview",Ext.calendar.DayBodyView);
Ext.calendar.DayView=Ext.extend(Ext.Container,{showTime:true,showTodayText:true,todayText:"Today",ddCreateEventText:"Create event for {0}",ddMoveEventText:"Move event to {0}",dayCount:1,initComponent:function(){this.dayCount=this.dayCount>7?7:this.dayCount;var a=Ext.apply({},this.initialConfig);a.showTime=this.showTime;a.showTodatText=this.showTodayText;a.todayText=this.todayText;a.dayCount=this.dayCount;a.wekkCount=1;var b=Ext.applyIf({xtype:"dayheaderview",id:this.id+"-hd"},a);a=Ext.applyIf({xtype:"daybodyview",
id:this.id+"-bd"},a);this.items=[b,a];this.addClass("ext-cal-dayview ext-cal-ct");Ext.calendar.DayView.superclass.initComponent.call(this)},afterRender:function(){Ext.calendar.DayView.superclass.afterRender.call(this);this.header=Ext.getCmp(this.id+"-hd");this.body=Ext.getCmp(this.id+"-bd");this.body.on("eventsrendered",this.forceSize,this)},refresh:function(){this.header.refresh();this.body.refresh()},forceSize:function(){(function(){var a=this.el.up(".x-panel-body"),b=this.el.child(".ext-cal-day-header");
a=a.getHeight()-b.getHeight();this.el.child(".ext-cal-body-ct").setHeight(a)}).defer(10,this)},onResize:function(){this.forceSize()},getViewBounds:function(){return this.header.getViewBounds()},getStartDate:function(){return this.header.getStartDate()},setStartDate:function(a){this.header.setStartDate(a,true);this.body.setStartDate(a,true)},renderItems:function(){this.header.renderItems();this.body.renderItems()},isToday:function(){return this.header.isToday()},moveTo:function(a,b){this.header.moveTo(a,
b);this.body.moveTo(a,b)},moveNext:function(a){this.header.moveNext(a);this.body.moveNext(a)},movePrev:function(a){this.header.movePrev(a);this.body.movePrev(a)},moveDays:function(a,b){this.header.moveDays(a,b);this.body.moveDays(a,b)},moveToday:function(a){this.header.moveToday(a);this.body.moveToday(a)}});Ext.reg("dayview",Ext.calendar.DayView);Ext.calendar.WeekView=Ext.extend(Ext.calendar.DayView,{dayCount:7});Ext.reg("weekview",Ext.calendar.WeekView);
Ext.calendar.DateRangeField=Ext.extend(Ext.form.Field,{toText:"to",allDayText:"All day",onRender:function(a,b){if(!this.el){this.startDate=new Ext.form.DateField({id:this.id+"-start-date",format:"n/j/Y",width:100,listeners:{change:{fn:function(){this.checkDates("date","start")},scope:this}}});this.startTime=new Ext.form.TimeField({id:this.id+"-start-time",hidden:this.showTimes===false,labelWidth:0,hideLabel:true,width:90,listeners:{select:{fn:function(){this.checkDates("time","start")},scope:this}}});
this.endTime=new Ext.form.TimeField({id:this.id+"-end-time",hidden:this.showTimes===false,labelWidth:0,hideLabel:true,width:90,listeners:{select:{fn:function(){this.checkDates("time","end")},scope:this}}});this.endDate=new Ext.form.DateField({id:this.id+"-end-date",format:"n/j/Y",hideLabel:true,width:100,listeners:{change:{fn:function(){this.checkDates("date","end")},scope:this}}});this.allDay=new Ext.form.Checkbox({id:this.id+"-allday",hidden:this.showTimes===false||this.showAllDay===false,boxLabel:this.allDayText,
handler:function(e,f){this.startTime.setVisible(!f);this.endTime.setVisible(!f)},scope:this});this.toLabel=new Ext.form.Label({xtype:"label",id:this.id+"-to-label",text:this.toText});this.fieldCt=new Ext.Container({autoEl:{id:this.id},cls:"ext-dt-range",renderTo:a,layout:"table",layoutConfig:{columns:6},defaults:{hideParent:true},items:[this.startDate,this.startTime,this.toLabel,this.endTime,this.endDate,this.allDay]});this.fieldCt.ownerCt=this;this.el=this.fieldCt.getEl();this.items=new Ext.util.MixedCollection;
this.items.addAll([this.startDate,this.endDate,this.toLabel,this.startTime,this.endTime,this.allDay])}Ext.calendar.DateRangeField.superclass.onRender.call(this,a,b)},checkDates:function(a,b){var e=Ext.getCmp(this.id+"-start-"+a),f=Ext.getCmp(this.id+"-end-"+a),g=this.getDT("start"),h=this.getDT("end");if(g>h)if(b=="start")f.setValue(g);else{e.setValue(h);this.checkDates(a,"start")}a=="date"&&this.checkDates("time",b)},getValue:function(){return[this.getDT("start"),this.getDT("end"),this.allDay.getValue()]},
getDT:function(a){var b=this[a+"Time"].getValue(),e=this[a+"Date"].getValue();if(Ext.isDate(e))e=e.format(this[a+"Date"].format);else return null;if(b!=""&&this[a+"Time"].isVisible())return Date.parseDate(e+" "+b,this[a+"Date"].format+" "+this[a+"Time"].format);return Date.parseDate(e,this[a+"Date"].format)},setValue:function(a){if(Ext.isArray(a)){this.setDT(a[0],"start");this.setDT(a[1],"end");this.allDay.setValue(!!a[2])}else if(Ext.isDate(a)){this.setDT(a,"start");this.setDT(a,"end");this.allDay.setValue(false)}else if(a[Ext.calendar.EventMappings.StartDate.name]){this.setDT(a[Ext.calendar.EventMappings.StartDate.name],
"start");this.setDT(a[Ext.calendar.EventMappings.EndDate.name],"end")||this.setDT(a[Ext.calendar.EventMappings.StartDate.name],"end");this.allDay.setValue(!!a[Ext.calendar.EventMappings.IsAllDay.name])}},setDT:function(a,b){if(a&&Ext.isDate(a)){this[b+"Date"].setValue(a);this[b+"Time"].setValue(a.format(this[b+"Time"].format));return true}},isDirty:function(){var a=false;this.rendered&&!this.disabled&&this.items.each(function(b){if(b.isDirty()){a=true;return false}});return a},onDisable:function(){this.delegateFn("disable")},
onEnable:function(){this.delegateFn("enable")},reset:function(){this.delegateFn("reset")},delegateFn:function(a){this.items.each(function(b){b[a]&&b[a]()})},beforeDestroy:function(){Ext.destroy(this.fieldCt);Ext.calendar.DateRangeField.superclass.beforeDestroy.call(this)},getRawValue:Ext.emptyFn,setRawValue:Ext.emptyFn});Ext.reg("daterangefield",Ext.calendar.DateRangeField);
Ext.calendar.ReminderField=Ext.extend(Ext.form.ComboBox,{width:200,fieldLabel:"Reminder",mode:"local",triggerAction:"all",forceSelection:true,displayField:"desc",valueField:"value",initComponent:function(){Ext.calendar.ReminderField.superclass.initComponent.call(this);this.store=this.store||new Ext.data.ArrayStore({fields:["value","desc"],idIndex:0,data:[["","None"],["0","At start time"],["5","5 minutes before start"],["15","15 minutes before start"],["30","30 minutes before start"],["60","1 hour before start"],
["90","1.5 hours before start"],["120","2 hours before start"],["180","3 hours before start"],["360","6 hours before start"],["720","12 hours before start"],["1440","1 day before start"],["2880","2 days before start"],["4320","3 days before start"],["5760","4 days before start"],["7200","5 days before start"],["10080","1 week before start"],["20160","2 weeks before start"]]})},initValue:function(){this.value!==undefined?this.setValue(this.value):this.setValue("");this.originalValue=this.getValue()}});
Ext.reg("reminderfield",Ext.calendar.ReminderField);
Ext.calendar.EventEditForm=Ext.extend(Ext.form.FormPanel,{labelWidth:65,title:"Event Form",titleTextAdd:"Add Event",titleTextEdit:"Edit Event",bodyStyle:"background:transparent;padding:20px 20px 10px;",border:false,buttonAlign:"center",autoHeight:true,cls:"ext-evt-edit-form",newId:1E4,layout:"column",initComponent:function(){this.addEvents({eventadd:true,eventupdate:true,eventdelete:true,eventcancel:true});this.titleField=new Ext.form.TextField({fieldLabel:"Title",name:Ext.calendar.EventMappings.Title.name,
anchor:"90%"});this.dateRangeField=new Ext.calendar.DateRangeField({fieldLabel:"When",anchor:"90%"});this.reminderField=new Ext.calendar.ReminderField({name:"Reminder"});this.notesField=new Ext.form.TextArea({fieldLabel:"Notes",name:Ext.calendar.EventMappings.Notes.name,grow:true,growMax:150,anchor:"100%"});this.locationField=new Ext.form.TextField({fieldLabel:"Location",name:Ext.calendar.EventMappings.Location.name,anchor:"100%"});this.urlField=new Ext.form.TextField({fieldLabel:"Web Link",name:Ext.calendar.EventMappings.Url.name,
anchor:"100%"});var a=[this.titleField,this.dateRangeField,this.reminderField],b=[this.notesField,this.locationField,this.urlField];if(this.calendarStore){this.calendarField=new Ext.calendar.CalendarPicker({store:this.calendarStore,name:Ext.calendar.EventMappings.CalendarId.name});a.splice(2,0,this.calendarField)}this.items=[{id:"left-col",columnWidth:0.65,layout:"form",border:false,items:a},{id:"right-col",columnWidth:0.35,layout:"form",border:false,items:b}];this.fbar=[{text:"Save",scope:this,handler:this.onSave},
{cls:"ext-del-btn",text:"Delete",scope:this,handler:this.onDelete},{text:"Cancel",scope:this,handler:this.onCancel}];Ext.calendar.EventEditForm.superclass.initComponent.call(this)},loadRecord:function(a){this.form.loadRecord.apply(this.form,arguments);this.activeRecord=a;this.dateRangeField.setValue(a.data);this.calendarStore&&this.form.setValues({calendar:a.data[Ext.calendar.EventMappings.CalendarId.name]});if(this.isAdd=!!a.data[Ext.calendar.EventMappings.IsNew.name]){a.markDirty();this.setTitle(this.titleTextAdd);
Ext.select(".ext-del-btn").setDisplayed(false)}else{this.setTitle(this.titleTextEdit);Ext.select(".ext-del-btn").setDisplayed(true)}this.titleField.focus()},updateRecord:function(){var a=this.dateRangeField.getValue();this.form.updateRecord(this.activeRecord);this.activeRecord.set(Ext.calendar.EventMappings.StartDate.name,a[0]);this.activeRecord.set(Ext.calendar.EventMappings.EndDate.name,a[1]);this.activeRecord.set(Ext.calendar.EventMappings.IsAllDay.name,a[2])},onCancel:function(){this.cleanup(true);
this.fireEvent("eventcancel",this,this.activeRecord)},cleanup:function(){this.activeRecord&&this.activeRecord.dirty&&this.activeRecord.reject();delete this.activeRecord;this.form.isDirty()&&this.form.reset()},onSave:function(){if(this.form.isValid()){this.updateRecord();this.activeRecord.dirty?this.fireEvent(this.isAdd?"eventadd":"eventupdate",this,this.activeRecord):this.onCancel()}},onDelete:function(){this.fireEvent("eventdelete",this,this.activeRecord)}});Ext.reg("eventeditform",Ext.calendar.EventEditForm);
Ext.calendar.EventEditWindow=function(a){var b={xtype:"form",labelWidth:65,frame:false,bodyStyle:"background:transparent;padding:5px 10px 10px;",bodyBorder:false,border:false,items:[{id:"title",name:Ext.calendar.EventMappings.Title.name,fieldLabel:"Title",xtype:"textfield",anchor:"100%"},{xtype:"daterangefield",id:"date-range",anchor:"100%",fieldLabel:"When"}]};if(a.calendarStore){this.calendarStore=a.calendarStore;delete a.calendarStore;b.items.push({xtype:"calendarpicker",id:"calendar",name:"calendar",
anchor:"100%",store:this.calendarStore})}Ext.calendar.EventEditWindow.superclass.constructor.call(this,Ext.apply({titleTextAdd:"Add Event",titleTextEdit:"Edit Event",width:600,autocreate:true,border:true,closeAction:"hide",modal:false,resizable:false,buttonAlign:"left",savingMessage:"Saving changes...",deletingMessage:"Deleting event...",fbar:[{xtype:"tbtext",text:'<a href="#" id="tblink">Edit Details...</a>'},"->",{text:"Save",disabled:false,handler:this.onSave,scope:this},{id:"delete-btn",text:"Delete",
disabled:false,handler:this.onDelete,scope:this,hideMode:"offsets"},{text:"Cancel",disabled:false,handler:this.onCancel,scope:this}],items:b},a))};
Ext.extend(Ext.calendar.EventEditWindow,Ext.Window,{newId:1E4,initComponent:function(){Ext.calendar.EventEditWindow.superclass.initComponent.call(this);this.formPanel=this.items.items[0];this.addEvents({eventadd:true,eventupdate:true,eventdelete:true,eventcancel:true,editdetails:true})},afterRender:function(){Ext.calendar.EventEditWindow.superclass.afterRender.call(this);this.el.addClass("ext-cal-event-win");Ext.get("tblink").on("click",function(a){a.stopEvent();this.updateRecord();this.fireEvent("editdetails",
this,this.activeRecord)},this)},show:function(a,b){Ext.calendar.EventEditWindow.superclass.show.call(this,Ext.isIE8&&Ext.isStrict?null:b,function(){Ext.getCmp("title").focus(false,100)});Ext.getCmp("delete-btn")[a.data&&a.data[Ext.calendar.EventMappings.EventId.name]?"show":"hide"]();var e,f=this.formPanel.form;if(a.data){e=a;if(this.isAdd=!!e.data[Ext.calendar.EventMappings.IsNew.name]){e.markDirty();this.setTitle(this.titleTextAdd)}else this.setTitle(this.titleTextEdit)}else{this.isAdd=true;this.setTitle(this.titleTextAdd);
var g=Ext.calendar.EventMappings,h=a[g.StartDate.name],j=a[g.EndDate.name]||h.add("h",1);e=new Ext.calendar.EventRecord;e.data[g.EventId.name]=this.newId++;e.data[g.StartDate.name]=h;e.data[g.EndDate.name]=j;e.data[g.IsAllDay.name]=!!a[g.IsAllDay.name]||h.getDate()!=j.clone().add(Date.MILLI,1).getDate();e.data[g.IsNew.name]=true;f.reset()}f.loadRecord(e);this.calendarStore&&Ext.getCmp("calendar").setValue(e.data[Ext.calendar.EventMappings.CalendarId.name]);Ext.getCmp("date-range").setValue(e.data);
this.activeRecord=e;return this},roundTime:function(a,b){b=b||15;var e=parseInt(a.getMinutes(),10);return a.add("mi",b-e%b)},onCancel:function(){this.cleanup(true);this.fireEvent("eventcancel",this)},cleanup:function(a){this.activeRecord&&this.activeRecord.dirty&&this.activeRecord.reject();delete this.activeRecord;a===true&&this.hide()},updateRecord:function(){var a=this.formPanel.form,b=Ext.getCmp("date-range").getValue(),e=Ext.calendar.EventMappings;a.updateRecord(this.activeRecord);this.activeRecord.set(e.StartDate.name,
b[0]);this.activeRecord.set(e.EndDate.name,b[1]);this.activeRecord.set(e.IsAllDay.name,b[2]);this.activeRecord.set(e.CalendarId.name,this.formPanel.form.findField("calendar").getValue())},onSave:function(){if(this.formPanel.form.isValid()){this.updateRecord();this.activeRecord.dirty?this.fireEvent(this.isAdd?"eventadd":"eventupdate",this,this.activeRecord):this.onCancel()}},onDelete:function(){this.fireEvent("eventdelete",this,this.activeRecord)}});
Ext.calendar.CalendarPanel=Ext.extend(Ext.Panel,{showDayView:true,showWeekView:true,showMonthView:true,showNavBar:true,todayText:"Today",showTodayText:true,showTime:true,dayText:"Day",weekText:"Week",monthText:"Month",layoutConfig:{layoutOnCardChange:true,deferredRender:true},startDate:new Date,initComponent:function(){this.tbar={cls:"ext-cal-toolbar",border:true,buttonAlign:"center",items:[{id:this.id+"-tb-prev",handler:this.onPrevClick,scope:this,iconCls:"x-tbar-page-prev"}]};this.viewCount=0;if(this.showDayView){this.tbar.items.push({id:this.id+
"-tb-day",text:this.dayText,handler:this.onDayClick,scope:this,toggleGroup:"tb-views"});this.viewCount++}if(this.showWeekView){this.tbar.items.push({id:this.id+"-tb-week",text:this.weekText,handler:this.onWeekClick,scope:this,toggleGroup:"tb-views"});this.viewCount++}if(this.showMonthView||this.viewCount==0){this.tbar.items.push({id:this.id+"-tb-month",text:this.monthText,handler:this.onMonthClick,scope:this,toggleGroup:"tb-views"});this.viewCount++;this.showMonthView=true}this.tbar.items.push({id:this.id+
"-tb-next",handler:this.onNextClick,scope:this,iconCls:"x-tbar-page-next"});this.tbar.items.push("->");var a=this.viewCount-1;this.activeItem=this.activeItem===undefined?a:this.activeItem>a?a:this.activeItem;if(this.showNavBar===false){delete this.tbar;this.addClass("x-calendar-nonav")}Ext.calendar.CalendarPanel.superclass.initComponent.call(this);this.addEvents({eventadd:true,eventupdate:true,eventdelete:true,eventcancel:true,viewchange:true});this.layout="card";if(this.showDayView){a=Ext.apply({xtype:"dayview",
title:this.dayText,showToday:this.showToday,showTodayText:this.showTodayText,showTime:this.showTime},this.dayViewCfg);a.id=this.id+"-day";a.store=a.store||this.eventStore;this.initEventRelay(a);this.add(a)}if(this.showWeekView){a=Ext.applyIf({xtype:"weekview",title:this.weekText,showToday:this.showToday,showTodayText:this.showTodayText,showTime:this.showTime},this.weekViewCfg);a.id=this.id+"-week";a.store=a.store||this.eventStore;this.initEventRelay(a);this.add(a)}if(this.showMonthView){a=Ext.applyIf({xtype:"monthview",
title:this.monthText,showToday:this.showToday,showTodayText:this.showTodayText,showTime:this.showTime,listeners:{weekclick:{fn:function(b,e){this.showWeek(e)},scope:this}}},this.monthViewCfg);a.id=this.id+"-month";a.store=a.store||this.eventStore;this.initEventRelay(a);this.add(a)}this.add(Ext.applyIf({xtype:"eventeditform",id:this.id+"-edit",calendarStore:this.calendarStore,listeners:{eventadd:{scope:this,fn:this.onEventAdd},eventupdate:{scope:this,fn:this.onEventUpdate},eventdelete:{scope:this,
fn:this.onEventDelete},eventcancel:{scope:this,fn:this.onEventCancel}}},this.editViewCfg))},initEventRelay:function(a){a.listeners=a.listeners||{};a.listeners.afterrender={fn:function(b){this.relayEvents(b,["eventsrendered","eventclick","eventover","eventout","dayclick","eventmove","datechange","rangeselect","eventdelete","eventresize","initdrag"])},scope:this,single:true}},afterRender:function(){Ext.calendar.CalendarPanel.superclass.afterRender.call(this);this.fireViewChange()},onLayout:function(){Ext.calendar.CalendarPanel.superclass.onLayout.call(this);
if(!this.navInitComplete){this.updateNavState();this.navInitComplete=true}},onEventAdd:function(a,b){b.data[Ext.calendar.EventMappings.IsNew.name]=false;this.eventStore.add(b);this.hideEditForm();this.fireEvent("eventadd",this,b)},onEventUpdate:function(a,b){b.commit();this.hideEditForm();this.fireEvent("eventupdate",this,b)},onEventDelete:function(a,b){this.eventStore.remove(b);this.hideEditForm();this.fireEvent("eventdelete",this,b)},onEventCancel:function(a,b){this.hideEditForm();this.fireEvent("eventcancel",
this,b)},showEditForm:function(a){this.preEditView=this.layout.activeItem.id;this.setActiveView(this.id+"-edit");this.layout.activeItem.loadRecord(a);return this},hideEditForm:function(){if(this.preEditView){this.setActiveView(this.preEditView);delete this.preEditView}return this},setActiveView:function(a){var b=this.layout;b.setActiveItem(a);if(a==this.id+"-edit"){this.getTopToolbar().hide();this.doLayout()}else{b.activeItem.refresh();this.getTopToolbar().show();this.updateNavState()}this.activeView=
b.activeItem;this.fireViewChange()},fireViewChange:function(){var a=null,b=this.layout.activeItem;if(b.getViewBounds){vb=b.getViewBounds();a={activeDate:b.getStartDate(),viewStart:vb.start,viewEnd:vb.end}}this.fireEvent("viewchange",this,b,a)},updateNavState:function(){if(this.showNavBar!==false){var a=this.layout.activeItem.id.split(this.id+"-")[1];Ext.getCmp(this.id+"-tb-"+a).toggle(true)}},setStartDate:function(a){this.layout.activeItem.setStartDate(a,true);this.updateNavState();this.fireViewChange()},
showWeek:function(a){this.setActiveView(this.id+"-week");this.setStartDate(a)},onPrevClick:function(){this.startDate=this.layout.activeItem.movePrev();this.updateNavState();this.fireViewChange()},onNextClick:function(){this.startDate=this.layout.activeItem.moveNext();this.updateNavState();this.fireViewChange()},onDayClick:function(){this.setActiveView(this.id+"-day")},onWeekClick:function(){this.setActiveView(this.id+"-week")},onMonthClick:function(){this.setActiveView(this.id+"-month")},getActiveView:function(){return this.layout.activeItem}});
Ext.reg("calendarpanel",Ext.calendar.CalendarPanel);Ext.ns("Ext.calendar");
(function(){Ext.apply(Ext.calendar,{Date:{diffDays:function(a,b){day=864E5;diff=b.clearTime(true).getTime()-a.clearTime(true).getTime();return Math.ceil(diff/day)},copyTime:function(a,b){var e=b.clone();e.setHours(a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds());return e},compare:function(a,b,e){if(e!==true){a=a.clone();a.setMilliseconds(0);b=b.clone();b.setMilliseconds(0)}return b.getTime()-a.getTime()},maxOrMin:function(a,b){for(var e=a?0:Number.MAX_VALUE,f=0,g=b.length;f<g;f++)e=
Math[a?"max":"min"](e,b[f].getTime());return new Date(e)},max:function(){return this.maxOrMin.apply(this,[true,arguments])},min:function(){return this.maxOrMin.apply(this,[false,arguments])}}})})();
Ext.calendar.DayHeaderTemplate=function(a){Ext.apply(this,a);this.allDayTpl=new Ext.calendar.BoxLayoutTemplate(a);this.allDayTpl.compile();Ext.calendar.DayHeaderTemplate.superclass.constructor.call(this,'<div class="ext-cal-hd-ct">','<table class="ext-cal-hd-days-tbl" cellspacing="0" cellpadding="0">',"<tbody>","<tr>",'<td class="ext-cal-gutter"></td>','<td class="ext-cal-hd-days-td"><div class="ext-cal-hd-ad-inner">{allDayTpl}</div></td>','<td class="ext-cal-gutter-rt"></td>',"</tr>","</tobdy>",
"</table>","</div>")};Ext.extend(Ext.calendar.DayHeaderTemplate,Ext.XTemplate,{applyTemplate:function(a){return Ext.calendar.DayHeaderTemplate.superclass.applyTemplate.call(this,{allDayTpl:this.allDayTpl.apply(a)})}});Ext.calendar.DayHeaderTemplate.prototype.apply=Ext.calendar.DayHeaderTemplate.prototype.applyTemplate;
Ext.calendar.DayBodyTemplate=function(a){Ext.apply(this,a);Ext.calendar.DayBodyTemplate.superclass.constructor.call(this,'<table class="ext-cal-bg-tbl" cellspacing="0" cellpadding="0">',"<tbody>",'<tr height="1">','<td class="ext-cal-gutter"></td>','<td colspan="{dayCount}">','<div class="ext-cal-bg-rows">','<div class="ext-cal-bg-rows-inner">','<tpl for="times">','<div class="ext-cal-bg-row">','<div class="ext-cal-bg-row-div ext-row-{[xindex]}"></div>',"</div>","</tpl>","</div>","</div>","</td>",
"</tr>","<tr>",'<td class="ext-cal-day-times">','<tpl for="times">','<div class="ext-cal-bg-row">','<div class="ext-cal-day-time-inner">{.}</div>',"</div>","</tpl>","</td>",'<tpl for="days">','<td class="ext-cal-day-col">','<div class="ext-cal-day-col-inner">','<div id="{[this.id]}-day-col-{.:date("Ymd")}" class="ext-cal-day-col-gutter"></div>',"</div>","</td>","</tpl>","</tr>","</tbody>","</table>")};
Ext.extend(Ext.calendar.DayBodyTemplate,Ext.XTemplate,{applyTemplate:function(a){this.today=(new Date).clearTime();this.dayCount=this.dayCount||1;var b=0,e=[];a=a.viewStart.clone();for(var f;b<this.dayCount;b++)e[b]=a.add(Date.DAY,b);f=[];a=(new Date).clearTime();for(b=0;b<24;b++){f.push(a.format("ga"));a=a.add(Date.HOUR,1)}return Ext.calendar.DayBodyTemplate.superclass.applyTemplate.call(this,{days:e,dayCount:e.length,times:f})}});Ext.calendar.DayBodyTemplate.prototype.apply=Ext.calendar.DayBodyTemplate.prototype.applyTemplate;
Ext.calendar.DayViewTemplate=function(a){Ext.apply(this,a);this.headerTpl=new Ext.calendar.DayHeaderTemplate(a);this.headerTpl.compile();this.bodyTpl=new Ext.calendar.DayBodyTemplate(a);this.bodyTpl.compile();Ext.calendar.DayViewTemplate.superclass.constructor.call(this,'<div class="ext-cal-inner-ct">',"{headerTpl}","{bodyTpl}","</div>")};
Ext.extend(Ext.calendar.DayViewTemplate,Ext.XTemplate,{applyTemplate:function(a){return Ext.calendar.DayViewTemplate.superclass.applyTemplate.call(this,{headerTpl:this.headerTpl.apply(a),bodyTpl:this.bodyTpl.apply(a)})}});Ext.calendar.DayViewTemplate.prototype.apply=Ext.calendar.DayViewTemplate.prototype.applyTemplate;
Ext.calendar.BoxLayoutTemplate=function(a){Ext.apply(this,a);Ext.calendar.BoxLayoutTemplate.superclass.constructor.call(this,'<tpl for="weeks">','<div id="{[this.id]}-wk-{[xindex-1]}" class="ext-cal-wk-ct" style="top:{[this.getRowTop(xindex, xcount)]}%; height:{[this.getRowHeight(xcount)]}%;">',this.showWeekLinks?'<div id="{weekLinkId}" class="ext-cal-week-link">{weekNum}</div>':"",'<table class="ext-cal-bg-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for=".">','<td id="{[this.id]}-day-{date:date("Ymd")}" class="{cellCls}">&nbsp;</td>',
"</tpl>","</tr>","</tbody>","</table>",'<table class="ext-cal-evt-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for=".">','<td id="{[this.id]}-ev-day-{date:date("Ymd")}" class="{titleCls}"><div>{title}</div></td>',"</tpl>","</tr>","</tbody>","</table>","</div>","</tpl>",{getRowTop:function(b,e){return(b-1)*(100/e)},getRowHeight:function(b){return 100/b}})};
Ext.extend(Ext.calendar.BoxLayoutTemplate,Ext.XTemplate,{applyTemplate:function(a){Ext.apply(this,a);a=0;var b="";b=true;for(var e=false,f=false,g=false,h=false,j=[[]],l=(new Date).clearTime(),k=this.viewStart.clone(),m=this.startDate.getMonth();a<this.weekCount||this.weekCount==-1;a++){if(k>this.viewEnd)break;j[a]=[];for(var n=0;n<this.dayCount;n++){e=k.getTime()===l.getTime();f=b||k.getDate()==1;g=k.getMonth()<m&&this.weekCount==-1;h=k.getMonth()>m&&this.weekCount==-1;if(k.getDay()==1){j[a].weekNum=
this.showWeekNumbers?k.format("W"):"&nbsp;";j[a].weekLinkId="ext-cal-week-"+k.format("Ymd")}if(f)b=e?this.getTodayText():k.format(this.dayCount==1?"l, F j, Y":b?"M j, Y":"M j");else{b=a==0&&this.showHeader!==true?"D j":"j";b=e?this.getTodayText():k.format(b)}j[a].push({title:b,date:k.clone(),titleCls:"ext-cal-dtitle "+(e?" ext-cal-dtitle-today":"")+(a==0?" ext-cal-dtitle-first":"")+(g?" ext-cal-dtitle-prev":"")+(h?" ext-cal-dtitle-next":""),cellCls:"ext-cal-day "+(e?" ext-cal-day-today":"")+(n==0?
" ext-cal-day-first":"")+(g?" ext-cal-day-prev":"")+(h?" ext-cal-day-next":"")});k=k.add(Date.DAY,1);b=false}}return Ext.calendar.BoxLayoutTemplate.superclass.applyTemplate.call(this,{weeks:j})},getTodayText:function(){var a=(new Date).format("l, F j, Y"),b=this.showTodayText!==false?this.todayText:"",e=this.showTime!==false?' <span id="'+this.id+'-clock" class="ext-cal-dtitle-time">'+(new Date).format("g:i a")+"</span>":"",f=b.length>0||e.length>0?" &mdash; ":"";if(this.dayCount==1)return a+f+b+
e;fmt=this.weekCount==1?"D j":"j";return b.length>0?b+e:(new Date).format(fmt)+e}});Ext.calendar.BoxLayoutTemplate.prototype.apply=Ext.calendar.BoxLayoutTemplate.prototype.applyTemplate;
Ext.calendar.MonthViewTemplate=function(a){Ext.apply(this,a);this.weekTpl=new Ext.calendar.BoxLayoutTemplate(a);this.weekTpl.compile();Ext.calendar.MonthViewTemplate.superclass.constructor.call(this,'<div class="ext-cal-inner-ct {extraClasses}">','<div class="ext-cal-hd-ct ext-cal-month-hd">',this.showWeekLinks?'<div class="ext-cal-week-link-hd">&nbsp;</div>':"",'<table class="ext-cal-hd-days-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for="days">','<th class="ext-cal-hd-day{[xindex==1 ? " ext-cal-day-first" : ""]}" title="{.:date("l, F j, Y")}">{.:date("D")}</th>',
"</tpl>","</tr>","</tbody>","</table>","</div>",'<div class="ext-cal-body-ct">{weeks}</div>',"</div>")};Ext.extend(Ext.calendar.MonthViewTemplate,Ext.XTemplate,{applyTemplate:function(a){var b=[],e=this.weekTpl.apply(a);a=a.viewStart;for(var f=0;f<7;f++)b.push(a.add(Date.DAY,f));a=this.showHeader===true?"":"ext-cal-noheader";if(this.showWeekLinks)a+=" ext-cal-week-links";return Ext.calendar.MonthViewTemplate.superclass.applyTemplate.call(this,{days:b,weeks:e,extraClasses:a})}});
Ext.calendar.MonthViewTemplate.prototype.apply=Ext.calendar.MonthViewTemplate.prototype.applyTemplate;
Ext.dd.ScrollManager=function(){var a=Ext.dd.DragDropMgr,b={},e=null,f={},g=function(){a.dragCurrent&&a.refreshCache(a.dragCurrent.groups)},h=function(){if(a.dragCurrent){var k=Ext.dd.ScrollManager,m=f.el.ddScrollConfig?f.el.ddScrollConfig.increment:k.increment;if(k.animate)f.el.scroll(f.dir,m,true,k.animDuration,g);else f.el.scroll(f.dir,m)&&g()}},j=function(){f.id&&clearInterval(f.id);f.id=0;f.el=null;f.dir=""},l=function(k,m){j();f.el=k;f.dir=m;var n=k.ddScrollConfig&&k.ddScrollConfig.frequency?
k.ddScrollConfig.frequency:Ext.dd.ScrollManager.frequency,p=k.ddScrollConfig?k.ddScrollConfig.ddGroup:undefined;if(p===undefined||a.dragCurrent.ddGroup==p)f.id=setInterval(h,n)};a.fireEvents=a.fireEvents.createSequence(function(k,m){if(!(m||!a.dragCurrent)){var n=Ext.dd.ScrollManager;if(!e||e!=a.dragCurrent){e=a.dragCurrent;n.refreshCache()}var p=Ext.lib.Event.getXY(k);p=new Ext.lib.Point(p[0],p[1]);var t,s,u,o;for(t in b)if(b.hasOwnProperty(t)){s=b[t];u=s._region;o=s.ddScrollConfig?s.ddScrollConfig:
n;if(u&&u.contains(p)&&s.isScrollable())if(u.bottom-p.y<=o.vthresh){f.el!=s&&l(s,"down");return}else if(u.right-p.x<=o.hthresh){f.el!=s&&l(s,"left");return}else if(p.y-u.top<=o.vthresh){f.el!=s&&l(s,"up");return}else if(p.x-u.left<=o.hthresh){f.el!=s&&l(s,"right");return}}j()}},a);a.stopDrag=a.stopDrag.createSequence(function(){e=null;j()},a);return{register:function(k){if(Ext.isArray(k))for(var m=0,n=k.length;m<n;m++)this.register(k[m]);else{k=Ext.get(k);b[k.id]=k}},unregister:function(k){if(Ext.isArray(k))for(var m=
0,n=k.length;m<n;m++)this.unregister(k[m]);else{k=Ext.get(k);delete b[k.id]}},vthresh:25,hthresh:25,increment:100,frequency:500,animate:true,animDuration:0.4,refreshCache:function(){for(var k in b)if(b.hasOwnProperty(k))if(typeof b[k]=="object")b[k]._region=b[k].getRegion()}}}();
Ext.calendar.StatusProxy=function(a){Ext.apply(this,a);this.id=this.id||Ext.id();this.el=new Ext.Layer({dh:{id:this.id,cls:"ext-dd-drag-proxy x-dd-drag-proxy "+this.dropNotAllowed,cn:[{cls:"x-dd-drop-icon"},{cls:"ext-dd-ghost-ct",cn:[{cls:"x-dd-drag-ghost"},{cls:"ext-dd-msg"}]}]},shadow:!a||a.shadow!==false});this.ghost=Ext.get(this.el.dom.childNodes[1].childNodes[0]);this.message=Ext.get(this.el.dom.childNodes[1].childNodes[1]);this.dropStatus=this.dropNotAllowed};
Ext.extend(Ext.calendar.StatusProxy,Ext.dd.StatusProxy,{moveEventCls:"ext-cal-dd-move",addEventCls:"ext-cal-dd-add",update:function(a){if(typeof a=="string")this.ghost.update(a);else{this.ghost.update("");a.style.margin="0";this.ghost.dom.appendChild(a)}if(a=this.ghost.dom.firstChild){Ext.fly(a).setStyle("float","none").setHeight("auto");Ext.getDom(a).id+="-ddproxy"}},updateMsg:function(a){this.message.update(a)}});
Ext.calendar.DragZone=Ext.extend(Ext.dd.DragZone,{ddGroup:"CalendarDD",eventSelector:".ext-cal-evt",constructor:function(a,b){if(!Ext.calendar._statusProxyInstance)Ext.calendar._statusProxyInstance=new Ext.calendar.StatusProxy;this.proxy=Ext.calendar._statusProxyInstance;Ext.calendar.DragZone.superclass.constructor.call(this,a,b)},getDragData:function(a){var b=a.getTarget(this.eventSelector,3);if(b){a=this.view.getEventRecordFromEl(b);return{type:"eventdrag",ddel:b,eventStart:a.data[Ext.calendar.EventMappings.StartDate.name],
eventEnd:a.data[Ext.calendar.EventMappings.EndDate.name],proxy:this.proxy}}b=this.view.getDayAt(a.getPageX(),a.getPageY());if(b.el)return{type:"caldrag",start:b.date,proxy:this.proxy};return null},onInitDrag:function(a,b){if(this.dragData.ddel){var e=this.dragData.ddel.cloneNode(true),f=Ext.fly(e).child("dl");Ext.fly(e).setWidth("auto");f&&f.setHeight("auto");this.proxy.update(e);this.onStartDrag(a,b)}else this.dragData.start&&this.onStartDrag(a,b);this.view.onInitDrag();return true},afterRepair:function(){if(Ext.enableFx&&
this.dragData.ddel)Ext.Element.fly(this.dragData.ddel).highlight(this.hlColor||"c3daf9");this.dragging=false},getRepairXY:function(){if(this.dragData.ddel)return Ext.Element.fly(this.dragData.ddel).getXY()},afterInvalidDrop:function(){Ext.select(".ext-dd-shim").hide()}});
Ext.calendar.DropZone=Ext.extend(Ext.dd.DropZone,{ddGroup:"CalendarDD",eventSelector:".ext-cal-evt",shims:[],getTargetFromEvent:function(a){var b=this.dragOffset||0;b=a.getPageY()-b;a=this.view.getDayAt(a.getPageX(),b);return a.el?a:null},onNodeOver:function(a,b,e,f){b=Ext.calendar.Date;e=f.type=="eventdrag"?a.date:b.min(f.start,a.date);a=f.type=="eventdrag"?a.date.add(Date.DAY,b.diffDays(f.eventStart,f.eventEnd)):b.max(f.start,a.date);if(!this.dragStartDate||!this.dragEndDate||b.diffDays(e,this.dragStartDate)!=
0||b.diffDays(a,this.dragEndDate)!=0){this.dragStartDate=e;this.dragEndDate=a.clearTime().add(Date.DAY,1).add(Date.MILLI,-1);this.shim(e,a);var g=e.format("n/j");if(b.diffDays(e,a)>0)g+="-"+a.format("n/j");a=String.format(f.type=="eventdrag"?this.moveText:this.createText,g);f.proxy.updateMsg(a)}return this.dropAllowed},shim:function(a,b){this.currWeek=-1;var e=a.clone(),f=0,g,h,j=Ext.calendar.Date.diffDays(e,b)+1;for(Ext.each(this.shims,function(k){if(k)k.isActive=false});f++<j;){if(h=this.view.getDayEl(e)){var l=
this.view.getWeekIndex(e);g=this.shims[l];if(!g){g=this.createShim();this.shims[l]=g}if(l!=this.currWeek){g.boxInfo=h.getBox();this.currWeek=l}else{h=h.getBox();g.boxInfo.right=h.right;g.boxInfo.width=h.right-g.boxInfo.x}g.isActive=true}e=e.add(Date.DAY,1)}Ext.each(this.shims,function(k){if(k)if(k.isActive){k.show();k.setBox(k.boxInfo)}else k.isVisible()&&k.hide()})},createShim:function(){if(!this.shimCt){this.shimCt=Ext.get("ext-dd-shim-ct");if(!this.shimCt){this.shimCt=document.createElement("div");
this.shimCt.id="ext-dd-shim-ct";Ext.getBody().appendChild(this.shimCt)}}var a=document.createElement("div");a.className="ext-dd-shim";this.shimCt.appendChild(a);return new Ext.Layer({shadow:false,useDisplay:true,constrain:false},a)},clearShims:function(){Ext.each(this.shims,function(a){a&&a.hide()})},onContainerOver:function(){return this.dropAllowed},onCalendarDragComplete:function(){delete this.dragStartDate;delete this.dragEndDate;this.clearShims()},onNodeDrop:function(a,b,e,f){if(a&&f){if(f.type==
"eventdrag"){b=this.view.getEventRecordFromEl(f.ddel);a=Ext.calendar.Date.copyTime(b.data[Ext.calendar.EventMappings.StartDate.name],a.date);this.view.onEventDrop(b,a);this.onCalendarDragComplete();return true}if(f.type=="caldrag"){this.view.onCalendarEndDrag(this.dragStartDate,this.dragEndDate,this.onCalendarDragComplete.createDelegate(this));return true}}this.onCalendarDragComplete();return false},onContainerDrop:function(){this.onCalendarDragComplete();return false},destroy:function(){Ext.calendar.DropZone.superclass.destroy.call(this);
Ext.destroy(this.shimCt)}});
Ext.calendar.DayViewDragZone=Ext.extend(Ext.calendar.DragZone,{ddGroup:"DayViewDD",resizeSelector:".ext-evt-rsz",getDragData:function(a){var b=a.getTarget(this.resizeSelector,2,true);if(b){b=b.parent(this.eventSelector);a=this.view.getEventRecordFromEl(b);return{type:"eventresize",ddel:b.dom,eventStart:a.data[Ext.calendar.EventMappings.StartDate.name],eventEnd:a.data[Ext.calendar.EventMappings.EndDate.name],proxy:this.proxy}}if(b=a.getTarget(this.eventSelector,3)){a=this.view.getEventRecordFromEl(b);return{type:"eventdrag",
ddel:b,eventStart:a.data[Ext.calendar.EventMappings.StartDate.name],eventEnd:a.data[Ext.calendar.EventMappings.EndDate.name],proxy:this.proxy}}b=this.view.getDayAt(a.getPageX(),a.getPageY());if(b.el)return{type:"caldrag",dayInfo:b,proxy:this.proxy};return null}});
Ext.calendar.DayViewDropZone=Ext.extend(Ext.calendar.DropZone,{ddGroup:"DayViewDD",onNodeOver:function(a,b,e,f){var g,h,j;b=this.createText;if(f.type=="caldrag"){if(!this.dragStartMarker){this.dragStartMarker=a.el.parent().createChild({style:"position:absolute;"});this.dragStartMarker.setBox(a.timeBox);this.dragCreateDt=a.date}h=this.dragStartMarker.getBox();h.height=Math.ceil(Math.abs(e.xy[1]-h.y)/a.timeBox.height)*a.timeBox.height;if(e.xy[1]<h.y){h.height+=a.timeBox.height;h.y=h.y-h.height+a.timeBox.height;
j=this.dragCreateDt.add(Date.MINUTE,30)}else a.date=a.date.add(Date.MINUTE,30);this.shim(this.dragCreateDt,h);a=Ext.calendar.Date.copyTime(a.date,this.dragCreateDt);this.dragStartDate=Ext.calendar.Date.min(this.dragCreateDt,a);this.dragEndDate=j||Ext.calendar.Date.max(this.dragCreateDt,a);g=this.dragStartDate.format("g:ia-")+this.dragEndDate.format("g:ia")}else{h=Ext.get(f.ddel);j=h.parent().parent();h=h.getBox();h.width=j.getWidth();if(f.type=="eventdrag"){if(this.dragOffset===undefined){this.dragOffset=
a.timeBox.y-h.y;h.y=a.timeBox.y-this.dragOffset}else h.y=a.timeBox.y;g=a.date.format("n/j g:ia");h.x=a.el.getLeft();this.shim(a.date,h);b=this.moveText}if(f.type=="eventresize"){if(!this.resizeDt)this.resizeDt=a.date;h.x=j.getLeft();h.height=Math.ceil(Math.abs(e.xy[1]-h.y)/a.timeBox.height)*a.timeBox.height;if(e.xy[1]<h.y)h.y-=h.height;else a.date=a.date.add(Date.MINUTE,30);this.shim(this.resizeDt,h);a=Ext.calendar.Date.copyTime(a.date,this.resizeDt);e=Ext.calendar.Date.min(f.eventStart,a);a=Ext.calendar.Date.max(f.eventStart,
a);f.resizeDates={StartDate:e,EndDate:a};g=e.format("g:ia-")+a.format("g:ia");b=this.resizeText}}f.proxy.updateMsg(String.format(b,g));return this.dropAllowed},shim:function(a,b){Ext.each(this.shims,function(f){if(f){f.isActive=false;f.hide()}});var e=this.shims[0];if(!e){e=this.createShim();this.shims[0]=e}e.isActive=true;e.show();e.setBox(b)},onNodeDrop:function(a,b,e,f){if(a&&f){if(f.type=="eventdrag"){b=this.view.getEventRecordFromEl(f.ddel);this.view.onEventDrop(b,a.date);this.onCalendarDragComplete();
delete this.dragOffset;return true}if(f.type=="eventresize"){b=this.view.getEventRecordFromEl(f.ddel);this.view.onEventResize(b,f.resizeDates);this.onCalendarDragComplete();delete this.resizeDt;return true}if(f.type=="caldrag"){Ext.destroy(this.dragStartMarker);delete this.dragStartMarker;delete this.dragCreateDt;this.view.onCalendarEndDrag(this.dragStartDate,this.dragEndDate,this.onCalendarDragComplete.createDelegate(this));return true}}this.onCalendarDragComplete();return false}});
Ext.calendar.EventMappings={EventId:{name:"EventId",mapping:"id",type:"int"},CalendarId:{name:"CalendarId",mapping:"cid",type:"int"},Title:{name:"Title",mapping:"title",type:"string"},StartDate:{name:"StartDate",mapping:"start",type:"date",dateFormat:"c"},EndDate:{name:"EndDate",mapping:"end",type:"date",dateFormat:"c"},Location:{name:"Location",mapping:"loc",type:"string"},Notes:{name:"Notes",mapping:"notes",type:"string"},Url:{name:"Url",mapping:"url",type:"string"},IsAllDay:{name:"IsAllDay",mapping:"ad",
type:"boolean"},Reminder:{name:"Reminder",mapping:"rem",type:"string"},IsNew:{name:"IsNew",mapping:"n",type:"boolean"}};
(function(){var a=Ext.calendar.EventMappings;Ext.calendar.EventRecord=Ext.data.Record.create([a.EventId,a.CalendarId,a.Title,a.StartDate,a.EndDate,a.Location,a.Notes,a.Url,a.IsAllDay,a.Reminder,a.IsNew]);Ext.calendar.EventRecord.reconfigure=function(){Ext.calendar.EventRecord=Ext.data.Record.create([a.EventId,a.CalendarId,a.Title,a.StartDate,a.EndDate,a.Location,a.Notes,a.Url,a.IsAllDay,a.Reminder,a.IsNew])}})();
Ext.calendar.MonthDayDetailView=Ext.extend(Ext.BoxComponent,{initComponent:function(){Ext.calendar.CalendarView.superclass.initComponent.call(this);this.addEvents({eventsrendered:true});if(!this.el)this.el=document.createElement("div")},afterRender:function(){this.tpl=this.getTemplate();Ext.calendar.MonthDayDetailView.superclass.afterRender.call(this);this.el.on({click:this.view.onClick,mouseover:this.view.onMouseOver,mouseout:this.view.onMouseOut,scope:this.view})},getTemplate:function(){if(!this.tpl)this.tpl=
new Ext.XTemplate('<div class="ext-cal-mdv x-unselectable">','<table class="ext-cal-mvd-tbl" cellpadding="0" cellspacing="0">',"<tbody>",'<tpl for=".">','<tr><td class="ext-cal-ev">{markup}</td></tr>',"</tpl>","</tbody>","</table>","</div>");this.tpl.compile();return this.tpl},update:function(a){this.date=a;this.refresh()},refresh:function(){if(this.rendered){var a=this.view.getEventTemplate(),b=[];evts=this.store.queryBy(function(e){var f=this.date.clearTime(true).getTime(),g=e.data[Ext.calendar.EventMappings.StartDate.name].clearTime(true).getTime(),
h=f==g,j=false;if(!h){e=e.data[Ext.calendar.EventMappings.EndDate.name].clearTime(true).getTime();j=g<f&&e>=f}return h||j},this);evts.each(function(e){e=e.data;var f=Ext.calendar.EventMappings;e._renderAsAllDay=e[f.IsAllDay.name]||Ext.calendar.Date.diffDays(e[f.StartDate.name],e[f.EndDate.name])>0;e.spanLeft=Ext.calendar.Date.diffDays(e[f.StartDate.name],this.date)>0;e.spanRight=Ext.calendar.Date.diffDays(this.date,e[f.EndDate.name])>0;e.spanCls=e.spanLeft?e.spanRight?"ext-cal-ev-spanboth":"ext-cal-ev-spanleft":
e.spanRight?"ext-cal-ev-spanright":"";b.push({markup:a.apply(this.getTemplateEventData(e))})},this);this.tpl.overwrite(this.el,b);this.fireEvent("eventsrendered",this,this.date,evts.getCount())}},getTemplateEventData:function(a){a=this.view.getTemplateEventData(a);a._elId="dtl-"+a._elId;return a}});Ext.reg("monthdaydetailview",Ext.calendar.MonthDayDetailView);
Ext.calendar.CalendarPicker=Ext.extend(Ext.form.ComboBox,{fieldLabel:"Calendar",valueField:"CalendarId",displayField:"Title",triggerAction:"all",mode:"local",forceSelection:true,width:200,initComponent:function(){Ext.calendar.CalendarPicker.superclass.initComponent.call(this);this.tpl=this.tpl||'<tpl for="."><div class="x-combo-list-item ext-color-{'+this.valueField+'}"><div class="ext-cal-picker-icon">&nbsp;</div>{'+this.displayField+"}</div></tpl>"},afterRender:function(){Ext.calendar.CalendarPicker.superclass.afterRender.call(this);
this.wrap=this.el.up(".x-form-field-wrap");this.wrap.addClass("ext-calendar-picker");this.icon=Ext.DomHelper.append(this.wrap,{tag:"div",cls:"ext-cal-picker-icon ext-cal-picker-mainicon"})},setValue:function(a){this.wrap.removeClass("ext-color-"+this.getValue());if(!a&&this.store!==undefined)a=this.store.getAt(0).data.CalendarId;Ext.calendar.CalendarPicker.superclass.setValue.call(this,a);this.wrap.addClass("ext-color-"+a)}});Ext.reg("calendarpicker",Ext.calendar.CalendarPicker);
Ext.calendar.WeekEventRenderer=function(){var a=function(b,e,f){var g;if(b=Ext.get(b+"-wk-"+e)){b=b.child(".ext-cal-evt-tbl",true);(g=b.tBodies[0].childNodes[f+1])||(g=Ext.DomHelper.append(b.tBodies[0],"<tr></tr>"))}return Ext.get(g)};return{render:function(b){for(var e=0,f=b.eventGrid,g=b.viewStart.clone(),h=b.tpl,j=b.maxEventsPerDay!=undefined?b.maxEventsPerDay:999,l=b.weekCount<1?6:b.weekCount,k=b.weekCount==1?b.dayCount:7,m;e<l;e++)if(!f[e]||f[e].length==0){if(l==1){n=a(b.id,e,0);m={tag:"td",
cls:"ext-cal-ev",id:b.id+"-empty-0-day-"+g.format("Ymd"),html:"&nbsp;"};if(k>1)m.colspan=k;Ext.DomHelper.append(n,m)}g=g.add(Date.DAY,7)}else for(var n,p=0,t=f[e],s=g.clone(),u=s.add(Date.DAY,k).add(Date.MILLI,-1);p<k;p++){if(t[p]){for(var o=emptyCells=skipped=0,v=t[p],w=v.length;o<w;o++)if(v[o]){if(emptyCells>0&&o-emptyCells<j){n=a(b.id,e,o-emptyCells);m={tag:"td",cls:"ext-cal-ev",id:b.id+"-empty-"+w+"-day-"+g.format("Ymd")};if(emptyCells>1&&j-o>emptyCells)m.rowspan=Math.min(emptyCells,j-o);Ext.DomHelper.append(n,
m);emptyCells=0}if(o>=j)skipped++;else{m=v[o];if(!m.isSpan||m.isSpanStart){var q=m.data||m.event.data;q._weekIndex=e;q._renderAsAllDay=q[Ext.calendar.EventMappings.IsAllDay.name]||m.isSpanStart;q.spanLeft=q[Ext.calendar.EventMappings.StartDate.name].getTime()<s.getTime();q.spanRight=q[Ext.calendar.EventMappings.EndDate.name].getTime()>u.getTime();q.spanCls=q.spanLeft?q.spanRight?"ext-cal-ev-spanboth":"ext-cal-ev-spanleft":q.spanRight?"ext-cal-ev-spanright":"";n=a(b.id,e,o);m={tag:"td",cls:"ext-cal-ev",
cn:h.apply(b.templateDataFn(q))};q=Ext.calendar.Date.diffDays(g,q[Ext.calendar.EventMappings.EndDate.name])+1;q=Math.min(q,k-p);if(q>1)m.colspan=q;Ext.DomHelper.append(n,m)}}}else emptyCells++;if(o>j){n=a(b.id,e,j);Ext.DomHelper.append(n,{tag:"td",cls:"ext-cal-ev-more",id:"ext-cal-ev-more-"+g.format("Ymd"),cn:{tag:"a",html:"+"+skipped+" more..."}})}if(w<b.evtMaxCount[e])if(n=a(b.id,e,w)){m={tag:"td",cls:"ext-cal-ev",id:b.id+"-empty-"+(w+1)+"-day-"+g.format("Ymd")};o=b.evtMaxCount[e]-w;if(o>1)m.rowspan=
o;Ext.DomHelper.append(n,m)}}else if(n=a(b.id,e,0)){m={tag:"td",cls:"ext-cal-ev",id:b.id+"-empty-day-"+g.format("Ymd")};if(b.evtMaxCount[e]>1)m.rowSpan=b.evtMaxCount[e];Ext.DomHelper.append(n,m)}g=g.add(Date.DAY,1)}}}}();
Ext.calendar.CalendarView=Ext.extend(Ext.BoxComponent,{startDay:0,spansHavePriority:false,trackMouseOver:true,enableFx:true,enableAddFx:true,enableUpdateFx:false,enableRemoveFx:true,enableDD:true,monitorResize:true,ddCreateEventText:"Create event for {0}",ddMoveEventText:"Move event to {0}",ddResizeEventText:"Update event to {0}",weekCount:1,dayCount:1,eventSelector:".ext-cal-evt",eventOverClass:"ext-evt-over",eventElIdDelimiter:"-evt-",dayElIdDelimiter:"-day-",getEventBodyMarkup:Ext.emptyFn,getEventTemplate:Ext.emptyFn,
initComponent:function(){this.setStartDate(this.startDate||new Date);Ext.calendar.CalendarView.superclass.initComponent.call(this);this.addEvents({eventsrendered:true,eventclick:true,eventover:true,eventout:true,datechange:true,rangeselect:true,eventmove:true,initdrag:true,dayover:true,dayout:true})},afterRender:function(){Ext.calendar.CalendarView.superclass.afterRender.call(this);this.renderTemplate();this.store&&this.setStore(this.store,true);this.el.on({mouseover:this.onMouseOver,mouseout:this.onMouseOut,
click:this.onClick,resize:this.onResize,scope:this});this.el.unselectable();this.enableDD&&this.initDD&&this.initDD();this.on("eventsrendered",this.forceSize);this.forceSize.defer(100,this)},forceSize:function(){if(this.el&&this.el.child){var a=this.el.child(".ext-cal-hd-ct"),b=this.el.child(".ext-cal-body-ct");if(!(b==null||a==null)){a=a.getHeight();var e=this.el.parent().getSize();b.setHeight(e.height-a)}}},refresh:function(){this.prepareData();this.renderTemplate();this.renderItems()},getWeekCount:function(){var a=
Ext.calendar.Date.diffDays(this.viewStart,this.viewEnd);return Math.ceil(a/this.dayCount)},prepareData:function(){var a=this.startDate.getLastDateOfMonth(),b=0,e=this.viewStart.clone(),f=this.weekCount<1?6:this.weekCount;this.eventGrid=[[]];this.allDayGrid=[[]];this.evtMaxCount=[];for(var g=this.store.queryBy(function(j){return this.isEventVisible(j.data)},this);b<f;b++){this.evtMaxCount[b]=0;if(this.weekCount==-1&&e>a)break;this.eventGrid[b]=this.eventGrid[b]||[];this.allDayGrid[b]=this.allDayGrid[b]||
[];for(d=0;d<this.dayCount;d++){if(g.getCount()>0){var h=g.filterBy(function(j){var l=e.getTime()==j.data[Ext.calendar.EventMappings.StartDate.name].clearTime(true).getTime();j=b==0&&d==0&&e>j.data[Ext.calendar.EventMappings.StartDate.name];return l||j},this);this.sortEventRecordsForDay(h);this.prepareEventGrid(h,b,d)}e=e.add(Date.DAY,1)}}this.currentWeekCount=b},prepareEventGrid:function(a,b,e){var f=0;this.viewStart.clone();var g=this.maxEventsPerDay?this.maxEventsPerDay:999;a.each(function(h){var j=
Ext.calendar.EventMappings,l=Ext.calendar.Date.diffDays(Ext.calendar.Date.max(this.viewStart,h.data[j.StartDate.name]),Ext.calendar.Date.min(this.viewEnd,h.data[j.EndDate.name]))+1;if(l>1||Ext.calendar.Date.diffDays(h.data[j.StartDate.name],h.data[j.EndDate.name])>1){this.prepareEventGridSpans(h,this.eventGrid,b,e,l);this.prepareEventGridSpans(h,this.allDayGrid,b,e,l,true)}else{f=this.findEmptyRowIndex(b,e);this.eventGrid[b][e]=this.eventGrid[b][e]||[];this.eventGrid[b][e][f]=h;if(h.data[j.IsAllDay.name]){f=
this.findEmptyRowIndex(b,e,true);this.allDayGrid[b][e]=this.allDayGrid[b][e]||[];this.allDayGrid[b][e][f]=h}}if(this.evtMaxCount[b]<this.eventGrid[b][e].length)this.evtMaxCount[b]=Math.min(g+1,this.eventGrid[b][e].length);return true},this)},prepareEventGridSpans:function(a,b,e,f,g,h){var j=e,l=f;h=this.findEmptyRowIndex(e,f,h);var k=this.viewStart.clone(),m={event:a,isSpan:true,isSpanStart:true,spanLeft:false,spanRight:f==6};b[e][f]=b[e][f]||[];for(b[e][f][h]=m;--g;){k=k.add(Date.DAY,1);if(k>this.viewEnd)break;
if(++l>6){l=0;j++;h=this.findEmptyRowIndex(j,0)}b[j]=b[j]||[];b[j][l]=b[j][l]||[];b[j][l][h]={event:a,isSpan:true,isSpanStart:l==0,spanLeft:j>e&&l%7==0,spanRight:l==6&&g>1}}},findEmptyRowIndex:function(a,b,e){e=e?this.allDayGrid:this.eventGrid;a=e[a]?e[a][b]||[]:[];b=0;for(e=a.length;b<e;b++)if(a[b]==null)return b;return e},renderTemplate:function(){if(this.tpl){this.tpl.overwrite(this.el,this.getParams());this.lastRenderStart=this.viewStart.clone();this.lastRenderEnd=this.viewEnd.clone()}},disableStoreEvents:function(){this.monitorStoreEvents=
false},enableStoreEvents:function(a){this.monitorStoreEvents=true;a===true&&this.refresh()},onResize:function(){this.refresh()},onInitDrag:function(){this.fireEvent("initdrag",this)},onEventDrop:function(a,b){if(Ext.calendar.Date.compare(a.data[Ext.calendar.EventMappings.StartDate.name],b)!==0){var e=b.getTime()-a.data[Ext.calendar.EventMappings.StartDate.name].getTime();a.set(Ext.calendar.EventMappings.StartDate.name,b);a.set(Ext.calendar.EventMappings.EndDate.name,a.data[Ext.calendar.EventMappings.EndDate.name].add(Date.MILLI,
e));this.fireEvent("eventmove",this,a)}},onCalendarEndDrag:function(a,b,e){this.dragPending=true;var f={};f[Ext.calendar.EventMappings.StartDate.name]=a;f[Ext.calendar.EventMappings.EndDate.name]=b;this.fireEvent("rangeselect",this,f,this.onCalendarEndDragComplete.createDelegate(this,[e]))},onCalendarEndDragComplete:function(a){a();this.dragPending=false},onUpdate:function(a,b,e){if(this.monitorStoreEvents!==false)if(e==Ext.data.Record.COMMIT){this.refresh();this.enableFx&&this.enableUpdateFx&&this.doUpdateFx(this.getEventEls(b.data[Ext.calendar.EventMappings.EventId.name]),
{scope:this})}},doUpdateFx:function(a,b){this.highlightEvent(a,null,b)},onAdd:function(a,b){if(this.monitorStoreEvents!==false){var e=b[0];this.tempEventId=e.id;this.refresh();this.enableFx&&this.enableAddFx&&this.doAddFx(this.getEventEls(e.data[Ext.calendar.EventMappings.EventId.name]),{scope:this})}},doAddFx:function(a,b){a.fadeIn(Ext.apply(b,{duration:2}))},onRemove:function(a,b){if(this.monitorStoreEvents!==false)if(this.enableFx&&this.enableRemoveFx)this.doRemoveFx(this.getEventEls(b.data[Ext.calendar.EventMappings.EventId.name]),
{remove:true,scope:this,callback:this.refresh});else{this.getEventEls(b.data[Ext.calendar.EventMappings.EventId.name]).remove();this.refresh()}},doRemoveFx:function(a,b){a.fadeOut(b)},highlightEvent:function(a,b,e){if(this.enableFx){var f;!(Ext.isIE||Ext.isOpera)?a.highlight(b,e):a.each(function(g){g.highlight(b,Ext.applyIf({attr:"color"},e));(f=g.child(".ext-cal-evm"))&&f.highlight(b,e)},this)}},getEventIdFromEl:function(a){a=Ext.get(a);a=a.id.split(this.eventElIdDelimiter)[1];if(a.indexOf("-")>
-1)a=a.split("-")[0];return a},getEventId:function(a){if(a===undefined&&this.tempEventId)a=this.tempEventId;return a},getEventSelectorCls:function(a,b){return(b?".":"")+this.id+this.eventElIdDelimiter+this.getEventId(a)},getEventEls:function(a){a=Ext.select(this.getEventSelectorCls(this.getEventId(a),true),false,this.el.id);return new Ext.CompositeElement(a)},isToday:function(){var a=(new Date).clearTime().getTime();return this.viewStart.getTime()<=a&&this.viewEnd.getTime()>=a},onDataChanged:function(){this.refresh()},
isEventVisible:function(a){var b=this.viewStart.getTime(),e=this.viewEnd.getTime(),f=Ext.calendar.EventMappings,g=(a.data?a.data[f.StartDate.name]:a[f.StartDate.name]).getTime();f=(a.data?a.data[f.EndDate.name]:a[f.EndDate.name]).add(Date.SECOND,-1).getTime();a=f>=b&&f<=e;f=g<b&&f>e;return g>=b&&g<=e||a||f},isOverlapping:function(a,b){var e=a.data?a.data:a,f=b.data?b.data:b,g=Ext.calendar.EventMappings,h=e[g.StartDate.name].getTime(),j=e[g.EndDate.name].add(Date.SECOND,-1).getTime();e=f[g.StartDate.name].getTime();
f=f[g.EndDate.name].add(Date.SECOND,-1).getTime();if(j<h)j=h;if(f<e)f=e;g=j>=e&&j<=f;j=h<e&&j>f;return h>=e&&h<=f||g||j},getDayEl:function(a){return Ext.get(this.getDayId(a))},getDayId:function(a){if(Ext.isDate(a))a=a.format("Ymd");return this.id+this.dayElIdDelimiter+a},getStartDate:function(){return this.startDate},setStartDate:function(a,b){this.startDate=a.clearTime();this.setViewBounds(a);this.store.load({params:{start:this.viewStart.format("m-d-Y"),end:this.viewEnd.format("m-d-Y")}});b===true&&
this.refresh();this.fireEvent("datechange",this,this.startDate,this.viewStart,this.viewEnd)},setViewBounds:function(a){a=a||this.startDate;var b=a.getDay()-this.startDay;switch(this.weekCount){case 0:case 1:this.viewStart=this.dayCount<7?a:a.add(Date.DAY,-b).clearTime(true);this.viewEnd=this.viewStart.add(Date.DAY,this.dayCount||7).add(Date.SECOND,-1);break;case -1:a=a.getFirstDateOfMonth();b=a.getDay()-this.startDay;this.viewStart=a.add(Date.DAY,-b).clearTime(true);a=a.add(Date.MONTH,1).add(Date.SECOND,
-1);this.viewEnd=a.add(Date.DAY,6-a.getDay());break;default:this.viewStart=a.add(Date.DAY,-b).clearTime(true);this.viewEnd=this.viewStart.add(Date.DAY,this.weekCount*7).add(Date.SECOND,-1)}},getViewBounds:function(){return{start:this.viewStart,end:this.viewEnd}},sortEventRecordsForDay:function(a){a.length<2||a.sort("ASC",function(b,e){var f=b.data,g=e.data,h=Ext.calendar.EventMappings;if(f[h.IsAllDay.name])return-1;else if(g[h.IsAllDay.name])return 1;if(this.spansHavePriority){var j=Ext.calendar.Date.diffDays;
if(j(f[h.StartDate.name],f[h.EndDate.name])>0){if(j(g[h.StartDate.name],g[h.EndDate.name])>0){if(f[h.StartDate.name].getTime()==g[h.StartDate.name].getTime())return g[h.EndDate.name].getTime()-f[h.EndDate.name].getTime();return f[h.StartDate.name].getTime()-g[h.StartDate.name].getTime()}return-1}else if(j(g[h.StartDate.name],g[h.EndDate.name])>0)return 1}return f[h.StartDate.name].getTime()-g[h.StartDate.name].getTime()}.createDelegate(this))},moveTo:function(a,b){if(Ext.isDate(a)){this.setStartDate(a);
b!==false&&this.refresh();return this.startDate}return a},moveNext:function(){return this.moveTo(this.viewEnd.add(Date.DAY,1))},movePrev:function(a){return this.moveDays(-(Ext.calendar.Date.diffDays(this.viewStart,this.viewEnd)+1),a)},moveMonths:function(a,b){return this.moveTo(this.startDate.add(Date.MONTH,a),b)},moveWeeks:function(a,b){return this.moveTo(this.startDate.add(Date.DAY,a*7),b)},moveDays:function(a,b){return this.moveTo(this.startDate.add(Date.DAY,a),b)},moveToday:function(a){return this.moveTo(new Date,
a)},setStore:function(a,b){if(!b&&this.store){this.store.un("datachanged",this.onDataChanged,this);this.store.un("add",this.onAdd,this);this.store.un("remove",this.onRemove,this);this.store.un("update",this.onUpdate,this);this.store.un("clear",this.refresh,this)}if(a){a.on("datachanged",this.onDataChanged,this);a.on("add",this.onAdd,this);a.on("remove",this.onRemove,this);a.on("update",this.onUpdate,this);a.on("clear",this.refresh,this)}(this.store=a)&&a.getCount()>0&&this.refresh()},getEventRecord:function(a){return this.store.getAt(this.store.find(Ext.calendar.EventMappings.EventId.name,
a))},getEventRecordFromEl:function(a){return this.getEventRecord(this.getEventIdFromEl(a))},getParams:function(){return{viewStart:this.viewStart,viewEnd:this.viewEnd,startDate:this.startDate,dayCount:this.dayCount,weekCount:this.weekCount,title:this.getTitle()}},getTitle:function(){return this.startDate.format("F Y")},onClick:function(a){if(a=a.getTarget(this.eventSelector,5)){this.fireEvent("eventclick",this,this.getEventRecord(this.getEventIdFromEl(a)),a);return true}},onMouseOver:function(a,b){if(this.trackMouseOver!==
false&&(this.dragZone==undefined||!this.dragZone.dragging))this.handleEventMouseEvent(a,b,"over")||this.handleDayMouseEvent(a,b,"over")},onMouseOut:function(a,b){if(this.trackMouseOver!==false&&(this.dragZone==undefined||!this.dragZone.dragging))this.handleEventMouseEvent(a,b,"out")||this.handleDayMouseEvent(a,b,"out")},handleEventMouseEvent:function(a,b,e){b=a.getTarget(this.eventSelector,5,true);var f;if(b){a=Ext.get(a.getRelatedTarget());if(b==a||b.contains(a))return true;f=this.getEventIdFromEl(b);
if(this.eventOverClass!=""){a=this.getEventEls(f);a[e=="over"?"addClass":"removeClass"](this.eventOverClass)}this.fireEvent("event"+e,this,this.getEventRecord(f),b);return true}return false},getDateFromId:function(a,b){var e=a.split(b);return e[e.length-1]},handleDayMouseEvent:function(a,b,e){if(b=a.getTarget("td",3))if(b.id&&b.id.indexOf(this.dayElIdDelimiter)>-1){b=this.getDateFromId(b.id,this.dayElIdDelimiter);a=Ext.get(a.getRelatedTarget());var f;if(a)f=(f=a.is("td")?a:a.up("td",3))&&f.id?this.getDateFromId(f.id,
this.dayElIdDelimiter):"";if(!a||b!=f){if((f=this.getDayEl(b))&&this.dayOverClass!="")f[e=="over"?"addClass":"removeClass"](this.dayOverClass);this.fireEvent("day"+e,this,Date.parseDate(b,"Ymd"),f)}}},renderItems:function(){throw"This method must be implemented by a subclass";}});
Ext.calendar.MonthView=Ext.extend(Ext.calendar.CalendarView,{showTime:true,showTodayText:true,todayText:"Today",showHeader:false,showWeekLinks:false,showWeekNumbers:false,weekLinkOverClass:"ext-week-link-over",daySelector:".ext-cal-day",moreSelector:".ext-cal-ev-more",weekLinkSelector:".ext-cal-week-link",weekCount:-1,dayCount:7,moreElIdDelimiter:"-more-",weekLinkIdDelimiter:"ext-cal-week-",initComponent:function(){Ext.calendar.MonthView.superclass.initComponent.call(this);this.addEvents({dayclick:true,
weekclick:true,dayover:true,dayout:true})},initDD:function(){var a={view:this,createText:this.ddCreateEventText,moveText:this.ddMoveEventText,ddGroup:"MonthViewDD"};this.dragZone=new Ext.calendar.DragZone(this.el,a);this.dropZone=new Ext.calendar.DropZone(this.el,a)},onDestroy:function(){Ext.destroy(this.ddSelector);Ext.destroy(this.dragZone);Ext.destroy(this.dropZone);Ext.calendar.MonthView.superclass.onDestroy.call(this)},afterRender:function(){if(!this.tpl)this.tpl=new Ext.calendar.MonthViewTemplate({id:this.id,
showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime,showHeader:this.showHeader,showWeekLinks:this.showWeekLinks,showWeekNumbers:this.showWeekNumbers});this.tpl.compile();this.addClass("ext-cal-monthview ext-cal-ct");Ext.calendar.MonthView.superclass.afterRender.call(this)},onResize:function(){if(this.monitorResize){this.maxEventsPerDay=this.getMaxEventsPerDay();this.refresh()}},forceSize:function(){if(this.showWeekLinks&&this.el&&this.el.child){var a=this.el.select(".ext-cal-hd-days-tbl"),
b=this.el.select(".ext-cal-bg-tbl"),e=this.el.select(".ext-cal-evt-tbl"),f=this.el.child(".ext-cal-week-link").getWidth();f=this.el.getWidth()-f;a.setWidth(f);b.setWidth(f);e.setWidth(f)}Ext.calendar.MonthView.superclass.forceSize.call(this)},initClock:function(){if(Ext.fly(this.id+"-clock")!==null){this.prevClockDay=(new Date).getDay();this.clockTask&&Ext.TaskMgr.stop(this.clockTask);this.clockTask=Ext.TaskMgr.start({run:function(){var a=Ext.fly(this.id+"-clock"),b=new Date;if(b.getDay()==this.prevClockDay)a&&
a.update(b.format("g:i a"));else{this.prevClockDay=b.getDay();this.moveTo(b)}},scope:this,interval:1E3})}},getEventBodyMarkup:function(){if(!this.eventBodyMarkup)this.eventBodyMarkup='{Title}<tpl if="_isReminder"><i class="ext-cal-ic ext-cal-ic-rem">&nbsp;</i></tpl><tpl if="_isRecurring"><i class="ext-cal-ic ext-cal-ic-rcr">&nbsp;</i></tpl><tpl if="spanLeft"><i class="ext-cal-spl">&nbsp;</i></tpl><tpl if="spanRight"><i class="ext-cal-spr">&nbsp;</i></tpl>';return this.eventBodyMarkup},getEventTemplate:function(){if(!this.eventTpl){var a;
a=this.getEventBodyMarkup();a=!(Ext.isIE||Ext.isOpera)?new Ext.XTemplate('<div id="{_elId}" class="{_selectorCls} {_colorCls} {values.spanCls} ext-cal-evt ext-cal-evr">',a,"</div>"):new Ext.XTemplate('<tpl if="_renderAsAllDay">','<div id="{_elId}" class="{_selectorCls} {values.spanCls} {_colorCls} ext-cal-evt ext-cal-evo">','<div class="ext-cal-evm">','<div class="ext-cal-evi">',"</tpl>",'<tpl if="!_renderAsAllDay">','<div id="{_elId}" class="{_selectorCls} {_colorCls} ext-cal-evt ext-cal-evr">',
"</tpl>",a,'<tpl if="_renderAsAllDay">',"</div>","</div>","</tpl>","</div>");a.compile();this.eventTpl=a}return this.eventTpl},getTemplateEventData:function(a){var b=Ext.calendar.EventMappings,e=this.getEventSelectorCls(a[b.EventId.name]),f=a[b.Title.name];return Ext.applyIf({_selectorCls:e,_colorCls:"ext-color-"+(a[b.CalendarId.name]?a[b.CalendarId.name]:"default")+(a._renderAsAllDay?"-ad":""),_elId:e+"-"+a._weekIndex,_isRecurring:a.Recurrence&&a.Recurrence!="",_isReminder:a[b.Reminder.name]&&a[b.Reminder.name]!=
"",Title:(a[b.IsAllDay.name]?"":a[b.StartDate.name].format("g:ia "))+(!f||f.length==0?"(No title)":f)},a)},refresh:function(){this.detailPanel&&this.detailPanel.hide();Ext.calendar.MonthView.superclass.refresh.call(this);this.showTime!==false&&this.initClock()},renderItems:function(){Ext.calendar.WeekEventRenderer.render({eventGrid:this.allDayOnly?this.allDayGrid:this.eventGrid,viewStart:this.viewStart,tpl:this.getEventTemplate(),maxEventsPerDay:this.maxEventsPerDay,id:this.id,templateDataFn:this.getTemplateEventData.createDelegate(this),
evtMaxCount:this.evtMaxCount,weekCount:this.weekCount,dayCount:this.dayCount});this.fireEvent("eventsrendered",this)},getDayEl:function(a){return Ext.get(this.getDayId(a))},getDayId:function(a){if(Ext.isDate(a))a=a.format("Ymd");return this.id+this.dayElIdDelimiter+a},getWeekIndex:function(a){a=this.getDayEl(a).up(".ext-cal-wk-ct");return parseInt(a.id.split("-wk-")[1],10)},getDaySize:function(a){var b=this.el.getBox(),e=b.width/this.dayCount;b=b.height/this.getWeekCount();if(a)b=(a=this.el.select(".ext-cal-dtitle").first().parent("tr"))?
b-a.getHeight(true):b;return{height:b,width:e}},getEventHeight:function(){if(!this.eventHeight){var a=this.el.select(".ext-cal-evt").first();this.eventHeight=a?a.parent("tr").getHeight():18}return this.eventHeight},getMaxEventsPerDay:function(){var a=this.getDaySize(true).height,b=this.getEventHeight();return Math.max(Math.floor((a-b)/b),0)},getDayAt:function(a,b){var e=this.el.getBox(),f=this.getDaySize();e=this.viewStart.add(Date.DAY,Math.floor((b-e.y)/f.height)*7+Math.floor((a-e.x)/f.width));return{date:e,
el:this.getDayEl(e)}},moveNext:function(){return this.moveMonths(1)},movePrev:function(){return this.moveMonths(-1)},onInitDrag:function(){Ext.calendar.MonthView.superclass.onInitDrag.call(this);Ext.select(this.daySelector).removeClass(this.dayOverClass);this.detailPanel&&this.detailPanel.hide()},onMoreClick:function(a){if(this.detailPanel)this.detailPanel.setTitle(a.format("F j"));else this.detailPanel=new Ext.Panel({id:this.id+"-details-panel",title:a.format("F j"),layout:"fit",floating:true,renderTo:Ext.getBody(),
tools:[{id:"close",handler:function(b,e,f){f.hide()}}],items:{xtype:"monthdaydetailview",id:this.id+"-details-view",date:a,view:this,store:this.store,listeners:{eventsrendered:this.onDetailViewUpdated.createDelegate(this)}}});this.detailPanel.getComponent(this.id+"-details-view").update(a)},onDetailViewUpdated:function(a,b,e){a=this.detailPanel;var f=a.getFrameHeight(),g=this.getEventHeight();e=f+e*g+3;b=this.getDayEl(b);f=b.getBox();a.updateBox(f);a.setHeight(e);a.setWidth(Math.max(f.width,220));
a.show();a.getPositionEl().alignTo(b,"t-t?")},onHide:function(){Ext.calendar.MonthView.superclass.onHide.call(this);this.detailPanel&&this.detailPanel.hide()},onClick:function(a){this.detailPanel&&this.detailPanel.hide();if(!Ext.calendar.MonthView.superclass.onClick.apply(this,arguments)){this.dropZone&&this.dropZone.clearShims();var b=a.getTarget(this.weekLinkSelector,3);if(b){b=b.id.split(this.weekLinkIdDelimiter)[1];this.fireEvent("weekclick",this,Date.parseDate(b,"Ymd"))}else if(b=a.getTarget(this.moreSelector,
3)){b=b.id.split(this.moreElIdDelimiter)[1];this.onMoreClick(Date.parseDate(b,"Ymd"))}else if(b=a.getTarget("td",3))if(b.id&&b.id.indexOf(this.dayElIdDelimiter)>-1){b=b.id.split(this.dayElIdDelimiter);b=b[b.length-1];this.fireEvent("dayclick",this,Date.parseDate(b,"Ymd"),false,Ext.get(this.getDayId(b)))}}},handleDayMouseEvent:function(a,b,e){var f=a.getTarget(this.weekLinkSelector,3,true);f?f[e=="over"?"addClass":"removeClass"](this.weekLinkOverClass):Ext.calendar.MonthView.superclass.handleDayMouseEvent.apply(this,
arguments)}});Ext.reg("monthview",Ext.calendar.MonthView);
Ext.calendar.DayHeaderView=Ext.extend(Ext.calendar.MonthView,{weekCount:1,dayCount:1,allDayOnly:true,monitorResize:false,afterRender:function(){if(!this.tpl)this.tpl=new Ext.calendar.DayHeaderTemplate({id:this.id,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime});this.tpl.compile();this.addClass("ext-cal-day-header");Ext.calendar.DayHeaderView.superclass.afterRender.call(this)},forceSize:Ext.emptyFn,refresh:function(){Ext.calendar.DayHeaderView.superclass.refresh.call(this);this.recalcHeaderBox()},
recalcHeaderBox:function(){var a=this.el.child(".ext-cal-evt-tbl").getHeight();this.el.setHeight(a+7);Ext.isIE&&Ext.isStrict&&this.el.child(".ext-cal-hd-ad-inner").setHeight(a+4)},moveNext:function(a){this.moveDays(this.dayCount,a)},movePrev:function(a){this.moveDays(-this.dayCount,a)},onClick:function(a){var b=a.getTarget("td",3);if(b)if(b.id&&b.id.indexOf(this.dayElIdDelimiter)>-1){b=b.id.split(this.dayElIdDelimiter);b=b[b.length-1];this.fireEvent("dayclick",this,Date.parseDate(b,"Ymd"),true,Ext.get(this.getDayId(b)));
return}Ext.calendar.DayHeaderView.superclass.onClick.apply(this,arguments)}});Ext.reg("dayheaderview",Ext.calendar.DayHeaderView);
Ext.calendar.DayBodyView=Ext.extend(Ext.calendar.CalendarView,{dayColumnElIdDelimiter:"-day-col-",initComponent:function(){Ext.calendar.DayBodyView.superclass.initComponent.call(this);this.addEvents({eventresize:true,dayclick:true})},initDD:function(){var a={createText:this.ddCreateEventText,moveText:this.ddMoveEventText,resizeText:this.ddResizeEventText};this.el.ddScrollConfig={vthresh:Ext.isIE||Ext.isOpera?100:40,hthresh:-1,frequency:50,increment:100,ddGroup:"DayViewDD"};this.dragZone=new Ext.calendar.DayViewDragZone(this.el,
Ext.apply({view:this,containerScroll:true},a));this.dropZone=new Ext.calendar.DayViewDropZone(this.el,Ext.apply({view:this},a))},refresh:function(){var a=this.el.getScroll().top;this.prepareData();this.renderTemplate();this.renderItems();this.scrollReady&&this.scrollTo(a)},scrollTo:function(a,b){if(b=b||Ext.isIE||Ext.isOpera)(function(){this.el.scrollTo("top",a);this.scrollReady=true}).defer(10,this);else{this.el.scrollTo("top",a);this.scrollReady=true}},afterRender:function(){if(!this.tpl)this.tpl=
new Ext.calendar.DayBodyTemplate({id:this.id,dayCount:this.dayCount,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime});this.tpl.compile();this.addClass("ext-cal-body-ct");Ext.calendar.DayBodyView.superclass.afterRender.call(this);this.scrollTo(294)},forceSize:Ext.emptyFn,onEventResize:function(a,b){var e=Ext.calendar.Date,f=Ext.calendar.EventMappings.StartDate.name,g=Ext.calendar.EventMappings.EndDate.name;if(!(e.compare(a.data[f],b.StartDate)===0&&e.compare(a.data[g],
b.EndDate)===0)){a.set(f,b.StartDate);a.set(g,b.EndDate);this.fireEvent("eventresize",this,a)}},getEventBodyMarkup:function(){if(!this.eventBodyMarkup)this.eventBodyMarkup='{Title}<tpl if="_isReminder"><i class="ext-cal-ic ext-cal-ic-rem">&nbsp;</i></tpl><tpl if="_isRecurring"><i class="ext-cal-ic ext-cal-ic-rcr">&nbsp;</i></tpl>';return this.eventBodyMarkup},getEventTemplate:function(){if(!this.eventTpl){this.eventTpl=!(Ext.isIE||Ext.isOpera)?new Ext.XTemplate('<div id="{_elId}" class="{_selectorCls} {_colorCls} ext-cal-evt ext-cal-evr" style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">',
'<div class="ext-evt-bd">',this.getEventBodyMarkup(),"</div>",'<div class="ext-evt-rsz"><div class="ext-evt-rsz-h">&nbsp;</div></div>',"</div>"):new Ext.XTemplate('<div id="{_elId}" class="ext-cal-evt {_selectorCls} {_colorCls}-x" style="left: {_left}%; width: {_width}%; top: {_top}px;">','<div class="ext-cal-evb">&nbsp;</div>','<dl style="height: {_height}px;" class="ext-cal-evdm">','<dd class="ext-evt-bd">',this.getEventBodyMarkup(),"</dd>",'<div class="ext-evt-rsz"><div class="ext-evt-rsz-h">&nbsp;</div></div>',
"</dl>",'<div class="ext-cal-evb">&nbsp;</div>',"</div>");this.eventTpl.compile()}return this.eventTpl},getEventAllDayTemplate:function(){if(!this.eventAllDayTpl){var a;a=this.getEventBodyMarkup();a=!(Ext.isIE||Ext.isOpera)?new Ext.XTemplate('<div id="{_elId}" class="{_selectorCls} {_colorCls} {values.spanCls} ext-cal-evt ext-cal-evr" style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">',a,"</div>"):new Ext.XTemplate('<div id="{_elId}" class="ext-cal-evt" style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">',
'<div class="{_selectorCls} {values.spanCls} {_colorCls} ext-cal-evo">','<div class="ext-cal-evm">','<div class="ext-cal-evi">',a,"</div>","</div>","</div></div>");a.compile();this.eventAllDayTpl=a}return this.eventAllDayTpl},getTemplateEventData:function(a){var b=this.getEventSelectorCls(a[Ext.calendar.EventMappings.EventId.name]),e={},f=Ext.calendar.EventMappings;this.getTemplateEventBox(a);e._selectorCls=b;e._colorCls="ext-color-"+a[f.CalendarId.name]+(a._renderAsAllDay?"-ad":"");e._elId=b+(a._weekIndex?
"-"+a._weekIndex:"");e._isRecurring=a.Recurrence&&a.Recurrence!="";e._isReminder=a[f.Reminder.name]&&a[f.Reminder.name]!="";b=a[f.Title.name];e.Title=(a[f.IsAllDay.name]?"":a[f.StartDate.name].format("g:ia "))+(!b||b.length==0?"(No title)":b);return Ext.applyIf(e,a)},getTemplateEventBox:function(a){var b=a[Ext.calendar.EventMappings.StartDate.name],e=a[Ext.calendar.EventMappings.EndDate.name];b=b.getHours()*60+b.getMinutes();e=e.getHours()*60+e.getMinutes()-b;a._left=0;a._width=100;a._top=Math.round(b*
0.7)+1;a._height=Math.max(e*0.7-2,15)},renderItems:function(){for(var a=0,b=[],e,f,g,h;a<this.dayCount;a++){e=emptyCells=skipped=0;for(g=(f=this.eventGrid[0][a])?f.length:0;e<g;e++)if(evt=f[e]){h=evt.data||evt.event.data;if(!h._renderAsAllDay){Ext.apply(h,{cls:"ext-cal-ev",_positioned:true});b.push({data:this.getTemplateEventData(h),date:this.viewStart.add(Date.DAY,a)})}}}a=f=0;for(e=b.length;a<e;a++){evt=b[a].data;evt2=null;for(g=0;g<e;g++)if(a!=g){evt2=b[g].data;if(this.isOverlapping(evt,evt2)){evt._overlap=
evt._overlap==undefined?1:evt._overlap+1;if(a<g){if(evt._overcol===undefined)evt._overcol=0;evt2._overcol=evt._overcol+1;f=Math.max(f,evt2._overcol)}}}}for(a=0;a<e;a++){evt=b[a].data;if(evt._overlap!==undefined){g=100/(f+1);evt._width=g;evt._left=g*evt._overcol}g=this.getEventTemplate().apply(evt);h=this.id+"-day-col-"+b[a].date.format("Ymd");Ext.DomHelper.append(h,g)}this.fireEvent("eventsrendered",this)},getDayEl:function(a){return Ext.get(this.getDayId(a))},getDayId:function(a){if(Ext.isDate(a))a=
a.format("Ymd");return this.id+this.dayColumnElIdDelimiter+a},getDaySize:function(){var a=this.el.child(".ext-cal-day-col-inner").getBox();return{height:a.height,width:a.width}},getDayAt:function(a,b){var e=this.el.child(".ext-cal-day-times").getWidth(),f=this.el.getBox(),g=this.getDaySize(false),h=Math.floor((a-f.x-e)/g.width);e=this.el.getScroll();var j=this.el.child(".ext-cal-bg-row").getHeight()/2,l=Math.max(0,Math.ceil((b-f.y-j+e.top)/j)),k=l*30;h=this.viewStart.add(Date.DAY,h).add(Date.MINUTE,
k);k=this.getDayEl(h);var m=a;if(k)m=k.getLeft();return{date:h,el:k,timeBox:{x:m,y:l*21+f.y-e.top,width:g.width,height:j}}},onClick:function(a){if(!(this.dragPending||Ext.calendar.DayBodyView.superclass.onClick.apply(this,arguments)))if(a.getTarget(".ext-cal-day-times",3)===null){var b=a.getTarget("td",3);if(b)if(b.id&&b.id.indexOf(this.dayElIdDelimiter)>-1){b=this.getDateFromId(b.id,this.dayElIdDelimiter);this.fireEvent("dayclick",this,Date.parseDate(b,"Ymd"),true,Ext.get(this.getDayId(b,true)));
return}(b=this.getDayAt(a.xy[0],a.xy[1]))&&b.date&&this.fireEvent("dayclick",this,b.date,false,null)}}});Ext.reg("daybodyview",Ext.calendar.DayBodyView);
Ext.calendar.DayView=Ext.extend(Ext.Container,{showTime:true,showTodayText:true,todayText:"Today",ddCreateEventText:"Create event for {0}",ddMoveEventText:"Move event to {0}",dayCount:1,initComponent:function(){this.dayCount=this.dayCount>7?7:this.dayCount;var a=Ext.apply({},this.initialConfig);a.showTime=this.showTime;a.showTodatText=this.showTodayText;a.todayText=this.todayText;a.dayCount=this.dayCount;a.wekkCount=1;var b=Ext.applyIf({xtype:"dayheaderview",id:this.id+"-hd"},a);a=Ext.applyIf({xtype:"daybodyview",
id:this.id+"-bd"},a);this.items=[b,a];this.addClass("ext-cal-dayview ext-cal-ct");Ext.calendar.DayView.superclass.initComponent.call(this)},afterRender:function(){Ext.calendar.DayView.superclass.afterRender.call(this);this.header=Ext.getCmp(this.id+"-hd");this.body=Ext.getCmp(this.id+"-bd");this.body.on("eventsrendered",this.forceSize,this)},refresh:function(){this.header.refresh();this.body.refresh()},forceSize:function(){(function(){var a=this.el.up(".x-panel-body"),b=this.el.child(".ext-cal-day-header");
a=a.getHeight()-b.getHeight();this.el.child(".ext-cal-body-ct").setHeight(a)}).defer(10,this)},onResize:function(){this.forceSize()},getViewBounds:function(){return this.header.getViewBounds()},getStartDate:function(){return this.header.getStartDate()},setStartDate:function(a){this.header.setStartDate(a,true);this.body.setStartDate(a,true)},renderItems:function(){this.header.renderItems();this.body.renderItems()},isToday:function(){return this.header.isToday()},moveTo:function(a,b){this.header.moveTo(a,
b);this.body.moveTo(a,b)},moveNext:function(a){this.header.moveNext(a);this.body.moveNext(a)},movePrev:function(a){this.header.movePrev(a);this.body.movePrev(a)},moveDays:function(a,b){this.header.moveDays(a,b);this.body.moveDays(a,b)},moveToday:function(a){this.header.moveToday(a);this.body.moveToday(a)}});Ext.reg("dayview",Ext.calendar.DayView);Ext.calendar.WeekView=Ext.extend(Ext.calendar.DayView,{dayCount:7});Ext.reg("weekview",Ext.calendar.WeekView);
Ext.calendar.DateRangeField=Ext.extend(Ext.form.Field,{toText:"to",allDayText:"All day",onRender:function(a,b){if(!this.el){this.startDate=new Ext.form.DateField({id:this.id+"-start-date",format:"n/j/Y",width:100,listeners:{change:{fn:function(){this.checkDates("date","start")},scope:this}}});this.startTime=new Ext.form.TimeField({id:this.id+"-start-time",hidden:this.showTimes===false,labelWidth:0,hideLabel:true,width:90,listeners:{select:{fn:function(){this.checkDates("time","start")},scope:this}}});
this.endTime=new Ext.form.TimeField({id:this.id+"-end-time",hidden:this.showTimes===false,labelWidth:0,hideLabel:true,width:90,listeners:{select:{fn:function(){this.checkDates("time","end")},scope:this}}});this.endDate=new Ext.form.DateField({id:this.id+"-end-date",format:"n/j/Y",hideLabel:true,width:100,listeners:{change:{fn:function(){this.checkDates("date","end")},scope:this}}});this.allDay=new Ext.form.Checkbox({id:this.id+"-allday",hidden:this.showTimes===false||this.showAllDay===false,boxLabel:this.allDayText,
handler:function(e,f){this.startTime.setVisible(!f);this.endTime.setVisible(!f)},scope:this});this.toLabel=new Ext.form.Label({xtype:"label",id:this.id+"-to-label",text:this.toText});this.fieldCt=new Ext.Container({autoEl:{id:this.id},cls:"ext-dt-range",renderTo:a,layout:"table",layoutConfig:{columns:6},defaults:{hideParent:true},items:[this.startDate,this.startTime,this.toLabel,this.endTime,this.endDate,this.allDay]});this.fieldCt.ownerCt=this;this.el=this.fieldCt.getEl();this.items=new Ext.util.MixedCollection;
this.items.addAll([this.startDate,this.endDate,this.toLabel,this.startTime,this.endTime,this.allDay])}Ext.calendar.DateRangeField.superclass.onRender.call(this,a,b)},checkDates:function(a,b){var e=Ext.getCmp(this.id+"-start-"+a),f=Ext.getCmp(this.id+"-end-"+a),g=this.getDT("start"),h=this.getDT("end");if(g>h)if(b=="start")f.setValue(g);else{e.setValue(h);this.checkDates(a,"start")}a=="date"&&this.checkDates("time",b)},getValue:function(){return[this.getDT("start"),this.getDT("end"),this.allDay.getValue()]},
getDT:function(a){var b=this[a+"Time"].getValue(),e=this[a+"Date"].getValue();if(Ext.isDate(e))e=e.format(this[a+"Date"].format);else return null;if(b!=""&&this[a+"Time"].isVisible())return Date.parseDate(e+" "+b,this[a+"Date"].format+" "+this[a+"Time"].format);return Date.parseDate(e,this[a+"Date"].format)},setValue:function(a){if(Ext.isArray(a)){this.setDT(a[0],"start");this.setDT(a[1],"end");this.allDay.setValue(!!a[2])}else if(Ext.isDate(a)){this.setDT(a,"start");this.setDT(a,"end");this.allDay.setValue(false)}else if(a[Ext.calendar.EventMappings.StartDate.name]){this.setDT(a[Ext.calendar.EventMappings.StartDate.name],
"start");this.setDT(a[Ext.calendar.EventMappings.EndDate.name],"end")||this.setDT(a[Ext.calendar.EventMappings.StartDate.name],"end");this.allDay.setValue(!!a[Ext.calendar.EventMappings.IsAllDay.name])}},setDT:function(a,b){if(a&&Ext.isDate(a)){this[b+"Date"].setValue(a);this[b+"Time"].setValue(a.format(this[b+"Time"].format));return true}},isDirty:function(){var a=false;this.rendered&&!this.disabled&&this.items.each(function(b){if(b.isDirty()){a=true;return false}});return a},onDisable:function(){this.delegateFn("disable")},
onEnable:function(){this.delegateFn("enable")},reset:function(){this.delegateFn("reset")},delegateFn:function(a){this.items.each(function(b){b[a]&&b[a]()})},beforeDestroy:function(){Ext.destroy(this.fieldCt);Ext.calendar.DateRangeField.superclass.beforeDestroy.call(this)},getRawValue:Ext.emptyFn,setRawValue:Ext.emptyFn});Ext.reg("daterangefield",Ext.calendar.DateRangeField);
Ext.calendar.ReminderField=Ext.extend(Ext.form.ComboBox,{width:200,fieldLabel:"Reminder",mode:"local",triggerAction:"all",forceSelection:true,displayField:"desc",valueField:"value",initComponent:function(){Ext.calendar.ReminderField.superclass.initComponent.call(this);this.store=this.store||new Ext.data.ArrayStore({fields:["value","desc"],idIndex:0,data:[["","None"],["0","At start time"],["5","5 minutes before start"],["15","15 minutes before start"],["30","30 minutes before start"],["60","1 hour before start"],
["90","1.5 hours before start"],["120","2 hours before start"],["180","3 hours before start"],["360","6 hours before start"],["720","12 hours before start"],["1440","1 day before start"],["2880","2 days before start"],["4320","3 days before start"],["5760","4 days before start"],["7200","5 days before start"],["10080","1 week before start"],["20160","2 weeks before start"]]})},initValue:function(){this.value!==undefined?this.setValue(this.value):this.setValue("");this.originalValue=this.getValue()}});
Ext.reg("reminderfield",Ext.calendar.ReminderField);
Ext.calendar.EventEditForm=Ext.extend(Ext.form.FormPanel,{labelWidth:65,title:"Event Form",titleTextAdd:"Add Event",titleTextEdit:"Edit Event",bodyStyle:"background:transparent;padding:20px 20px 10px;",border:false,buttonAlign:"center",autoHeight:true,cls:"ext-evt-edit-form",newId:1E4,layout:"column",initComponent:function(){this.addEvents({eventadd:true,eventupdate:true,eventdelete:true,eventcancel:true});this.titleField=new Ext.form.TextField({fieldLabel:"Title",name:Ext.calendar.EventMappings.Title.name,
anchor:"90%"});this.dateRangeField=new Ext.calendar.DateRangeField({fieldLabel:"When",anchor:"90%"});this.reminderField=new Ext.calendar.ReminderField({name:"Reminder"});this.notesField=new Ext.form.TextArea({fieldLabel:"Notes",name:Ext.calendar.EventMappings.Notes.name,grow:true,growMax:150,anchor:"100%"});this.locationField=new Ext.form.TextField({fieldLabel:"Location",name:Ext.calendar.EventMappings.Location.name,anchor:"100%"});this.urlField=new Ext.form.TextField({fieldLabel:"Web Link",name:Ext.calendar.EventMappings.Url.name,
anchor:"100%"});var a=[this.titleField,this.dateRangeField,this.reminderField],b=[this.notesField,this.locationField,this.urlField];if(this.calendarStore){this.calendarField=new Ext.calendar.CalendarPicker({store:this.calendarStore,name:Ext.calendar.EventMappings.CalendarId.name});a.splice(2,0,this.calendarField)}this.items=[{id:"left-col",columnWidth:0.65,layout:"form",border:false,items:a},{id:"right-col",columnWidth:0.35,layout:"form",border:false,items:b}];this.fbar=[{text:"Save",scope:this,handler:this.onSave},
{cls:"ext-del-btn",text:"Delete",scope:this,handler:this.onDelete},{text:"Cancel",scope:this,handler:this.onCancel}];Ext.calendar.EventEditForm.superclass.initComponent.call(this)},loadRecord:function(a){this.form.loadRecord.apply(this.form,arguments);this.activeRecord=a;this.dateRangeField.setValue(a.data);this.calendarStore&&this.form.setValues({calendar:a.data[Ext.calendar.EventMappings.CalendarId.name]});if(this.isAdd=!!a.data[Ext.calendar.EventMappings.IsNew.name]){a.markDirty();this.setTitle(this.titleTextAdd);
Ext.select(".ext-del-btn").setDisplayed(false)}else{this.setTitle(this.titleTextEdit);Ext.select(".ext-del-btn").setDisplayed(true)}this.titleField.focus()},updateRecord:function(){var a=this.dateRangeField.getValue();this.form.updateRecord(this.activeRecord);this.activeRecord.set(Ext.calendar.EventMappings.StartDate.name,a[0]);this.activeRecord.set(Ext.calendar.EventMappings.EndDate.name,a[1]);this.activeRecord.set(Ext.calendar.EventMappings.IsAllDay.name,a[2])},onCancel:function(){this.cleanup(true);
this.fireEvent("eventcancel",this,this.activeRecord)},cleanup:function(){this.activeRecord&&this.activeRecord.dirty&&this.activeRecord.reject();delete this.activeRecord;this.form.isDirty()&&this.form.reset()},onSave:function(){if(this.form.isValid()){this.updateRecord();this.activeRecord.dirty?this.fireEvent(this.isAdd?"eventadd":"eventupdate",this,this.activeRecord):this.onCancel()}},onDelete:function(){this.fireEvent("eventdelete",this,this.activeRecord)}});Ext.reg("eventeditform",Ext.calendar.EventEditForm);
Ext.calendar.EventEditWindow=function(a){var b={xtype:"form",labelWidth:65,frame:false,bodyStyle:"background:transparent;padding:5px 10px 10px;",bodyBorder:false,border:false,items:[{id:"title",name:Ext.calendar.EventMappings.Title.name,fieldLabel:"Title",xtype:"textfield",anchor:"100%"},{xtype:"daterangefield",id:"date-range",anchor:"100%",fieldLabel:"When"}]};if(a.calendarStore){this.calendarStore=a.calendarStore;delete a.calendarStore;b.items.push({xtype:"calendarpicker",id:"calendar",name:"calendar",
anchor:"100%",store:this.calendarStore})}Ext.calendar.EventEditWindow.superclass.constructor.call(this,Ext.apply({titleTextAdd:"Add Event",titleTextEdit:"Edit Event",width:600,autocreate:true,border:true,closeAction:"hide",modal:false,resizable:false,buttonAlign:"left",savingMessage:"Saving changes...",deletingMessage:"Deleting event...",fbar:[{xtype:"tbtext",text:'<a href="#" id="tblink">Edit Details...</a>'},"->",{text:"Save",disabled:false,handler:this.onSave,scope:this},{id:"delete-btn",text:"Delete",
disabled:false,handler:this.onDelete,scope:this,hideMode:"offsets"},{text:"Cancel",disabled:false,handler:this.onCancel,scope:this}],items:b},a))};
Ext.extend(Ext.calendar.EventEditWindow,Ext.Window,{newId:1E4,initComponent:function(){Ext.calendar.EventEditWindow.superclass.initComponent.call(this);this.formPanel=this.items.items[0];this.addEvents({eventadd:true,eventupdate:true,eventdelete:true,eventcancel:true,editdetails:true})},afterRender:function(){Ext.calendar.EventEditWindow.superclass.afterRender.call(this);this.el.addClass("ext-cal-event-win");Ext.get("tblink").on("click",function(a){a.stopEvent();this.updateRecord();this.fireEvent("editdetails",
this,this.activeRecord)},this)},show:function(a,b){Ext.calendar.EventEditWindow.superclass.show.call(this,Ext.isIE8&&Ext.isStrict?null:b,function(){Ext.getCmp("title").focus(false,100)});Ext.getCmp("delete-btn")[a.data&&a.data[Ext.calendar.EventMappings.EventId.name]?"show":"hide"]();var e,f=this.formPanel.form;if(a.data){e=a;if(this.isAdd=!!e.data[Ext.calendar.EventMappings.IsNew.name]){e.markDirty();this.setTitle(this.titleTextAdd)}else this.setTitle(this.titleTextEdit)}else{this.isAdd=true;this.setTitle(this.titleTextAdd);
var g=Ext.calendar.EventMappings,h=a[g.StartDate.name],j=a[g.EndDate.name]||h.add("h",1);e=new Ext.calendar.EventRecord;e.data[g.EventId.name]=this.newId++;e.data[g.StartDate.name]=h;e.data[g.EndDate.name]=j;e.data[g.IsAllDay.name]=!!a[g.IsAllDay.name]||h.getDate()!=j.clone().add(Date.MILLI,1).getDate();e.data[g.IsNew.name]=true;f.reset()}f.loadRecord(e);this.calendarStore&&Ext.getCmp("calendar").setValue(e.data[Ext.calendar.EventMappings.CalendarId.name]);Ext.getCmp("date-range").setValue(e.data);
this.activeRecord=e;return this},roundTime:function(a,b){b=b||15;var e=parseInt(a.getMinutes(),10);return a.add("mi",b-e%b)},onCancel:function(){this.cleanup(true);this.fireEvent("eventcancel",this)},cleanup:function(a){this.activeRecord&&this.activeRecord.dirty&&this.activeRecord.reject();delete this.activeRecord;a===true&&this.hide()},updateRecord:function(){var a=this.formPanel.form,b=Ext.getCmp("date-range").getValue(),e=Ext.calendar.EventMappings;a.updateRecord(this.activeRecord);this.activeRecord.set(e.StartDate.name,
b[0]);this.activeRecord.set(e.EndDate.name,b[1]);this.activeRecord.set(e.IsAllDay.name,b[2]);this.activeRecord.set(e.CalendarId.name,this.formPanel.form.findField("calendar").getValue())},onSave:function(){if(this.formPanel.form.isValid()){this.updateRecord();this.activeRecord.dirty?this.fireEvent(this.isAdd?"eventadd":"eventupdate",this,this.activeRecord):this.onCancel()}},onDelete:function(){this.fireEvent("eventdelete",this,this.activeRecord)}});
Ext.calendar.CalendarPanel=Ext.extend(Ext.Panel,{showDayView:true,showWeekView:true,showMonthView:true,showNavBar:true,todayText:"Today",showTodayText:true,showTime:true,dayText:"Day",weekText:"Week",monthText:"Month",layoutConfig:{layoutOnCardChange:true,deferredRender:true},startDate:new Date,initComponent:function(){this.tbar={cls:"ext-cal-toolbar",border:true,buttonAlign:"center",items:[{id:this.id+"-tb-prev",handler:this.onPrevClick,scope:this,iconCls:"x-tbar-page-prev"}]};this.viewCount=0;if(this.showDayView){this.tbar.items.push({id:this.id+
"-tb-day",text:this.dayText,handler:this.onDayClick,scope:this,toggleGroup:"tb-views"});this.viewCount++}if(this.showWeekView){this.tbar.items.push({id:this.id+"-tb-week",text:this.weekText,handler:this.onWeekClick,scope:this,toggleGroup:"tb-views"});this.viewCount++}if(this.showMonthView||this.viewCount==0){this.tbar.items.push({id:this.id+"-tb-month",text:this.monthText,handler:this.onMonthClick,scope:this,toggleGroup:"tb-views"});this.viewCount++;this.showMonthView=true}this.tbar.items.push({id:this.id+
"-tb-next",handler:this.onNextClick,scope:this,iconCls:"x-tbar-page-next"});this.tbar.items.push("->");var a=this.viewCount-1;this.activeItem=this.activeItem===undefined?a:this.activeItem>a?a:this.activeItem;if(this.showNavBar===false){delete this.tbar;this.addClass("x-calendar-nonav")}Ext.calendar.CalendarPanel.superclass.initComponent.call(this);this.addEvents({eventadd:true,eventupdate:true,eventdelete:true,eventcancel:true,viewchange:true});this.layout="card";if(this.showDayView){a=Ext.apply({xtype:"dayview",
title:this.dayText,showToday:this.showToday,showTodayText:this.showTodayText,showTime:this.showTime},this.dayViewCfg);a.id=this.id+"-day";a.store=a.store||this.eventStore;this.initEventRelay(a);this.add(a)}if(this.showWeekView){a=Ext.applyIf({xtype:"weekview",title:this.weekText,showToday:this.showToday,showTodayText:this.showTodayText,showTime:this.showTime},this.weekViewCfg);a.id=this.id+"-week";a.store=a.store||this.eventStore;this.initEventRelay(a);this.add(a)}if(this.showMonthView){a=Ext.applyIf({xtype:"monthview",
title:this.monthText,showToday:this.showToday,showTodayText:this.showTodayText,showTime:this.showTime,listeners:{weekclick:{fn:function(b,e){this.showWeek(e)},scope:this}}},this.monthViewCfg);a.id=this.id+"-month";a.store=a.store||this.eventStore;this.initEventRelay(a);this.add(a)}this.add(Ext.applyIf({xtype:"eventeditform",id:this.id+"-edit",calendarStore:this.calendarStore,listeners:{eventadd:{scope:this,fn:this.onEventAdd},eventupdate:{scope:this,fn:this.onEventUpdate},eventdelete:{scope:this,
fn:this.onEventDelete},eventcancel:{scope:this,fn:this.onEventCancel}}},this.editViewCfg))},initEventRelay:function(a){a.listeners=a.listeners||{};a.listeners.afterrender={fn:function(b){this.relayEvents(b,["eventsrendered","eventclick","eventover","eventout","dayclick","eventmove","datechange","rangeselect","eventdelete","eventresize","initdrag"])},scope:this,single:true}},afterRender:function(){Ext.calendar.CalendarPanel.superclass.afterRender.call(this);this.fireViewChange()},onLayout:function(){Ext.calendar.CalendarPanel.superclass.onLayout.call(this);
if(!this.navInitComplete){this.updateNavState();this.navInitComplete=true}},onEventAdd:function(a,b){b.data[Ext.calendar.EventMappings.IsNew.name]=false;this.eventStore.add(b);this.hideEditForm();this.fireEvent("eventadd",this,b)},onEventUpdate:function(a,b){b.commit();this.hideEditForm();this.fireEvent("eventupdate",this,b)},onEventDelete:function(a,b){this.eventStore.remove(b);this.hideEditForm();this.fireEvent("eventdelete",this,b)},onEventCancel:function(a,b){this.hideEditForm();this.fireEvent("eventcancel",
this,b)},showEditForm:function(a){this.preEditView=this.layout.activeItem.id;this.setActiveView(this.id+"-edit");this.layout.activeItem.loadRecord(a);return this},hideEditForm:function(){if(this.preEditView){this.setActiveView(this.preEditView);delete this.preEditView}return this},setActiveView:function(a){var b=this.layout;b.setActiveItem(a);if(a==this.id+"-edit"){this.getTopToolbar().hide();this.doLayout()}else{b.activeItem.refresh();this.getTopToolbar().show();this.updateNavState()}this.activeView=
b.activeItem;this.fireViewChange()},fireViewChange:function(){var a=null,b=this.layout.activeItem;if(b.getViewBounds){vb=b.getViewBounds();a={activeDate:b.getStartDate(),viewStart:vb.start,viewEnd:vb.end}}this.fireEvent("viewchange",this,b,a)},updateNavState:function(){if(this.showNavBar!==false){var a=this.layout.activeItem.id.split(this.id+"-")[1];Ext.getCmp(this.id+"-tb-"+a).toggle(true)}},setStartDate:function(a){this.layout.activeItem.setStartDate(a,true);this.updateNavState();this.fireViewChange()},
showWeek:function(a){this.setActiveView(this.id+"-week");this.setStartDate(a)},onPrevClick:function(){this.startDate=this.layout.activeItem.movePrev();this.updateNavState();this.fireViewChange()},onNextClick:function(){this.startDate=this.layout.activeItem.moveNext();this.updateNavState();this.fireViewChange()},onDayClick:function(){this.setActiveView(this.id+"-day")},onWeekClick:function(){this.setActiveView(this.id+"-week")},onMonthClick:function(){this.setActiveView(this.id+"-month")},getActiveView:function(){return this.layout.activeItem}});
Ext.reg("calendarpanel",Ext.calendar.CalendarPanel);Ext.namespace("Ext.ux.Ribbon");
Ext.ux.Ribbon=Ext.extend(Ext.TabPanel,{titleId:null,constructor:function(a){this.titleId=[];Ext.apply(a,{baseCls:"x-plain ui-ribbon",margins:"0 0 0 0",plain:true,border:false,deferredRender:false,layoutOnTabChange:true,title:"",activeTab:0,listeners:{beforetabchange:function(e){e.expand()},afterrender:{scope:this,fn:function(){if(this.titleId.length>0)for(var e=0;e<this.titleId.length;e++)(r=Ext.get(this.titleId[e].id))&&r.on("click",this.titleId[e].fn)}}}});Ext.apply(this,Ext.apply(this.initialConfig,
a));if(a.items)for(var b=0;b<a.items.length;b++)this.initRibbon(a.items[b],b);Ext.ux.Ribbon.superclass.constructor.apply(this,arguments)},initRibbon:function(a){for(var b=[],e=0;e<a.ribbon.length;e++){c={xtype:"buttongroup",cls:"x-btn-group-ribbonstyle",defaults:{scale:"small",iconAlign:"left",minWidth:40},items:a.ribbon[e].items};title=a.ribbon[e].title||"";topTitle=a.ribbon[e].topTitle||false;if(onTitleClick=a.ribbon[e].onTitleClick||false){titleId="ux-ribbon-"+Ext.id();title='<span id="'+titleId+
'" style="cursor:pointer;">'+title+"</span>";this.titleId.push({id:titleId,fn:onTitleClick})}if(title!=="")topTitle?Ext.apply(c,{title:title}):Ext.apply(c,{footerCfg:{cls:"x-btn-group-header x-unselectable",tag:"span",html:title}});if(cfg=a.ribbon[e].cfg||null){Ext.applyIf(c,a.ribbon[e].cfg);cfg.defaults&&Ext.apply(c.defaults,cfg.defaults)}b.push(c)}Ext.apply(a,{baseCls:"x-plain",tbar:b})}});Ext.ns("Ext.ux");
Ext.ux.Lightbox=function(){var a={},b=[],e,f=false,g=[];return{overlayOpacity:0.85,animate:true,resizeSpeed:8,borderSize:10,labelImage:"Image",labelOf:"of",init:function(){this.resizeDuration=this.animate?(11-this.resizeSpeed)*0.15:0;this.overlayDuration=this.animate?0.2:0;if(!f){Ext.apply(this,Ext.util.Observable.prototype);Ext.util.Observable.constructor.call(this);this.addEvents("open","close");this.initMarkup();this.initEvents();f=true}},initMarkup:function(){a.shim=Ext.DomHelper.append(document.body,
{tag:"iframe",id:"ux-lightbox-shim"},true);a.overlay=Ext.DomHelper.append(document.body,{id:"ux-lightbox-overlay"},true);var h=new Ext.Template(this.getTemplate());a.lightbox=h.append(document.body,{},true);Ext.each(["outerImageContainer","imageContainer","image","hoverNav","navPrev","navNext","loading","loadingLink","outerDataContainer","dataContainer","data","details","caption","imageNumber","bottomNav","navClose"],function(j){a[j]=Ext.get("ux-lightbox-"+j)});Ext.each([a.overlay,a.lightbox,a.shim],
function(j){j.setVisibilityMode(Ext.Element.DISPLAY);j.hide()});h=(this.animate?250:1)+"px";a.outerImageContainer.setStyle({width:h,height:h})},getTemplate:function(){return['<div id="ux-lightbox">','<div id="ux-lightbox-outerImageContainer">','<div id="ux-lightbox-imageContainer">','<img id="ux-lightbox-image">','<div id="ux-lightbox-hoverNav">','<a href="#" id="ux-lightbox-navPrev"></a>','<a href="#" id="ux-lightbox-navNext"></a>',"</div>",'<div id="ux-lightbox-loading">','<a id="ux-lightbox-loadingLink"></a>',
"</div>","</div>","</div>",'<div id="ux-lightbox-outerDataContainer">','<div id="ux-lightbox-dataContainer">','<div id="ux-lightbox-data">','<div id="ux-lightbox-details">','<span id="ux-lightbox-caption"></span>','<span id="ux-lightbox-imageNumber"></span>',"</div>",'<div id="ux-lightbox-bottomNav">','<a href="#" id="ux-lightbox-navClose"></a>',"</div>","</div>","</div>","</div>","</div>"]},initEvents:function(){var h=function(j){j.preventDefault();this.close()};a.overlay.on("click",h,this);a.loadingLink.on("click",
h,this);a.navClose.on("click",h,this);a.lightbox.on("click",function(j){j.getTarget().id=="ux-lightbox"&&this.close()},this);a.navPrev.on("click",function(j){j.preventDefault();this.setImage(e-1)},this);a.navNext.on("click",function(j){j.preventDefault();this.setImage(e+1)},this)},register:function(h,j){if(g.indexOf(h)===-1){g.push(h);Ext.fly(document).on("click",function(l){var k=l.getTarget(h);if(k){l.preventDefault();this.open(k,h,j)}},this)}},open:function(h,j,l){l=l||false;this.setViewSize();
a.overlay.fadeIn({duration:this.overlayDuration,endOpacity:this.overlayOpacity,callback:function(){b=[];var k=0;if(l){var m=Ext.query(j);for(Ext.each(m,function(p){p.href&&b.push([p.href,p.title])});b[k][0]!=h.href;)k++}else b.push([h.href,h.title]);m=Ext.fly(document).getScroll();var n=m.top+Ext.lib.Dom.getViewportHeight()/10;a.lightbox.setStyle({top:n+"px",left:m.left+"px"}).show();this.setImage(k);this.fireEvent("open",b[k])},scope:this})},setViewSize:function(){var h=this.getViewSize();a.overlay.setStyle({width:h[0]+
"px",height:h[1]+"px"});a.shim.setStyle({width:h[0]+"px",height:h[1]+"px"}).show()},setImage:function(h){e=h;this.disableKeyNav();this.animate&&a.loading.show();a.image.hide();a.hoverNav.hide();a.navPrev.hide();a.navNext.hide();a.dataContainer.setOpacity(1.0E-4);a.imageNumber.hide();var j=new Image;j.onload=function(){a.image.dom.src=b[e][0];this.resizeImage(j.width,j.height)}.createDelegate(this);j.src=b[e][0]},resizeImage:function(h,j){var l=a.outerImageContainer.getWidth(),k=a.outerImageContainer.getHeight(),
m=h+this.borderSize*2,n=j+this.borderSize*2;l=l-m;var p=function(){a.hoverNav.setWidth(a.imageContainer.getWidth()+"px");a.navPrev.setHeight(j+"px");a.navNext.setHeight(j+"px");a.outerDataContainer.setWidth(m+"px");this.showImage()};k-n!=0||l!=0?a.outerImageContainer.shift({height:n,width:m,duration:this.resizeDuration,scope:this,callback:p,delay:50}):p.call(this)},showImage:function(){a.loading.hide();a.image.fadeIn({duration:this.resizeDuration,scope:this,callback:function(){this.updateDetails()}});
this.preloadImages()},updateDetails:function(){var h=a.data.getWidth(true)-a.navClose.getWidth()-10;a.details.setWidth((h>0?h:0)+"px");a.caption.update(b[e][1]);a.caption.show();if(b.length>1){a.imageNumber.update(this.labelImage+" "+(e+1)+" "+this.labelOf+"  "+b.length);a.imageNumber.show()}a.dataContainer.fadeIn({duration:this.resizeDuration/2,scope:this,callback:function(){var j=this.getViewSize();a.overlay.setHeight(j[1]+"px");this.updateNav()}})},updateNav:function(){this.enableKeyNav();a.hoverNav.show();
e>0&&a.navPrev.show();e<b.length-1&&a.navNext.show()},enableKeyNav:function(){Ext.fly(document).on("keydown",this.keyNavAction,this)},disableKeyNav:function(){Ext.fly(document).un("keydown",this.keyNavAction,this)},keyNavAction:function(h){h=h.getKey();if(h==88||h==67||h==27)this.close();else if(h==80||h==37)e!=0&&this.setImage(e-1);else if(h==78||h==39)e!=b.length-1&&this.setImage(e+1)},preloadImages:function(){var h;if(b.length>e+1){h=new Image;h.src=b[e+1][0]}if(e>0){h=new Image;h.src=b[e-1][0]}},
close:function(){this.disableKeyNav();a.lightbox.hide();a.overlay.fadeOut({duration:this.overlayDuration});a.shim.hide();this.fireEvent("close",e)},getViewSize:function(){return[Ext.lib.Dom.getViewWidth(),Ext.lib.Dom.getViewHeight()]}}}();Ext.onReady(Ext.ux.Lightbox.init,Ext.ux.Lightbox);Ext.namespace("Ext.ux.grid");Ext.ux.grid.GridHeaderFilters=function(a){a&&Ext.apply(this,a)};
Ext.extend(Ext.ux.grid.GridHeaderFilters,Ext.util.Observable,{height:26,padding:2,highlightOnFilter:true,highlightColor:"yellow",stateful:true,applyMode:"auto",filters:null,ensureFilteredVisible:true,applyFiltersText:"Apply filters",init:function(a){this.grid=a;this.gridView=null;this.panels=[];this.headerCells=null;this.grid.on("render",this.onRender,this);this.grid.on("columnmove",this.renderFilters.createDelegate(this,[false]),this);this.grid.on("columnresize",this.onColResize,this);this.grid.on("resize",
this.resizeAllFilterFields,this);if(this.stateful){this.grid.on("beforestatesave",this.saveFilters,this);this.grid.on("beforestaterestore",this.loadFilters,this)}this.grid.getColumnModel().on("hiddenchange",this.onColHidden,this);this.grid.addEvents({filterupdate:true});this.addEvents({render:true});Ext.ux.grid.GridHeaderFilters.superclass.constructor.call(this);this.grid.stateEvents[this.grid.stateEvents.length]="filterupdate";this.grid.headerFilters=this;this.grid.getHeaderFilter=function(b){if(!this.headerFilters)return null;
return this.headerFilters.filterFields[b]?this.headerFilters.getFieldValue(this.headerFilters.filterFields[b]):null};this.grid.setHeaderFilter=function(b,e){if(this.headerFilters){var f={};f[b]=e;this.setHeaderFilters(f)}};this.grid.setHeaderFilters=function(b,e,f){if(this.headerFilters){e&&this.resetHeaderFilters(false);if(arguments.length<3)f=true;var g=false,h;for(h in b)if(this.headerFilters.filterFields[h]){g=this.headerFilters.filterFields[h];this.headerFilters.setFieldValue(g,b[h]);this.headerFilters.applyFilter(g,
false);g=true}g&&f&&this.headerFilters.storeReload()}};this.grid.getHeaderFilterField=function(b){if(this.headerFilters)return this.headerFilters.filterFields[b]?this.headerFilters.filterFields[b]:null};this.grid.resetHeaderFilters=function(b){if(this.headerFilters){if(arguments.length==0)b=true;for(var e in this.headerFilters.filterFields){var f=this.headerFilters.filterFields[e];Ext.isFunction(f.clearValue)?f.clearValue():this.headerFilters.setFieldValue(f,"");this.headerFilters.applyFilter(f,false)}b&&
this.headerFilters.storeReload()}};this.grid.applyHeaderFilters=function(b){if(arguments.length==0)b=true;this.headerFilters.applyFilters(b)}},renderFilters:function(a){this.filterFields={};for(var b in this.panels)this.panels[b]!=null&&Ext.type(this.panels[b].destroy)=="function"&&this.panels[b].destroy();this.panels=[];this.cm=this.grid.getColumnModel();this.gridView=this.grid.view;this.headTr=Ext.DomQuery.selectNode("tr",this.gridView.mainHd.dom);this.headerCells=Ext.query("td",this.headTr);b=
this.cm.getColumnsBy(function(){return true});for(var e=0;e<b.length;e++){var f=b[e];this.panels[f.dataIndex]=this.createFilterPanel(f,this.grid)}if(this.isFiltered()){a&&this.storeReload();this.highlightFilters(true)}},onRender:function(){if(!this.filters)this.filters={};this.renderFilters(true);this.grid.store.on("load",function(){this.renderFilters(false)},this);this.fireEvent("render",this)},onRefresh:function(){this.renderFilters(false)},resizeAllFilterFields:function(){for(var a in this.panels){var b=
this.cm.findColumnIndex(a);if(b>=0){b=this.cm.getColumnWidth(b);var e=this.panels[a];if(e&&e!=null&&Ext.type(e.doLayout)=="function"){e.setWidth(b-2);e.doLayout(false,true)}}}},onColResize:function(a,b){var e=this.panels[this.cm.getDataIndex(a)];if(e&&e!=null){if(isNaN(b))b=0;e.setWidth(b<2?0:b-2);e.doLayout(false,true);if(a>0){var f=this.panels[this.cm.getDataIndex(a-1)];if(f&&f!=null&&Ext.type(f.doLayout)=="function"){e=this.cm.getColumnWidth(a-1);f.setWidth(e-2);f.doLayout(false,true)}}if(a+1<
this.cm.getColumnCount())if((f=this.panels[this.cm.getDataIndex(a+1)])&&f!=null&&Ext.type(f.doLayout)=="function"){e=this.cm.getColumnWidth(a+1);f.setWidth(e-2);f.doLayout(false,true)}}},onColHidden:function(a,b,e){if(!e)if((e=this.panels[a.getDataIndex(b)])&&e!=null){a=a.getColumnWidth(b);e.setWidth(a<2?0:a-2);e.doLayout(false,true)}},saveFilters:function(a,b){var e={},f;for(f in this.filters)e[f]=this.filters[f];b.gridHeaderFilters=e;return true},loadFilters:function(a,b){var e=b.gridHeaderFilters;
if(e){if(!this.filters)this.filters={};Ext.applyIf(this.filters,e)}},isFiltered:function(){for(var a in this.filters)if(this.filterFields[a]&&!Ext.isEmpty(this.filters[a]))return true;return false},highlightFilters:function(a){if(this.highlightOnFilter){a=a?this.highlightColor:"transparent";for(var b in this.filterFields){this.filterFields[b].highlightCtrl.getEl().dom.style.backgroundColor="transparent";if(!Ext.isEmpty(this.filters[b]))this.filterFields[b].highlightCtrl.getEl().dom.style.backgroundColor=
a}}},getFieldValue:function(a){return Ext.type(a.filterEncoder)=="function"?a.filterEncoder.call(a,a.getValue()):a.getValue()},setFieldValue:function(a,b){if(Ext.type(a.filterDecoder)=="function")b=a.filterDecoder.call(a,b);a.setValue(b)},applyFilter:function(a,b){if(arguments.length<2)b=true;if(a)if(a.isValid()){var e=this.getFieldValue(a);if(Ext.isEmpty(e)){if(this.filters[a.filterName]==e)b=false;delete this.grid.store.baseParams[a.filterName];delete this.filters[a.filterName]}else{if(this.filters[a.filterName]==
e)b=false;this.grid.store.baseParams[a.filterName]=e;this.filters[a.filterName]=e;if(this.ensureFilteredVisible){var f=this.grid.getColumnModel().findColumnIndex(a.dataIndex);f>=0&&this.grid.getColumnModel().isHidden(f)&&this.grid.getColumnModel().setHidden(f,false)}}this.highlightFilters(this.isFiltered());this.grid.fireEvent("filterupdate",a.filterName,e,a);b&&this.storeReload()}},applyFilters:function(a){if(arguments.length<1)a=true;for(var b in this.filterFields)this.applyFilter(this.filterFields[b],
false);a&&this.storeReload()},storeReload:function(){if(this.grid.store.lastOptions){var a={start:0};if(this.grid.store.lastOptions.params&&this.grid.store.lastOptions.params.limit)a.limit=this.grid.store.lastOptions.params.limit;this.grid.store.load({params:a})}},createFilterField:function(a,b){var e={};Ext.apply(e,b);Ext.apply(e,{dataIndex:a,stateful:false});if(e.applyFilterEvent){e.listeners={scope:this};e.listeners[e.applyFilterEvent]=function(f){this.applyFilter(f)}}else if(this.applyMode=="auto"||
this.applyMode=="change"||Ext.isEmpty(this.applyMode))e.listeners={change:function(f,g,h){if(g!=h){g=f.getXType();g=="combo"||g=="datefield"||this.applyFilter(f)}},select:function(f){this.applyFilter(f)},scope:this};else if(this.applyMode=="enter")e.listeners={specialkey:function(f,g){g.stopPropagation();g.getKey()==g.ENTER&&this.applyFilters()},scope:this};return e},configureField:function(a){this.filterFields[a.filterName]=a;if(Ext.isEmpty(this.filters[a.filterName])){if(a.value){a.setValue(a.value);
this.applyFilter(a,false)}}else{this.setFieldValue(a,this.filters[a.filterName]);this.applyFilter(a,false)}},createFilterPanel:function(a){var b=this.cm.getIndexById(a.id),e=Ext.get(this.headerCells[b]);if(Ext.isGecko)e.dom.style.MozUserSelect="text";var f=null;if(a.filter){f={width:this.cm.getColumnWidth(b)-2,height:this.height,border:false,bodyStyle:"background-color: transparent; padding: "+this.padding+"px",bodyBorder:false,layout:"fit",items:[],stateful:false};if(a.filter.constructor==Array){b=
{xtype:"compositefield",items:[]};for(var g in a.filter)if(a.filter.hasOwnProperty(g)){var h=a.filter[g];h=this.createFilterField(a.dataIndex,h);var j=h.filterName?h.filterName:a.dataIndex;h.filterName=j;h.flex=1;b.items.push(h)}f.items.push(b)}else{h=a.filter;Ext.apply(h,{margins:{top:2,left:2,right:2,bottom:2}});h=this.createFilterField(a.dataIndex,h);j=h.filterName?h.filterName:a.dataIndex;h.filterName=j;f.items.push(h)}f=new Ext.Panel(f);f.render(e);for(a=0;a<f.items.length;a++){e=f.items.get(a);
if(e.getXType()=="compositefield")for(g=0;g<e.items.length;g++){b=e.items.get(g);b.highlightCtrl=e.ownerCt;this.configureField(b)}else{e.highlightCtrl=e.ownerCt;this.configureField(e)}}}return f}});Ext.ns("Ext.ux.grid");
Ext.ux.grid.LockingHeaderGroupGridView=Ext.extend(Ext.grid.GridView,{lockText:"Lock",unlockText:"Unlock",rowBorderWidth:1,lockedBorderWidth:1,syncHeights:false,initTemplates:function(){var a=this.templates||{};if(!a.master)a.master=new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-locked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{lstyle}">{lockedHeader}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{lstyle}">{lockedBody}</div><div class="x-grid3-scroll-spacer"></div></div>',
"</div>",'<div class="x-grid3-viewport x-grid3-unlocked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{ostyle}">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{bstyle}">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',"</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>");if(!a.gcell)a.gcell=
new Ext.XTemplate('<td class="x-grid3-hd x-grid3-gcell x-grid3-td-{id} ux-grid-hd-group-row-{row} {cls}" style="{style}">','<div {tooltip} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"","{value}</div></td>");this.templates=a;this.hrowRe=/ux-grid-hd-group-row-(\d+)/;Ext.ux.grid.LockingHeaderGroupGridView.superclass.initTemplates.call(this)},getEditorParent:function(){return this.el.dom},initElements:function(){var a=
Ext.Element,b=this.grid.getGridEl().dom.firstChild,e=b.childNodes;this.el=new a(b);this.lockedWrap=new a(e[0]);this.lockedHd=new a(this.lockedWrap.dom.firstChild);this.lockedInnerHd=this.lockedHd.dom.firstChild;this.lockedScroller=new a(this.lockedWrap.dom.childNodes[1]);this.lockedBody=new a(this.lockedScroller.dom.firstChild);this.mainWrap=new a(e[1]);this.mainHd=new a(this.mainWrap.dom.firstChild);if(this.grid.hideHeaders){this.lockedHd.setDisplayed(false);this.mainHd.setDisplayed(false)}this.innerHd=
this.mainHd.dom.firstChild;this.scroller=new a(this.mainWrap.dom.childNodes[1]);this.forceFit&&this.scroller.setStyle("overflow-x","hidden");this.mainBody=new a(this.scroller.dom.firstChild);this.focusEl=new a(this.scroller.dom.childNodes[1]);this.resizeMarker=new a(e[2]);this.resizeProxy=new a(e[3]);this.focusEl.swallowEvent("click",true)},getLockedRows:function(){return this.hasRows()?this.lockedBody.dom.childNodes:[]},getLockedRow:function(a){return this.getLockedRows()[a]},getCell:function(a,
b){var e=this.cm.getLockedCount();if(b<e)return this.getLockedRow(a).getElementsByTagName("td")[b];return Ext.ux.grid.LockingHeaderGroupGridView.superclass.getCell.call(this,a,b-e)},getHeaderCell:function(a){var b=this.cm.getLockedCount();if(a<b)return this.lockedHd.dom.getElementsByTagName("td")[a];return this.mainHd.query(this.cellSelector)[a-b]},addRowClass:function(a,b){var e=this.getLockedRow(a);e&&this.fly(e).addClass(b);Ext.ux.grid.LockingHeaderGroupGridView.superclass.addRowClass.call(this,
a,b)},removeRowClass:function(a,b){var e=this.getLockedRow(a);e&&this.fly(e).removeClass(b);Ext.ux.grid.LockingHeaderGroupGridView.superclass.removeRowClass.call(this,a,b)},removeRow:function(a){Ext.removeNode(this.getLockedRow(a));Ext.ux.grid.LockingHeaderGroupGridView.superclass.removeRow.call(this,a)},removeRows:function(a,b){for(var e=this.lockedBody.dom,f=a;f<=b;f++)Ext.removeNode(e.childNodes[a]);Ext.ux.grid.LockingHeaderGroupGridView.superclass.removeRows.call(this,a,b)},syncScroll:function(a){this.lockedScroller.dom.scrollTop=
this.scroller.dom.scrollTop;Ext.ux.grid.LockingHeaderGroupGridView.superclass.syncScroll.call(this,a)},updateSortIcon:function(a,b){var e=this.sortClasses,f=this.lockedHd.select("td").removeClass(e),g=this.mainHd.select("td").removeClass(e),h=this.cm.getLockedCount();e=e[b=="DESC"?1:0];a<h?f.item(a).addClass(e):g.item(a-h).addClass(e)},updateAllColumnWidths:function(){var a=this.getTotalWidth(),b=this.cm.getColumnCount(),e=this.getLockedWidth(),f=this.cm.getLockedCount(),g=[],h,j;this.updateLockedWidth();
for(j=0;j<b;j++){g[j]=this.getColumnWidth(j);this.getHeaderCell(j).style.width=g[j]}var l=this.getLockedRows(),k=this.getRows(),m,n;j=0;for(h=k.length;j<h;j++){m=l[j];m.style.width=e;if(m.firstChild){m.firstChild.style.width=e;m=m.firstChild.rows[0];for(n=0;n<f;n++)m.childNodes[n].style.width=g[n]}m=k[j];m.style.width=a;if(m.firstChild){m.firstChild.style.width=a;m=m.firstChild.rows[0];for(n=f;n<b;n++)m.childNodes[n-f].style.width=g[n]}}this.updateGroupStyles();this.onAllColumnWidthsUpdated(g,a);
this.syncHeaderHeight()},onColumnWidthUpdated:function(){Ext.ux.grid.LockingHeaderGroupGridView.superclass.onColumnWidthUpdated.call(this,arguments);this.updateGroupStyles.call(this)},onAllColumnWidthsUpdated:function(){Ext.ux.grid.LockingHeaderGroupGridView.superclass.onAllColumnWidthsUpdated.call(this,arguments);this.updateGroupStyles.call(this)},updateColumnWidth:function(a){var b=this.getColumnWidth(a),e=this.cm.getLockedCount(),f,g,h;this.updateLockedWidth();if(a<e){f=this.getLockedRows();g=
this.getLockedWidth();e=a}else{f=this.getRows();g=this.getTotalWidth();e=a-e}this.getHeaderCell(a).style.width=b;for(var j=0,l=f.length;j<l;j++){h=f[j];h.style.width=g;if(h.firstChild){h.firstChild.style.width=g;h.firstChild.rows[0].childNodes[e].style.width=b}}this.onColumnWidthUpdated(a,b,this.getTotalWidth());this.syncHeaderHeight()},updateColumnHidden:function(a,b){var e=this.cm.getLockedCount(),f,g,h,j=b?"none":"";this.updateLockedWidth();if(a<e){f=this.getLockedRows();g=this.getLockedWidth();
e=a}else{f=this.getRows();g=this.getTotalWidth();e=a-e}this.getHeaderCell(a).style.display=j;for(var l=0,k=f.length;l<k;l++){h=f[l];h.style.width=g;if(h.firstChild){h.firstChild.style.width=g;h.firstChild.rows[0].childNodes[e].style.display=j}}this.onColumnHiddenUpdated(a,b,this.getTotalWidth());delete this.lastViewWidth;this.layout()},doRender:function(a,b,e,f,g,h){var j=this.templates,l=j.cell;j=j.row;for(var k=g-1,m="width:"+this.getTotalWidth()+";",n="width:"+this.getLockedWidth()+";",p=[],t=
[],s,u,o,v={},w={},q,y=0,A=b.length;y<A;y++){q=b[y];s=[];u=[];for(var z=y+f,x=0;x<g;x++){o=a[x];v.id=o.id;v.css=(x===0?"x-grid3-cell-first ":x==k?"x-grid3-cell-last ":"")+(this.cm.config[x].cellCls?" "+this.cm.config[x].cellCls:"");v.attr=v.cellAttr="";v.value=o.renderer(q.data[o.name],v,q,z,x,e);v.style=o.style;if(Ext.isEmpty(v.value))v.value="&#160;";if(this.markDirty&&q.dirty&&Ext.isDefined(q.modified[o.name]))v.css+=" x-grid3-dirty-cell";if(o.locked)u[u.length]=l.apply(v);else s[s.length]=l.apply(v)}o=
[];if(h&&(z+1)%2===0)o[0]="x-grid3-row-alt";if(q.dirty)o[1]=" x-grid3-dirty-row";w.cols=g;if(this.getRowClass)o[2]=this.getRowClass(q,z,w,e);w.alt=o.join(" ");w.cells=s.join("");w.tstyle=m;p[p.length]=j.apply(w);w.cells=u.join("");w.tstyle=n;t[t.length]=j.apply(w)}return[p.join(""),t.join("")]},processRows:function(a,b){if(!(!this.ds||this.ds.getCount()<1)){var e=this.getRows(),f=this.getLockedRows(),g,h;b=b||!this.grid.stripeRows;a=a||0;for(var j=0,l=e.length;j<l;++j){g=e[j];h=f[j];g.rowIndex=j;
h.rowIndex=j;if(!b){g.className=g.className.replace(this.rowClsRe," ");h.className=h.className.replace(this.rowClsRe," ");if((j+1)%2===0){g.className+=" x-grid3-row-alt";h.className+=" x-grid3-row-alt"}}if(this.syncHeights){g=Ext.get(g);h=Ext.get(h);var k=g.getHeight(),m=h.getHeight();if(k>m)h.setHeight(k);else m>k&&g.setHeight(m)}}if(a===0){Ext.fly(e[0]).addClass(this.firstRowCls);Ext.fly(f[0]).addClass(this.firstRowCls)}Ext.fly(e[e.length-1]).addClass(this.lastRowCls);Ext.fly(f[f.length-1]).addClass(this.lastRowCls)}},
afterRender:function(){if(this.ds&&this.cm){var a=this.renderRows()||["&#160;","&#160;"];this.mainBody.dom.innerHTML=a[0];this.lockedBody.dom.innerHTML=a[1];this.processRows(0,true);this.deferEmptyText!==true&&this.applyEmptyText()}},renderUI:function(){var a=this.renderHeaders(),b=this.templates.body.apply({rows:"&#160;"});a=this.templates.master.apply({body:b,header:a[0],ostyle:"width:"+this.getOffsetWidth()+";",bstyle:"width:"+this.getTotalWidth()+";",lockedBody:b,lockedHeader:a[1],lstyle:"width:"+
this.getLockedWidth()+";"});b=this.grid;b.getGridEl().dom.innerHTML=a;this.initElements();Ext.fly(this.innerHd).on("click",this.handleHdDown,this);Ext.fly(this.lockedInnerHd).on("click",this.handleHdDown,this);this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.lockedHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.scroller.on("scroll",this.syncScroll,this);if(b.enableColumnResize!==
false){this.splitZone=new Ext.grid.GridView.SplitDragZone(b,this.mainHd.dom);this.splitZone.setOuterHandleElId(Ext.id(this.lockedHd.dom));this.splitZone.setOuterHandleElId(Ext.id(this.mainHd.dom))}if(b.enableColumnMove){this.columnDrag=new Ext.grid.GridView.ColumnDragZone(b,this.innerHd);this.columnDrag.setOuterHandleElId(Ext.id(this.lockedInnerHd));this.columnDrag.setOuterHandleElId(Ext.id(this.innerHd));this.columnDrop=new Ext.grid.HeaderDropZone(b,this.mainHd.dom)}if(b.enableHdMenu!==false){this.hmenu=
new Ext.menu.Menu({id:b.id+"-hctx"});this.hmenu.add({itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"});this.grid.enableColLock!==false&&this.hmenu.add("-",{itemId:"lock",text:this.lockText,cls:"xg-hmenu-lock"},{itemId:"unlock",text:this.unlockText,cls:"xg-hmenu-unlock"});if(b.enableColumnHide!==false){this.colMenu=new Ext.menu.Menu({id:b.id+"-hcols-menu"});this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});
this.hmenu.add("-",{itemId:"columns",hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})}this.hmenu.on("itemclick",this.handleHdMenuClick,this)}if(b.trackMouseOver){this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut});this.lockedBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut})}if(b.enableDragDrop||b.enableDrag)this.dragZone=new Ext.grid.GridDragZone(b,{ddGroup:b.ddGroup||"GridDD"});this.updateHeaderSortState()},splitZoneConfig:{allowHeaderDrag:function(a){return!a.getTarget(null,
null,true).hasClass("ux-grid-hd-group-cell")}},columnDropConfig:{getTargetFromEvent:function(a){return this.view.findHeaderCell(Ext.lib.Event.getTarget(a))},positionIndicator:function(a,b,e){a=this.getDragDropData.call(this,a,b,e);if(a===false)return false;b=a.px+this.proxyOffsets[0];this.proxyTop.setLeftTop(b,a.r.top+this.proxyOffsets[1]);this.proxyTop.show();this.proxyBottom.setLeftTop(b,a.r.bottom);this.proxyBottom.show();return a.pt},onNodeDrop:function(a,b,e,f){b=f.header;if(b!=a){a=this.getDragDropData.call(this,
b,a,e);if(a===false)return false;e=this.grid.colModel;b=a.oldIndex<a.newIndex;f=e.rows;for(var g=a.row,h=f.length;g<h;g++){for(var j=f[g],l=j.length,k=0,m=1,n=l,p=0,t=0;p<l;p++){var s=j[p];if(a.oldIndex>=t&&a.oldIndex<t+s.colspan)k=p;if(a.oldIndex+a.colspan-1>=t&&a.oldIndex+a.colspan-1<t+s.colspan)m=p-k+1;if(a.newIndex>=t&&a.newIndex<t+s.colspan)n=p;t+=s.colspan}l=j.splice(k,m);f[g]=j.splice(0,n-(b?m:0)).concat(l).concat(j)}for(f=0;f<a.colspan;f++){g=a.oldIndex+(b?0:f);h=a.newIndex+(b?-1:f);e.moveColumn(g,
h);this.grid.fireEvent("columnmove",g,h)}return true}return false}},updateGroupStyles:function(a){for(var b=this.lockedHd.query(".x-grid3-header-offset > table"),e=this.getLockedWidth(),f=this.rows,g=[],h=0;h<b.length;h++){b[h].style.width=e;if(h<f.length){var j=b[h].firstChild.firstChild.childNodes;for(var l=g[h]=0,k=0;l<j.length;l++){var m=f[h][l];g[h]+=1;if(typeof a!="number"||a>=k&&a<k+m.colspan){var n=this.getGroupStyle.call(this,m,k);j[l].style.width=n.width;j[l].style.display=n.hidden?"none":
""}k+=m.colspan}}}b=this.mainHd.query(".x-grid3-header-offset > table");e=this.getTotalWidth();f=this.rows;for(h=0;h<b.length;h++){b[h].style.width=e;if(h<f.length){j=b[h].firstChild.firstChild.childNodes;l=0;for(k=this.cm.getLockedCount();l<j.length;l++){m=f[h][g[h]+l];if(typeof a!="number"||a>=k&&a<k+m.colspan){n=this.getGroupStyle.call(this,m,k);j[l].style.width=n.width;j[l].style.display=n.hidden?"none":""}k+=m.colspan}}}},getGroupRowIndex:function(a){if(a)if((a=a.className.match(this.hrowRe))&&
a[1])return parseInt(a[1],10);return this.cm.rows.length},layout:function(){if(this.mainBody){var a=this.grid,b=a.getGridEl().getSize(true),e=b.width;if(!(!a.hideHeaders&&(e<20||b.height<20))){this.syncHeaderHeight();if(a.autoHeight){this.scroller.dom.style.overflow="visible";this.lockedScroller.dom.style.overflow="visible";if(Ext.isWebKit){this.scroller.dom.style.position="static";this.lockedScroller.dom.style.position="static"}}else{this.el.setSize(b.width,b.height);a=this.mainHd.getHeight();var f=
b.height-a}this.updateLockedWidth();if(this.forceFit){if(this.lastViewWidth!=e){this.fitColumns(false,false);this.lastViewWidth=e}}else{this.autoExpand();this.syncHeaderScroll()}this.onLayout(e,f)}}},getGroupSpan:function(a,b){if(a<0)return{col:0,colspan:this.cm.getColumnCount()};var e=this.cm.rows[a];if(e){for(var f=0,g=0,h=e.length;f<h;f++){var j=e[f];if(b>=g&&b<g+j.colspan)return{col:g,colspan:j.colspan};g+=j.colspan}return{col:g,colspan:0}}return{col:b,colspan:1}},getOffsetWidth:function(){return this.cm.getTotalWidth()-
this.cm.getTotalLockedWidth()+this.getScrollOffset()+"px"},renderHeaders:function(){var a=this.cm,b=this.templates;b=b.hcell;for(var e=[],f=[],g={},h=a.getColumnCount(),j=h-1,l=0;l<h;l++){g.id=a.getColumnId(l);g.value=a.getColumnHeader(l)||"";g.style=this.getColumnStyle(l,true);g.tooltip=this.getColumnTooltip(l);g.css=(l===0?"x-grid3-cell-first ":l==j?"x-grid3-cell-last ":"")+(a.config[l].headerCls?" "+a.config[l].headerCls:"");if(a.config[l].align=="right")g.istyle="padding-right:16px";else delete g.istyle;
if(a.isLocked(l))f[f.length]=b.apply(g);else e[e.length]=b.apply(g)}b=this.templates;g=[];j=[];a=this.cm;for(var k=this.rows,m="width:"+this.getTotalWidth()+";",n=0,p=k.length;n<p;n++){var t=k[n],s=[],u=[],o=l=0;for(h=t.length;l<h;l++){var v=t[l];v.colspan=v.colspan||1;var w=this.getColumnId(v.dataIndex?a.findColumnIndex(v.dataIndex):o),q=this.getGroupStyle.call(this,v,o);w=b.gcell.apply({cls:"ux-grid-hd-group-cell",id:w,row:n,style:"width:"+q.width+";"+(q.hidden?"display:none;":"")+(v.align?"text-align:"+
v.align+";":""),tooltip:v.tooltip?(Ext.QuickTips.isEnabled()?"ext:qtip":"title")+'="'+v.tooltip+'"':"",istyle:v.align=="right"?"padding-right:16px":"",btn:this.grid.enableHdMenu&&v.header,value:v.header||"&nbsp;"});if(a.isLocked(v.dataIndex?a.findColumnIndex(v.dataIndex):o))u[l]=w;else s[l]=w;o+=v.colspan}g[n]=b.header.apply({tstyle:m,cells:s.join("")});j[n]=b.header.apply({tstyle:m,cells:u.join("")})}g.push(b.header.apply({cells:e.join(""),tstyle:"width:"+this.getTotalWidth()+";"}));j.push(b.header.apply({cells:f.join(""),
tstyle:"width:"+this.getLockedWidth()+";"}));return[g.join(""),j.join("")]},getGroupStyle:function(a,b){for(var e=0,f=true,g=b,h=b+a.colspan;g<h;g++)if(!this.cm.isHidden(g)){f=this.cm.getColumnWidth(g);if(typeof f=="number")e+=f;f=false}return{width:(Ext.isBorderBox||Ext.isWebKit&&!Ext.isSafari2?e:Math.max(e-this.borderWidth,0))+"px",hidden:f}},findHeaderCell:function(a){return a?this.fly(a).findParent("td.x-grid3-hd",this.cellSelectorDepth):false},findHeaderIndex:function(a){return(a=this.findHeaderCell(a))?
this.getCellIndex(a):false},updateHeaders:function(){var a=this.renderHeaders();this.innerHd.firstChild.innerHTML=a[0];this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=this.getTotalWidth();this.lockedInnerHd.firstChild.innerHTML=a[1];a=this.getLockedWidth();this.lockedInnerHd.firstChild.style.width=a;this.lockedInnerHd.firstChild.firstChild.style.width=a},getResolvedXY:function(a){if(!a)return null;var b=a.cell;a=a.row;return b?Ext.fly(b).getXY():
[this.scroller.getX(),Ext.fly(a).getY()]},syncFocusEl:function(a,b,e){Ext.ux.grid.LockingHeaderGroupGridView.superclass.syncFocusEl.call(this,a,b,b<this.cm.getLockedCount()?false:e)},ensureVisible:function(a,b,e){return Ext.ux.grid.LockingHeaderGroupGridView.superclass.ensureVisible.call(this,a,b,b<this.cm.getLockedCount()?false:e)},insertRows:function(a,b,e,f){a=a.getCount()-1;if(!f&&b===0&&e>=a)this.refresh();else{f||this.fireEvent("beforerowsinserted",this,b,e);var g=this.renderRows(b,e),h=this.getRow(b);
if(h){b===0&&this.removeRowClass(0,this.firstRowCls);Ext.DomHelper.insertHtml("beforeBegin",h,g[0]);h=this.getLockedRow(b);Ext.DomHelper.insertHtml("beforeBegin",h,g[1])}else{this.removeRowClass(a-1,this.lastRowCls);Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,g[0]);Ext.DomHelper.insertHtml("beforeEnd",this.lockedBody.dom,g[1])}if(f){if(b===0||b>=a)this.addRowClass(b,b===0?this.firstRowCls:this.lastRowCls)}else{this.fireEvent("rowsinserted",this,b,e);this.processRows(b)}}this.syncFocusEl(b)},
getColumnStyle:function(a,b){var e=!b?this.cm.config[a].cellStyle||this.cm.config[a].css||"":this.cm.config[a].headerStyle||"";e+="width:"+this.getColumnWidth(a)+";";if(this.cm.isHidden(a))e+="display:none;";var f=this.cm.config[a].align;if(f)e+="text-align:"+f+";";return e},getLockedWidth:function(){return this.cm.getTotalLockedWidth()+"px"},getTotalWidth:function(){return this.cm.getTotalWidth()-this.cm.getTotalLockedWidth()+"px"},getColumnData:function(){for(var a=[],b=this.cm,e=b.getColumnCount(),
f=0;f<e;f++){var g=b.getDataIndex(f);a[f]={name:!Ext.isDefined(g)?this.ds.fields.get(f).name:g,renderer:b.getRenderer(f),id:b.getColumnId(f),style:this.getColumnStyle(f),locked:b.isLocked(f)}}return a},renderBody:function(){var a=this.renderRows()||["&#160;","&#160;"];return[this.templates.body.apply({rows:a[0]}),this.templates.body.apply({rows:a[1]})]},refreshRow:function(a){Ext.ux.grid.LockingHeaderGroupGridView.superclass.refreshRow.call(this,a);a=Ext.isNumber(a)?a:this.ds.indexOf(a);this.getLockedRow(a).rowIndex=
a},refresh:function(a){this.fireEvent("beforerefresh",this);this.grid.stopEditing(true);var b=this.renderBody();this.mainBody.update(b[0]).setWidth(this.getTotalWidth());this.lockedBody.update(b[1]).setWidth(this.getLockedWidth());if(a===true){this.updateHeaders();this.updateHeaderSortState()}this.processRows(0,true);this.layout();this.applyEmptyText();this.fireEvent("refresh",this)},onDenyColumnLock:function(){},initData:function(a,b){this.cm&&this.cm.un("columnlockchange",this.onColumnLock,this);
Ext.ux.grid.LockingHeaderGroupGridView.superclass.initData.call(this,a,b);this.cm&&this.cm.on("columnlockchange",this.onColumnLock,this)},onColumnLock:function(){this.refresh(true)},handleHdMenuClick:function(a){var b=this.hdCtxIndex,e=this.cm,f=a.getItemId(),g=e.getLockedCount();switch(f){case "lock":if(e.getColumnCount(true)<=g+1){this.onDenyColumnLock();return}e.setLocked(b,true);if(g!=b){e.moveColumn(b,g);this.grid.fireEvent("columnmove",b,g)}break;case "unlock":if(g-1!=b){e.setLocked(b,false,
true);e.moveColumn(b,g-1);this.grid.fireEvent("columnmove",b,g-1)}else e.setLocked(b,false);break;default:return Ext.ux.grid.LockingHeaderGroupGridView.superclass.handleHdMenuClick.call(this,a)}return true},handleHdDown:function(a,b){var e=Ext.get(b);if(e.hasClass("x-grid3-hd-btn")){a.stopEvent();var f=this.findHeaderCell(b);Ext.fly(f).addClass("x-grid3-hd-menu-open");this.hdCtxIndex=e=this.getCellIndex(f);var g=this.hmenu.items,h=this.cm;g.get("asc").setDisabled(!h.isSortable(e));g.get("desc").setDisabled(!h.isSortable(e));
this.hmenu.on("hide",function(){Ext.fly(f).removeClass("x-grid3-hd-menu-open")},this,{single:true});this.hmenu.show(b,"tl-bl?")}else if(e.hasClass("ux-grid-hd-group-cell")||Ext.fly(b).up(".ux-grid-hd-group-cell"))a.stopEvent();if(this.grid.enableColLock!==false)if(Ext.fly(b).hasClass("x-grid3-hd-btn")){f=this.findHeaderCell(b);e=this.getCellIndex(f);g=this.hmenu.items;h=this.cm;g.get("lock").setDisabled(h.isLocked(e));g.get("unlock").setDisabled(!h.isLocked(e))}},handleHdOver:function(a,b){var e=
this.findHeaderCell(b);if(e&&!this.headersDisabled){this.activeHdRef=b;this.activeHdIndex=this.getCellIndex(e);var f=this.fly(e);this.activeHdRegion=f.getRegion();if(!(this.cm.isMenuDisabled(this.activeHdIndex)||f.hasClass("ux-grid-hd-group-cell"))){f.addClass("x-grid3-hd-over");if(this.activeHdBtn=f.child(".x-grid3-hd-btn"))this.activeHdBtn.dom.style.height=e.firstChild.offsetHeight-1+"px"}}},handleHdOut:function(a,b){var e=this.findHeaderCell(b);if(e&&(!Ext.isIE||!a.within(e,true))){this.activeHdRef=
null;this.fly(e).removeClass("x-grid3-hd-over");e.style.cursor=""}},syncHeaderHeight:function(){this.innerHd.firstChild.firstChild.style.height="auto";this.lockedInnerHd.firstChild.firstChild.style.height="auto";var a=this.innerHd.firstChild.firstChild.offsetHeight,b=this.lockedInnerHd.firstChild.firstChild.offsetHeight;a=(b>a?b:a)+"px";this.innerHd.firstChild.firstChild.style.height=a;this.lockedInnerHd.firstChild.firstChild.style.height=a},updateLockedWidth:function(){var a=this.cm.getTotalLockedWidth(),
b=this.cm.getTotalWidth()-a,e=this.grid.getGridEl().getSize(true),f=Ext.isBorderBox?0:this.lockedBorderWidth,g=Ext.isBorderBox?0:this.rowBorderWidth,h=e.width-a-f-g+"px",j=this.getScrollOffset();if(!this.grid.autoHeight){e=e.height-this.mainHd.getHeight()+"px";this.lockedScroller.dom.style.height=e;this.scroller.dom.style.height=e}this.lockedWrap.dom.style.width=a+g+"px";this.scroller.dom.style.width=h;this.mainWrap.dom.style.left=a+f+g+"px";if(this.innerHd){this.lockedInnerHd.firstChild.style.width=
a+"px";this.lockedInnerHd.firstChild.firstChild.style.width=a+"px";this.innerHd.style.width=h;this.innerHd.firstChild.style.width=b+g+j+"px";this.innerHd.firstChild.firstChild.style.width=b+"px"}if(this.mainBody){this.lockedBody.dom.style.width=a+g+"px";this.mainBody.dom.style.width=b+g+"px"}}});
Ext.ux.grid.LockingGroupColumnModel=Ext.extend(Ext.grid.ColumnModel,{isLocked:function(a){return this.config[a].locked===true},setLocked:function(a,b,e){if(this.isLocked(a)!=b){this.config[a].locked=b;e||this.fireEvent("columnlockchange",this,a,b)}},getTotalLockedWidth:function(){for(var a=0,b=0,e=this.config.length;b<e;b++)if(this.isLocked(b)&&!this.isHidden(b))a+=this.getColumnWidth(b);return a},getLockedCount:function(){for(var a=this.config.length,b=0;b<a;b++)if(!this.isLocked(b))return b;return a},
moveColumn:function(a,b){var e=this.isLocked(a),f=this.isLocked(b);if(a<b&&e&&!f)this.setLocked(a,false,true);else a>b&&!e&&f&&this.setLocked(a,true,true);Ext.ux.grid.LockingGroupColumnModel.superclass.moveColumn.apply(this,arguments)}});Ext.QuickTips.init();if(typeof console=="undefined")var console={log:function(){}};Ext.namespace("Ext.m3");var SOFTWARE_NAME="\u041f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0430 \u041c3";function assert(a,b){if(!a){console.error(b);throw Error(b);}}
function smart_eval(a){if(a!=undefined)if(a.substring(0,1)=="{"){if(a=Ext.util.JSON.decode(a))if(a.code){var b=a.code();b&&b instanceof Ext.Window&&typeof AppDesktop!="undefined"&&AppDesktop&&AppDesktop.getDesktop().createWindow(b);return b}else if(a.message&&a.message!="")Ext.Msg.show({title:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435",msg:a.message,buttons:Ext.Msg.OK,icon:a.success!=undefined&&!a.success?Ext.Msg.WARNING:Ext.Msg.Info})}else{try{b=eval(a)}catch(e){Ext.Msg.show({title:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435",
msg:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043d\u0435\u043f\u0440\u0435\u0434\u0432\u0438\u0434\u0435\u043d\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430!",buttons:Ext.Msg.OK,fn:Ext.emptyFn,animEl:"elId",icon:Ext.MessageBox.WARNING});throw e;}b&&b instanceof Ext.Window&&typeof AppDesktop!="undefined"&&AppDesktop&&AppDesktop.getDesktop().createWindow(b);return b}}Ext.ns("Ext.app.form");
Ext.app.form.SearchField=Ext.extend(Ext.form.TwinTriggerField,{initComponent:function(){Ext.app.form.SearchField.superclass.initComponent.call(this);this.on("specialkey",function(a,b){b.getKey()==b.ENTER&&this.onTrigger2Click()},this)},validationEvent:false,validateOnBlur:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:true,width:180,hasSearch:false,paramName:"filter",paramId:"id",nodeId:"-1",onTrigger1Click:function(){if(this.hasSearch){this.el.dom.value=
"";var a=this.getComponentForSearch();if(a instanceof Ext.grid.GridPanel){var b=a.getStore();b.baseParams=b.baseParams||{};b.baseParams[this.paramName]="";b.baseParams[this.paramId]=this.nodeId||"";b.reload({params:{start:0}})}else if(a instanceof Ext.ux.tree.TreeGrid){this.el.dom.value="";b=a.getLoader();b.baseParams=b.baseParams||{};b.baseParams[this.paramName]="";a=a.getRootNode();b.load(a);a.expand()}this.triggers[0].hide();this.hasSearch=false}},onTrigger2Click:function(){var a=this.getRawValue(),
b=this.getComponentForSearch();if(b instanceof Ext.grid.GridPanel){var e=b.getStore();e.baseParams=e.baseParams||{};e.baseParams[this.paramName]=a;e.baseParams[this.paramId]=this.nodeId||"";e.reload({params:{start:0}})}else if(b instanceof Ext.ux.tree.TreeGrid){e=b.getLoader();e.baseParams=e.baseParams||{};e.baseParams[this.paramName]=a;b=b.getRootNode();e.load(b);b.expand()}if(a){this.hasSearch=true;this.triggers[0].show()}},clear:function(){this.onTrigger1Click()},search:function(){this.onTrigger2Click()}});
Ext.override(Ext.form.Field,{isEdit:true,isModified:false,updateLabel:function(){this.setFieldLabel(this.fieldLabel)},setFieldLabel:function(a){if(a!=undefined){if(this.rendered){var b=a+":";if(this.isModified)b='<span style="color:darkmagenta;">'+b+"</span>";var e=this.el.up(".x-form-item",10,true);e&&e.child(".x-form-item-label").update(b)}this.fieldLabel=a}},fireKey:function(a){if(a.isSpecialKey()){a.getKey()==a.ENTER&&this.onBlur();this.fireEvent("specialkey",this,a)}}});
Ext.app.TitlePanel=Ext.extend(Ext.Panel,{titleItems:null,addTitleItem:function(a){a=Ext.ComponentMgr.create(a);var b=Ext.DomHelper.append(this.header,{tag:"div",style:"float:right;margin-top:-4px;margin-left:3px;"},true);a.render(b)},onRender:function(){Ext.app.TitlePanel.superclass.onRender.apply(this,arguments);if(this.titleItems!=null){if(Ext.isArray(this.titleItems))for(var a=this.titleItems.length-1;a>=0;a--)this.addTitleItem(this.titleItems[a]);else this.addTitleItems(this.titleItems);this.header&&
this.header.removeClass("x-unselectable")}},getChildByName:function(a){if(this.items)for(var b=0;b<this.items.length;b++)if(this.items.items[b].name==a)return this.items.items[b];if(this.titleItems)for(b=0;b<this.titleItems.length;b++)if(this.titleItems[b].name==a)return this.titleItems[b];return null}});
function uiFailureResponseOnFormSubmit(a){if(a.action.failureType=="server"){obj=Ext.util.JSON.decode(a.action.response.responseText);Ext.Msg.show({title:a.title,msg:obj.error_msg,buttons:Ext.Msg.OK,icon:Ext.Msg.WARNING})}else Ext.Msg.alert(a.title,a.message)}
function uiAjaxFailMessage(a,b){if(Ext.isEmpty(a))Ext.Msg.alert(SOFTWARE_NAME,"\u0418\u0437\u0432\u0438\u043d\u0438\u0442\u0435, \u0441\u0435\u0440\u0432\u0435\u0440 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043d\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d.");else if(b.failureType==="server")b&&b.response&&b.response.responseText&&smart_eval(b.response.responseText);else{var e=Ext.getBody().getViewSize(),f=e.width<500?e.width-50:500;e=e.height<300?e.height-50:300;if(!a.responseText&&
b&&b.response)a=b.response;(new Ext.Window({modal:true,width:f,height:e,title:"Request Failure",layout:"fit",maximizable:true,maximized:true,listeners:{maximize:{fn:function(g){var h=Ext.getBody().getViewSize();g.setSize(h.width,h.height)},scope:this},resize:{fn:function(g){var h=Ext.getCmp("__ErrorMessageEditor");g=g.body.getViewSize();h.setSize(g.width,g.height-42)}}},items:new Ext.form.FormPanel({baseCls:"x-plain",layout:"absolute",defaultType:"label",items:[{x:5,y:5,html:'<div class="x-window-dlg"><div class="ext-mb-error" style="width:32px;height:32px"></div></div>'},
{x:42,y:6,html:"<b>Status Code: </b>"},{x:125,y:6,text:a.status},{x:42,y:25,html:"<b>Status Text: </b>"},{x:125,y:25,text:a.statusText},{x:0,y:42,id:"__ErrorMessageEditor",xtype:"htmleditor",value:a.responseText,readOnly:true,enableAlignments:false,enableColors:false,enableFont:false,enableFontSize:false,enableFormat:false,enableLinks:false,enableLists:false,enableSourceEdit:false,listeners:{push:{fn:function(){(function(g){try{for(var h=g.getElementsByTagName("script"),j=0;j<h.length;j++)h[j].innerText?
this.eval(h[j].innerText):this.eval(h[j].textContent);this.hideAll(this.getElementsByClassName(g,"table","vars"));this.hideAll(this.getElementsByClassName(g,"ol","pre-context"));this.hideAll(this.getElementsByClassName(g,"ol","post-context"));this.hideAll(this.getElementsByClassName(g,"div","pastebin"))}catch(l){}}).call(this.iframe.contentWindow,this.iframe.contentDocument)}}}}]})})).show()}}
function uiShowErrorMessage(a){obj=Ext.util.JSON.decode(a.responseText);obj.error_msg&&Ext.Msg.alert(SOFTWARE_NAME,obj.error_msg);return obj.success}function sendRequest(a,b,e){var f=new Ext.LoadMask(Ext.getBody());f.show();Ext.Ajax.request({params:e,url:a,method:"POST",success:function(g){try{smart_eval(g.responseText)}finally{f.hide()}},failure:function(){uiAjaxFailMessage.apply(this,arguments);f.hide()}})}
function thousandCurrencyRenderer(a){if(typeof a!="number"){var b=a;try{b=parseFloat(a.replace(/,+/,".").replace(/\s+/g,""))}catch(e){b=NaN}if(isNaN(b))return a;else a=b}b="";var f=a.toFixed(2).split(".");a=f[0];f=f[1];var g=0,h=0,j=a.length%3;if(j!=0){for(;h<j;h++)b+=a.charAt(h);b+=" "}for(;h<a.length;h++){if(g%3==0&&g!=0)b+=" ";b+=a.charAt(h);g++}if(f)b+=","+f;return b=b.replace(/\s,/,",")}Ext.m3.ComboBox=Ext.extend(Ext.form.ComboBox,{getText:function(){return this.lastSelectionText}});
Ext.m3.GridPanel=Ext.extend(Ext.grid.GridPanel,{constructor:function(a,b){var e=b.selModel,f=b.colModel||[];e&&e instanceof Ext.grid.CheckboxSelectionModel&&f.columns.unshift(e);var g;g=b.menus.contextMenu&&b.menus.contextMenu instanceof Ext.menu.Menu?function(k){k.stopEvent();b.menus.contextMenu.showAt(k.getXY())}:Ext.emptyFn;var h;h=b.menus.rowContextMenu&&b.menus.rowContextMenu instanceof Ext.menu.Menu?function(k,m,n){n.stopEvent();this.getSelectionModel().selectRow(m);b.menus.rowContextMenu.showAt(n.getXY())}:
Ext.emptyFn;var j=b.plugins||[],l=b.bundedColumns;l&&l instanceof Array&&l.length>0&&j.push(new Ext.ux.grid.ColumnHeaderGroup({rows:l}));a.listeners=Ext.applyIf({contextmenu:g,rowcontextmenu:h,beforerender:function(){var k=this.getBottomToolbar();if(k&&k instanceof Ext.PagingToolbar){var m=this.getStore();m.setBaseParam("start",0);m.setBaseParam("limit",k.pageSize);k.bind(m)}}},a.listeners||{});e=Ext.applyIf({sm:e,colModel:f,plugins:j},a);Ext.m3.GridPanel.superclass.constructor.call(this,e)},initComponent:function(){Ext.m3.GridPanel.superclass.initComponent.call(this);
this.getStore().on("exception",this.storeException,this)},storeException:function(a,b,e,f,g){uiAjaxFailMessage(g,f)}});
Ext.m3.EditorGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{constructor:function(a,b){var e=b.selModel,f=b.colModel||[];e&&e instanceof Ext.grid.CheckboxSelectionModel&&f.unshift(e);var g;g=b.menus.contextMenu&&b.menus.contextMenu instanceof Ext.menu.Menu?function(k){k.stopEvent();b.menus.contextMenu.showAt(k.getXY())}:Ext.emptyFn;var h;h=b.menus.rowContextMenu&&b.menus.contextMenu instanceof Ext.menu.Menu?function(k,m,n){n.stopEvent();this.getSelectionModel().selectRow(m);b.menus.rowContextMenu.showAt(n.getXY())}:
Ext.emptyFn;var j=b.plugins||[],l=b.bundedColumns;l&&l instanceof Array&&l.length>0&&j.push(new Ext.ux.grid.ColumnHeaderGroup({rows:l}));a.listeners=Ext.applyIf({contextmenu:g,rowcontextmenu:h,beforerender:function(){var k=this.getBottomToolbar();if(k&&k instanceof Ext.PagingToolbar){var m=this.getStore();m.setBaseParam("start",0);m.setBaseParam("limit",k.pageSize);k.bind(m)}}},a.listeners||{});e=Ext.applyIf({sm:e,colModel:f,plugins:j},a);Ext.m3.EditorGridPanel.superclass.constructor.call(this,e)},
initComponent:function(){Ext.m3.EditorGridPanel.superclass.initComponent.call(this);this.getStore().on("exception",this.storeException,this)},storeException:function(a,b,e,f,g){if(b=="remote"&&e!=Ext.data.Api.actions.read)g.raw.message&&Ext.Msg.show({title:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!",msg:g.raw.message,buttons:Ext.Msg.CANCEL,icon:Ext.Msg.WARNING});else uiAjaxFailMessage(g,f)}});
Ext.version=="3.0"&&Ext.override(Ext.grid.GridView,{ensureVisible:function(a,b,e){if((a=this.resolveCell(a,b,e))&&a.row){var f=a.row,g=a.cell;b=this.scroller.dom;var h=0,j=f,l=this.el.dom;j=f;for(l=this.el.dom;j&&j!=l;){h+=j.offsetTop;j=j.offsetParent}h-=this.mainHd.dom.offsetHeight;f=h+f.offsetHeight;j=b.clientHeight;l=parseInt(b.scrollTop,10);var k=l+j;if(h<l)b.scrollTop=h;else if(f>k)b.scrollTop=f-j;if(e!==false){e=parseInt(g.offsetLeft,10);g=e+g.offsetWidth;h=parseInt(b.scrollLeft,10);l=h+b.clientWidth;
if(e<h)b.scrollLeft=e;else if(g>l)b.scrollLeft=g-b.clientWidth}return this.getResolvedXY(a)}}});Ext.namespace("Ext.ux.maximgb.tg");
Ext.ux.maximgb.tg.AbstractTreeStore=Ext.extend(Ext.data.Store,{leaf_field_name:"_is_leaf",page_offset:0,active_node:null,constructor:function(a){Ext.ux.maximgb.tg.AbstractTreeStore.superclass.constructor.call(this,a);if(!this.paramNames.active_node)this.paramNames.active_node="anode";this.addEvents("beforeexpandnode","expandnode","expandnodefailed","beforecollapsenode","collapsenode","beforeactivenodechange","activenodechange")},remove:function(a){a===this.active_node&&this.setActiveNode(null);this.removeNodeDescendants(a);
Ext.ux.maximgb.tg.AbstractTreeStore.superclass.remove.call(this,a)},removeNodeDescendants:function(a){var b,e=this.getNodeChildren(a);a=0;for(b=e.length;a<b;a++)this.remove(e[a])},load:function(a){if(a)if(a.params){if(a.params[this.paramNames.active_node]===undefined)a.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null}else{a.params={};a.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null}else{a={params:{}};a.params[this.paramNames.active_node]=
this.active_node?this.active_node.id:null}if(a.params[this.paramNames.active_node]!==null)a.add=true;return Ext.ux.maximgb.tg.AbstractTreeStore.superclass.load.call(this,a)},loadRecords:function(a,b,e){if(!a||e===false){e!==false&&this.fireEvent("load",this,[],b);if(b.callback)b.callback.call(b.scope||this,[],b,false)}else{e=a.records;var f=a.totalRecords||e.length,g=this.getPageOffsetFromOptions(b);a=this.getLoadedNodeIdFromOptions(b);var h,j,l=this;if(!b||b.add!==true){if(this.pruneModifiedRecords)this.modified=
[];h=0;for(a=e.length;h<a;h++)e[h].join(this);if(this.snapshot){this.data=this.snapshot;delete this.snapshot}this.data.clear();this.data.addAll(e);this.page_offset=g;this.totalLength=f;this.applySort();this.fireEvent("datachanged",this)}else{if(a)h=this.getById(a);if(h){this.setNodeLoaded(h,true);this.setNodeChildrenOffset(h,g);this.setNodeChildrenTotalCount(h,Math.max(f,e.length));this.removeNodeDescendants(h)}this.suspendEvents();g={};h=0;for(a=e.length;h<a;h++){f=e[h];j=this.indexOfId(f.id);if(j==
-1){g[f.id]=false;this.add(f)}else{g[f.id]=true;j=this.getAt(j);j.reject();j.data=f.data;e[h]=j}}this.applySort();this.resumeEvents();e.sort(function(k,m){var n=l.data.indexOf(k),p=l.data.indexOf(m);return n>p?1:-1});h=0;for(a=e.length;h<a;h++){f=e[h];g[f.id]==true?this.fireEvent("update",this,f,Ext.data.Record.COMMIT):this.fireEvent("add",this,[f],this.data.indexOf(f))}}this.fireEvent("load",this,e,b);if(b.callback)b.callback.call(b.scope||this,e,b,true)}},sort:function(a,b){if(this.remoteSort){this.setActiveNode(null);
if(this.lastOptions){this.lastOptions.add=false;if(this.lastOptions.params)this.lastOptions.params[this.paramNames.active_node]=null}}return Ext.ux.maximgb.tg.AbstractTreeStore.superclass.sort.call(this,a,b)},applySort:function(){if(this.sortInfo&&!this.remoteSort){var a=this.sortInfo;this.sortData(a.field,a.direction)}else this.applyTreeSort()},sortData:function(a,b){b=b||"ASC";var e=this.fields.get(a).sortType,f=function(g,h){var j=e(g.data[a]),l=e(h.data[a]);return j>l?1:j<l?-1:0};this.data.sort(b,
f);this.snapshot&&this.snapshot!=this.data&&this.snapshot.sort(b,f);this.applyTreeSort()},applyTreeSort:function(){var a,b,e,f=[],g=this.getRootNodes();a=0;for(b=g.length;a<b;a++){e=g[a];f.push(e);this.collectNodeChildrenTreeSorted(f,e)}if(f.length>0){this.data.clear();this.data.addAll(f)}if(this.snapshot&&this.snapshot!==this.data){a=this.data;this.data=this.snapshot;this.snapshot=null;this.applyTreeSort();this.snapshot=this.data;this.data=a}},collectNodeChildrenTreeSorted:function(a,b){var e,f,
g,h=this.getNodeChildren(b);e=0;for(f=h.length;e<f;e++){g=h[e];a.push(g);this.collectNodeChildrenTreeSorted(a,g)}},getActiveNode:function(){return this.active_node},setActiveNode:function(a){if(this.active_node!==a)if(a)if(this.data.indexOf(a)!=-1){if(this.fireEvent("beforeactivenodechange",this,this.active_node,a)!==false){this.active_node=a;this.fireEvent("activenodechange",this,this.active_node,a)}}else throw"Given record is not from the store.";else if(this.fireEvent("beforeactivenodechange",
this,this.active_node,a)!==false){this.active_node=a;this.fireEvent("activenodechange",this,this.active_node,a)}},isExpandedNode:function(a){return a.ux_maximgb_tg_expanded===true},setNodeExpanded:function(a,b){a.ux_maximgb_tg_expanded=b},isVisibleNode:function(a){var b,e=this.getNodeAncestors(a),f=true;a=0;for(b=e.length;a<b;a++){f=f&&this.isExpandedNode(e[a]);if(!f)break}return f},isLeafNode:function(a){return a.get(this.leaf_field_name)==true},isLoadedNode:function(a){return a.ux_maximgb_tg_loaded!==
undefined?a.ux_maximgb_tg_loaded:this.isLeafNode(a)||this.hasChildNodes(a)?true:false},setNodeLoaded:function(a,b){a.ux_maximgb_tg_loaded=b},getNodeChildrenOffset:function(a){return a.ux_maximgb_tg_offset||0},setNodeChildrenOffset:function(a,b){a.ux_maximgb_tg_offset=b},getNodeChildrenTotalCount:function(a){return a.ux_maximgb_tg_total||0},setNodeChildrenTotalCount:function(a,b){a.ux_maximgb_tg_total=b},collapseNode:function(a){if(this.isExpandedNode(a)&&this.fireEvent("beforecollapsenode",this,a)!==
false){this.setNodeExpanded(a,false);this.fireEvent("collapsenode",this,a)}},expandNode:function(a){var b;if(!this.isExpandedNode(a)&&this.fireEvent("beforeexpandnode",this,a)!==false)if(this.isLoadedNode(a)){this.setNodeExpanded(a,true);this.fireEvent("expandnode",this,a)}else{b={};b[this.paramNames.active_node]=a.id;this.load({add:true,params:b,callback:this.expandNodeCallback,scope:this})}},expandNodeCallback:function(a,b,e){a=this.getById(b.params[this.paramNames.active_node]);if(e&&a){this.setNodeExpanded(a,
true);this.fireEvent("expandnode",this,a)}else this.fireEvent("expandnodefailed",this,b.params[this.paramNames.active_node],a)},expandAll:function(){var a,b,e,f=this.data.getRange();this.suspendEvents();b=0;for(e=f.length;b<e;b++){a=f[b];this.isExpandedNode(a)||this.expandNode(a)}this.resumeEvents();this.fireEvent("datachanged",this)},collapseAll:function(){var a,b,e,f=this.data.getRange();this.suspendEvents();b=0;for(e=f.length;b<e;b++){a=f[b];this.isExpandedNode(a)&&this.collapseNode(a)}this.resumeEvents();
this.fireEvent("datachanged",this)},getLoadedNodeIdFromOptions:function(a){var b=null;if(a&&a.params&&a.params[this.paramNames.active_node])b=a.params[this.paramNames.active_node];return b},getPageOffsetFromOptions:function(a){var b=0;if(a&&a.params&&a.params[this.paramNames.start]){b=parseInt(a.params[this.paramNames.start],10);if(isNaN(b))b=0}return b},hasNextSiblingNode:function(a){return this.getNodeNextSibling(a)!==null},hasPrevSiblingNode:function(a){return this.getNodePrevSibling(a)!==null},
hasChildNodes:function(a){return this.getNodeChildrenCount(a)>0},getNodeAncestors:function(a){var b=[];for(a=this.getNodeParent(a);a;){b.push(a);a=this.getNodeParent(a)}return b},getNodeChildrenCount:function(a){return this.getNodeChildren(a).length},getNodeNextSibling:function(a){var b,e=null;b=(b=this.getNodeParent(a))?this.getNodeChildren(b):this.getRootNodes();a=b.indexOf(a);if(a<b.length-1)e=b[a+1];return e},getNodePrevSibling:function(a){var b,e=null;b=(b=this.getNodeParent(a))?this.getNodeChildren(b):
this.getRootNodes();a=b.indexOf(a);if(a>0)e=b[a-1];return e},getRootNodes:function(){throw"Abstract method call";},getNodeDepth:function(){throw"Abstract method call";},getNodeParent:function(){throw"Abstract method call";},getNodeChildren:function(){throw"Abstract method call";},addToNode:function(){throw"Abstract method call";},removeFromNode:function(){throw"Abstract method call";},getPageOffset:function(){return this.page_offset},getActiveNodePageOffset:function(){return this.active_node?this.getNodeChildrenOffset(this.active_node):
this.getPageOffset()},getActiveNodeCount:function(){return this.active_node?this.getNodeChildrenCount(this.active_node):this.getRootNodes().length},getActiveNodeTotalCount:function(){return this.active_node?this.getNodeChildrenTotalCount(this.active_node):this.getTotalCount()}});
Ext.ux.maximgb.tg.AdjacencyListStore=Ext.extend(Ext.ux.maximgb.tg.AbstractTreeStore,{parent_id_field_name:"_parent",getRootNodes:function(){var a,b,e=[],f=this.data.getRange();a=0;for(b=f.length;a<b;a++)f[a].get(this.parent_id_field_name)==null&&e.push(f[a]);return e},getNodeDepth:function(a){return this.getNodeAncestors(a).length},getNodeParent:function(a){return this.getById(a.get(this.parent_id_field_name))},getNodeChildren:function(a){var b,e,f=[],g=this.data.getRange();b=0;for(e=g.length;b<e;b++)g[b].get(this.parent_id_field_name)==
a.id&&f.push(g[b]);return f},addToNode:function(a,b){b.set(this.parent_id_field_name,a.id);this.addSorted(b)},removeFromNode:function(a,b){this.remove(b)}});Ext.reg("Ext.ux.maximgb.tg.AdjacencyListStore",Ext.ux.maximgb.tg.AdjacencyListStore);
Ext.ux.maximgb.tg.NestedSetStore=Ext.extend(Ext.ux.maximgb.tg.AbstractTreeStore,{left_field_name:"_lft",right_field_name:"_rgt",level_field_name:"_level",root_node_level:1,getRootNodes:function(){var a,b,e=[],f=this.data.getRange();a=0;for(b=f.length;a<b;a++)f[a].get(this.level_field_name)==this.root_node_level&&e.push(f[a]);return e},getNodeDepth:function(a){return a.get(this.level_field_name)-this.root_node_level},getNodeParent:function(a){var b=null,e=this.data.getRange(),f,g,h,j,l,k,m,n;h=a.get(this.left_field_name);
l=a.get(this.right_field_name);m=a.get(this.level_field_name);f=0;for(g=e.length;f<g;f++){a=e[f];j=a.get(this.left_field_name);k=a.get(this.right_field_name);n=a.get(this.level_field_name);if(n==m-1&&j<h&&k>l){b=a;break}}return b},getNodeChildren:function(a){var b,e,f,g,h,j,l,k=[];j=this.data.getRange();b=a.get(this.left_field_name);e=a.get(this.right_field_name);g=a.get(this.level_field_name);i=0;for(len=j.length;i<len;i++){l=j[i];a=l.get(this.left_field_name);f=l.get(this.right_field_name);h=l.get(this.level_field_name);
h==g+1&&a>b&&f<e&&k.push(l)}return k}});
Ext.ux.maximgb.tg.GridView=Ext.extend(Ext.grid.GridView,{expanded_icon_class:"ux-maximgb-tg-elbow-minus",last_expanded_icon_class:"ux-maximgb-tg-elbow-end-minus",collapsed_icon_class:"ux-maximgb-tg-elbow-plus",last_collapsed_icon_class:"ux-maximgb-tg-elbow-end-plus",skip_width_update_class:"ux-maximgb-tg-skip-width-update",initTemplates:function(){var a=this.templates||{};if(!a.row)a.row=new Ext.Template('<div class="x-grid3-row ux-maximgb-tg-level-{level} {alt}" style="{tstyle} {display_style}">','<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',
"<tbody>","<tr>{cells}</tr>",this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':"","</tbody>","</table>","</div>");if(!a.mastercell)a.mastercell=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="ux-maximgb-tg-mastercell-wrap">',"{treeui}",'<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',
"</div>","</td>");if(!a.treeui)a.treeui=new Ext.Template('<div class="ux-maximgb-tg-uiwrap" style="width: {wrap_width}px">',"{elbow_line}",'<div style="left: {left}px" class="{cls}">&#160;</div>',"</div>");if(!a.elbow_line)a.elbow_line=new Ext.Template('<div style="left: {left}px" class="{cls}">&#160;</div>');this.templates=a;Ext.ux.maximgb.tg.GridView.superclass.initTemplates.call(this)},doRender:function(a,b,e,f,g,h){for(var j=this.templates,l=j.cell,k=j.row,m=g-1,n=[],p,t={},s={tstyle:"width:"+
this.getTotalWidth()+";"},u,o=0,v=b.length;o<v;o++){u=b[o];p=[];var w=o+f,q=this.renderRow(u,w,g,e,this.cm.getTotalWidth());if(q===false)for(q=0;q<g;q++){l=a[q];t.id=l.id;t.css=q==0?"x-grid3-cell-first ":q==m?"x-grid3-cell-last ":"";t.attr=t.cellAttr="";t.value=l.renderer.call(l.scope,u.data[l.name],t,u,w,q,e);t.style=l.style;if(Ext.isEmpty(t.value))t.value="&#160;";if(this.markDirty&&u.dirty&&typeof u.modified[l.name]!=="undefined")t.css+=" x-grid3-dirty-cell";if(l.id==this.grid.master_column_id){t.treeui=
this.renderCellTreeUI(u,e);l=j.mastercell}else l=j.cell;p[p.length]=l.apply(t)}else p.push(q);q=[];if(h&&(w+1)%2==0)q[0]="x-grid3-row-alt";if(u.dirty)q[1]=" x-grid3-dirty-row";s.cols=g;if(this.getRowClass)q[2]=this.getRowClass(u,w,s,e);s.alt=q.join(" ");s.cells=p.join("");s.display_style=e.isVisibleNode(u)?"":"display: none;";s.level=e.getNodeDepth(u);n[n.length]=k.apply(s)}return n.join("")},renderCellTreeUI:function(a,b){var e=this.templates.treeui,f=this.templates.elbow_line,g={},h,j,l=level=b.getNodeDepth(a);
g.wrap_width=(l+1)*16;if(level>0){g.elbow_line="";h=a;for(left=0;level--;){if(j=b.getNodeParent(h))g.elbow_line=b.hasNextSiblingNode(j)?f.apply({left:level*16,cls:"ux-maximgb-tg-elbow-line"})+g.elbow_line:f.apply({left:level*16,cls:"ux-maximgb-tg-elbow-empty"})+g.elbow_line;else throw["Tree inconsistency can't get level ",level+1," node(id=",h.id,") parent."].join("");h=j}}if(b.isLeafNode(a))g.cls=b.hasNextSiblingNode(a)?"ux-maximgb-tg-elbow":"ux-maximgb-tg-elbow-end";else{g.cls="ux-maximgb-tg-elbow-active ";
g.cls+=b.isExpandedNode(a)?b.hasNextSiblingNode(a)?this.expanded_icon_class:this.last_expanded_icon_class:b.hasNextSiblingNode(a)?this.collapsed_icon_class:this.last_collapsed_icon_class}g.left=1+l*16;return e.apply(g)},renderRow:function(){return false},afterRender:function(){Ext.ux.maximgb.tg.GridView.superclass.afterRender.call(this);this.updateAllColumnWidths()},updateAllColumnWidths:function(){var a=this.getTotalWidth(),b=this.cm.getColumnCount(),e=[],f,g;for(g=0;g<b;g++)e[g]=this.getColumnWidth(g);
this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=a;this.mainBody.dom.style.width=a;for(g=0;g<b;g++)this.getHeaderCell(g).style.width=e[g];var h=this.getRows(),j;g=0;for(f=h.length;g<f;g++){j=h[g];j.style.width=a;if(j.firstChild){j.firstChild.style.width=a;j=j.firstChild.rows[0];for(var l=0;l<b&&l<j.childNodes.length;l++)if(!Ext.fly(j.childNodes[l]).hasClass(this.skip_width_update_class))j.childNodes[l].style.width=e[l]}}this.onAllColumnWidthsUpdated(e,
a)},updateColumnWidth:function(a){var b=this.getColumnWidth(a),e=this.getTotalWidth();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=e;this.mainBody.dom.style.width=e;this.getHeaderCell(a).style.width=b;for(var f=this.getRows(),g,h=0,j=f.length;h<j;h++){g=f[h];g.style.width=e;if(g.firstChild){g.firstChild.style.width=e;if(a<g.firstChild.rows[0].childNodes.length)if(!Ext.fly(g.firstChild.rows[0].childNodes[a]).hasClass(this.skip_width_update_class))g.firstChild.rows[0].childNodes[a].style.width=
b}}this.onColumnWidthUpdated(a,b,e)},updateColumnHidden:function(a,b){var e=this.getTotalWidth();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=e;this.mainBody.dom.style.width=e;var f=b?"none":"";this.getHeaderCell(a).style.display=f;for(var g=this.getRows(),h,j=0,l=g.length;j<l;j++){h=g[j];h.style.width=e;if(h.firstChild){h.firstChild.style.width=e;if(a<h.firstChild.rows[0].childNodes.length)if(!Ext.fly(h.firstChild.rows[0].childNodes[a]).hasClass(this.skip_width_update_class))h.firstChild.rows[0].childNodes[a].style.display=
f}}this.onColumnHiddenUpdated(a,b,e);delete this.lastViewWidth;this.layout()},processRows:function(a,b){var e=0;if(!(this.ds.getCount()<1)){b=!this.grid.stripeRows;var f=this.getRows();e=0;Ext.each(f,function(g,h){g.rowIndex=h;g.className=g.className.replace(this.rowClsRe," ");if(g.style.display!="none"){if(!b&&(e+1)%2===0)g.className+=" x-grid3-row-alt";e++}},this);Ext.fly(f[0]).addClass(this.firstRowCls);Ext.fly(f[f.length-1]).addClass(this.lastRowCls)}},ensureVisible:function(a,b,e){var f,g=this.ds.getAt(a);
if(!this.ds.isVisibleNode(g))for(f=this.ds.getNodeAncestors(g);f.length>0;){g=f.shift();this.ds.isExpandedNode(g)||this.ds.expandNode(g)}return Ext.ux.maximgb.tg.GridView.superclass.ensureVisible.call(this,a,b,e)},expandRow:function(a,b){var e=this.ds,f,g,h,j,l;if(typeof a=="number"){f=a;a=e.getAt(f)}else f=e.indexOf(a);b=b||false;h=this.getRow(f);if(f=Ext.fly(h).child(".ux-maximgb-tg-elbow-active"))if(e.hasNextSiblingNode(a)){f.removeClass(this.collapsed_icon_class);f.removeClass(this.last_collapsed_icon_class);
f.addClass(this.expanded_icon_class)}else{f.removeClass(this.collapsed_icon_class);f.removeClass(this.last_collapsed_icon_class);f.addClass(this.last_expanded_icon_class)}if(e.isVisibleNode(a)){j=e.getNodeChildren(a);f=0;for(g=j.length;f<g;f++){l=e.indexOf(j[f]);h=this.getRow(l);h.style.display="block";e.isExpandedNode(j[f])&&this.expandRow(l,true)}}b||this.processRows(0)},collapseRow:function(a,b){var e=this.ds,f,g,h,j,l;if(typeof a=="number"){f=a;a=e.getAt(f)}else f=e.indexOf(a);b=b||false;j=this.getRow(f);
if(pmel=Ext.fly(j).child(".ux-maximgb-tg-elbow-active"))if(e.hasNextSiblingNode(a)){pmel.removeClass(this.expanded_icon_class);pmel.removeClass(this.last_expanded_icon_class);pmel.addClass(this.collapsed_icon_class)}else{pmel.removeClass(this.expanded_icon_class);pmel.removeClass(this.last_expanded_icon_class);pmel.addClass(this.last_collapsed_icon_class)}h=e.getNodeChildren(a);f=0;for(g=h.length;f<g;f++){l=e.indexOf(h[f]);j=this.getRow(l);if(j.style.display!="none"){j.style.display="none";this.collapseRow(l,
true)}}b||this.processRows(0)},initData:function(a,b){Ext.ux.maximgb.tg.GridView.superclass.initData.call(this,a,b);if(this.ds){this.ds.un("expandnode",this.onStoreExpandNode,this);this.ds.un("collapsenode",this.onStoreCollapseNode,this)}if(a){a.on("expandnode",this.onStoreExpandNode,this);a.on("collapsenode",this.onStoreCollapseNode,this)}},onLoad:function(a,b,e){if(e&&e.params&&(e.params[a.paramNames.active_node]===null||a.indexOfId(e.params[a.paramNames.active_node])==-1))Ext.ux.maximgb.tg.GridView.superclass.onLoad.call(this,
a,b,e)},onAdd:function(a,b,e){Ext.ux.maximgb.tg.GridView.superclass.onAdd.call(this,a,b,e);this.mainWrap&&this.processRows(0)},onRemove:function(a,b,e,f){Ext.ux.maximgb.tg.GridView.superclass.onRemove.call(this,a,b,e,f);f!==true&&this.mainWrap&&this.processRows(0)},onUpdate:function(a,b){Ext.ux.maximgb.tg.GridView.superclass.onUpdate.call(this,a,b);this.mainWrap&&this.processRows(0)},onStoreExpandNode:function(a,b){this.expandRow(b)},onStoreCollapseNode:function(a,b){this.collapseRow(b)}});
Ext.ux.maximgb.tg.GridPanel=Ext.extend(Ext.m3.GridPanel,{master_column_id:0,tg_cls:"ux-maximgb-tg-panel",initComponent:function(){this.initComponentPreOverride();Ext.ux.maximgb.tg.GridPanel.superclass.initComponent.call(this);this.getSelectionModel().on("selectionchange",this.onTreeGridSelectionChange,this);this.initComponentPostOverride()},initComponentPreOverride:Ext.emptyFn,initComponentPostOverride:Ext.emptyFn,onRender:function(a,b){Ext.ux.maximgb.tg.GridPanel.superclass.onRender.call(this,a,
b);this.el.addClass(this.tg_cls)},getView:function(){if(!this.view)this.view=new Ext.ux.maximgb.tg.GridView(this.viewConfig);return this.view},onClick:function(a){var b=a.getTarget(),e=this.getView().findRowIndex(b),f=this.getStore();this.getSelectionModel();var g=true;if(e!==false)if(Ext.fly(b).hasClass("ux-maximgb-tg-elbow-active")){b=f.getAt(e);f.isExpandedNode(b)?f.collapseNode(b):f.expandNode(b);g=false}g&&Ext.ux.maximgb.tg.GridPanel.superclass.onClick.call(this,a)},onMouseDown:function(a){var b=
a.getTarget();Ext.fly(b).hasClass("ux-maximgb-tg-elbow-active")||Ext.ux.maximgb.tg.GridPanel.superclass.onMouseDown.call(this,a)},onTreeGridSelectionChange:function(a,b){var e,f=this.getStore();if(a.getSelected){e=a.getSelected();f.setActiveNode(e)}else if(a.getSelectedCell&&b){e=b.record;f.setActiveNode(e)}if(e)if(!f.isVisibleNode(e))for(e=f.getNodeAncestors(e);e.length>0;)f.expandNode(e.pop())}});
Ext.ux.maximgb.tg.EditorGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{master_column_id:0,initComponent:function(){this.initComponentPreOverride();Ext.ux.maximgb.tg.EditorGridPanel.superclass.initComponent.call(this);this.getSelectionModel().on("selectionchange",this.onTreeGridSelectionChange,this);this.initComponentPostOverride()},initComponentPreOverride:Ext.emptyFn,initComponentPostOverride:Ext.emptyFn,onRender:function(a,b){Ext.ux.maximgb.tg.EditorGridPanel.superclass.onRender.call(this,a,b);
this.el.addClass("ux-maximgb-tg-panel")},getView:function(){if(!this.view)this.view=new Ext.ux.maximgb.tg.GridView(this.viewConfig);return this.view},onClick:function(a){var b=a.getTarget(),e=this.getView().findRowIndex(b),f=this.getStore();this.getSelectionModel();var g=true;if(e!==false)if(Ext.fly(b).hasClass("ux-maximgb-tg-elbow-active")){b=f.getAt(e);f.isExpandedNode(b)?f.collapseNode(b):f.expandNode(b);g=false}g&&Ext.ux.maximgb.tg.EditorGridPanel.superclass.onClick.call(this,a)},onMouseDown:function(a){var b=
a.getTarget();Ext.fly(b).hasClass("ux-maximgb-tg-elbow-active")||Ext.ux.maximgb.tg.EditorGridPanel.superclass.onMouseDown.call(this,a)},onTreeGridSelectionChange:function(a,b){var e,f=this.getStore();if(a.getSelected){e=a.getSelected();f.setActiveNode(e)}else if(a.getSelectedCell&&b){e=b.record;f.setActiveNode(e)}if(e)if(!f.isVisibleNode(e))for(e=f.getNodeAncestors(e);e.length>0;)f.expandNode(e.pop())}});
Ext.ux.maximgb.tg.PagingToolbar=Ext.extend(Ext.PagingToolbar,{onRender:function(a,b){Ext.ux.maximgb.tg.PagingToolbar.superclass.onRender.call(this,a,b);this.updateUI()},getPageData:function(){var a=0,b=0;if(this.store){b=this.store.getActiveNodePageOffset();a=this.store.getActiveNodeTotalCount()}return{total:a,activePage:Math.ceil((b+this.pageSize)/this.pageSize),pages:a<this.pageSize?1:Math.ceil(a/this.pageSize)}},updateInfo:function(){var a=0,b=0,e=0;if(this.displayItem){if(this.store){b=this.store.getActiveNodePageOffset();
a=this.store.getActiveNodeCount();e=this.store.getActiveNodeTotalCount()}a=a==0?this.emptyMsg:String.format(this.displayMsg,b+1,b+a,e);this.displayItem.setText(a)}},updateUI:function(){var a=this.getPageData(),b=a.activePage,e=a.pages;this.afterTextItem.setText(String.format(this.afterPageText,a.pages));this.inputItem.setValue(b);this.first.setDisabled(b==1);this.prev.setDisabled(b==1);this.next.setDisabled(b==e);this.last.setDisabled(b==e);this.refresh.enable();this.updateInfo()},bindStore:function(a,
b){!b&&this.store&&this.store.un("activenodechange",this.onStoreActiveNodeChange,this);a&&a.on("activenodechange",this.onStoreActiveNodeChange,this);Ext.ux.maximgb.tg.PagingToolbar.superclass.bindStore.call(this,a,b)},beforeLoad:function(a,b){var e=this.getParams();Ext.ux.maximgb.tg.PagingToolbar.superclass.beforeLoad.call(this,a,b);if(b&&b.params){if(b.params[e.start]===undefined)b.params[e.start]=0;if(b.params[e.limit]===undefined)b.params[e.limit]=this.pageSize}},moveFirst:function(){this.doLoad(0)},
movePrevious:function(){var a=this.store;a=a?a.getActiveNodePageOffset():0;this.doLoad(Math.max(0,a-this.pageSize))},moveNext:function(){var a=this.store;this.doLoad((a?a.getActiveNodePageOffset():0)+this.pageSize)},moveLast:function(){var a=this.store;a&&a.getActiveNodePageOffset();a=a?a.getActiveNodeTotalCount():0;var b=a%this.pageSize;this.doLoad(b?a-b:a-this.pageSize)},onStoreActiveNodeChange:function(){this.rendered&&this.updateUI()}});Ext.reg("Ext.ux.maximgb.tg.GridPanel",Ext.ux.maximgb.tg.GridPanel);
Ext.reg("Ext.ux.maximgb.tg.EditorGridPanel",Ext.ux.maximgb.tg.EditorGridPanel);Ext.reg("Ext.ux.maximgb.tg.PagingToolbar",Ext.ux.maximgb.tg.PagingToolbar);
Ext.m3.Window=Ext.extend(Ext.Window,{constructor:function(a,b){this.actionContextJson=this.parentWindow=null;if(b&&b.parentWindowID)this.parentWindow=Ext.getCmp(b.parentWindowID);if(b&&b.helpTopic)this.m3HelpTopic=b.helpTopic;if(b&&b.contextJson)this.actionContextJson=b.contextJson;Ext.m3.Window.superclass.constructor.call(this,a)},initTools:function(){if(this.m3HelpTopic){var a=this.m3HelpTopic;this.addTool({id:"help",handler:function(){showHelpWindow(a)}})}Ext.m3.Window.superclass.initTools.call(this)}});
Ext.m3.AdvancedTreeGrid=Ext.extend(Ext.ux.maximgb.tg.GridPanel,{constructor:function(a,b){assert(b.storeParams.url,"\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043e \u0437\u0430\u0434\u0430\u043d\u043e url. \t\t\turl="+b.storeParams.url);var e=b.columnsToRecord||[];e.push({name:"_id",type:"int"},{name:"_level",type:"int"},{name:"_lft",type:"int"},{name:"_rgt",type:"int"},{name:"_is_leaf",type:"bool"},{name:"_parent",type:"int"});e=new Ext.ux.maximgb.tg.AdjacencyListStore({autoLoad:true,
url:b.storeParams.url,reader:new Ext.data.JsonReader({id:"_id",root:b.storeParams.root,totalProperty:"total",successProperty:"success"},Ext.data.Record.create(e))});var f;if(b.bbar)f=new Ext.ux.maximgb.tg.PagingToolbar({store:e,displayInfo:true,pageSize:b.bbar.pageSize});f=Ext.applyIf({store:e,bbar:f},a);Ext.m3.AdvancedTreeGrid.superclass.constructor.call(this,f,b)}});
Ext.m3.ObjectTree=Ext.extend(Ext.m3.AdvancedTreeGrid,{constructor:function(a,b){assert(b.allowPaging!==undefined,"allowPaging is undefined");assert(b.rowIdName!==undefined,"rowIdName is undefined");assert(b.actions!==undefined,"actions is undefined");this.allowPaging=b.allowPaging;this.rowIdName=b.rowIdName;this.actionNewUrl=b.actions.newUrl;this.actionEditUrl=b.actions.editUrl;this.actionDeleteUrl=b.actions.deleteUrl;this.actionDataUrl=b.actions.dataUrl;this.actionContextJson=b.actions.contextJson;
Ext.m3.ObjectTree.superclass.constructor.call(this,a,b)},onNewRecord:function(){assert(this.actionNewUrl,"actionNewUrl is not define");var a=this;Ext.Ajax.request({url:this.actionNewUrl,params:this.actionContextJson||{},success:function(b,e){return a.childWindowOpenHandler(b,e)},failure:Ext.emptyFn})},onNewRecordChild:function(){assert(this.actionNewUrl,"actionNewUrl is not define");if(this.getSelectionModel().getSelected()){var a={};a[this.rowIdName]=this.getSelectionModel().getSelected().get("_parent");
var b=this;Ext.Ajax.request({url:this.actionNewUrl,params:Ext.applyIf(a,this.actionContextJson||{}),success:function(e,f){return b.childWindowOpenHandler(e,f)},failure:Ext.emptyFn})}else Ext.Msg.show({title:"\u041d\u043e\u0432\u044b\u0439",msg:"\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d",buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO})},onEditRecord:function(){assert(this.actionEditUrl,"actionEditUrl is not define");assert(this.rowIdName,"rowIdName is not define");
if(this.getSelectionModel().hasSelection()){var a={};a[this.rowIdName]=this.getSelectionModel().getSelected().id;var b=this;Ext.Ajax.request({url:this.actionEditUrl,params:Ext.applyIf(a,this.actionContextJson||{}),success:function(e,f){return b.childWindowOpenHandler(e,f)},failure:Ext.emptyFn})}},onDeleteRecord:function(){assert(this.actionDeleteUrl,"actionDeleteUrl is not define");assert(this.rowIdName,"rowIdName is not define");var a=this;Ext.Msg.show({title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438",
msg:"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c?",icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,fn:function(b){if(b=="yes")if(a.getSelectionModel().hasSelection()){b={};b[a.rowIdName]=a.getSelectionModel().getSelected().id;Ext.Ajax.request({url:a.actionDeleteUrl,params:Ext.applyIf(b,
a.actionContextJson||{}),success:function(e,f){return a.deleteOkHandler(e,f)},failure:Ext.emptyFn})}}})},childWindowOpenHandler:function(a){if(a=smart_eval(a.responseText)){var b=this;a.on("closed_ok",function(){return b.refreshStore()})}},deleteOkHandler:function(a){smart_eval(a.responseText);this.refreshStore()},refreshStore:function(){if(this.allowPaging){var a=this.getBottomToolbar();a&&a instanceof Ext.PagingToolbar&&a.changePage(Math.ceil((a.cursor+a.pageSize)/a.pageSize))}else this.getStore().load()}});
Ext.m3.AdvancedDataField=Ext.extend(Ext.form.DateField,{constructor:function(a,b){this.baseTriggers=[{iconCls:"x-form-date-trigger",handler:null,hide:null},{iconCls:"x-form-current-date-trigger",handler:null,hide:null}];this.hideTriggerToday=false;if(b.hideTriggerToday)this.hideTriggerToday=true;Ext.m3.AdvancedDataField.superclass.constructor.call(this,a)},initComponent:function(){Ext.m3.AdvancedDataField.superclass.initComponent.call(this);this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",
cn:[]};Ext.each(this.baseTriggers,function(a){this.triggerConfig.cn.push({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+a.iconCls})},this);this.initBaseTrigger()},initTrigger:function(){var a=this.trigger.select(".x-form-trigger",true),b=this;a.each(function(e,f,g){var h="Trigger"+(g+1);e.hide=function(){var j=b.wrap.getWidth();this.dom.style.display="none";b.el.setWidth(j-b.trigger.getWidth());this["hidden"+h]=true};e.show=function(){var j=b.wrap.getWidth();this.dom.style.display="";b.el.setWidth(j-
b.trigger.getWidth());this["hidden"+h]=false};if(this.baseTriggers[g].hide){e.dom.style.display="none";this["hidden"+h]=true}this.mon(e,"click",this.baseTriggers[g].handler,this,{preventDefault:true});e.addClassOnOver("x-form-trigger-over");e.addClassOnClick("x-form-trigger-click")},this);this.triggers=a.elements},initBaseTrigger:function(){this.baseTriggers[0].handler=this.onTriggerClick;this.baseTriggers[1].handler=function(){this.setValue(new Date)};this.baseTriggers[1].hide=this.hideTriggerToday}});
Ext.m3.AdvancedComboBox=Ext.extend(Ext.m3.ComboBox,{constructor:function(a,b){this.askBeforeDeleting=true;this.actionContextJson=this.actionEditUrl=this.actionSelectUrl=null;this.hideBaseTrigger=false;this.defaultText=this.defaultValue=null;this.hideTriggerClear=b.hideClearTrigger||false;this.hideTriggerDropDown=false;this.hideTriggerDictSelect=b.hideDictSelectTrigger||false;this.hideTriggerDictEdit=true;if(!b.hideEditTrigger)this.hideTriggerDictEdit=b.hideEditTrigger;this.defaultLimit=50;this.triggerClearClass=
"x-form-clear-trigger";this.triggerSelectClass="x-form-select-trigger";this.triggerEditClass="x-form-edit-trigger";assert(b.actions,"params.actions is undefined");if(b.actions.actionSelectUrl)this.actionSelectUrl=b.actions.actionSelectUrl;if(b.actions.actionEditUrl)this.actionEditUrl=b.actions.actionEditUrl;this.askBeforeDeleting=b.askBeforeDeleting;this.actionContextJson=b.actions.contextJson;this.hideBaseTrigger=false;if(a.hideTrigger){delete a.hideTrigger;this.hideBaseTrigger=true}this.defaultValue=
b.defaultValue;this.defaultText=b.defaultText;this.baseTriggers=[{iconCls:"x-form-clear-trigger",handler:null,hide:null},{iconCls:"",handler:null,hide:null},{iconCls:"x-form-select-trigger",handler:null,hide:null},{iconCls:"x-form-edit-trigger",handler:null,hide:true}];this.allTriggers=[].concat(this.baseTriggers);b.customTriggers&&Ext.each(b.customTriggers,function(e){this.allTriggers.push(e)},this);Ext.m3.AdvancedComboBox.superclass.constructor.call(this,a)},initComponent:function(){Ext.m3.AdvancedComboBox.superclass.initComponent.call(this);
this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",cn:[]};Ext.each(this.allTriggers,function(a){this.triggerConfig.cn.push({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+a.iconCls})},this);if(!this.actionSelectUrl)this.hideTriggerDictSelect=true;if(!this.actionEditUrl)this.hideTriggerDictEdit=true;if(this.hideBaseTrigger)this.hideTriggerDropDown=true;this.defaultValue&&this.defaultText&&this.addRecordToStore(this.defaultValue,this.defaultText);this.initBaseTrigger();this.addEvents("beforerequest",
"afterselect","changed");this.getStore().baseParams=Ext.applyIf({start:0,limit:this.defaultLimit},this.getStore().baseParams)},getTrigger:function(a){return this.triggers[a]},initTrigger:function(){var a=this.trigger.select(".x-form-trigger",true),b=this;a.each(function(e,f,g){var h="Trigger"+(g+1);e.hide=function(){var j=b.wrap.getWidth();this.dom.style.display="none";b.el.setWidth(j-b.trigger.getWidth());this["hidden"+h]=true};e.show=function(){var j=b.wrap.getWidth();this.dom.style.display="";
b.el.setWidth(j-b.trigger.getWidth());this["hidden"+h]=false};if(this.allTriggers[g].hide){e.dom.style.display="none";this["hidden"+h]=true}if(this.disabled)this.mun(e,"click",this.allTriggers[g].handler,this,{preventDefault:true});else{this.mon(e,"click",this.allTriggers[g].handler,this,{preventDefault:true});e.addClassOnOver("x-form-trigger-over");e.addClassOnClick("x-form-trigger-click")}},this);this.triggers=a.elements},initBaseTrigger:function(){this.baseTriggers[0].handler=this.onTriggerClearClick;
this.baseTriggers[1].handler=this.onTriggerDropDownClick;this.baseTriggers[2].handler=this.onTriggerDictSelectClick;this.baseTriggers[3].handler=this.onTriggerDictEditClick;this.baseTriggers[0].hide=this.hideTriggerClear;this.baseTriggers[1].hide=this.hideTriggerDropDown;this.baseTriggers[2].hide=this.hideTriggerDictSelect;this.baseTriggers[3].hide=this.hideTriggerDictEdit;if(!this.getValue()){this.baseTriggers[0].hide=true;this.baseTriggers[3].hide=true}},getTriggerWidth:function(){var a=0;Ext.each(this.triggers,
function(b,e){var f="Trigger"+(e+1),g=b.getWidth();a+=g===0&&!this["hidden"+f]?this.defaultTriggerWidth:g},this);return a},onDestroy:function(){Ext.destroy(this.triggers);Ext.destroy(this.allTriggers);Ext.destroy(this.baseTriggers);Ext.m3.AdvancedComboBox.superclass.onDestroy.call(this)},onTriggerDropDownClick:function(){if(this.fireEvent("beforerequest",this)){if(this.isExpanded())this.collapse();else{this.getStore().load();this.onFocus({});this.doQuery(this.allQuery,true)}this.el.focus()}},onTriggerDictSelectClick:function(){this.onSelectInDictionary()},
onTriggerClearClick:function(){if(this.askBeforeDeleting){var a=this;Ext.Msg.show({title:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435",msg:"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435?",icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,
fn:function(b){b=="yes"&&a.clearValue()}})}else this.clearValue()},onTriggerDictEditClick:function(){this.onEditBtn()},onSelect:function(a,b){if(this.fireEvent("afterselect",this,a.data[this.valueField],a.data[this.displayField])){Ext.m3.AdvancedComboBox.superclass.onSelect.call(this,a,b);this.showClearBtn();this.showEditBtn();this.fireEvent("change",this,a.data[this.valueField||this.displayField]);this.fireEvent("changed",this)}},showClearBtn:function(){if(!this.hideTriggerClear){this.el.parent().setOverflow("hidden");
this.getTrigger(0).show()}},hideClearBtn:function(){this.el.parent().setOverflow("auto");this.getTrigger(0).hide()},showEditBtn:function(){if(this.actionEditUrl&&!this.hideTriggerDictEdit&&this.getValue()){this.el.parent().setOverflow("hidden");this.getTrigger(3).show()}},hideEditBtn:function(){if(this.actionEditUrl){this.el.parent().setOverflow("auto");this.getTrigger(3).hide()}},clearValue:function(){var a=this.getValue();Ext.m3.AdvancedComboBox.superclass.clearValue.call(this);this.hideClearBtn();
this.hideEditBtn();this.fireEvent("change",this,"",a);this.fireEvent("changed",this)},setValue:function(a){Ext.m3.AdvancedComboBox.superclass.setValue.call(this,a);if(a)if(this.rendered){this.showClearBtn();this.showEditBtn()}else this.hideTrigger4=this.hideTrigger1=true},onSelectInDictionary:function(){assert(this.actionSelectUrl,"actionSelectUrl is undefined");if(this.fireEvent("beforerequest",this)){var a=this;Ext.Ajax.request({url:this.actionSelectUrl,method:"POST",params:this.actionContextJson,
success:function(b){(b=smart_eval(b.responseText))&&b.on("closed_ok",function(e,f){a.fireEvent("afterselect",a,e,f)&&a.addRecordToStore(e,f)})},failure:function(){uiAjaxFailMessage.apply(this,arguments)}})}},addRecordToStore:function(a,b){var e=new Ext.data.Record;e.id=a;e[this.displayField]=b;this.getStore().loadData({total:1,rows:[e]});e=this.getValue();this.setValue(a);this.collapse();this.fireEvent("change",this,a,e);this.fireEvent("changed",this)},onEditBtn:function(){assert(this.actionEditUrl,
"actionEditUrl is undefined");value_id=this.getValue();assert(value_id,"Value not selected but edit window called");Ext.Ajax.request({url:this.actionEditUrl,method:"POST",params:Ext.applyIf({id:value_id},this.actionContextJson),success:function(a){smart_eval(a.responseText)},failure:function(){uiAjaxFailMessage()}})},triggerBlur:function(){this.focusClass&&this.el.removeClass(this.focusClass);this.wrap&&this.wrap.removeClass(this.wrapFocusClass)}});
Ext.m3.HelpWindow=Ext.extend(Ext.Window,{constructor:function(a){this.title="\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f";this.minimizable=this.maximizable=this.maximized=true;this.width=800;this.height=550;Ext.m3.HelpWindow.superclass.constructor.call(this,a)}});function showHelpWindow(a){window.open(a)}
Ext.m3.EditWindow=Ext.extend(Ext.m3.Window,{constructor:function(a,b){this.formUrl=this.formId=null;this.changesCount=0;this.originalTitle=null;if(b)if(b.form){if(b.form.id)this.formId=b.form.id;if(b.form.url)this.formUrl=b.form.url}Ext.m3.EditWindow.superclass.constructor.call(this,a,b)},initComponent:function(){Ext.m3.EditWindow.superclass.initComponent.call(this);this.items.each(function(a){this.setFieldOnChange(a,this)},this);this.addEvents("beforesubmit","closing_canceled")},getForm:function(){assert(this.formId,
"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d formId \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u044b");return Ext.getCmp(this.formId).getForm()},submitForm:function(a,b,e){assert(this.formUrl,"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d url \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u044b");if((a=Ext.getCmp(this.formId).getForm())&&!a.isValid())Ext.Msg.show({title:"\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0444\u043e\u0440\u043c\u044b",msg:"\u041d\u0430 \u0444\u043e\u0440\u043c\u0435 \u0438\u043c\u0435\u044e\u0442\u0441\u044f \u043d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435 \u043f\u043e\u043b\u044f",
buttons:Ext.Msg.OK,icon:Ext.Msg.WARNING});else{var f=this,g=new Ext.LoadMask(this.body,{msg:"\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435..."});e={url:this.formUrl,submitEmptyText:false,params:Ext.applyIf(e||{},this.actionContextJson||{}),success:function(h,j){f.fireEvent("closed_ok",j.response.responseText);f.close(true);try{smart_eval(j.response.responseText)}finally{g.hide();f.disableToolbars(false)}},failure:function(){uiAjaxFailMessage.apply(f,arguments);g.hide();f.disableToolbars(false)}};
if(f.fireEvent("beforesubmit",e)){this.disableToolbars(true);g.show();a.submit(e)}}},onChangeFieldValue:function(a,b,e,f){if(a.originalValue!==b){a.isModified||f.changesCount++;a.isModified=true}else{a.isModified&&f.changesCount--;a.isModified=false}f.updateTitle();a.updateLabel()},setFieldOnChange:function(a,b){if(a){a instanceof Ext.form.Field&&a.isEdit&&a.on("change",function(f,g,h){b.onChangeFieldValue(f,g,h,b)});if(a.items)if(a.items instanceof Array)for(var e=0;e<a.items.length;e++)b.setFieldOnChange(a.items[e],
b);else a.items.each(function(f){b.setFieldOnChange(f,b)});if(a.titleItems)for(e=0;e<a.titleItems.length;e++)b.setFieldOnChange(a.titleItems[e],b)}},updateTitle:function(){if(this.title!==this.originalTitle&&this.originalTitle===null)this.originalTitle=this.title;this.changesCount!==0?this.setTitle("*"+this.originalTitle):this.setTitle(this.originalTitle)},close:function(a){if(this.changesCount!==0&&!a){var b=this;Ext.Msg.show({title:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435",msg:"\u0414\u0430\u043d\u043d\u044b\u0435 \u0431\u044b\u043b\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u044b! C\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f?",
buttons:Ext.Msg.YESNOCANCEL,fn:function(e){if(e==="yes")this.submitForm();else e==="no"?Ext.m3.EditWindow.superclass.close.call(b):b.fireEvent("closing_canceled")},animEl:"elId",icon:Ext.MessageBox.QUESTION,scope:this})}else Ext.m3.EditWindow.superclass.close.call(this)},disableToolbars:function(a){for(var b=[this.getTopToolbar(),this.getFooterToolbar(),this.getBottomToolbar()],e=0;e<b.length;e++)b[e]&&b[e].setDisabled(a)}});
Ext.m3.ObjectGrid=Ext.extend(Ext.m3.GridPanel,{constructor:function(a,b){assert(b.allowPaging!==undefined,"allowPaging is undefined");assert(b.rowIdName!==undefined,"rowIdName is undefined");assert(b.actions!==undefined,"actions is undefined");this.allowPaging=b.allowPaging;this.rowIdName=b.rowIdName;this.columnParamName=b.columnParamName;this.actionNewUrl=b.actions.newUrl;this.actionEditUrl=b.actions.editUrl;this.actionDeleteUrl=b.actions.deleteUrl;this.actionDataUrl=b.actions.dataUrl;this.actionContextJson=
b.actions.contextJson;Ext.m3.ObjectGrid.superclass.constructor.call(this,a,b)},initComponent:function(){Ext.m3.ObjectGrid.superclass.initComponent.call(this);var a=this.getStore();a.baseParams=Ext.applyIf(a.baseParams||{},this.actionContextJson||{});this.addEvents("beforenewrequest","afternewrequest","beforeeditrequest","aftereditrequest","beforedeleterequest","afterdeleterequest")},onNewRecord:function(){assert(this.actionNewUrl,"actionNewUrl is not define");var a=new Ext.LoadMask(this.body),b={url:this.actionNewUrl,
params:this.actionContextJson||{},success:function(f,g){if(e.fireEvent("afternewrequest",e,f,g)){try{var h=e.childWindowOpenHandler(f,g)}finally{a.hide();e.disableToolbars(false)}return h}a.hide();e.disableToolbars(false)},failure:function(){uiAjaxFailMessage.apply(this,arguments);a.hide();e.disableToolbars(false)}};if(this.fireEvent("beforenewrequest",this,b)){var e=this;this.disableToolbars(true);a.show();Ext.Ajax.request(b)}},onEditRecord:function(){assert(this.actionEditUrl,"actionEditUrl is not define");
assert(this.rowIdName,"rowIdName is not define");if(this.getSelectionModel().hasSelection()){var a={},b=this.getSelectionModel();if(b instanceof Ext.grid.RowSelectionModel)if(b.singleSelect)a[this.rowIdName]=b.getSelected().id;else{b=b.getSelections();for(var e=[],f=0,g=b.length;f<g;f++)e.push(b[f].id);a[this.rowIdName]=e.join()}else if(b instanceof Ext.grid.CellSelectionModel){assert(this.columnParamName,"columnParamName is not define");if(b=b.getSelectedCell()){e=this.getStore().getAt(b[0]);a[this.rowIdName]=
e.id;a[this.columnParamName]=this.getColumnModel().getDataIndex(b[1])}}var h=new Ext.LoadMask(this.body);a={url:this.actionEditUrl,params:Ext.applyIf(a,this.actionContextJson||{}),success:function(l,k){if(j.fireEvent("aftereditrequest",j,l,k)){try{var m=j.childWindowOpenHandler(l,k)}finally{h.hide();j.disableToolbars(false)}return m}h.hide();j.disableToolbars(false)},failure:function(){uiAjaxFailMessage.apply(this,arguments);h.hide();j.disableToolbars(false)}};if(this.fireEvent("beforeeditrequest",
this,a)){var j=this;this.disableToolbars(true);h.show();Ext.Ajax.request(a)}}},onDeleteRecord:function(){assert(this.actionDeleteUrl,"actionDeleteUrl is not define");assert(this.rowIdName,"rowIdName is not define");var a=this;a.getSelectionModel().hasSelection()&&Ext.Msg.show({title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438",msg:"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c?",
icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,fn:function(b){if(b=="yes"){b={};var e=a.getSelectionModel();if(e instanceof Ext.grid.RowSelectionModel)if(e.singleSelect)b[a.rowIdName]=e.getSelected().id;else{e=e.getSelections();for(var f=[],g=0,h=e.length;g<h;g++)f.push(e[g].id);b[a.rowIdName]=f.join()}else if(e instanceof Ext.grid.CellSelectionModel){assert(a.columnParamName,"columnParamName is not define");if(e=e.getSelectedCell()){f=a.getStore().getAt(e[0]);b[a.rowIdName]=f.id;b[a.columnParamName]=
a.getColumnModel().getDataIndex(e[1])}}var j=new Ext.LoadMask(a.body);b={url:a.actionDeleteUrl,params:Ext.applyIf(b,a.actionContextJson||{}),success:function(l,k){if(a.fireEvent("afterdeleterequest",a,l,k)){try{var m=a.deleteOkHandler(l,k)}finally{j.hide();a.disableToolbars(false)}return m}j.hide();a.disableToolbars(false)},failure:function(){uiAjaxFailMessage.apply(this,arguments);j.hide();a.disableToolbars(false)}};if(a.fireEvent("beforedeleterequest",a,b)){a.disableToolbars(true);j.show();Ext.Ajax.request(b)}}}})},
childWindowOpenHandler:function(a){if(a=smart_eval(a.responseText)){var b=this;a.on("closed_ok",function(){return b.refreshStore()})}},deleteOkHandler:function(a){smart_eval(a.responseText);this.refreshStore()},refreshStore:function(){if(this.allowPaging){var a=this.getBottomToolbar();a&&a instanceof Ext.PagingToolbar&&a.changePage(Math.ceil((a.cursor+a.pageSize)/a.pageSize))}else this.getStore().load()},disableToolbars:function(a){for(var b=[this.getTopToolbar(),this.getFooterToolbar(),this.getBottomToolbar()],
e=0;e<b.length;e++)b[e]&&b[e].setDisabled(a)}});
Ext.m3.EditorObjectGrid=Ext.extend(Ext.m3.EditorGridPanel,{constructor:function(a,b){assert(b.allowPaging!==undefined,"allowPaging is undefined");assert(b.rowIdName!==undefined,"rowIdName is undefined");assert(b.actions!==undefined,"actions is undefined");this.allowPaging=b.allowPaging;this.rowIdName=b.rowIdName;this.columnParamName=b.columnParamName;this.actionNewUrl=b.actions.newUrl;this.actionEditUrl=b.actions.editUrl;this.actionDeleteUrl=b.actions.deleteUrl;this.actionDataUrl=b.actions.dataUrl;
this.actionContextJson=b.actions.contextJson;Ext.m3.EditorObjectGrid.superclass.constructor.call(this,a,b)},initComponent:function(){Ext.m3.EditorObjectGrid.superclass.initComponent.call(this);var a=this.getStore();a.baseParams=Ext.applyIf(a.baseParams||{},this.actionContextJson||{});this.addEvents("beforenewrequest","afternewrequest","beforeeditrequest","aftereditrequest","beforedeleterequest","afterdeleterequest")},onNewRecord:function(){assert(this.actionNewUrl,"actionNewUrl is not define");var a=
{url:this.actionNewUrl,params:this.actionContextJson||{},success:function(e,f){if(b.fireEvent("afternewrequest",b,e,f))return b.childWindowOpenHandler(e,f)},failure:Ext.emptyFn};if(this.fireEvent("beforenewrequest",this,a)){var b=this;Ext.Ajax.request(a)}},onEditRecord:function(){assert(this.actionEditUrl,"actionEditUrl is not define");assert(this.rowIdName,"rowIdName is not define");if(this.getSelectionModel().hasSelection()){var a={},b=this.getSelectionModel();if(b instanceof Ext.grid.RowSelectionModel)if(b.singleSelect)a[this.rowIdName]=
b.getSelected().id;else{b=b.getSelections();for(var e=[],f=0,g=b.length;f<g;f++)e.push(b[f].id);a[this.rowIdName]=e}else if(b instanceof Ext.grid.CellSelectionModel){assert(this.columnParamName,"columnParamName is not define");if(b=b.getSelectedCell()){e=this.getStore().getAt(b[0]);a[this.rowIdName]=e.id;a[this.columnParamName]=this.getColumnModel().getDataIndex(b[1])}}a={url:this.actionEditUrl,params:Ext.applyIf(a,this.actionContextJson||{}),success:function(j,l){if(h.fireEvent("aftereditrequest",
h,j,l))return h.childWindowOpenHandler(j,l)},failure:Ext.emptyFn};if(this.fireEvent("beforeeditrequest",this,a)){var h=this;Ext.Ajax.request(a)}}},onDeleteRecord:function(){assert(this.actionDeleteUrl,"actionDeleteUrl is not define");assert(this.rowIdName,"rowIdName is not define");var a=this;a.getSelectionModel().hasSelection()&&Ext.Msg.show({title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438",msg:"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c?",
icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,fn:function(b){if(b=="yes"){b={};var e=a.getSelectionModel();if(e instanceof Ext.grid.RowSelectionModel)if(e.singleSelect)b[a.rowIdName]=e.getSelected().id;else{e=e.getSelections();for(var f=[],g=0,h=e.length;g<h;g++)f.push(e[g].id);b[a.rowIdName]=f}else if(e instanceof Ext.grid.CellSelectionModel){assert(a.columnParamName,"columnParamName is not define");if(e=e.getSelectedCell()){f=a.getStore().getAt(e[0]);b[a.rowIdName]=f.id;b[a.columnParamName]=a.getColumnModel().getDataIndex(e[1])}}b=
{url:a.actionDeleteUrl,params:Ext.applyIf(b,a.actionContextJson||{}),success:function(j,l){if(a.fireEvent("afterdeleterequest",a,j,l))return a.deleteOkHandler(j,l)},failure:Ext.emptyFn};a.fireEvent("beforedeleterequest",a,b)&&Ext.Ajax.request(b)}}})},childWindowOpenHandler:function(a){if(a=smart_eval(a.responseText)){var b=this;a.on("closed_ok",function(){return b.refreshStore()})}},deleteOkHandler:function(a){smart_eval(a.responseText);this.refreshStore()},refreshStore:function(){if(this.allowPaging){var a=
this.getBottomToolbar();a&&a instanceof Ext.PagingToolbar&&a.changePage(Math.ceil((a.cursor+a.pageSize)/a.pageSize))}else this.getStore().load()}});
Ext.m3.AddrField=Ext.extend(Ext.Container,{constructor:function(a,b){var e=b.items||[],f=new Ext.data.JsonStore({url:b.kladr_url,idProperty:"code",root:"rows",totalProperty:"total",fields:[{name:"code"},{name:"display_name"},{name:"socr"},{name:"zipcode"},{name:"gni"},{name:"uno"},{name:"okato"}]}),g=new Ext.data.Record;g.code=b.place_value;g.display_name=b.place_text;f.loadData({total:1,rows:[g]});var h=b.read_only?"m3-grey-field":"";this.place=new Ext.form.ComboBox({name:b.place_field_name,fieldLabel:b.place_label,
allowBlank:b.place_allow_blank,readOnly:b.read_only,cls:h,hideTrigger:true,minChars:2,emptyText:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0430\u0441\u0435\u043b\u0435\u043d\u043d\u044b\u0439 \u043f\u0443\u043d\u043a\u0442...",queryParam:"filter",store:f,resizable:true,displayField:"display_name",valueField:"code",mode:"remote",hiddenName:b.place_field_name,valueNotFoundText:""});this.place.setValue(b.place_value);if(b.level>1){f=new Ext.data.JsonStore({url:b.street_url,idProperty:"code",
root:"rows",totalProperty:"total",fields:[{name:"code"},{name:"display_name"},{name:"socr"},{name:"zipcode"},{name:"gni"},{name:"uno"},{name:"okato"}]});g=new Ext.data.Record;g.code=b.street_value;g.display_name=b.street_text;f.loadData({total:1,rows:[g]});this.street=new Ext.form.ComboBox({name:b.street_field_name,fieldLabel:b.street_label,allowBlank:b.street_allow_blank,readOnly:b.read_only,cls:h,hideTrigger:true,minChars:2,emptyText:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0443\u043b\u0438\u0446\u0443...",
queryParam:"filter",store:f,resizable:true,displayField:"display_name",valueField:"code",mode:"remote",hiddenName:b.street_field_name,valueNotFoundText:""});this.street.setValue(b.street_value);if(b.level>2){this.house=new Ext.form.TextField({name:b.house_field_name,allowBlank:b.house_allow_blank,readOnly:b.read_only,cls:h,fieldLabel:b.house_label,value:b.house_value,emptyText:"",width:40});this.zipcode=new Ext.form.TextField({name:b.zipcode_field_name,value:b.zipcode_value,emptyText:"\u0438\u043d\u0434\u0435\u043a\u0441",
readOnly:b.read_only,cls:h,width:55,maskRe:/[0-9]/});if(b.level>3)this.flat=new Ext.form.TextField({name:b.flat_field_name,fieldLabel:b.flat_label,value:b.flat_value,allowBlank:b.flat_allow_blank,readOnly:b.read_only,cls:h,emptyText:"",width:40})}}if(b.addr_visible)this.addr=new Ext.form.TextArea({name:b.addr_field_name,anchor:"100%",fieldLabel:b.addr_label,value:b.addr_value,readOnly:true,cls:h,height:36});if(b.view_mode==1){this.place.flex=1;g=b.level>2?[this.place,this.zipcode]:[this.place];if(b.level>
1){this.street.flex=1;this.street.fieldLabel=b.place_label;g.push({xtype:"label",style:{padding:"3px"},text:b.street_label+":"},this.street);if(b.level>2){this.house.fieldLabel=b.place_label;g.push({xtype:"label",style:{padding:"3px"},text:b.house_label+":"},this.house);if(b.level>3){this.flat.fieldLabel=b.place_label;g.push({xtype:"label",style:{padding:"3px"},text:b.flat_label+":"},this.flat)}}}g={xtype:"compositefield",anchor:"100%",fieldLabel:b.place_label,items:g};e.push(g);b.addr_visible&&e.push(this.addr)}if(b.view_mode==
2){if(b.level>2){this.place.flex=1;g={xtype:"compositefield",anchor:"100%",fieldLabel:b.place_label,items:[this.place,this.zipcode]};e.push(g)}else{this.place.anchor="100%";e.push(this.place)}if(b.level>1){this.street.flex=1;g=[this.street];if(b.level>2){this.house.fieldLabel=b.street_label;g.push({xtype:"label",style:{padding:"3px"},text:b.house_label+":"},this.house);if(b.level>3){this.flat.fieldLabel=b.street_label;g.push({xtype:"label",style:{padding:"3px"},text:b.flat_label+":"},this.flat)}}g=
{xtype:"compositefield",anchor:"100%",fieldLabel:b.street_label,items:g};e.push(g)}b.addr_visible&&e.push(this.addr)}if(b.view_mode==3){if(b.level>2){this.place.flex=1;g={xtype:"compositefield",anchor:"100%",fieldLabel:b.place_label,items:[this.place,this.zipcode]};e.push(g)}else{this.place.anchor="100%";e.push(this.place)}if(b.level>1){this.street.anchor="100%";e.push(this.street);if(b.level>2){g=[{xtype:"container",layout:"form",items:this.house,style:{overflow:"hidden"}}];b.level>3&&g.push({xtype:"container",
layout:"form",style:{padding:"0px 0px 0px 5px",overflow:"hidden"},items:this.flat});g=new Ext.Container({anchor:"100%",layout:"column",items:g,style:{overflow:"hidden"}});e.push(g)}}b.addr_visible&&e.push(this.addr)}e=Ext.applyIf({items:e,get_addr_url:b.get_addr_url,level:b.level,addr_visible:b.addr_visible,style:{overflow:"hidden"}},a);Ext.Container.superclass.constructor.call(this,e)},beforeStreetQuery:function(){this.street.getStore().baseParams.place_code=this.place.value},clearStreet:function(){this.street.setValue("")},
initComponent:function(){Ext.m3.AddrField.superclass.initComponent.call(this);this.mon(this.place,"change",this.onChangePlace,this);if(this.level>1){this.mon(this.street,"change",this.onChangeStreet,this);if(this.level>2){this.mon(this.house,"change",this.onChangeHouse,this);this.mon(this.zipcode,"change",this.onChangeZipcode,this);this.level>3&&this.mon(this.flat,"change",this.onChangeFlat,this)}}this.mon(this.place,"beforequery",this.beforePlaceQuery,this);if(this.level>1){this.mon(this.place,"change",
this.clearStreet,this);this.mon(this.street,"beforequery",this.beforeStreetQuery,this)}this.addEvents("change","change_place","change_street","change_house","change_flat","change_zipcode","before_query_place")},getNewAddr:function(){var a;if(this.place!=undefined)a=this.place.getValue();var b;if(this.street!=undefined)b=this.street.getValue();var e;if(this.house!=undefined)e=this.house.getValue();var f;if(this.flat!=undefined)f=this.flat.getValue();var g;if(this.zipcode!=undefined)g=this.zipcode.getValue();
var h=this;Ext.Ajax.request({url:this.get_addr_url,params:Ext.applyIf({place:a,street:b,house:e,flat:f,zipcode:g,addr_cmp:this.addr.id},this.params),success:function(j){smart_eval(j.responseText);h.fireEvent("change")},failure:function(){Ext.Msg.show({title:"",msg:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0430\u0434\u0440\u0435\u0441.<br>\u041f\u0440\u0438\u0447\u0438\u043d\u0430: \u0441\u0435\u0440\u0432\u0435\u0440 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d.",
buttons:Ext.Msg.OK,icon:Ext.Msg.WARNING})}})},setNewAddr:function(a){if(this.addr!=undefined)this.addr.value=a},onChangePlace:function(){var a=this.place.getValue(),b=this.place.getStore().data.get(a);if(b!=undefined){b=b.data;b.zipcode&&this.zipcode.setValue(b.zipcode)}else this.place.setValue("");this.fireEvent("change_place",this,a,b);this.addr_visible&&this.getNewAddr()},onChangeStreet:function(){var a=this.street.getValue(),b=this.street.getStore().data.get(a);if(b!=undefined){b=b.data;b.zipcode&&
this.zipcode.setValue(b.zipcode)}else this.clearStreet();this.fireEvent("change_street",this,a,b);this.addr_visible&&this.getNewAddr()},onChangeHouse:function(){this.fireEvent("change_house",this,this.house.getValue());this.addr_visible&&this.getNewAddr()},onChangeFlat:function(){this.fireEvent("change_flat",this,this.flat.getValue());this.addr_visible&&this.getNewAddr()},onChangeZipcode:function(){this.fireEvent("change_zipcode",this,this.zipcode.getValue());this.addr_visible&&this.getNewAddr()},
beforePlaceQuery:function(a){this.fireEvent("before_query_place",this,a)}});Ext.ns("Ext.ux.form");
Ext.ux.form.FileUploadField=Ext.extend(Ext.form.TextField,{readOnly:true,autoSize:Ext.emptyFn,iconClsSelectFile:"x-form-file-icon",iconClsClearFile:"x-form-file-clear-icon",iconClsDownloadFile:"x-form-file-download-icon",constructor:function(a,b){if(b){if(b.prefixUploadField)this.prefixUploadField=b.prefixUploadField;if(b.fileUrl)this.fileUrl=b.fileUrl;if(a.readOnly)this.readOnlyAll=true;this.possibleFileExtensions=b.possibleFileExtensions?b.possibleFileExtensions:""}Ext.ux.form.FileUploadField.superclass.constructor.call(this,
a,b)},initComponent:function(){Ext.ux.form.FileUploadField.superclass.initComponent.call(this);this.addEvents("fileselected")},onRender:function(a,b){Ext.ux.form.FileUploadField.superclass.onRender.call(this,a,b);this.value=this.getFileName();this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.createFileInput();var e=Ext.applyIf(this.buttonCfg||{},{iconCls:this.iconClsSelectFile});this.buttonFile=new Ext.Button(Ext.apply(e,{renderTo:this.wrap,
width:16,cls:"x-form-file-btn"+(e.iconCls?" x-btn-icon":""),tooltip:{text:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0444\u0430\u0439\u043b",width:150}}));this.buttonClear=new Ext.Button({renderTo:this.wrap,width:16,cls:"x-form-file-clear",iconCls:this.iconClsClearFile,handler:this.clickClearField,scope:this,hidden:this.value?false:true,tooltip:{text:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",width:65}});this.renderHelperBtn();this.bindListeners();this.resizeEl=this.positionEl=this.wrap;
if(this.readOnlyAll){this.buttonFile.setDisabled(true);this.buttonFile.getEl().setStyle("z-index",3);this.buttonClear.setDisabled(true);this.getHelperBtn()&&this.getHelperBtn().setDisabled(true)}},renderHelperBtn:function(){this.buttonDownload=new Ext.Button({renderTo:this.wrap,width:16,cls:"x-form-file-download",iconCls:this.iconClsDownloadFile,handler:this.clickDownload,scope:this,hidden:this.value?false:true,tooltip:{text:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c",width:65}})},getHelperBtn:function(){return this.buttonDownload},
bindListeners:function(){this.fileInput.on({scope:this,mouseenter:function(){this.buttonFile.addClass(["x-btn-over","x-btn-focus"])},mouseleave:function(){this.buttonFile.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},mousedown:function(){this.buttonFile.addClass("x-btn-click")},mouseup:function(){this.buttonFile.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},change:function(){if(this.isFileExtensionOK()){var a=this.fileInput.dom.value;this.setValue(a);this.fireEvent("fileselected",
this,a);if(a){this.fileUrl=null;if(!this.buttonClear.isVisible()){this.buttonClear.show();this.el.setWidth(this.el.getWidth()-this.buttonClear.getWidth())}}}else{Ext.Msg.show({title:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435",msg:"\u041d\u0435\u0432\u0435\u0440\u043d\u043e\u0435 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435 \u0444\u0430\u0439\u043b\u0430",buttons:Ext.Msg.OK,fn:Ext.emptyFn,animEl:"elId",icon:Ext.MessageBox.WARNING});this.reset()}}})},createFileInput:function(){this.fileInput=
this.wrap.createChild({id:this.getFileInputId(),name:(this.prefixUploadField||"")+this.name,cls:"x-form-file",tag:"input",type:"file",size:1,width:20});Ext.QuickTips.unregister(this.fileInput);Ext.QuickTips.register({target:this.fileInput,text:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0444\u0430\u0439\u043b",width:86,dismissDelay:1E4})},reset:function(){this.fileInput.remove();this.createFileInput();this.bindListeners();Ext.ux.form.FileUploadField.superclass.reset.call(this)},getFileInputId:function(){return this.id+
"-file"},onResize:function(a,b){Ext.ux.form.FileUploadField.superclass.onResize.call(this,a,b);this.wrap.setWidth(a);a=this.wrap.getWidth()-this.buttonFile.getEl().getWidth();var e=this.buttonClear.getWidth();if(e)a-=e;if(e=this.getHelperBtn()?this.getHelperBtn().getWidth():0)a-=e;Ext.isWebKit?this.el.setWidth(a+5):this.el.setWidth(a)},onDestroy:function(){Ext.ux.form.FileUploadField.superclass.onDestroy.call(this);Ext.QuickTips.unregister(this.fileInput);Ext.destroy(this.fileInput,this.buttonFile,
this.buttonClear,this.getHelperBtn(),this.wrap)},onDisable:function(){Ext.ux.form.FileUploadField.superclass.onDisable.call(this);this.doDisable(true)},onEnable:function(){Ext.ux.form.FileUploadField.superclass.onEnable.call(this);this.doDisable(false)},doDisable:function(a){this.fileInput.dom.disabled=a;this.buttonFile.setDisabled(a);this.buttonClear.setDisabled(a);this.getHelperBtn()&&this.getHelperBtn().setDisabled(a)},preFocus:Ext.emptyFn,alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,
"tl-tr",[2,0])},clickClearField:function(){this.reset();this.setValue("");var a=this.el.getWidth()+this.buttonClear.getWidth();if(this.getHelperBtn()){a+=this.getHelperBtn().isVisible()?this.getHelperBtn().getWidth():0;this.getHelperBtn().hide()}this.el.setWidth(a);this.buttonClear.hide()},getFileUrl:function(a){return document.location.protocol+"//"+document.location.host+"/"+a},clickDownload:function(){var a=this.getFileUrl(this.fileUrl);a&&window.open(a)},getFileName:function(){return this.value.split("/").reverse()[0]},
isFileExtensionOK:function(){var a=this.fileInput.dom.value.split(".");if(a.length>0)return this.possibleFileExtensions.split(",").indexOf(a[a.length-1].toLowerCase())!=-1;return false},setReadOnly:function(a){Ext.ux.form.FileUploadField.superclass.setReadOnly.call(this,a)}});Ext.reg("fileuploadfield",Ext.ux.form.FileUploadField);Ext.form.FileUploadField=Ext.ux.form.FileUploadField;Ext.ns("Ext.ux.form");
Ext.ux.form.ImageUploadField=Ext.extend(Ext.form.FileUploadField,{iconClsSelectFile:"x-form-image-icon",iconClsClearFile:"x-form-image-clear-icon",iconClsPreviewImage:"x-form-image-preview-icon",constructor:function(a,b){if(b){if(b.thumbnailWidth)this.thumbnailWidth=b.thumbnailWidth;if(b.thumbnailHeight)this.thumbnailHeight=b.thumbnailHeight;if(b.prefixThumbnailImg)this.prefixThumbnailImg=b.prefixThumbnailImg;if(b.thumbnail)this.thumbnail=b.thumbnail;if(b.fileUrl){var e=b.fileUrl.split("/"),f=e.slice(0,
e.length-1);e=e[e.length-1];var g=this.prefixThumbnailImg||"";f=String.format("{0}/{1}{2}",f.join("/"),g,e);this.previewTip=new Ext.QuickTip({id:"preview_tip_window",html:String.format('<a href="{0}" rel="lightbox"><image src="{1}" WIDTH={2} HEIGHT={3} OnClick=Ext.getCmp("preview_tip_window").hide()></a>',b.fileUrl,this.getFileUrl(f),this.thumbnailWidth,this.thumbnailHeight),autoHide:false,width:this.thumbnailWidth+10,height:this.thumbnailHeight+10})}}Ext.ux.form.ImageUploadField.superclass.constructor.call(this,
a,b)},renderHelperBtn:function(){if(this.thumbnail)this.buttonPreview=new Ext.Button({renderTo:this.wrap,width:16,cls:"x-form-file-download",iconCls:this.iconClsPreviewImage,handler:this.clickHelperBtn,scope:this,hidden:this.value?false:true,tooltip:{text:"\u041f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043f\u043e\u043a\u0430\u0437",width:140}})},getHelperBtn:function(){return this.buttonPreview},clickHelperBtn:function(){var a=this.getEl(),b=a.getXY();
this.previewTip.showAt([b[0],b[1]+a.getHeight()])},createFileInput:function(){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:(this.prefixUploadField||"")+this.name,cls:"x-form-file",tag:"input",type:"file",size:1,width:20});Ext.QuickTips.unregister(this.fileInput);Ext.QuickTips.register({target:this.fileInput,text:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435",width:130,dismissDelay:1E4})},onDestroy:function(){Ext.ux.form.ImageUploadField.superclass.onDestroy.call(this);
Ext.destroy(this.previewTip)}});Ext.ux.Lightbox.register("a[rel^=lightbox]");Ext.reg("imageuploadfield",Ext.ux.form.ImageUploadField);function createAdvancedTreeGrid(a,b){return new Ext.m3.AdvancedTreeGrid(a,b)}function createGridPanel(a,b){return a.editor?new Ext.m3.EditorGridPanel(a,b):new Ext.m3.GridPanel(a,b)}function createObjectGrid(a,b){return a.editor?new Ext.m3.EditorObjectGrid(a,b):new Ext.m3.ObjectGrid(a,b)}function createObjectTree(a,b){return new Ext.m3.ObjectTree(a,b)}
function createAdvancedComboBox(a,b){return new Ext.m3.AdvancedComboBox(a,b)}function createAdvancedDataField(a,b){return new Ext.m3.AdvancedDataField(a,b)}
Ext.onReady(function(){Ext.override(Ext.Window,{tmpModal:false,manager:new Ext.WindowGroup,constrain:true,activateChildWindow:function(){this.toFront()},listeners:{beforeshow:function(){Ext.get(this.renderTo).getHeight()<this.getHeight()&&this.setHeight(Ext.get(this.renderTo).getHeight());if(this.parentWindow){this.parentWindow.setDisabled(true);this.parentWindow.el.removeClass("x-masked-relative");this.parentWindow.on("activate",this.activateChildWindow,this);this.modal=false;this.tmpModal=true;
if(window.AppDesktop){var a=AppDesktop.getDesktop().taskbar.tbPanel.getTabWin(this.parentWindow);a&&a.mask()}}if(this.modal){(a=Ext.get("ux-taskbar"))&&a.mask();(a=Ext.get("ux-toptoolbar"))&&a.mask()}},beforeclose:function(){if(this.tmpModal&&this.parentWindow){this.parentWindow.un("activate",this.activateChildWindow,this);this.parentWindow.setDisabled(false);this.parentWindow.toFront();if(window.AppDesktop){var a=AppDesktop.getDesktop().taskbar.tbPanel.getTabWin(this.parentWindow);a&&a.unmask()}}if(this.modal){(a=
Ext.get("ux-taskbar"))&&a.unmask();(a=Ext.get("ux-toptoolbar"))&&a.unmask()}},hide:function(){if(this.modal)if(!this.parentWindow){var a=Ext.get("ux-taskbar");a&&a.unmask();(a=Ext.get("ux-toptoolbar"))&&a.unmask()}}}})});
Ext.override(Ext.ux.tree.TreeGrid,{fitColumns:function(){var a=this.getInnerWidth()-Ext.num(this.scrollOffset,Ext.getScrollBarWidth()),b=this.getTotalColumnWidth(),e=this.getVisibleColumns(),f,g=0;for(f=0;f<e.length;f++){if(f==e.length-1){e[f].width=a-g-1;break}e[f].width=Math.floor(a/100*(e[f].width*100/b))-1;g+=e[f].width}this.updateColumnWidths()},onResize:function(a,b){Ext.ux.tree.TreeGrid.superclass.onResize.apply(this,arguments);var e=this.innerBody.dom,f=this.innerHd.dom;if(e){if(Ext.isNumber(b))e.style.height=
this.body.getHeight(true)-f.offsetHeight+"px";if(Ext.isNumber(a)){var g=Ext.num(this.scrollOffset,Ext.getScrollBarWidth());if(this.reserveScrollOffset||e.offsetWidth-e.clientWidth>10)this.setScrollOffset(g);else{var h=this;setTimeout(function(){h.setScrollOffset(e.offsetWidth-e.clientWidth>10?g:0)},10)}}this.fitColumns()}}});
Ext.override(Ext.tree.ColumnResizer,{onEnd:function(){var a=this.proxy.getWidth(),b=this.tree;this.proxy.remove();delete this.dragHd;b.columns[this.hdIndex].width=a;b.fitColumns();setTimeout(function(){b.headersDisabled=false},100)}});Ext.override(Ext.tree.TreeNodeUI,{onDblClick:function(a){a.preventDefault();if(!this.disabled)if(this.fireEvent("beforedblclick",this.node,a)!==false){this.checkbox&&this.toggleCheck();this.fireEvent("dblclick",this.node,a)}}});
Ext.override(Ext.form.Action.Submit,{run:function(){var a=this.options,b=this.getMethod(),e=b=="GET";if(a.clientValidation===false||this.form.isValid()){if(a.submitEmptyText===false){var f=[];this.form.items.each(function(g){if(g.el.getValue()==g.emptyText){f.push(g);g.el.dom.value=""}g instanceof Ext.form.CompositeField&&g.items.each(function(h){if(h.el.getValue()==h.emptyText){f.push(h);h.el.dom.value=""}})})}Ext.Ajax.request(Ext.apply(this.createCallback(a),{form:this.form.el.dom,url:this.getUrl(e),
method:b,headers:a.headers,params:!e?this.getParams():null,isUpload:this.form.fileUpload}));a.submitEmptyText===false&&Ext.each(f,function(g){g.applyEmptyText&&g.applyEmptyText()})}else if(a.clientValidation!==false){this.failureType=Ext.form.Action.CLIENT_INVALID;this.form.afterAction(this,false)}}});Ext.override(Ext.PagingToolbar,{onPagingBlur:Ext.emptyFn});
if(Ext.isIE7||Ext.isIE6)Ext.Panel.override({setAutoScroll:function(){if(this.rendered&&this.autoScroll){var a=this.body||this.el;if(a){a.setOverflow("auto");a.dom.style.position="relative"}}}});
