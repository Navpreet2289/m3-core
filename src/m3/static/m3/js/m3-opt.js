Ext.ux.Reorderer=Ext.extend(Object,{defaults:{animate:true,animationDuration:0.2,defaultReorderable:false},constructor:function(a){Ext.apply(this,a||{},this.defaults)},init:function(a){this.target=a;this.initEvents();a=this.getItems();var b=a.length,d;for(d=0;d<b;d++)this.createIfReorderable(a[d])},reorder:function(a){var b=this.target;if(b.fireEvent("before-reorder",a,b,this)!==false){this.doReorder(a);b.fireEvent("reorder",a,b,this)}},doReorder:function(){throw Error("doReorder must be implemented in the Ext.ux.Reorderer subclass");
},createItemDD:function(){throw Error("createItemDD must be implemented in the Ext.ux.Reorderer subclass");},createItemDD:function(a){var b=a.getEl(),d=this.target,e=this;a.dd=new Ext.dd.DD(b,undefined,{isTarget:false});a.dd.constrainTo(d.getEl());a.dd.setYConstraint(0,0,0);Ext.apply(a.dd,{b4StartDrag:function(){this.startPosition=b.getXY();this.startZIndex=b.getStyle("zIndex");b.setStyle("zIndex",1E4);a.suspendEvents()},onDrag:function(){for(var f=b.getXY()[0],g=f-this.startPosition[0],j=d.items.items,
h=j.indexOf(a),k=0;k<j.length;k++){var l=j[k];if(l.reorderable&&l.id!=a.id){var m=l.getEl().getBox();m=(e.buttonXCache[l.id]||m.x)+m.width/2;l=h>k&&g<0&&f<m;m=h<k&&g>0&&f+b.getWidth()>m;if(l||m){e[l?"onMovedLeft":"onMovedRight"](a,k,h);break}}}},endDrag:function(){e.updateButtonXCache();b.moveTo(e.buttonXCache[a.id],undefined,{duration:e.animationDuration,scope:this,callback:function(){a.resumeEvents();d.fireEvent("reordered",a,d)}});b.setStyle("zIndex",this.startZIndex)}})},createIfReorderable:function(a){if(this.defaultReorderable&&
a.reorderable==undefined)a.reorderable=true;if(a.reorderable&&!a.dd)a.rendered?this.createItemDD(a):a.on("render",this.createItemDD.createDelegate(this,[a]),this,{single:true})},getItems:function(){return this.target.items.items},initEvents:function(){this.target.addEvents("before-reorder","reorder")}});
Ext.ux.HBoxReorderer=Ext.extend(Ext.ux.Reorderer,{init:function(a){this.buttonXCache={};a.on({scope:this,add:function(b,d){this.createIfReorderable(d)}});Ext.ux.HBoxReorderer.superclass.init.apply(this,arguments)},createItemDD:function(a){if(a.dd==undefined){var b=a.getEl(),d=this,e=d.target;a.dd=new Ext.dd.DD(b,undefined,{isTarget:false});b.applyStyles({position:"absolute"});var f=function(){return false};Ext.apply(a.dd,{b4StartDrag:function(){this.startPosition=b.getXY();this.startZIndex=b.getStyle("zIndex");
b.setStyle("zIndex",1E4);a.suspendEvents();a.menu&&a.menu.on("beforeshow",f,d)},startDrag:function(){this.constrainTo(e.getEl());this.setYConstraint(0,0,0)},onDrag:function(){var g=b.getXY()[0],j=g-this.startPosition[0],h=e.items.items,k=h.length,l=h.indexOf(a),m,n;for(m=0;m<k;m++){n=h[m];if(n.reorderable&&n.id!=a.id){var o=n.getEl().getBox();o=(d.buttonXCache[n.id]||o.x)+o.width/2;n=l>m&&j<0&&g<o;o=l<m&&j>0&&g+b.getWidth()>o;if(n||o){d[n?"onMovedLeft":"onMovedRight"](a,m,l);break}}}},endDrag:function(){d.updateButtonXCache();
b.moveTo(d.buttonXCache[a.id],b.getY(),{duration:d.animationDuration,scope:this,callback:function(){a.resumeEvents();a.menu&&a.menu.un("beforeshow",f,d);e.fireEvent("reordered",a,e)}});b.setStyle("zIndex",this.startZIndex)}})}},onMovedLeft:function(a,b,d){var e=this.target,f=e.items.items,g=f.length;if(b!=undefined&&b!=d){e.remove(a,false);e.insert(b,a);this.updateButtonXCache();for(b=0;b<g;b++){e=f[b];d=this.buttonXCache[e.id];if(a==e)a.dd.startPosition[0]=d;else{e=e.getEl();e.moveTo(d,e.getY(),
{duration:this.animationDuration})}}}},onMovedRight:function(){this.onMovedLeft.apply(this,arguments)},updateButtonXCache:function(){var a=this.target,b=a.items,d=a.getEl().getBox(true).x;b.each(function(e){this.buttonXCache[e.id]=d;d+=e.getEl().getWidth()},this)}});Ext.ns("Ext.ux.plugins.grid");
Ext.ux.plugins.grid.CellToolTips=function(a){var b;if(Ext.isArray(a)){b=a;a={}}else b=a.ajaxTips;Ext.ux.plugins.grid.CellToolTips.superclass.constructor.call(this,a);if(a.tipConfig)this.tipConfig=a.tipConfig;this.ajaxTips=b};
Ext.extend(Ext.ux.plugins.grid.CellToolTips,Ext.util.Observable,{version:1.3,ajaxTips:false,tipTpls:false,tipFns:false,tipUrls:"",tipConfig:{},request:false,init:function(a){if(this.ajaxTips){this.tipTpls={};this.tipFns={};this.tipAfterFns={};this.tipUrls={};Ext.each(this.ajaxTips,function(b){this.tipTpls[b.field]=new Ext.XTemplate(b.tpl);if(b.url)this.tipUrls[b.field]=b.url;if(b.fn)this.tipFns[b.field]=b.fn;if(b.afterFn)this.tipAfterFns[b.field]=b.afterFn;if(b.tipConfig)this.tipConfig=b.tipConfig},
this);delete this.ajaxTips;a.on("render",this.onGridRender.createDelegate(this))}},setFieldTpl:function(a,b){this.tipTpls[a]=Ext.isObject(b)?b:new Ext.XTemplate(b)},onGridRender:function(a){if(this.tipTpls){Ext.apply(this.tipConfig,{target:a.getView().mainBody,delegate:".x-grid3-cell-inner",renderTo:document.body,finished:false});Ext.applyIf(this.tipConfig,{trackMouse:true});this.tip=new Ext.ToolTip(this.tipConfig);this.tip.ctt=this;this.tip.on("beforeshow",this.beforeTipShow.createDelegate(this.tip,
[this,a],true));this.tip.on("hide",this.hideTip)}},beforeTipShow:function(a,b,d){var e=d.getView().findCellIndex(a.triggerElement);e=d.getColumnModel().getDataIndex(e);if(!b.tipTpls[e])return false;if(a.finished)a.body.dom.innerHTML=a.ctt.tipTpls[e].apply(a.tipdata);else{var f=typeof b.tipUrls[e]=="string",g=d.getView().findRowIndex(a.triggerElement),j=d.getStore().getAt(g);if(d.CellToolTipCondition&&d.CellToolTipCondition(g,j)===false)return false;g=j.copy().data;if(f){b.loadDetails(b.tipFns[e]?
b.tipFns[e](g):g,a,d,b,e);a.body.dom.innerHTML="Loading..."}else a.body.dom.innerHTML=b.tipTpls[e].apply(b.tipFns[e]?b.tipFns[e](j.data):j.data)}},hideTip:function(a){a.finished=false},loadDetails:function(a,b,d,e,f){Ext.Ajax.request({url:e.tipUrls[f],params:a,method:"POST",success:function(g){b.finished=true;b.tipdata=Ext.decode(g.responseText);if(e.tipAfterFns[f])b.tipdata=e.tipAfterFns[f](b.tipdata);b.show()}})}});Ext.namespace("Ext.ux.grid");
Ext.ux.grid.GridHeaderFilters=function(a){a&&Ext.apply(this,a)};
Ext.extend(Ext.ux.grid.GridHeaderFilters,Ext.util.Observable,{fieldHeight:22,fieldPadding:1,highlightOnFilter:true,highlightColor:"yellow",highlightCls:null,stateful:true,applyMode:"auto",filters:null,filtersInitMode:"replace",ensureFilteredVisible:true,cfgFilterInit:false,containerConfig:null,labelWidth:50,fcc:null,filterFields:null,filterContainers:null,filterContainerCls:"x-ghf-filter-container",inResizeProcess:false,init:function(a){this.grid=a;a=this.grid.getView();a.updateHeaders=a.updateHeaders.createSequence(function(){this.renderFilters.call(this)},
this).createInterceptor(function(){return true},this);this.grid.on({scope:this,render:this.onRender,resize:this.onResize,columnresize:this.onColResize,reconfigure:this.onReconfigure,beforedestroy:this.destroyFilters});if(this.stateful){this.grid.on("beforestatesave",this.saveFilters,this);this.grid.on("beforestaterestore",this.loadFilters,this)}this.grid.getColumnModel().on("hiddenchange",this.onColHidden,this);this.grid.addEvents("filterupdate");this.addEvents({render:true});this.cfgFilterInit=Ext.isDefined(this.filters)&&
this.filters!==null;if(!this.filters)this.filters={};this.configure(this.grid.getColumnModel());Ext.ux.grid.GridHeaderFilters.superclass.constructor.call(this);if(this.stateful){if(!Ext.isArray(this.grid.stateEvents))this.grid.stateEvents=[];this.grid.stateEvents.push("filterupdate")}Ext.apply(this.grid,{headerFilters:this,getHeaderFilter:function(b){if(!this.headerFilters)return null;return this.headerFilters.filters[b]},setHeaderFilter:function(b,d){if(this.headerFilters){var e={};e[b]=d;this.setHeaderFilters(e)}},
setHeaderFilters:function(b,d,e){if(this.headerFilters){d&&this.resetHeaderFilters(false);if(arguments.length<3)e=true;var f=false,g;for(g in b)if(this.headerFilters.filterFields[g]){f=this.headerFilters.filterFields[g];this.headerFilters.setFieldValue(f,b[g]);this.headerFilters.applyFilter(f,false);f=true}f&&e&&this.headerFilters.storeReload()}},getHeaderFilterField:function(b){if(this.headerFilters)return this.headerFilters.filterFields[b]?this.headerFilters.filterFields[b]:null},resetHeaderFilters:function(b){if(this.headerFilters){if(arguments.length==
0)b=true;for(var d in this.headerFilters.filterFields){var e=this.headerFilters.filterFields[d];Ext.isFunction(e.clearValue)?e.clearValue():this.headerFilters.setFieldValue(e,"");this.headerFilters.applyFilter(e,false)}b&&this.headerFilters.storeReload()}},applyHeaderFilters:function(b){if(arguments.length==0)b=true;this.headerFilters.applyFilters(b)}})},configure:function(a){a=a.getColumnsBy(function(h){return Ext.isObject(h.filter)||Ext.isArray(h.filter)?true:false});this.fcc={};for(var b=0;b<a.length;b++){var d=
a[b],e=d.filter;Ext.isArray(e)||(e=[e]);for(var f=0;f<e.length;f++){var g=Ext.apply({filterName:f>0?d.dataIndex+f:d.dataIndex},e[f]);Ext.apply(g,{columnId:d.id,dataIndex:d.dataIndex,hideLabel:true,anchor:"100%"});if(!this.cfgFilterInit&&!Ext.isEmpty(g.value))this.filters[g.filterName]=Ext.isFunction(g.filterEncoder)?g.filterEncoder.call(this,g.value):g.value;delete g.value;if(g.applyFilterEvent){g.listeners={scope:this};g.listeners[g.applyFilterEvent]=function(h){this.applyFilter(h)};delete g.applyFilterEvent}else if(this.applyMode===
"auto"||this.applyMode==="change"||Ext.isEmpty(this.applyMode))if(g.hasListener!=undefined){g.hasListener("change")||g.on("change",function(h){var k=h.getXType();k=="combo"||k=="datefield"||this.applyFilter(h)},this);g.hasListener("specialkey")||g.on("specialkey",function(h,k){k.stopPropagation();k.getKey()==k.ENTER&&h.el.dom.blur()},this);g.hasListener("select")||g.on("select",function(h){this.applyFilter(h)},this)}else g.listeners={change:function(h){var k=h.getXType();k=="combo"||k=="datefield"||
this.applyFilter(h)},select:function(h){this.applyFilter(h)},scope:this};else if(this.applyMode==="enter")g.listeners={specialkey:function(h,k){k.stopPropagation();k.getKey()==k.ENTER&&this.applyFilters()},scope:this};var j=this.fcc[g.columnId];if(!j){j={cls:this.filterContainerCls,border:false,bodyBorder:false,bodyStyle:"background-color: transparent",labelSeparator:"",labelWidth:this.labelWidth,layout:"hbox",style:{},items:[]};this.containerConfig&&Ext.apply(j,this.containerConfig);this.fcc[g.columnId]=
j}j.items.push({bodyStyle:"background-color: transparent",border:false,bodyBorder:false,layout:"form",padding:2,margins:"0 0 -4 0",flex:1,items:[g]})}}},renderFilterContainer:function(a,b){if(!this.filterContainers)this.filterContainers={};var d=this.grid.getColumnModel().getIndexById(a),e=this.grid.getView().getHeaderCell(d);e=Ext.get(e);if(Ext.isGecko)e.dom.style.MozUserSelect="text";e.dom.style.verticalAlign="top";b.width=e.getWidth()-3;d=new Ext.Container(b);d.render(e);this.filterContainers[a]=
d;e=0;if(!this.filterFields)this.filterFields={};var f=d.findBy(function(j){return!Ext.isEmpty(j.filterName)});if(!Ext.isEmpty(f))for(var g=0;g<f.length;g++){this.filterFields[f[g].filterName]=f[g];e+=f[g].getHeight()}return d},renderFilters:function(){if(this.fcc){for(var a in this.fcc)this.renderFilterContainer(a,this.fcc[a]);this.setFilters(this.filters);this.highlightFilters(this.isFiltered())}},onRender:function(){this.isFiltered()&&this.applyFilters(false);this.fireEvent("render",this)},getFilterField:function(a){return this.filterFields?
this.filterFields[a]:null},setFilters:function(a,b){if((this.filters=a)&&this.filterFields){for(var d in this.filters)this.filterFields[d]||delete this.filters[d];for(d in this.filterFields){var e=this.filterFields[d],f=this.filters[e.filterName];if(Ext.isEmpty(f))b&&this.setFieldValue(e,"");else this.setFieldValue(e,f)}}},onColResize:function(a,b){if(this.filterContainers){if(!this.inResizeProcess)if(this.grid.viewConfig&&this.grid.viewConfig.forceFit){this.onResize();return}var d=this.filterContainers[this.grid.getColumnModel().getColumnId(a)];
if(d){if(isNaN(b))b=0;d.setWidth(b<3?0:b-3);d.doLayout(false,true)}}},onResize:function(){this.inResizeProcess=true;for(var a=this.grid.getColumnModel().getColumnCount(),b=0;b<a;b++){var d=this.grid.getView().getHeaderCell(b);d=Ext.get(d);this.onColResize(b,d.getWidth())}this.inResizeProcess=false},onColHidden:function(a,b,d){if(!d){a=this.grid.getColumnModel().getColumnWidth(b);this.onColResize(b,a)}},onReconfigure:function(a,b,d){this.destroyFilters();this.configure(d);this.renderFilters()},saveFilters:function(a,
b){var d={},e;for(e in this.filters)d[e]=this.filters[e];b.gridHeaderFilters=d;return true},loadFilters:function(a,b){var d=b.gridHeaderFilters;if(d)if(this.cfgFilterInit)this.filtersInitMode==="merge"&&Ext.apply(d,this.filters);else this.filters=d},isFiltered:function(){for(var a in this.filters)if(!Ext.isEmpty(this.filters[a]))return true;return false},highlightFilters:function(a){if(this.highlightOnFilter)if(this.filterContainers)if(this.grid.getView().mainHd){var b=a?this.highlightColor:"transparent",
d;for(d in this.filterContainers){var e=this.filterContainers[d];if(e.rendered)if(Ext.isEmpty(this.highlightCls))e.getEl().setStyle("backgroundColor",b);else a?e.getEl().addClass(this.highlightCls):e.getEl().removeClass(this.highlightCls)}}},getFieldValue:function(a){return Ext.isFunction(a.filterEncoder)?a.filterEncoder.call(a,a.getValue()):a.getValue()},setFieldValue:function(a,b){if(Ext.isFunction(a.filterDecoder))b=a.filterDecoder.call(a,b);a.setValue(b)},applyFilter:function(a,b){if(arguments.length<
2)b=true;if(a)if(a.isValid())if(!(a.disabled&&!Ext.isDefined(this.grid.store.baseParams[a.filterName]))){var d=this.getFieldValue(a);if(a.disabled||Ext.isEmpty(d)){delete this.grid.store.baseParams[a.filterName];delete this.filters[a.filterName]}else{this.grid.store.baseParams[a.filterName]=d;this.filters[a.filterName]=d;if(this.ensureFilteredVisible){var e=this.grid.getColumnModel().getIndexById(a.columnId);e>=0&&this.grid.getColumnModel().isHidden(e)&&this.grid.getColumnModel().setHidden(e,false)}}this.highlightFilters(this.isFiltered());
this.grid.fireEvent("filterupdate",a.filterName,d,a);b&&this.storeReload()}},applyFilters:function(a){if(arguments.length<1)a=true;for(var b in this.filterFields)this.applyFilter(this.filterFields[b],false);a&&this.storeReload()},storeReload:function(){if(this.grid.store.lastOptions){var a={start:0};if(this.grid.store.lastOptions.params&&this.grid.store.lastOptions.params.limit)a.limit=this.grid.store.lastOptions.params.limit;this.grid.store.load({params:a})}},getFilterContainer:function(a){return this.filterContainers?
this.filterContainers[a]:null},destroyFilters:function(){if(this.filterFields)for(var a in this.filterFields){Ext.destroy(this.filterFields[a]);delete this.filterFields[a]}if(this.filterContainers)for(a in this.filterContainers){Ext.destroy(this.filterContainers[a]);delete this.filterContainers[a]}}});Ext.ns("Ext.ux.grid");
Ext.ux.grid.LockingHeaderGroupGridView=Ext.extend(Ext.grid.GridView,{lockText:"Lock",unlockText:"Unlock",rowBorderWidth:1,lockedBorderWidth:1,syncHeights:false,initTemplates:function(){var a=this.templates||{};if(!a.master)a.master=new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-locked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{lstyle}">{lockedHeader}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{lstyle}">{lockedBody}</div><div class="x-grid3-scroll-spacer"></div></div>',
"</div>",'<div class="x-grid3-viewport x-grid3-unlocked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{ostyle}">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{bstyle}">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',"</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>");if(!a.gcell)a.gcell=
new Ext.XTemplate('<td class="x-grid3-hd x-grid3-gcell x-grid3-td-{id} ux-grid-hd-group-row-{row} {cls}" style="{style}">','<div {tooltip} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"","{value}</div></td>");this.templates=a;this.hrowRe=/ux-grid-hd-group-row-(\d+)/;Ext.ux.grid.LockingHeaderGroupGridView.superclass.initTemplates.call(this)},getEditorParent:function(){return this.el.dom},initElements:function(){var a=
Ext.Element,b=this.grid.getGridEl().dom.firstChild,d=b.childNodes;this.el=new a(b);this.lockedWrap=new a(d[0]);this.lockedHd=new a(this.lockedWrap.dom.firstChild);this.lockedInnerHd=this.lockedHd.dom.firstChild;this.lockedScroller=new a(this.lockedWrap.dom.childNodes[1]);this.lockedBody=new a(this.lockedScroller.dom.firstChild);this.mainWrap=new a(d[1]);this.mainHd=new a(this.mainWrap.dom.firstChild);if(this.grid.hideHeaders){this.lockedHd.setDisplayed(false);this.mainHd.setDisplayed(false)}this.innerHd=
this.mainHd.dom.firstChild;this.scroller=new a(this.mainWrap.dom.childNodes[1]);this.forceFit&&this.scroller.setStyle("overflow-x","hidden");this.mainBody=new a(this.scroller.dom.firstChild);this.focusEl=new a(this.scroller.dom.childNodes[1]);this.resizeMarker=new a(d[2]);this.resizeProxy=new a(d[3]);this.focusEl.swallowEvent("click",true)},getLockedRows:function(){return this.hasRows()?this.lockedBody.dom.childNodes:[]},getLockedRow:function(a){return this.getLockedRows()[a]},getCell:function(a,
b){var d=this.cm.getLockedCount();if(b<d)return this.getLockedRow(a).getElementsByTagName("td")[b];return Ext.ux.grid.LockingHeaderGroupGridView.superclass.getCell.call(this,a,b-d)},getHeaderCell:function(a){var b=this.cm.getLockedCount();if(a<b)return this.lockedHd.dom.getElementsByTagName("td")[a];return this.mainHd.query(this.cellSelector)[a-b]},addRowClass:function(a,b){var d=this.getLockedRow(a);d&&this.fly(d).addClass(b);Ext.ux.grid.LockingHeaderGroupGridView.superclass.addRowClass.call(this,
a,b)},removeRowClass:function(a,b){var d=this.getLockedRow(a);d&&this.fly(d).removeClass(b);Ext.ux.grid.LockingHeaderGroupGridView.superclass.removeRowClass.call(this,a,b)},removeRow:function(a){Ext.removeNode(this.getLockedRow(a));Ext.ux.grid.LockingHeaderGroupGridView.superclass.removeRow.call(this,a)},removeRows:function(a,b){for(var d=this.lockedBody.dom,e=a;e<=b;e++)Ext.removeNode(d.childNodes[a]);Ext.ux.grid.LockingHeaderGroupGridView.superclass.removeRows.call(this,a,b)},syncScroll:function(a){this.lockedScroller.dom.scrollTop=
this.scroller.dom.scrollTop;Ext.ux.grid.LockingHeaderGroupGridView.superclass.syncScroll.call(this,a)},updateSortIcon:function(a,b){var d=this.sortClasses,e=this.lockedHd.select("td").removeClass(d),f=this.mainHd.select("td").removeClass(d),g=this.cm.getLockedCount();d=d[b=="DESC"?1:0];a<g?e.item(a).addClass(d):f.item(a-g).addClass(d)},updateAllColumnWidths:function(){var a=this.getTotalWidth(),b=this.cm.getColumnCount(),d=this.getLockedWidth(),e=this.cm.getLockedCount(),f=[],g,j;this.updateLockedWidth();
for(j=0;j<b;j++){f[j]=this.getColumnWidth(j);this.getHeaderCell(j).style.width=f[j]}var h=this.getLockedRows(),k=this.getRows(),l,m;j=0;for(g=k.length;j<g;j++){l=h[j];l.style.width=d;if(l.firstChild){l.firstChild.style.width=d;l=l.firstChild.rows[0];for(m=0;m<e;m++)l.childNodes[m].style.width=f[m]}l=k[j];l.style.width=a;if(l.firstChild){l.firstChild.style.width=a;l=l.firstChild.rows[0];for(m=e;m<b;m++)l.childNodes[m-e].style.width=f[m]}}this.updateGroupStyles();this.onAllColumnWidthsUpdated(f,a);
this.syncHeaderHeight()},onColumnWidthUpdated:function(){Ext.ux.grid.LockingHeaderGroupGridView.superclass.onColumnWidthUpdated.call(this,arguments);this.updateGroupStyles.call(this)},onAllColumnWidthsUpdated:function(){Ext.ux.grid.LockingHeaderGroupGridView.superclass.onAllColumnWidthsUpdated.call(this,arguments);this.updateGroupStyles.call(this)},updateColumnWidth:function(a){var b=this.getColumnWidth(a),d=this.cm.getLockedCount(),e,f,g;this.updateLockedWidth();if(a<d){e=this.getLockedRows();f=
this.getLockedWidth();d=a}else{e=this.getRows();f=this.getTotalWidth();d=a-d}this.getHeaderCell(a).style.width=b;for(var j=0,h=e.length;j<h;j++){g=e[j];g.style.width=f;if(g.firstChild){g.firstChild.style.width=f;g.firstChild.rows[0].childNodes[d].style.width=b}}this.onColumnWidthUpdated(a,b,this.getTotalWidth());this.syncHeaderHeight()},updateColumnHidden:function(a,b){var d=this.cm.getLockedCount(),e,f,g,j=b?"none":"";this.updateLockedWidth();if(a<d){e=this.getLockedRows();f=this.getLockedWidth();
d=a}else{e=this.getRows();f=this.getTotalWidth();d=a-d}this.getHeaderCell(a).style.display=j;for(var h=0,k=e.length;h<k;h++){g=e[h];g.style.width=f;if(g.firstChild){g.firstChild.style.width=f;g.firstChild.rows[0].childNodes[d].style.display=j}}this.onColumnHiddenUpdated(a,b,this.getTotalWidth());delete this.lastViewWidth;this.layout()},doRender:function(a,b,d,e,f,g){var j=this.templates,h=j.cell;j=j.row;for(var k=f-1,l="width:"+this.getTotalWidth()+";",m="width:"+this.getLockedWidth()+";",n=[],o=
[],q,v,t,p={},u={},s,C=0,F=b.length;C<F;C++){s=b[C];q=[];v=[];for(var G=C+e,w=0;w<f;w++){t=a[w];p.id=t.id;p.css=(w===0?"x-grid3-cell-first ":w==k?"x-grid3-cell-last ":"")+(this.cm.config[w].cellCls?" "+this.cm.config[w].cellCls:"");p.attr=p.cellAttr="";p.value=t.renderer(s.data[t.name],p,s,G,w,d);p.style=t.style;if(Ext.isEmpty(p.value))p.value="&#160;";if(this.markDirty&&s.dirty&&Ext.isDefined(s.modified[t.name]))p.css+=" x-grid3-dirty-cell";if(t.locked)v[v.length]=h.apply(p);else q[q.length]=h.apply(p)}t=
[];if(g&&(G+1)%2===0)t[0]="x-grid3-row-alt";if(s.dirty)t[1]=" x-grid3-dirty-row";u.cols=f;if(this.getRowClass)t[2]=this.getRowClass(s,G,u,d);u.alt=t.join(" ");u.cells=q.join("");u.tstyle=l;n[n.length]=j.apply(u);u.cells=v.join("");u.tstyle=m;o[o.length]=j.apply(u)}return[n.join(""),o.join("")]},processRows:function(a,b){if(!(!this.ds||this.ds.getCount()<1)){var d=this.getRows(),e=this.getLockedRows(),f,g;b=b||!this.grid.stripeRows;a=a||0;for(var j=0,h=d.length;j<h;++j){f=d[j];g=e[j];f.rowIndex=j;
g.rowIndex=j;if(!b){f.className=f.className.replace(this.rowClsRe," ");g.className=g.className.replace(this.rowClsRe," ");if((j+1)%2===0){f.className+=" x-grid3-row-alt";g.className+=" x-grid3-row-alt"}}if(this.syncHeights){f=Ext.get(f);g=Ext.get(g);var k=f.getHeight(),l=g.getHeight();if(k>l)g.setHeight(k);else l>k&&f.setHeight(l)}}if(a===0){Ext.fly(d[0]).addClass(this.firstRowCls);Ext.fly(e[0]).addClass(this.firstRowCls)}Ext.fly(d[d.length-1]).addClass(this.lastRowCls);Ext.fly(e[e.length-1]).addClass(this.lastRowCls)}},
afterRender:function(){if(this.ds&&this.cm){var a=this.renderRows()||["&#160;","&#160;"];this.mainBody.dom.innerHTML=a[0];this.lockedBody.dom.innerHTML=a[1];this.processRows(0,true);this.deferEmptyText!==true&&this.applyEmptyText()}},renderUI:function(){var a=this.renderHeaders(),b=this.templates.body.apply({rows:"&#160;"});a=this.templates.master.apply({body:b,header:a[0],ostyle:"width:"+this.getOffsetWidth()+";",bstyle:"width:"+this.getTotalWidth()+";",lockedBody:b,lockedHeader:a[1],lstyle:"width:"+
this.getLockedWidth()+";"});b=this.grid;b.getGridEl().dom.innerHTML=a;this.initElements();Ext.fly(this.innerHd).on("click",this.handleHdDown,this);Ext.fly(this.lockedInnerHd).on("click",this.handleHdDown,this);this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.lockedHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.scroller.on("scroll",this.syncScroll,this);if(b.enableColumnResize!==
false){this.splitZone=new Ext.grid.GridView.SplitDragZone(b,this.mainHd.dom);this.splitZone.setOuterHandleElId(Ext.id(this.lockedHd.dom));this.splitZone.setOuterHandleElId(Ext.id(this.mainHd.dom))}if(b.enableColumnMove){this.columnDrag=new Ext.grid.GridView.ColumnDragZone(b,this.innerHd);this.columnDrag.setOuterHandleElId(Ext.id(this.lockedInnerHd));this.columnDrag.setOuterHandleElId(Ext.id(this.innerHd));this.columnDrop=new Ext.grid.HeaderDropZone(b,this.mainHd.dom)}if(b.enableHdMenu!==false){this.hmenu=
new Ext.menu.Menu({id:b.id+"-hctx"});this.hmenu.add({itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"});this.grid.enableColLock!==false&&this.hmenu.add("-",{itemId:"lock",text:this.lockText,cls:"xg-hmenu-lock"},{itemId:"unlock",text:this.unlockText,cls:"xg-hmenu-unlock"});if(b.enableColumnHide!==false){this.colMenu=new Ext.menu.Menu({id:b.id+"-hcols-menu"});this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});
this.hmenu.add("-",{itemId:"columns",hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})}this.hmenu.on("itemclick",this.handleHdMenuClick,this)}if(b.trackMouseOver){this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut});this.lockedBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut})}if(b.enableDragDrop||b.enableDrag)this.dragZone=new Ext.grid.GridDragZone(b,{ddGroup:b.ddGroup||"GridDD"});this.updateHeaderSortState()},splitZoneConfig:{allowHeaderDrag:function(a){return!a.getTarget(null,
null,true).hasClass("ux-grid-hd-group-cell")}},columnDropConfig:{getTargetFromEvent:function(a){return this.view.findHeaderCell(Ext.lib.Event.getTarget(a))},positionIndicator:function(a,b,d){a=this.getDragDropData.call(this,a,b,d);if(a===false)return false;b=a.px+this.proxyOffsets[0];this.proxyTop.setLeftTop(b,a.r.top+this.proxyOffsets[1]);this.proxyTop.show();this.proxyBottom.setLeftTop(b,a.r.bottom);this.proxyBottom.show();return a.pt},onNodeDrop:function(a,b,d,e){b=e.header;if(b!=a){a=this.getDragDropData.call(this,
b,a,d);if(a===false)return false;d=this.grid.colModel;b=a.oldIndex<a.newIndex;e=d.rows;for(var f=a.row,g=e.length;f<g;f++){for(var j=e[f],h=j.length,k=0,l=1,m=h,n=0,o=0;n<h;n++){var q=j[n];if(a.oldIndex>=o&&a.oldIndex<o+q.colspan)k=n;if(a.oldIndex+a.colspan-1>=o&&a.oldIndex+a.colspan-1<o+q.colspan)l=n-k+1;if(a.newIndex>=o&&a.newIndex<o+q.colspan)m=n;o+=q.colspan}h=j.splice(k,l);e[f]=j.splice(0,m-(b?l:0)).concat(h).concat(j)}for(e=0;e<a.colspan;e++){f=a.oldIndex+(b?0:e);g=a.newIndex+(b?-1:e);d.moveColumn(f,
g);this.grid.fireEvent("columnmove",f,g)}return true}return false}},updateGroupStyles:function(a){for(var b=this.lockedHd.query(".x-grid3-header-offset > table"),d=this.getLockedWidth(),e=this.rows,f=[],g=0;g<b.length;g++){b[g].style.width=d;if(g<e.length){var j=b[g].firstChild.firstChild.childNodes;for(var h=f[g]=0,k=0;h<j.length;h++){var l=e[g][h];f[g]+=1;if(typeof a!="number"||a>=k&&a<k+l.colspan){var m=this.getGroupStyle.call(this,l,k);j[h].style.width=m.width;j[h].style.display=m.hidden?"none":
""}k+=l.colspan}}}b=this.mainHd.query(".x-grid3-header-offset > table");d=this.getTotalWidth();e=this.rows;for(g=0;g<b.length;g++){b[g].style.width=d;if(g<e.length){j=b[g].firstChild.firstChild.childNodes;h=0;for(k=this.cm.getLockedCount();h<j.length;h++){l=e[g][f[g]+h];if(typeof a!="number"||a>=k&&a<k+l.colspan){m=this.getGroupStyle.call(this,l,k);j[h].style.width=m.width;j[h].style.display=m.hidden?"none":""}k+=l.colspan}}}},getGroupRowIndex:function(a){if(a)if((a=a.className.match(this.hrowRe))&&
a[1])return parseInt(a[1],10);return this.cm.rows.length},layout:function(){if(this.mainBody){var a=this.grid,b=a.getGridEl().getSize(true),d=b.width;if(!(!a.hideHeaders&&(d<20||b.height<20))){this.syncHeaderHeight();if(a.autoHeight){this.scroller.dom.style.overflow="visible";this.lockedScroller.dom.style.overflow="visible";if(Ext.isWebKit){this.scroller.dom.style.position="static";this.lockedScroller.dom.style.position="static"}}else{this.el.setSize(b.width,b.height);a=this.mainHd.getHeight();var e=
b.height-a}this.updateLockedWidth();if(this.forceFit){if(this.lastViewWidth!=d){this.fitColumns(false,false);this.lastViewWidth=d}}else{this.autoExpand();this.syncHeaderScroll()}this.onLayout(d,e)}}},getGroupSpan:function(a,b){if(a<0)return{col:0,colspan:this.cm.getColumnCount()};var d=this.cm.rows[a];if(d){for(var e=0,f=0,g=d.length;e<g;e++){var j=d[e];if(b>=f&&b<f+j.colspan)return{col:f,colspan:j.colspan};f+=j.colspan}return{col:f,colspan:0}}return{col:b,colspan:1}},getOffsetWidth:function(){return this.cm.getTotalWidth()-
this.cm.getTotalLockedWidth()+this.getScrollOffset()+"px"},renderHeaders:function(){var a=this.cm,b=this.templates;b=b.hcell;for(var d=[],e=[],f={},g=a.getColumnCount(),j=g-1,h=0;h<g;h++){f.id=a.getColumnId(h);f.value=a.getColumnHeader(h)||"";f.style=this.getColumnStyle(h,true);f.tooltip=this.getColumnTooltip(h);f.css=(h===0?"x-grid3-cell-first ":h==j?"x-grid3-cell-last ":"")+(a.config[h].headerCls?" "+a.config[h].headerCls:"");if(a.config[h].align=="right")f.istyle="padding-right:16px";else delete f.istyle;
if(a.isLocked(h))e[e.length]=b.apply(f);else d[d.length]=b.apply(f)}b=this.templates;f=[];j=[];a=this.cm;for(var k=this.rows,l="width:"+this.getTotalWidth()+";",m=0,n=k.length;m<n;m++){var o=k[m],q=[],v=[],t=h=0;for(g=o.length;h<g;h++){var p=o[h];p.colspan=p.colspan||1;var u=this.getColumnId(p.dataIndex?a.findColumnIndex(p.dataIndex):t),s=this.getGroupStyle.call(this,p,t);u=b.gcell.apply({cls:"ux-grid-hd-group-cell",id:u,row:m,style:"width:"+s.width+";"+(s.hidden?"display:none;":"")+(p.align?"text-align:"+
p.align+";":""),tooltip:p.tooltip?(Ext.QuickTips.isEnabled()?"ext:qtip":"title")+'="'+p.tooltip+'"':"",istyle:p.align=="right"?"padding-right:16px":"",btn:this.grid.enableHdMenu&&p.header,value:p.header||"&nbsp;"});if(a.isLocked(p.dataIndex?a.findColumnIndex(p.dataIndex):t))v[h]=u;else q[h]=u;t+=p.colspan}f[m]=b.header.apply({tstyle:l,cells:q.join("")});j[m]=b.header.apply({tstyle:l,cells:v.join("")})}f.push(b.header.apply({cells:d.join(""),tstyle:"width:"+this.getTotalWidth()+";"}));j.push(b.header.apply({cells:e.join(""),
tstyle:"width:"+this.getLockedWidth()+";"}));return[f.join(""),j.join("")]},getGroupStyle:function(a,b){for(var d=0,e=true,f=b,g=b+a.colspan;f<g;f++)if(!this.cm.isHidden(f)){e=this.cm.getColumnWidth(f);if(typeof e=="number")d+=e;e=false}return{width:(Ext.isBorderBox||Ext.isWebKit&&!Ext.isSafari2?d:Math.max(d-this.borderWidth,0))+"px",hidden:e}},findHeaderCell:function(a){return a?this.fly(a).findParent("td.x-grid3-hd",this.cellSelectorDepth):false},findHeaderIndex:function(a){return(a=this.findHeaderCell(a))?
this.getCellIndex(a):false},updateHeaders:function(){var a=this.renderHeaders();this.innerHd.firstChild.innerHTML=a[0];this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=this.getTotalWidth();this.lockedInnerHd.firstChild.innerHTML=a[1];a=this.getLockedWidth();this.lockedInnerHd.firstChild.style.width=a;this.lockedInnerHd.firstChild.firstChild.style.width=a},getResolvedXY:function(a){if(!a)return null;var b=a.cell;a=a.row;return b?Ext.fly(b).getXY():
[this.scroller.getX(),Ext.fly(a).getY()]},syncFocusEl:function(a,b,d){Ext.ux.grid.LockingHeaderGroupGridView.superclass.syncFocusEl.call(this,a,b,b<this.cm.getLockedCount()?false:d)},ensureVisible:function(a,b,d){return Ext.ux.grid.LockingHeaderGroupGridView.superclass.ensureVisible.call(this,a,b,b<this.cm.getLockedCount()?false:d)},insertRows:function(a,b,d,e){a=a.getCount()-1;if(!e&&b===0&&d>=a)this.refresh();else{e||this.fireEvent("beforerowsinserted",this,b,d);var f=this.renderRows(b,d),g=this.getRow(b);
if(g){b===0&&this.removeRowClass(0,this.firstRowCls);Ext.DomHelper.insertHtml("beforeBegin",g,f[0]);g=this.getLockedRow(b);Ext.DomHelper.insertHtml("beforeBegin",g,f[1])}else{this.removeRowClass(a-1,this.lastRowCls);Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,f[0]);Ext.DomHelper.insertHtml("beforeEnd",this.lockedBody.dom,f[1])}if(e){if(b===0||b>=a)this.addRowClass(b,b===0?this.firstRowCls:this.lastRowCls)}else{this.fireEvent("rowsinserted",this,b,d);this.processRows(b)}}this.syncFocusEl(b)},
getColumnStyle:function(a,b){var d=!b?this.cm.config[a].cellStyle||this.cm.config[a].css||"":this.cm.config[a].headerStyle||"";d+="width:"+this.getColumnWidth(a)+";";if(this.cm.isHidden(a))d+="display:none;";var e=this.cm.config[a].align;if(e)d+="text-align:"+e+";";return d},getLockedWidth:function(){return this.cm.getTotalLockedWidth()+"px"},getTotalWidth:function(){return this.cm.getTotalWidth()-this.cm.getTotalLockedWidth()+"px"},getColumnData:function(){for(var a=[],b=this.cm,d=b.getColumnCount(),
e=0;e<d;e++){var f=b.getDataIndex(e);a[e]={name:!Ext.isDefined(f)?this.ds.fields.get(e).name:f,renderer:b.getRenderer(e),id:b.getColumnId(e),style:this.getColumnStyle(e),locked:b.isLocked(e)}}return a},renderBody:function(){var a=this.renderRows()||["&#160;","&#160;"];return[this.templates.body.apply({rows:a[0]}),this.templates.body.apply({rows:a[1]})]},refreshRow:function(a){Ext.ux.grid.LockingHeaderGroupGridView.superclass.refreshRow.call(this,a);a=Ext.isNumber(a)?a:this.ds.indexOf(a);this.getLockedRow(a).rowIndex=
a},refresh:function(a){this.fireEvent("beforerefresh",this);this.grid.stopEditing(true);var b=this.renderBody();this.mainBody.update(b[0]).setWidth(this.getTotalWidth());this.lockedBody.update(b[1]).setWidth(this.getLockedWidth());if(a===true){this.updateHeaders();this.updateHeaderSortState()}this.processRows(0,true);this.layout();this.applyEmptyText();this.fireEvent("refresh",this)},onDenyColumnLock:function(){},initData:function(a,b){this.cm&&this.cm.un("columnlockchange",this.onColumnLock,this);
Ext.ux.grid.LockingHeaderGroupGridView.superclass.initData.call(this,a,b);this.cm&&this.cm.on("columnlockchange",this.onColumnLock,this)},onColumnLock:function(){this.refresh(true)},handleHdMenuClick:function(a){var b=this.hdCtxIndex,d=this.cm,e=a.getItemId(),f=d.getLockedCount();switch(e){case "lock":if(d.getColumnCount(true)<=f+1){this.onDenyColumnLock();return}d.setLocked(b,true);if(f!=b){d.moveColumn(b,f);this.grid.fireEvent("columnmove",b,f)}break;case "unlock":if(f-1!=b){d.setLocked(b,false,
true);d.moveColumn(b,f-1);this.grid.fireEvent("columnmove",b,f-1)}else d.setLocked(b,false);break;default:return Ext.ux.grid.LockingHeaderGroupGridView.superclass.handleHdMenuClick.call(this,a)}return true},handleHdDown:function(a,b){var d=Ext.get(b);if(d.hasClass("x-grid3-hd-btn")){a.stopEvent();var e=this.findHeaderCell(b);Ext.fly(e).addClass("x-grid3-hd-menu-open");this.hdCtxIndex=d=this.getCellIndex(e);var f=this.hmenu.items,g=this.cm;f.get("asc").setDisabled(!g.isSortable(d));f.get("desc").setDisabled(!g.isSortable(d));
this.hmenu.on("hide",function(){Ext.fly(e).removeClass("x-grid3-hd-menu-open")},this,{single:true});this.hmenu.show(b,"tl-bl?")}else if(d.hasClass("ux-grid-hd-group-cell")||Ext.fly(b).up(".ux-grid-hd-group-cell"))a.stopEvent();if(this.grid.enableColLock!==false)if(Ext.fly(b).hasClass("x-grid3-hd-btn")){e=this.findHeaderCell(b);d=this.getCellIndex(e);f=this.hmenu.items;g=this.cm;f.get("lock").setDisabled(g.isLocked(d));f.get("unlock").setDisabled(!g.isLocked(d))}},handleHdOver:function(a,b){var d=
this.findHeaderCell(b);if(d&&!this.headersDisabled){this.activeHdRef=b;this.activeHdIndex=this.getCellIndex(d);var e=this.fly(d);this.activeHdRegion=e.getRegion();if(!(this.cm.isMenuDisabled(this.activeHdIndex)||e.hasClass("ux-grid-hd-group-cell"))){e.addClass("x-grid3-hd-over");if(this.activeHdBtn=e.child(".x-grid3-hd-btn"))this.activeHdBtn.dom.style.height=d.firstChild.offsetHeight-1+"px"}}},handleHdOut:function(a,b){var d=this.findHeaderCell(b);if(d&&(!Ext.isIE||!a.within(d,true))){this.activeHdRef=
null;this.fly(d).removeClass("x-grid3-hd-over");d.style.cursor=""}},syncHeaderHeight:function(){this.innerHd.firstChild.firstChild.style.height="auto";this.lockedInnerHd.firstChild.firstChild.style.height="auto";var a=this.innerHd.firstChild.firstChild.offsetHeight,b=this.lockedInnerHd.firstChild.firstChild.offsetHeight;a=(b>a?b:a)+"px";this.innerHd.firstChild.firstChild.style.height=a;this.lockedInnerHd.firstChild.firstChild.style.height=a},updateLockedWidth:function(){var a=this.cm.getTotalLockedWidth(),
b=this.cm.getTotalWidth()-a,d=this.grid.getGridEl().getSize(true),e=Ext.isBorderBox?0:this.lockedBorderWidth,f=Ext.isBorderBox?0:this.rowBorderWidth,g=d.width-a-e-f+"px",j=this.getScrollOffset();if(!this.grid.autoHeight){d=d.height-this.mainHd.getHeight()+"px";this.lockedScroller.dom.style.height=d;this.scroller.dom.style.height=d}this.lockedWrap.dom.style.width=a+f+"px";this.scroller.dom.style.width=g;this.mainWrap.dom.style.left=a+e+f+"px";if(this.innerHd){this.lockedInnerHd.firstChild.style.width=
a+"px";this.lockedInnerHd.firstChild.firstChild.style.width=a+"px";this.innerHd.style.width=g;this.innerHd.firstChild.style.width=b+f+j+"px";this.innerHd.firstChild.firstChild.style.width=b+"px"}if(this.mainBody){this.lockedBody.dom.style.width=a+f+"px";this.mainBody.dom.style.width=b+f+"px"}}});
Ext.ux.grid.LockingGroupColumnModel=Ext.extend(Ext.grid.ColumnModel,{isLocked:function(a){return this.config[a].locked===true},setLocked:function(a,b,d){if(this.isLocked(a)!=b){this.config[a].locked=b;d||this.fireEvent("columnlockchange",this,a,b)}},getTotalLockedWidth:function(){for(var a=0,b=0,d=this.config.length;b<d;b++)if(this.isLocked(b)&&!this.isHidden(b))a+=this.getColumnWidth(b);return a},getLockedCount:function(){for(var a=this.config.length,b=0;b<a;b++)if(!this.isLocked(b))return b;return a},
moveColumn:function(a,b){var d=this.isLocked(a),e=this.isLocked(b);if(a<b&&d&&!e)this.setLocked(a,false,true);else a>b&&!d&&e&&this.setLocked(a,true,true);Ext.ux.grid.LockingGroupColumnModel.superclass.moveColumn.apply(this,arguments)}});Ext.namespace("Ext.ux.Ribbon");
Ext.ux.Ribbon=Ext.extend(Ext.TabPanel,{titleId:null,constructor:function(a){this.titleId=[];Ext.apply(a,{baseCls:"x-plain ui-ribbon",margins:"0 0 0 0",plain:true,border:false,deferredRender:false,layoutOnTabChange:true,title:"",activeTab:0,listeners:{beforetabchange:function(d){d.expand()},afterrender:{scope:this,fn:function(){if(this.titleId.length>0)for(var d=0;d<this.titleId.length;d++)(r=Ext.get(this.titleId[d].id))&&r.on("click",this.titleId[d].fn)}}}});Ext.apply(this,Ext.apply(this.initialConfig,
a));if(a.items)for(var b=0;b<a.items.length;b++)this.initRibbon(a.items[b],b);Ext.ux.Ribbon.superclass.constructor.apply(this,arguments)},initRibbon:function(a){for(var b=[],d=0;d<a.ribbon.length;d++){c={xtype:"buttongroup",cls:"x-btn-group-ribbonstyle",defaults:{scale:"small",iconAlign:"left",minWidth:40},items:a.ribbon[d].items};title=a.ribbon[d].title||"";topTitle=a.ribbon[d].topTitle||false;if(onTitleClick=a.ribbon[d].onTitleClick||false){titleId="ux-ribbon-"+Ext.id();title='<span id="'+titleId+
'" style="cursor:pointer;">'+title+"</span>";this.titleId.push({id:titleId,fn:onTitleClick})}if(title!=="")topTitle?Ext.apply(c,{title:title}):Ext.apply(c,{footerCfg:{cls:"x-btn-group-header x-unselectable",tag:"span",html:title}});if(cfg=a.ribbon[d].cfg||null){Ext.applyIf(c,a.ribbon[d].cfg);cfg.defaults&&Ext.apply(c.defaults,cfg.defaults)}b.push(c)}Ext.apply(a,{baseCls:"x-plain",tbar:b})}});
Ext.ux.ToolbarDroppable=Ext.extend(Object,{constructor:function(a){Ext.apply(this,a,{})},init:function(a){this.toolbar=a;this.toolbar.on({scope:this,render:this.createDropTarget})},createDropTarget:function(){this.dropTarget=new Ext.dd.DropTarget(this.toolbar.getEl(),{notifyOver:this.notifyOver.createDelegate(this),notifyDrop:this.notifyDrop.createDelegate(this)})},addDDGroup:function(a){this.dropTarget!=undefined&&this.dropTarget.addToGroup(a)},calculateEntryIndex:function(a){var b=0,d=this.toolbar,
e=d.items.items,f=e.length;d=d.getEl().getXY()[0];a=a.getXY()[0]-d;for(var g=0;g<f;g++){b=e[g].getEl().getWidth();var j=d+b/2;d+=b;if(a<j){b=g;break}else b=g+1}return b},canDrop:function(){return true},notifyOver:function(){return this.canDrop.apply(this,arguments)?this.dropTarget.dropAllowed:this.dropTarget.dropNotAllowed},notifyDrop:function(a,b,d){a=this.canDrop(a,b,d);var e=this.toolbar;if(a){b=this.calculateEntryIndex(b);e.insert(b,this.createItem(d));e.doLayout();this.afterLayout()}return a},
createItem:function(){throw Error("The createItem method must be implemented in the ToolbarDroppable plugin");},afterLayout:Ext.emptyFn});
Ext.ux.ToolbarReorderer=Ext.extend(Ext.ux.Reorderer,{init:function(a){this.buttonXCache={};a.on({scope:this,add:function(b,d){this.createIfReorderable(d)}});Ext.ux.ToolbarReorderer.superclass.init.apply(this,arguments)},createItemDD:function(a){if(a.dd==undefined){var b=a.getEl(),d=this.target,e=this;a.dd=new Ext.dd.DD(b,undefined,{isTarget:false});var f=function(){return false};Ext.apply(a.dd,{b4StartDrag:function(){this.startPosition=b.getXY();this.startZIndex=b.getStyle("zIndex");b.setStyle("zIndex",
1E4);a.suspendEvents();a.menu&&a.menu.on("beforeshow",f,e)},startDrag:function(){this.constrainTo(d.getEl());this.setYConstraint(0,0,0)},onDrag:function(){for(var g=b.getXY()[0],j=g-this.startPosition[0],h=d.items.items,k=h.indexOf(a),l=0;l<h.length;l++){var m=h[l];if(m.reorderable&&m.id!=a.id){var n=m.getEl().getBox();n=(e.buttonXCache[m.id]||n.x)+n.width/2;m=k>l&&j<0&&g<n;n=k<l&&j>0&&g+b.getWidth()>n;if(m||n){e[m?"onMovedLeft":"onMovedRight"](a,l,k);break}}}},endDrag:function(){e.updateButtonXCache();
b.moveTo(e.buttonXCache[a.id],b.getY(),{duration:e.animationDuration,scope:this,callback:function(){a.resumeEvents();a.menu&&a.menu.un("beforeshow",f,e);d.fireEvent("reordered",a,d)}});b.setStyle("zIndex",this.startZIndex)}})}},onMovedLeft:function(a,b,d){var e=this.target,f=e.items.items;if(b!=undefined&&b!=d){e.remove(a,false);e.insert(b,a);this.updateButtonXCache();for(b=0;b<f.length;b++){e=f[b];d=this.buttonXCache[e.id];if(a==e)a.dd.startPosition[0]=d;else{e=e.getEl();e.moveTo(d,e.getY(),{duration:this.animationDuration})}}}},
onMovedRight:function(){this.onMovedLeft.apply(this,arguments)},updateButtonXCache:function(){var a=this.target,b=a.items,d=a.getEl().getBox(true).x;b.each(function(e){this.buttonXCache[e.id]=d;d+=e.getEl().getWidth()},this)}});Ext.ux.Mask=function(a){Ext.apply(this,{mask:a})};
Ext.extend(Ext.ux.Mask,Object,{init:function(a){this.LetrasL="abcdefghijklmnopqrstuvwxyz";this.LetrasU=Ext.util.Format.uppercase(this.LetrasL);this.Letras=this.LetrasL+this.LetrasU;this.Numeros="0123456789";this.Fixos="().-:/ ";this.Charset=" !\"#$%&'()*+,-./0123456789:;<=>?@"+this.LetrasU+"[]^_/`"+this.LetrasL+"{|}~";a.enableKeyEvents=true;a.on("keypress",function(b,d){return this.press(b,d)},this)},press:function(a,b){var d=a.getValue(),e=b.getKey(),f=this.mask,g=a.el.dom;if(b){if(g.selectionEnd-
g.selectionStart>0)return true;if(g.selectionStart>0&&g.selectionStart<g.textLength)return true;var j=this.Charset.substr(e-32,1);if(e<32||b.isNavKeyPress()||e==b.BACKSPACE)return true;if(Ext.isGecko||Ext.isGecko2||Ext.isGecko3)if(b.charCode==0&&b.keyCode==46||b.isSpecialKey())return true;e=d.length;if(e>=f.length){a.setValue(d);b.stopEvent();return false}for(e=f.substr(e,1);this.Fixos.indexOf(e)!=-1;){d+=e;e=d.length;if(e>=f.length){b.stopEvent();return false}e=f.substr(e,1)}switch(e){case "#":if(this.Numeros.indexOf(j)==
-1){b.stopEvent();return false}break;case "A":j=j.toUpperCase();if(this.LetrasU.indexOf(j)==-1){b.stopEvent();return false}break;case "a":j=j.toLowerCase();if(this.LetrasL.indexOf(j)==-1){b.stopEvent();return false}break;case "Z":if(this.Letras.indexOf(j)==-1){b.stopEvent();return false}break;case "*":a.setValue(d+j);break;default:a.setValue(d)}}a.setValue(d+j);g.selectionEnd=g.selectionStart;b.stopEvent();return false}});Ext.ns("Ext.ux");
Ext.ux.Lightbox=function(){var a={},b=[],d,e=false,f=[];return{overlayOpacity:0.85,animate:true,resizeSpeed:8,borderSize:10,labelImage:"Image",labelOf:"of",init:function(){this.resizeDuration=this.animate?(11-this.resizeSpeed)*0.15:0;this.overlayDuration=this.animate?0.2:0;if(!e){Ext.apply(this,Ext.util.Observable.prototype);Ext.util.Observable.constructor.call(this);this.addEvents("open","close");this.initMarkup();this.initEvents();e=true}},initMarkup:function(){a.shim=Ext.DomHelper.append(document.body,
{tag:"iframe",id:"ux-lightbox-shim"},true);a.overlay=Ext.DomHelper.append(document.body,{id:"ux-lightbox-overlay"},true);var g=new Ext.Template(this.getTemplate());a.lightbox=g.append(document.body,{},true);Ext.each(["outerImageContainer","imageContainer","image","hoverNav","navPrev","navNext","loading","loadingLink","outerDataContainer","dataContainer","data","details","caption","imageNumber","bottomNav","navClose"],function(j){a[j]=Ext.get("ux-lightbox-"+j)});Ext.each([a.overlay,a.lightbox,a.shim],
function(j){j.setVisibilityMode(Ext.Element.DISPLAY);j.hide()});g=(this.animate?250:1)+"px";a.outerImageContainer.setStyle({width:g,height:g})},getTemplate:function(){return['<div id="ux-lightbox">','<div id="ux-lightbox-outerImageContainer">','<div id="ux-lightbox-imageContainer">','<img id="ux-lightbox-image">','<div id="ux-lightbox-hoverNav">','<a href="#" id="ux-lightbox-navPrev"></a>','<a href="#" id="ux-lightbox-navNext"></a>',"</div>",'<div id="ux-lightbox-loading">','<a id="ux-lightbox-loadingLink"></a>',
"</div>","</div>","</div>",'<div id="ux-lightbox-outerDataContainer">','<div id="ux-lightbox-dataContainer">','<div id="ux-lightbox-data">','<div id="ux-lightbox-details">','<span id="ux-lightbox-caption"></span>','<span id="ux-lightbox-imageNumber"></span>',"</div>",'<div id="ux-lightbox-bottomNav">','<a href="#" id="ux-lightbox-navClose"></a>',"</div>","</div>","</div>","</div>","</div>"]},initEvents:function(){var g=function(j){j.preventDefault();this.close()};a.overlay.on("click",g,this);a.loadingLink.on("click",
g,this);a.navClose.on("click",g,this);a.lightbox.on("click",function(j){j.getTarget().id=="ux-lightbox"&&this.close()},this);a.navPrev.on("click",function(j){j.preventDefault();this.setImage(d-1)},this);a.navNext.on("click",function(j){j.preventDefault();this.setImage(d+1)},this)},register:function(g,j){if(f.indexOf(g)===-1){f.push(g);Ext.fly(document).on("click",function(h){var k=h.getTarget(g);if(k){h.preventDefault();this.open(k,g,j)}},this)}},open:function(g,j,h){h=h||false;this.setViewSize();
a.overlay.fadeIn({duration:this.overlayDuration,endOpacity:this.overlayOpacity,callback:function(){b=[];var k=0;if(h){var l=Ext.query(j);for(Ext.each(l,function(n){n.href&&b.push([n.href,n.title])});b[k][0]!=g.href;)k++}else b.push([g.href,g.title]);l=Ext.fly(document).getScroll();var m=l.top+Ext.lib.Dom.getViewportHeight()/10;a.lightbox.setStyle({top:m+"px",left:l.left+"px"}).show();this.setImage(k);this.fireEvent("open",b[k])},scope:this})},setViewSize:function(){var g=this.getViewSize();a.overlay.setStyle({width:g[0]+
"px",height:g[1]+"px"});a.shim.setStyle({width:g[0]+"px",height:g[1]+"px"}).show()},setImage:function(g){d=g;this.disableKeyNav();this.animate&&a.loading.show();a.image.hide();a.hoverNav.hide();a.navPrev.hide();a.navNext.hide();a.dataContainer.setOpacity(1.0E-4);a.imageNumber.hide();var j=new Image;j.onload=function(){a.image.dom.src=b[d][0];this.resizeImage(j.width,j.height)}.createDelegate(this);j.src=b[d][0]},resizeImage:function(g,j){var h=a.outerImageContainer.getWidth(),k=a.outerImageContainer.getHeight(),
l=g+this.borderSize*2,m=j+this.borderSize*2;h=h-l;var n=function(){a.hoverNav.setWidth(a.imageContainer.getWidth()+"px");a.navPrev.setHeight(j+"px");a.navNext.setHeight(j+"px");a.outerDataContainer.setWidth(l+"px");this.showImage()};k-m!=0||h!=0?a.outerImageContainer.shift({height:m,width:l,duration:this.resizeDuration,scope:this,callback:n,delay:50}):n.call(this)},showImage:function(){a.loading.hide();a.image.fadeIn({duration:this.resizeDuration,scope:this,callback:function(){this.updateDetails()}});
this.preloadImages()},updateDetails:function(){var g=a.data.getWidth(true)-a.navClose.getWidth()-10;a.details.setWidth((g>0?g:0)+"px");a.caption.update(b[d][1]);a.caption.show();if(b.length>1){a.imageNumber.update(this.labelImage+" "+(d+1)+" "+this.labelOf+"  "+b.length);a.imageNumber.show()}a.dataContainer.fadeIn({duration:this.resizeDuration/2,scope:this,callback:function(){var j=this.getViewSize();a.overlay.setHeight(j[1]+"px");this.updateNav()}})},updateNav:function(){this.enableKeyNav();a.hoverNav.show();
d>0&&a.navPrev.show();d<b.length-1&&a.navNext.show()},enableKeyNav:function(){Ext.fly(document).on("keydown",this.keyNavAction,this)},disableKeyNav:function(){Ext.fly(document).un("keydown",this.keyNavAction,this)},keyNavAction:function(g){g=g.getKey();if(g==88||g==67||g==27)this.close();else if(g==80||g==37)d!=0&&this.setImage(d-1);else if(g==78||g==39)d!=b.length-1&&this.setImage(d+1)},preloadImages:function(){var g;if(b.length>d+1){g=new Image;g.src=b[d+1][0]}if(d>0){g=new Image;g.src=b[d-1][0]}},
close:function(){this.disableKeyNav();a.lightbox.hide();a.overlay.fadeOut({duration:this.overlayDuration});a.shim.hide();this.fireEvent("close",d)},getViewSize:function(){return[Ext.lib.Dom.getViewWidth(),Ext.lib.Dom.getViewHeight()]}}}();Ext.onReady(Ext.ux.Lightbox.init,Ext.ux.Lightbox);Ext.QuickTips.init();if(typeof console=="undefined")var console={log:function(){}};Ext.namespace("Ext.m3");var SOFTWARE_NAME="\u041f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0430 \u041c3";
function assert(a,b){if(!a){console.error(b);throw Error(b);}}
function smart_eval(a){if(a!=undefined)if(a.substring(0,1)=="{"){if(a=Ext.util.JSON.decode(a))if(a.code){var b=a.code();b&&b instanceof Ext.Window&&typeof AppDesktop!="undefined"&&AppDesktop&&AppDesktop.getDesktop().createWindow(b);return b}else if(a.message&&a.message!="")Ext.Msg.show({title:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435",msg:a.message,buttons:Ext.Msg.OK,icon:a.success!=undefined&&!a.success?Ext.Msg.WARNING:Ext.Msg.Info})}else{try{b=eval(a)}catch(d){Ext.Msg.show({title:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435",
msg:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043d\u0435\u043f\u0440\u0435\u0434\u0432\u0438\u0434\u0435\u043d\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430!",buttons:Ext.Msg.OK,fn:Ext.emptyFn,animEl:"elId",icon:Ext.MessageBox.WARNING});throw d;}b&&b instanceof Ext.Window&&typeof AppDesktop!="undefined"&&AppDesktop&&AppDesktop.getDesktop().createWindow(b);return b}}Ext.ns("Ext.app.form");
Ext.app.form.SearchField=Ext.extend(Ext.form.TwinTriggerField,{initComponent:function(){Ext.app.form.SearchField.superclass.initComponent.call(this);this.on("specialkey",function(a,b){b.getKey()==b.ENTER&&this.onTrigger2Click()},this)},validationEvent:false,validateOnBlur:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:true,width:180,hasSearch:false,paramName:"filter",paramId:"id",nodeId:"-1",onTrigger1Click:function(){if(this.hasSearch){this.el.dom.value=
"";var a=this.getComponentForSearch();if(a instanceof Ext.grid.GridPanel){var b=a.getStore();b.baseParams=b.baseParams||{};b.baseParams[this.paramName]="";b.baseParams[this.paramId]=this.nodeId||"";b.reload({params:{start:0}})}else if(a instanceof Ext.ux.tree.TreeGrid){this.el.dom.value="";b=a.getLoader();b.baseParams=b.baseParams||{};b.baseParams[this.paramName]="";a=a.getRootNode();b.load(a);a.expand()}this.triggers[0].hide();this.hasSearch=false}},onTrigger2Click:function(){var a=this.getRawValue(),
b=this.getComponentForSearch();if(b instanceof Ext.grid.GridPanel){var d=b.getStore();d.baseParams=d.baseParams||{};d.baseParams[this.paramName]=a;d.baseParams[this.paramId]=this.nodeId||"";d.reload({params:{start:0}})}else if(b instanceof Ext.ux.tree.TreeGrid){d=b.getLoader();d.baseParams=d.baseParams||{};d.baseParams[this.paramName]=a;b=b.getRootNode();d.load(b);b.expand()}if(a){this.hasSearch=true;this.triggers[0].show()}},clear:function(){this.onTrigger1Click()},search:function(){this.onTrigger2Click()}});
Ext.override(Ext.form.Field,{isEdit:true,isModified:false,updateLabel:function(){this.setFieldLabel(this.fieldLabel)},setFieldLabel:function(a){if(a!=undefined){if(this.rendered){var b=a+":";if(this.isModified)b='<span style="color:darkmagenta;">'+b+"</span>";var d=this.el.up(".x-form-item",10,true);d&&d.child(".x-form-item-label").update(b)}this.fieldLabel=a}},fireKey:function(a){if(a.isSpecialKey()){a.getKey()==a.ENTER&&this.onBlur();this.fireEvent("specialkey",this,a)}}});
Ext.app.TitlePanel=Ext.extend(Ext.Panel,{titleItems:null,addTitleItem:function(a){a=Ext.ComponentMgr.create(a);var b=Ext.DomHelper.append(this.header,{tag:"div",style:"float:right;margin-top:-4px;margin-left:3px;"},true);a.render(b)},onRender:function(){Ext.app.TitlePanel.superclass.onRender.apply(this,arguments);if(this.titleItems!=null){if(Ext.isArray(this.titleItems))for(var a=this.titleItems.length-1;a>=0;a--)this.addTitleItem(this.titleItems[a]);else this.addTitleItems(this.titleItems);this.header&&
this.header.removeClass("x-unselectable")}},getChildByName:function(a){if(this.items)for(var b=0;b<this.items.length;b++)if(this.items.items[b].name==a)return this.items.items[b];if(this.titleItems)for(b=0;b<this.titleItems.length;b++)if(this.titleItems[b].name==a)return this.titleItems[b];return null}});
function uiFailureResponseOnFormSubmit(a){if(a.action.failureType=="server"){obj=Ext.util.JSON.decode(a.action.response.responseText);Ext.Msg.show({title:a.title,msg:obj.error_msg,buttons:Ext.Msg.OK,icon:Ext.Msg.WARNING})}else Ext.Msg.alert(a.title,a.message)}
function uiAjaxFailMessage(a,b){if(Ext.isEmpty(a))Ext.Msg.alert(SOFTWARE_NAME,"\u0418\u0437\u0432\u0438\u043d\u0438\u0442\u0435, \u0441\u0435\u0440\u0432\u0435\u0440 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043d\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d.");else if(b.failureType==="server")b&&b.response&&b.response.responseText&&smart_eval(b.response.responseText);else{var d=Ext.getBody().getViewSize(),e=d.width<500?d.width-50:500;d=d.height<300?d.height-50:300;if(!a.responseText&&
b&&b.response)a=b.response;(new Ext.Window({modal:true,width:e,height:d,title:"Request Failure",layout:"fit",maximizable:true,maximized:true,listeners:{maximize:{fn:function(f){var g=Ext.getBody().getViewSize();f.setSize(g.width,g.height)},scope:this},resize:{fn:function(f){var g=Ext.getCmp("__ErrorMessageEditor");f=f.body.getViewSize();g.setSize(f.width,f.height-42)}}},items:new Ext.form.FormPanel({baseCls:"x-plain",layout:"absolute",defaultType:"label",items:[{x:5,y:5,html:'<div class="x-window-dlg"><div class="ext-mb-error" style="width:32px;height:32px"></div></div>'},
{x:42,y:6,html:"<b>Status Code: </b>"},{x:125,y:6,text:a.status},{x:42,y:25,html:"<b>Status Text: </b>"},{x:125,y:25,text:a.statusText},{x:0,y:42,id:"__ErrorMessageEditor",xtype:"htmleditor",value:a.responseText,readOnly:true,enableAlignments:false,enableColors:false,enableFont:false,enableFontSize:false,enableFormat:false,enableLinks:false,enableLists:false,enableSourceEdit:false,listeners:{push:{fn:function(){(function(f){try{for(var g=f.getElementsByTagName("script"),j=0;j<g.length;j++)g[j].innerText?
this.eval(g[j].innerText):this.eval(g[j].textContent);this.hideAll(this.getElementsByClassName(f,"table","vars"));this.hideAll(this.getElementsByClassName(f,"ol","pre-context"));this.hideAll(this.getElementsByClassName(f,"ol","post-context"));this.hideAll(this.getElementsByClassName(f,"div","pastebin"))}catch(h){}}).call(this.iframe.contentWindow,this.iframe.contentDocument)}}}}]})})).show()}}
function uiShowErrorMessage(a){obj=Ext.util.JSON.decode(a.responseText);obj.error_msg&&Ext.Msg.alert(SOFTWARE_NAME,obj.error_msg);return obj.success}function sendRequest(a,b,d){var e=new Ext.LoadMask(Ext.getBody());e.show();Ext.Ajax.request({params:d,url:a,method:"POST",success:function(f){try{smart_eval(f.responseText)}finally{e.hide()}},failure:function(){uiAjaxFailMessage.apply(this,arguments);e.hide()}})}
function thousandCurrencyRenderer(a){if(typeof a!="number"){var b=a;try{b=parseFloat(a.replace(/,+/,".").replace(/\s+/g,""))}catch(d){b=NaN}if(isNaN(b))return a;else a=b}b="";var e=a.toFixed(2).split(".");a=e[0];e=e[1];var f=0,g=0,j=a.length%3;if(j!=0){for(;g<j;g++)b+=a.charAt(g);b+=" "}for(;g<a.length;g++){if(f%3==0&&f!=0)b+=" ";b+=a.charAt(g);f++}if(e)b+=","+e;return b=b.replace(/\s,/,",")}function includeInArr(a,b){return a.indexOf(b)!=-1}
function showMessage(a,b,d){b=b||"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435";a=a||"";d=d||Ext.MessageBox.INFO;Ext.Msg.show({title:b,msg:a,buttons:Ext.Msg.OK,icon:d})}function showWarning(a,b){showMessage(a,b,Ext.MessageBox.WARNING)}Ext.m3.ComboBox=Ext.extend(Ext.form.ComboBox,{getText:function(){return this.lastSelectionText}});
Ext.m3.GridPanel=Ext.extend(Ext.grid.GridPanel,{constructor:function(a,b){var d=b.selModel,e=b.colModel||[];d&&d instanceof Ext.grid.CheckboxSelectionModel&&e.columns.unshift(d);var f;f=b.menus.contextMenu&&b.menus.contextMenu instanceof Ext.menu.Menu?function(k){k.stopEvent();b.menus.contextMenu.showAt(k.getXY())}:Ext.emptyFn;var g;g=b.menus.rowContextMenu&&b.menus.rowContextMenu instanceof Ext.menu.Menu?function(k,l,m){m.stopEvent();this.getSelectionModel().isSelected(l)||this.getSelectionModel().selectRow(l);
b.menus.rowContextMenu.showAt(m.getXY())}:Ext.emptyFn;var j=b.plugins||[],h=b.bundedColumns;h&&h instanceof Array&&h.length>0&&j.push(new Ext.ux.grid.ColumnHeaderGroup({rows:h}));a.listeners=Ext.applyIf({contextmenu:f,rowcontextmenu:g,beforerender:function(){var k=this.getBottomToolbar();if(k&&k instanceof Ext.PagingToolbar){var l=this.getStore();l.setBaseParam("start",0);l.setBaseParam("limit",k.pageSize);k.bind(l)}}},a.listeners||{});d=Ext.applyIf({sm:d,colModel:e,plugins:j},a);Ext.m3.GridPanel.superclass.constructor.call(this,
d)},initComponent:function(){Ext.m3.GridPanel.superclass.initComponent.call(this);this.getStore().on("exception",this.storeException,this)},storeException:function(a,b,d,e,f){uiAjaxFailMessage(f,e)}});
Ext.m3.EditorGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{constructor:function(a,b){var d=b.selModel,e=b.colModel||[];d&&d instanceof Ext.grid.CheckboxSelectionModel&&e.unshift(d);var f;f=b.menus.contextMenu&&b.menus.contextMenu instanceof Ext.menu.Menu?function(k){k.stopEvent();b.menus.contextMenu.showAt(k.getXY())}:Ext.emptyFn;var g;g=b.menus.rowContextMenu&&b.menus.contextMenu instanceof Ext.menu.Menu?function(k,l,m){m.stopEvent();this.getSelectionModel().selectRow(l);b.menus.rowContextMenu.showAt(m.getXY())}:
Ext.emptyFn;var j=b.plugins||[],h=b.bundedColumns;h&&h instanceof Array&&h.length>0&&j.push(new Ext.ux.grid.ColumnHeaderGroup({rows:h}));a.listeners=Ext.applyIf({contextmenu:f,rowcontextmenu:g,beforerender:function(){var k=this.getBottomToolbar();if(k&&k instanceof Ext.PagingToolbar){var l=this.getStore();l.setBaseParam("start",0);l.setBaseParam("limit",k.pageSize);k.bind(l)}}},a.listeners||{});d=Ext.applyIf({sm:d,colModel:e,plugins:j},a);Ext.m3.EditorGridPanel.superclass.constructor.call(this,d)},
initComponent:function(){Ext.m3.EditorGridPanel.superclass.initComponent.call(this);this.getStore().on("exception",this.storeException,this)},storeException:function(a,b,d,e,f){if(b=="remote"&&d!=Ext.data.Api.actions.read)f.raw.message&&Ext.Msg.show({title:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!",msg:f.raw.message,buttons:Ext.Msg.CANCEL,icon:Ext.Msg.WARNING});else uiAjaxFailMessage(f,e)}});
Ext.version=="3.0"&&Ext.override(Ext.grid.GridView,{ensureVisible:function(a,b,d){if((a=this.resolveCell(a,b,d))&&a.row){var e=a.row,f=a.cell;b=this.scroller.dom;var g=0,j=e,h=this.el.dom;j=e;for(h=this.el.dom;j&&j!=h;){g+=j.offsetTop;j=j.offsetParent}g-=this.mainHd.dom.offsetHeight;e=g+e.offsetHeight;j=b.clientHeight;h=parseInt(b.scrollTop,10);var k=h+j;if(g<h)b.scrollTop=g;else if(e>k)b.scrollTop=e-j;if(d!==false){d=parseInt(f.offsetLeft,10);f=d+f.offsetWidth;g=parseInt(b.scrollLeft,10);h=g+b.clientWidth;
if(d<g)b.scrollLeft=d;else if(f>h)b.scrollLeft=f-b.clientWidth}return this.getResolvedXY(a)}}});Ext.namespace("Ext.ux.maximgb.tg");
Ext.ux.maximgb.tg.AbstractTreeStore=Ext.extend(Ext.data.Store,{leaf_field_name:"_is_leaf",page_offset:0,active_node:null,constructor:function(a){Ext.ux.maximgb.tg.AbstractTreeStore.superclass.constructor.call(this,a);if(!this.paramNames.active_node)this.paramNames.active_node="anode";this.addEvents("beforeexpandnode","expandnode","expandnodefailed","beforecollapsenode","collapsenode","beforeactivenodechange","activenodechange")},remove:function(a){a===this.active_node&&this.setActiveNode(null);this.removeNodeDescendants(a);
Ext.ux.maximgb.tg.AbstractTreeStore.superclass.remove.call(this,a)},removeNodeDescendants:function(a){var b,d=this.getNodeChildren(a);a=0;for(b=d.length;a<b;a++)this.remove(d[a])},load:function(a){if(a)if(a.params){if(a.params[this.paramNames.active_node]===undefined)a.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null}else{a.params={};a.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null}else{a={params:{}};a.params[this.paramNames.active_node]=
this.active_node?this.active_node.id:null}if(a.params[this.paramNames.active_node]!==null)a.add=true;return Ext.ux.maximgb.tg.AbstractTreeStore.superclass.load.call(this,a)},loadRecords:function(a,b,d){if(!a||d===false){d!==false&&this.fireEvent("load",this,[],b);if(b.callback)b.callback.call(b.scope||this,[],b,false)}else{d=a.records;var e=a.totalRecords||d.length,f=this.getPageOffsetFromOptions(b);a=this.getLoadedNodeIdFromOptions(b);var g,j,h=this;if(!b||b.add!==true){if(this.pruneModifiedRecords)this.modified=
[];g=0;for(a=d.length;g<a;g++)d[g].join(this);if(this.snapshot){this.data=this.snapshot;delete this.snapshot}this.data.clear();this.data.addAll(d);this.page_offset=f;this.totalLength=e;this.applySort();this.fireEvent("datachanged",this)}else{if(a)g=this.getById(a);if(g){this.setNodeLoaded(g,true);this.setNodeChildrenOffset(g,f);this.setNodeChildrenTotalCount(g,Math.max(e,d.length));this.removeNodeDescendants(g)}this.suspendEvents();f={};g=0;for(a=d.length;g<a;g++){e=d[g];j=this.indexOfId(e.id);if(j==
-1){f[e.id]=false;this.add(e)}else{f[e.id]=true;j=this.getAt(j);j.reject();j.data=e.data;d[g]=j}}this.applySort();this.resumeEvents();d.sort(function(k,l){var m=h.data.indexOf(k),n=h.data.indexOf(l);return m>n?1:-1});g=0;for(a=d.length;g<a;g++){e=d[g];f[e.id]==true?this.fireEvent("update",this,e,Ext.data.Record.COMMIT):this.fireEvent("add",this,[e],this.data.indexOf(e))}}this.fireEvent("load",this,d,b);if(b.callback)b.callback.call(b.scope||this,d,b,true)}},sort:function(a,b){if(this.remoteSort){this.setActiveNode(null);
if(this.lastOptions){this.lastOptions.add=false;if(this.lastOptions.params)this.lastOptions.params[this.paramNames.active_node]=null}}return Ext.ux.maximgb.tg.AbstractTreeStore.superclass.sort.call(this,a,b)},applySort:function(){if(this.sortInfo&&!this.remoteSort){var a=this.sortInfo;this.sortData(a.field,a.direction)}else this.applyTreeSort()},sortData:function(a,b){b=b||"ASC";var d=this.fields.get(a).sortType,e=function(f,g){var j=d(f.data[a]),h=d(g.data[a]);return j>h?1:j<h?-1:0};this.data.sort(b,
e);this.snapshot&&this.snapshot!=this.data&&this.snapshot.sort(b,e);this.applyTreeSort()},applyTreeSort:function(){var a,b,d,e=[],f=this.getRootNodes();a=0;for(b=f.length;a<b;a++){d=f[a];e.push(d);this.collectNodeChildrenTreeSorted(e,d)}if(e.length>0){this.data.clear();this.data.addAll(e)}if(this.snapshot&&this.snapshot!==this.data){a=this.data;this.data=this.snapshot;this.snapshot=null;this.applyTreeSort();this.snapshot=this.data;this.data=a}},collectNodeChildrenTreeSorted:function(a,b){var d,e,
f,g=this.getNodeChildren(b);d=0;for(e=g.length;d<e;d++){f=g[d];a.push(f);this.collectNodeChildrenTreeSorted(a,f)}},getActiveNode:function(){return this.active_node},setActiveNode:function(a){if(this.active_node!==a)if(a)if(this.data.indexOf(a)!=-1){if(this.fireEvent("beforeactivenodechange",this,this.active_node,a)!==false){this.active_node=a;this.fireEvent("activenodechange",this,this.active_node,a)}}else throw"Given record is not from the store.";else if(this.fireEvent("beforeactivenodechange",
this,this.active_node,a)!==false){this.active_node=a;this.fireEvent("activenodechange",this,this.active_node,a)}},isExpandedNode:function(a){return a.ux_maximgb_tg_expanded===true},setNodeExpanded:function(a,b){a.ux_maximgb_tg_expanded=b},isVisibleNode:function(a){var b,d=this.getNodeAncestors(a),e=true;a=0;for(b=d.length;a<b;a++){e=e&&this.isExpandedNode(d[a]);if(!e)break}return e},isLeafNode:function(a){return a.get(this.leaf_field_name)==true},isLoadedNode:function(a){return a.ux_maximgb_tg_loaded!==
undefined?a.ux_maximgb_tg_loaded:this.isLeafNode(a)||this.hasChildNodes(a)?true:false},setNodeLoaded:function(a,b){a.ux_maximgb_tg_loaded=b},getNodeChildrenOffset:function(a){return a.ux_maximgb_tg_offset||0},setNodeChildrenOffset:function(a,b){a.ux_maximgb_tg_offset=b},getNodeChildrenTotalCount:function(a){return a.ux_maximgb_tg_total||0},setNodeChildrenTotalCount:function(a,b){a.ux_maximgb_tg_total=b},collapseNode:function(a){if(this.isExpandedNode(a)&&this.fireEvent("beforecollapsenode",this,a)!==
false){this.setNodeExpanded(a,false);this.fireEvent("collapsenode",this,a)}},expandNode:function(a){var b;if(!this.isExpandedNode(a)&&this.fireEvent("beforeexpandnode",this,a)!==false)if(this.isLoadedNode(a)){this.setNodeExpanded(a,true);this.fireEvent("expandnode",this,a)}else{b={};b[this.paramNames.active_node]=a.id;this.load({add:true,params:b,callback:this.expandNodeCallback,scope:this})}},expandNodeCallback:function(a,b,d){a=this.getById(b.params[this.paramNames.active_node]);if(d&&a){this.setNodeExpanded(a,
true);this.fireEvent("expandnode",this,a)}else this.fireEvent("expandnodefailed",this,b.params[this.paramNames.active_node],a)},expandAll:function(){var a,b,d,e=this.data.getRange();this.suspendEvents();b=0;for(d=e.length;b<d;b++){a=e[b];this.isExpandedNode(a)||this.expandNode(a)}this.resumeEvents();this.fireEvent("datachanged",this)},collapseAll:function(){var a,b,d,e=this.data.getRange();this.suspendEvents();b=0;for(d=e.length;b<d;b++){a=e[b];this.isExpandedNode(a)&&this.collapseNode(a)}this.resumeEvents();
this.fireEvent("datachanged",this)},getLoadedNodeIdFromOptions:function(a){var b=null;if(a&&a.params&&a.params[this.paramNames.active_node])b=a.params[this.paramNames.active_node];return b},getPageOffsetFromOptions:function(a){var b=0;if(a&&a.params&&a.params[this.paramNames.start]){b=parseInt(a.params[this.paramNames.start],10);if(isNaN(b))b=0}return b},hasNextSiblingNode:function(a){return this.getNodeNextSibling(a)!==null},hasPrevSiblingNode:function(a){return this.getNodePrevSibling(a)!==null},
hasChildNodes:function(a){return this.getNodeChildrenCount(a)>0},getNodeAncestors:function(a){var b=[];for(a=this.getNodeParent(a);a;){b.push(a);a=this.getNodeParent(a)}return b},getNodeChildrenCount:function(a){return this.getNodeChildren(a).length},getNodeNextSibling:function(a){var b,d=null;b=(b=this.getNodeParent(a))?this.getNodeChildren(b):this.getRootNodes();a=b.indexOf(a);if(a<b.length-1)d=b[a+1];return d},getNodePrevSibling:function(a){var b,d=null;b=(b=this.getNodeParent(a))?this.getNodeChildren(b):
this.getRootNodes();a=b.indexOf(a);if(a>0)d=b[a-1];return d},getRootNodes:function(){throw"Abstract method call";},getNodeDepth:function(){throw"Abstract method call";},getNodeParent:function(){throw"Abstract method call";},getNodeChildren:function(){throw"Abstract method call";},addToNode:function(){throw"Abstract method call";},removeFromNode:function(){throw"Abstract method call";},getPageOffset:function(){return this.page_offset},getActiveNodePageOffset:function(){return this.active_node?this.getNodeChildrenOffset(this.active_node):
this.getPageOffset()},getActiveNodeCount:function(){return this.active_node?this.getNodeChildrenCount(this.active_node):this.getRootNodes().length},getActiveNodeTotalCount:function(){return this.active_node?this.getNodeChildrenTotalCount(this.active_node):this.getTotalCount()}});
Ext.ux.maximgb.tg.AdjacencyListStore=Ext.extend(Ext.ux.maximgb.tg.AbstractTreeStore,{parent_id_field_name:"_parent",getRootNodes:function(){var a,b,d=[],e=this.data.getRange();a=0;for(b=e.length;a<b;a++)e[a].get(this.parent_id_field_name)==null&&d.push(e[a]);return d},getNodeDepth:function(a){return this.getNodeAncestors(a).length},getNodeParent:function(a){return this.getById(a.get(this.parent_id_field_name))},getNodeChildren:function(a){var b,d,e=[],f=this.data.getRange();b=0;for(d=f.length;b<d;b++)f[b].get(this.parent_id_field_name)==
a.id&&e.push(f[b]);return e},addToNode:function(a,b){b.set(this.parent_id_field_name,a.id);this.addSorted(b)},removeFromNode:function(a,b){this.remove(b)}});Ext.reg("Ext.ux.maximgb.tg.AdjacencyListStore",Ext.ux.maximgb.tg.AdjacencyListStore);
Ext.ux.maximgb.tg.NestedSetStore=Ext.extend(Ext.ux.maximgb.tg.AbstractTreeStore,{left_field_name:"_lft",right_field_name:"_rgt",level_field_name:"_level",root_node_level:1,getRootNodes:function(){var a,b,d=[],e=this.data.getRange();a=0;for(b=e.length;a<b;a++)e[a].get(this.level_field_name)==this.root_node_level&&d.push(e[a]);return d},getNodeDepth:function(a){return a.get(this.level_field_name)-this.root_node_level},getNodeParent:function(a){var b=null,d=this.data.getRange(),e,f,g,j,h,k,l,m;g=a.get(this.left_field_name);
h=a.get(this.right_field_name);l=a.get(this.level_field_name);e=0;for(f=d.length;e<f;e++){a=d[e];j=a.get(this.left_field_name);k=a.get(this.right_field_name);m=a.get(this.level_field_name);if(m==l-1&&j<g&&k>h){b=a;break}}return b},getNodeChildren:function(a){var b,d,e,f,g,j,h,k=[];j=this.data.getRange();b=a.get(this.left_field_name);d=a.get(this.right_field_name);f=a.get(this.level_field_name);i=0;for(len=j.length;i<len;i++){h=j[i];a=h.get(this.left_field_name);e=h.get(this.right_field_name);g=h.get(this.level_field_name);
g==f+1&&a>b&&e<d&&k.push(h)}return k}});
Ext.ux.maximgb.tg.GridView=Ext.extend(Ext.grid.GridView,{expanded_icon_class:"ux-maximgb-tg-elbow-minus",last_expanded_icon_class:"ux-maximgb-tg-elbow-end-minus",collapsed_icon_class:"ux-maximgb-tg-elbow-plus",last_collapsed_icon_class:"ux-maximgb-tg-elbow-end-plus",skip_width_update_class:"ux-maximgb-tg-skip-width-update",initTemplates:function(){var a=this.templates||{};if(!a.row)a.row=new Ext.Template('<div class="x-grid3-row ux-maximgb-tg-level-{level} {alt}" style="{tstyle} {display_style}">','<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',
"<tbody>","<tr>{cells}</tr>",this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':"","</tbody>","</table>","</div>");if(!a.mastercell)a.mastercell=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="ux-maximgb-tg-mastercell-wrap">',"{treeui}",'<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',
"</div>","</td>");if(!a.treeui)a.treeui=new Ext.Template('<div class="ux-maximgb-tg-uiwrap" style="width: {wrap_width}px">',"{elbow_line}",'<div style="left: {left}px" class="{cls}">&#160;</div>',"</div>");if(!a.elbow_line)a.elbow_line=new Ext.Template('<div style="left: {left}px" class="{cls}">&#160;</div>');this.templates=a;Ext.ux.maximgb.tg.GridView.superclass.initTemplates.call(this)},doRender:function(a,b,d,e,f,g){for(var j=this.templates,h=j.cell,k=j.row,l=f-1,m=[],n,o={},q={tstyle:"width:"+
this.getTotalWidth()+";"},v,t=0,p=b.length;t<p;t++){v=b[t];n=[];var u=t+e,s=this.renderRow(v,u,f,d,this.cm.getTotalWidth());if(s===false)for(s=0;s<f;s++){h=a[s];o.id=h.id;o.css=s==0?"x-grid3-cell-first ":s==l?"x-grid3-cell-last ":"";o.attr=o.cellAttr="";o.value=h.renderer.call(h.scope,v.data[h.name],o,v,u,s,d);o.style=h.style;if(Ext.isEmpty(o.value))o.value="&#160;";if(this.markDirty&&v.dirty&&typeof v.modified[h.name]!=="undefined")o.css+=" x-grid3-dirty-cell";if(h.id==this.grid.master_column_id){o.treeui=
this.renderCellTreeUI(v,d);h=j.mastercell}else h=j.cell;n[n.length]=h.apply(o)}else n.push(s);s=[];if(g&&(u+1)%2==0)s[0]="x-grid3-row-alt";if(v.dirty)s[1]=" x-grid3-dirty-row";q.cols=f;if(this.getRowClass)s[2]=this.getRowClass(v,u,q,d);q.alt=s.join(" ");q.cells=n.join("");q.display_style=d.isVisibleNode(v)?"":"display: none;";q.level=d.getNodeDepth(v);m[m.length]=k.apply(q)}return m.join("")},renderCellTreeUI:function(a,b){var d=this.templates.treeui,e=this.templates.elbow_line,f={},g,j,h=level=b.getNodeDepth(a);
f.wrap_width=(h+1)*16;if(level>0){f.elbow_line="";g=a;for(left=0;level--;){if(j=b.getNodeParent(g))f.elbow_line=b.hasNextSiblingNode(j)?e.apply({left:level*16,cls:"ux-maximgb-tg-elbow-line"})+f.elbow_line:e.apply({left:level*16,cls:"ux-maximgb-tg-elbow-empty"})+f.elbow_line;else throw["Tree inconsistency can't get level ",level+1," node(id=",g.id,") parent."].join("");g=j}}if(b.isLeafNode(a))f.cls=b.hasNextSiblingNode(a)?"ux-maximgb-tg-elbow":"ux-maximgb-tg-elbow-end";else{f.cls="ux-maximgb-tg-elbow-active ";
f.cls+=b.isExpandedNode(a)?b.hasNextSiblingNode(a)?this.expanded_icon_class:this.last_expanded_icon_class:b.hasNextSiblingNode(a)?this.collapsed_icon_class:this.last_collapsed_icon_class}f.left=1+h*16;return d.apply(f)},renderRow:function(){return false},afterRender:function(){Ext.ux.maximgb.tg.GridView.superclass.afterRender.call(this);this.updateAllColumnWidths()},updateAllColumnWidths:function(){var a=this.getTotalWidth(),b=this.cm.getColumnCount(),d=[],e,f;for(f=0;f<b;f++)d[f]=this.getColumnWidth(f);
this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=a;this.mainBody.dom.style.width=a;for(f=0;f<b;f++)this.getHeaderCell(f).style.width=d[f];var g=this.getRows(),j;f=0;for(e=g.length;f<e;f++){j=g[f];j.style.width=a;if(j.firstChild){j.firstChild.style.width=a;j=j.firstChild.rows[0];for(var h=0;h<b&&h<j.childNodes.length;h++)if(!Ext.fly(j.childNodes[h]).hasClass(this.skip_width_update_class))j.childNodes[h].style.width=d[h]}}this.onAllColumnWidthsUpdated(d,
a)},updateColumnWidth:function(a){var b=this.getColumnWidth(a),d=this.getTotalWidth();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=d;this.mainBody.dom.style.width=d;this.getHeaderCell(a).style.width=b;for(var e=this.getRows(),f,g=0,j=e.length;g<j;g++){f=e[g];f.style.width=d;if(f.firstChild){f.firstChild.style.width=d;if(a<f.firstChild.rows[0].childNodes.length)if(!Ext.fly(f.firstChild.rows[0].childNodes[a]).hasClass(this.skip_width_update_class))f.firstChild.rows[0].childNodes[a].style.width=
b}}this.onColumnWidthUpdated(a,b,d)},updateColumnHidden:function(a,b){var d=this.getTotalWidth();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=d;this.mainBody.dom.style.width=d;var e=b?"none":"";this.getHeaderCell(a).style.display=e;for(var f=this.getRows(),g,j=0,h=f.length;j<h;j++){g=f[j];g.style.width=d;if(g.firstChild){g.firstChild.style.width=d;if(a<g.firstChild.rows[0].childNodes.length)if(!Ext.fly(g.firstChild.rows[0].childNodes[a]).hasClass(this.skip_width_update_class))g.firstChild.rows[0].childNodes[a].style.display=
e}}this.onColumnHiddenUpdated(a,b,d);delete this.lastViewWidth;this.layout()},processRows:function(a,b){var d=0;if(!(this.ds.getCount()<1)){b=!this.grid.stripeRows;var e=this.getRows();d=0;Ext.each(e,function(f,g){f.rowIndex=g;f.className=f.className.replace(this.rowClsRe," ");if(f.style.display!="none"){if(!b&&(d+1)%2===0)f.className+=" x-grid3-row-alt";d++}},this);Ext.fly(e[0]).addClass(this.firstRowCls);Ext.fly(e[e.length-1]).addClass(this.lastRowCls)}},ensureVisible:function(a,b,d){var e,f=this.ds.getAt(a);
if(!this.ds.isVisibleNode(f))for(e=this.ds.getNodeAncestors(f);e.length>0;){f=e.shift();this.ds.isExpandedNode(f)||this.ds.expandNode(f)}return Ext.ux.maximgb.tg.GridView.superclass.ensureVisible.call(this,a,b,d)},expandRow:function(a,b){var d=this.ds,e,f,g,j,h;if(typeof a=="number"){e=a;a=d.getAt(e)}else e=d.indexOf(a);b=b||false;g=this.getRow(e);if(e=Ext.fly(g).child(".ux-maximgb-tg-elbow-active"))if(d.hasNextSiblingNode(a)){e.removeClass(this.collapsed_icon_class);e.removeClass(this.last_collapsed_icon_class);
e.addClass(this.expanded_icon_class)}else{e.removeClass(this.collapsed_icon_class);e.removeClass(this.last_collapsed_icon_class);e.addClass(this.last_expanded_icon_class)}if(d.isVisibleNode(a)){j=d.getNodeChildren(a);e=0;for(f=j.length;e<f;e++){h=d.indexOf(j[e]);g=this.getRow(h);g.style.display="block";d.isExpandedNode(j[e])&&this.expandRow(h,true)}}b||this.processRows(0)},collapseRow:function(a,b){var d=this.ds,e,f,g,j,h;if(typeof a=="number"){e=a;a=d.getAt(e)}else e=d.indexOf(a);b=b||false;j=this.getRow(e);
if(pmel=Ext.fly(j).child(".ux-maximgb-tg-elbow-active"))if(d.hasNextSiblingNode(a)){pmel.removeClass(this.expanded_icon_class);pmel.removeClass(this.last_expanded_icon_class);pmel.addClass(this.collapsed_icon_class)}else{pmel.removeClass(this.expanded_icon_class);pmel.removeClass(this.last_expanded_icon_class);pmel.addClass(this.last_collapsed_icon_class)}g=d.getNodeChildren(a);e=0;for(f=g.length;e<f;e++){h=d.indexOf(g[e]);j=this.getRow(h);if(j.style.display!="none"){j.style.display="none";this.collapseRow(h,
true)}}b||this.processRows(0)},initData:function(a,b){Ext.ux.maximgb.tg.GridView.superclass.initData.call(this,a,b);if(this.ds){this.ds.un("expandnode",this.onStoreExpandNode,this);this.ds.un("collapsenode",this.onStoreCollapseNode,this)}if(a){a.on("expandnode",this.onStoreExpandNode,this);a.on("collapsenode",this.onStoreCollapseNode,this)}},onLoad:function(a,b,d){if(d&&d.params&&(d.params[a.paramNames.active_node]===null||a.indexOfId(d.params[a.paramNames.active_node])==-1))Ext.ux.maximgb.tg.GridView.superclass.onLoad.call(this,
a,b,d)},onAdd:function(a,b,d){Ext.ux.maximgb.tg.GridView.superclass.onAdd.call(this,a,b,d);this.mainWrap&&this.processRows(0)},onRemove:function(a,b,d,e){Ext.ux.maximgb.tg.GridView.superclass.onRemove.call(this,a,b,d,e);e!==true&&this.mainWrap&&this.processRows(0)},onUpdate:function(a,b){Ext.ux.maximgb.tg.GridView.superclass.onUpdate.call(this,a,b);this.mainWrap&&this.processRows(0)},onStoreExpandNode:function(a,b){this.expandRow(b)},onStoreCollapseNode:function(a,b){this.collapseRow(b)}});
Ext.ux.maximgb.tg.GridPanel=Ext.extend(Ext.m3.GridPanel,{master_column_id:0,tg_cls:"ux-maximgb-tg-panel",initComponent:function(){this.initComponentPreOverride();Ext.ux.maximgb.tg.GridPanel.superclass.initComponent.call(this);this.getSelectionModel().on("selectionchange",this.onTreeGridSelectionChange,this);this.initComponentPostOverride()},initComponentPreOverride:Ext.emptyFn,initComponentPostOverride:Ext.emptyFn,onRender:function(a,b){Ext.ux.maximgb.tg.GridPanel.superclass.onRender.call(this,a,
b);this.el.addClass(this.tg_cls)},getView:function(){if(!this.view)this.view=new Ext.ux.maximgb.tg.GridView(this.viewConfig);return this.view},onClick:function(a){var b=a.getTarget(),d=this.getView().findRowIndex(b),e=this.getStore();this.getSelectionModel();var f=true;if(d!==false)if(Ext.fly(b).hasClass("ux-maximgb-tg-elbow-active")){b=e.getAt(d);e.isExpandedNode(b)?e.collapseNode(b):e.expandNode(b);f=false}f&&Ext.ux.maximgb.tg.GridPanel.superclass.onClick.call(this,a)},onMouseDown:function(a){var b=
a.getTarget();Ext.fly(b).hasClass("ux-maximgb-tg-elbow-active")||Ext.ux.maximgb.tg.GridPanel.superclass.onMouseDown.call(this,a)},onTreeGridSelectionChange:function(a,b){var d,e=this.getStore();if(a.getSelected){d=a.getSelected();e.setActiveNode(d)}else if(a.getSelectedCell&&b){d=b.record;e.setActiveNode(d)}if(d)if(!e.isVisibleNode(d))for(d=e.getNodeAncestors(d);d.length>0;)e.expandNode(d.pop())}});
Ext.ux.maximgb.tg.EditorGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{master_column_id:0,initComponent:function(){this.initComponentPreOverride();Ext.ux.maximgb.tg.EditorGridPanel.superclass.initComponent.call(this);this.getSelectionModel().on("selectionchange",this.onTreeGridSelectionChange,this);this.initComponentPostOverride()},initComponentPreOverride:Ext.emptyFn,initComponentPostOverride:Ext.emptyFn,onRender:function(a,b){Ext.ux.maximgb.tg.EditorGridPanel.superclass.onRender.call(this,a,b);
this.el.addClass("ux-maximgb-tg-panel")},getView:function(){if(!this.view)this.view=new Ext.ux.maximgb.tg.GridView(this.viewConfig);return this.view},onClick:function(a){var b=a.getTarget(),d=this.getView().findRowIndex(b),e=this.getStore();this.getSelectionModel();var f=true;if(d!==false)if(Ext.fly(b).hasClass("ux-maximgb-tg-elbow-active")){b=e.getAt(d);e.isExpandedNode(b)?e.collapseNode(b):e.expandNode(b);f=false}f&&Ext.ux.maximgb.tg.EditorGridPanel.superclass.onClick.call(this,a)},onMouseDown:function(a){var b=
a.getTarget();Ext.fly(b).hasClass("ux-maximgb-tg-elbow-active")||Ext.ux.maximgb.tg.EditorGridPanel.superclass.onMouseDown.call(this,a)},onTreeGridSelectionChange:function(a,b){var d,e=this.getStore();if(a.getSelected){d=a.getSelected();e.setActiveNode(d)}else if(a.getSelectedCell&&b){d=b.record;e.setActiveNode(d)}if(d)if(!e.isVisibleNode(d))for(d=e.getNodeAncestors(d);d.length>0;)e.expandNode(d.pop())}});
Ext.ux.maximgb.tg.PagingToolbar=Ext.extend(Ext.PagingToolbar,{onRender:function(a,b){Ext.ux.maximgb.tg.PagingToolbar.superclass.onRender.call(this,a,b);this.updateUI()},getPageData:function(){var a=0,b=0;if(this.store){b=this.store.getActiveNodePageOffset();a=this.store.getActiveNodeTotalCount()}return{total:a,activePage:Math.ceil((b+this.pageSize)/this.pageSize),pages:a<this.pageSize?1:Math.ceil(a/this.pageSize)}},updateInfo:function(){var a=0,b=0,d=0;if(this.displayItem){if(this.store){b=this.store.getActiveNodePageOffset();
a=this.store.getActiveNodeCount();d=this.store.getActiveNodeTotalCount()}a=a==0?this.emptyMsg:String.format(this.displayMsg,b+1,b+a,d);this.displayItem.setText(a)}},updateUI:function(){var a=this.getPageData(),b=a.activePage,d=a.pages;this.afterTextItem.setText(String.format(this.afterPageText,a.pages));this.inputItem.setValue(b);this.first.setDisabled(b==1);this.prev.setDisabled(b==1);this.next.setDisabled(b==d);this.last.setDisabled(b==d);this.refresh.enable();this.updateInfo()},bindStore:function(a,
b){!b&&this.store&&this.store.un("activenodechange",this.onStoreActiveNodeChange,this);a&&a.on("activenodechange",this.onStoreActiveNodeChange,this);Ext.ux.maximgb.tg.PagingToolbar.superclass.bindStore.call(this,a,b)},beforeLoad:function(a,b){var d=this.getParams();Ext.ux.maximgb.tg.PagingToolbar.superclass.beforeLoad.call(this,a,b);if(b&&b.params){if(b.params[d.start]===undefined)b.params[d.start]=0;if(b.params[d.limit]===undefined)b.params[d.limit]=this.pageSize}},moveFirst:function(){this.doLoad(0)},
movePrevious:function(){var a=this.store;a=a?a.getActiveNodePageOffset():0;this.doLoad(Math.max(0,a-this.pageSize))},moveNext:function(){var a=this.store;this.doLoad((a?a.getActiveNodePageOffset():0)+this.pageSize)},moveLast:function(){var a=this.store;a&&a.getActiveNodePageOffset();a=a?a.getActiveNodeTotalCount():0;var b=a%this.pageSize;this.doLoad(b?a-b:a-this.pageSize)},onStoreActiveNodeChange:function(){this.rendered&&this.updateUI()}});Ext.reg("Ext.ux.maximgb.tg.GridPanel",Ext.ux.maximgb.tg.GridPanel);
Ext.reg("Ext.ux.maximgb.tg.EditorGridPanel",Ext.ux.maximgb.tg.EditorGridPanel);Ext.reg("Ext.ux.maximgb.tg.PagingToolbar",Ext.ux.maximgb.tg.PagingToolbar);
Ext.m3.Window=Ext.extend(Ext.Window,{constructor:function(a,b){this.actionContextJson=this.parentWindow=null;if(b&&b.parentWindowID)this.parentWindow=Ext.getCmp(b.parentWindowID);if(b&&b.helpTopic)this.m3HelpTopic=b.helpTopic;if(b&&b.contextJson)this.actionContextJson=b.contextJson;Ext.m3.Window.superclass.constructor.call(this,a)},initTools:function(){if(this.m3HelpTopic){var a=this.m3HelpTopic;this.addTool({id:"help",handler:function(){showHelpWindow(a)}})}Ext.m3.Window.superclass.initTools.call(this)}});
Ext.m3.AdvancedTreeGrid=Ext.extend(Ext.ux.maximgb.tg.GridPanel,{constructor:function(a,b){assert(b.storeParams.url,"\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043e \u0437\u0430\u0434\u0430\u043d\u043e url. \t\t\turl="+b.storeParams.url);var d=b.columnsToRecord||[];d.push({name:"_id",type:"int"},{name:"_level",type:"int"},{name:"_lft",type:"int"},{name:"_rgt",type:"int"},{name:"_is_leaf",type:"bool"},{name:"_parent",type:"int"});d=new Ext.ux.maximgb.tg.AdjacencyListStore({autoLoad:true,
url:b.storeParams.url,reader:new Ext.data.JsonReader({id:"_id",root:b.storeParams.root,totalProperty:"total",successProperty:"success"},Ext.data.Record.create(d))});var e;if(b.bbar)e=new Ext.ux.maximgb.tg.PagingToolbar({store:d,displayInfo:true,pageSize:b.bbar.pageSize});e=Ext.applyIf({store:d,bbar:e},a);Ext.m3.AdvancedTreeGrid.superclass.constructor.call(this,e,b)}});
Ext.m3.AddrField=Ext.extend(Ext.Container,{constructor:function(a,b){var d=b.items||[],e=new Ext.data.JsonStore({url:b.kladr_url,idProperty:"code",root:"rows",totalProperty:"total",fields:[{name:"code"},{name:"display_name"},{name:"socr"},{name:"zipcode"},{name:"gni"},{name:"uno"},{name:"okato"},{name:"addr_name"}]});if(b.place_record!=""&&b.place_record!=undefined){var f=Ext.util.JSON.decode(b.place_record);e.loadData({total:1,rows:[f]})}var g=b.read_only?"m3-grey-field":"";this.place=new Ext.form.ComboBox({name:b.place_field_name,
fieldLabel:b.place_label,allowBlank:b.place_allow_blank,readOnly:b.read_only,cls:g,hideTrigger:true,minChars:2,emptyText:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0430\u0441\u0435\u043b\u0435\u043d\u043d\u044b\u0439 \u043f\u0443\u043d\u043a\u0442...",queryParam:"filter",store:e,resizable:true,displayField:"display_name",valueField:"code",mode:"remote",hiddenName:b.place_field_name,valueNotFoundText:"",invalidClass:b.invalid_class});this.place.setValue(b.place_value);this.zipcode=new Ext.form.TextField({name:b.zipcode_field_name,
value:b.zipcode_value,emptyText:"\u0438\u043d\u0434\u0435\u043a\u0441",readOnly:b.read_only,cls:g,width:55,maskRe:/[0-9]/});if(b.level>1){e=new Ext.data.JsonStore({url:b.street_url,idProperty:"code",root:"rows",totalProperty:"total",fields:[{name:"code"},{name:"display_name"},{name:"socr"},{name:"zipcode"},{name:"gni"},{name:"uno"},{name:"okato"},{name:"name"}]});if(b.street_record!=""&&b.street_record!=undefined){f=Ext.util.JSON.decode(b.street_record);e.loadData({total:1,rows:[f]})}this.street=
new Ext.form.ComboBox({name:b.street_field_name,fieldLabel:b.street_label,allowBlank:b.street_allow_blank,readOnly:b.read_only,cls:g,hideTrigger:true,minChars:2,emptyText:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0443\u043b\u0438\u0446\u0443...",queryParam:"filter",store:e,resizable:true,displayField:"display_name",valueField:"code",mode:"remote",hiddenName:b.street_field_name,valueNotFoundText:"",invalidClass:b.invalid_class});this.street.setValue(b.street_value);if(b.level>2){this.house=new Ext.form.TextField({name:b.house_field_name,
allowBlank:b.house_allow_blank,readOnly:b.read_only,cls:g,fieldLabel:b.house_label,value:b.house_value,emptyText:"",width:40,invalidClass:b.invalid_class});if(b.level>3)this.flat=new Ext.form.TextField({name:b.flat_field_name,fieldLabel:b.flat_label,value:b.flat_value,allowBlank:b.flat_allow_blank,readOnly:b.read_only,cls:g,emptyText:"",width:40,invalidClass:b.invalid_class})}}if(b.addr_visible)this.addr=new Ext.form.TextArea({name:b.addr_field_name,anchor:"100%",fieldLabel:b.addr_label,value:b.addr_value,
readOnly:true,cls:g,height:36});if(b.view_mode==1){this.place.flex=1;f=b.level>2?[this.place,this.zipcode]:[this.place];if(b.level>1){this.street.flex=1;this.street.fieldLabel=b.place_label;f.push({xtype:"label",style:{padding:"3px"},text:b.street_label+":"},this.street);if(b.level>2){this.house.fieldLabel=b.place_label;f.push({xtype:"label",style:{padding:"3px"},text:b.house_label+":"},this.house);if(b.level>3){this.flat.fieldLabel=b.place_label;f.push({xtype:"label",style:{padding:"3px"},text:b.flat_label+
":"},this.flat)}}}f={xtype:"compositefield",anchor:"100%",fieldLabel:b.place_label,items:f,invalidClass:b.invalid_composite_field_class};d.push(f);b.addr_visible&&d.push(this.addr)}if(b.view_mode==2){if(b.level>2){this.place.flex=1;f={xtype:"compositefield",anchor:"100%",fieldLabel:b.place_label,items:[this.place,this.zipcode],invalidClass:b.invalid_composite_field_class};d.push(f)}else{this.place.anchor="100%";d.push(this.place)}if(b.level>1){this.street.flex=1;f=[this.street];if(b.level>2){this.house.fieldLabel=
b.street_label;f.push({xtype:"label",style:{padding:"3px"},text:b.house_label+":"},this.house);if(b.level>3){this.flat.fieldLabel=b.street_label;f.push({xtype:"label",style:{padding:"3px"},text:b.flat_label+":"},this.flat)}}f={xtype:"compositefield",anchor:"100%",fieldLabel:b.street_label,items:f,invalidClass:b.invalid_composite_field_class};d.push(f)}b.addr_visible&&d.push(this.addr)}if(b.view_mode==3){if(b.level>2){this.place.flex=1;f={xtype:"compositefield",anchor:"100%",fieldLabel:b.place_label,
items:[this.place,this.zipcode],invalidClass:b.invalid_composite_field_class};d.push(f)}else{this.place.anchor="100%";d.push(this.place)}if(b.level>1){this.street.anchor="100%";d.push(this.street);if(b.level>2){f=[{xtype:"container",layout:"form",items:this.house,style:{overflow:"hidden"}}];b.level>3&&f.push({xtype:"container",layout:"form",style:{padding:"0px 0px 0px 5px",overflow:"hidden"},items:this.flat});f=new Ext.Container({anchor:"100%",layout:"column",items:f,style:{overflow:"hidden"}});d.push(f)}}b.addr_visible&&
d.push(this.addr)}d=Ext.applyIf({items:d,get_addr_url:b.get_addr_url,level:b.level,addr_visible:b.addr_visible,style:{overflow:"hidden"}},a);Ext.Container.superclass.constructor.call(this,d)},beforeStreetQuery:function(){this.street.getStore().baseParams.place_code=this.place.value},clearStreet:function(){this.street.setValue("")},afterRenderAddr:function(){this.addr_visible&&this.addr.getEl().on("dblclick",this.onDblClickAddr,this)},initComponent:function(){Ext.m3.AddrField.superclass.initComponent.call(this);
this.mon(this.place,"change",this.onChangePlace,this);if(this.level>1){this.mon(this.street,"change",this.onChangeStreet,this);if(this.level>2){this.mon(this.house,"change",this.onChangeHouse,this);this.mon(this.zipcode,"change",this.onChangeZipcode,this);this.level>3&&this.mon(this.flat,"change",this.onChangeFlat,this)}}this.mon(this.place,"beforequery",this.beforePlaceQuery,this);this.level>1&&this.mon(this.street,"beforequery",this.beforeStreetQuery,this);this.addr_visible&&this.addr.on("afterrender",
this.afterRenderAddr,this);this.addEvents("change","change_place","change_street","change_house","change_flat","change_zipcode","before_query_place")},getNewAddr:function(){var a;if(this.place!=undefined)a=this.place.getValue();var b;if(this.street!=undefined)b=this.street.getValue();var d;if(this.house!=undefined)d=this.house.getValue();var e;if(this.flat!=undefined)e=this.flat.getValue();var f;if(this.zipcode!=undefined)f=this.zipcode.getValue();var g=null;a=this.place.getStore().data.get(a);if(a!=
undefined)g=a.data;a=null;b=this.street.getStore().data.get(b);if(b!=undefined)a=b.data;d=this.generateTextAddr(g,a,d,e,f);this.addr!=undefined&&this.addr.setValue(d)},generateTextAddr:function(a,b,d,e,f){var g="";g=b!=undefined?a.addr_name+", "+b.socr+" "+b.name:a.addr_name;if(f!="")g=f+", "+g;if(d!=""&&d!=undefined)g=g+", \u0434. "+d;if(e!=""&&e!=undefined)g=g+", \u043a. "+e;return g},setNewAddr:function(a){if(this.addr!=undefined)this.addr.value=a},onChangePlace:function(){var a=this.place.getValue(),
b=this.place.getStore().data.get(a);if(b!=undefined){b=b.data;b.zipcode&&this.zipcode.setValue(b.zipcode)}else this.place.setValue("");this.clearStreet();this.fireEvent("change_place",this,a,b);this.addr_visible&&this.getNewAddr()},onChangeStreet:function(){var a=this.street.getValue(),b=this.street.getStore().data.get(a);if(b!=undefined){b=b.data;b.zipcode&&this.zipcode.setValue(b.zipcode)}else this.clearStreet();this.fireEvent("change_street",this,a,b);this.addr_visible&&this.getNewAddr()},onChangeHouse:function(){this.fireEvent("change_house",
this,this.house.getValue());this.addr_visible&&this.getNewAddr()},onChangeFlat:function(){this.fireEvent("change_flat",this,this.flat.getValue());this.addr_visible&&this.getNewAddr()},onChangeZipcode:function(){this.fireEvent("change_zipcode",this,this.zipcode.getValue());this.addr_visible&&this.getNewAddr()},beforePlaceQuery:function(a){this.fireEvent("before_query_place",this,a)},onDblClickAddr:function(){this.addr_visible&&this.addr.setReadOnly(false)}});
Ext.m3.AdvancedComboBox=Ext.extend(Ext.m3.ComboBox,{constructor:function(a,b){this.askBeforeDeleting=true;this.actionContextJson=this.actionEditUrl=this.actionSelectUrl=null;this.hideBaseTrigger=false;this.defaultText=this.defaultValue=null;this.hideTriggerClear=b.hideClearTrigger||false;this.hideTriggerDropDown=false;this.hideTriggerDictSelect=b.hideDictSelectTrigger||false;this.hideTriggerDictEdit=true;if(!b.hideEditTrigger)this.hideTriggerDictEdit=b.hideEditTrigger;this.defaultLimit=50;this.triggerClearClass=
"x-form-clear-trigger";this.triggerSelectClass="x-form-select-trigger";this.triggerEditClass="x-form-edit-trigger";assert(b.actions,"params.actions is undefined");if(b.actions.actionSelectUrl)this.actionSelectUrl=b.actions.actionSelectUrl;if(b.actions.actionEditUrl)this.actionEditUrl=b.actions.actionEditUrl;this.askBeforeDeleting=b.askBeforeDeleting;this.actionContextJson=b.actions.contextJson;this.hideBaseTrigger=false;if(a.hideTrigger){delete a.hideTrigger;this.hideBaseTrigger=true}this.defaultValue=
b.defaultValue;this.defaultText=b.defaultText;this.baseTriggers=[{iconCls:"x-form-clear-trigger",handler:null,hide:null},{iconCls:"",handler:null,hide:null},{iconCls:"x-form-select-trigger",handler:null,hide:null},{iconCls:"x-form-edit-trigger",handler:null,hide:true}];this.allTriggers=[].concat(this.baseTriggers);b.customTriggers&&Ext.each(b.customTriggers,function(d){this.allTriggers.push(d)},this);Ext.m3.AdvancedComboBox.superclass.constructor.call(this,a)},initComponent:function(){Ext.m3.AdvancedComboBox.superclass.initComponent.call(this);
this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",cn:[]};Ext.each(this.allTriggers,function(a){this.triggerConfig.cn.push({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+a.iconCls})},this);if(!this.actionSelectUrl)this.hideTriggerDictSelect=true;if(!this.actionEditUrl)this.hideTriggerDictEdit=true;if(this.hideBaseTrigger)this.hideTriggerDropDown=true;this.defaultValue&&this.defaultText&&this.addRecordToStore(this.defaultValue,this.defaultText);this.initBaseTrigger();this.addEvents("beforerequest",
"afterselect","changed");this.getStore().baseParams=Ext.applyIf({start:0,limit:this.defaultLimit},this.getStore().baseParams)},getTrigger:function(a){return this.triggers[a]},initTrigger:function(){var a=this.trigger.select(".x-form-trigger",true),b=this;a.each(function(d,e,f){var g="Trigger"+(f+1);d.hide=function(){var j=b.wrap.getWidth();this.dom.style.display="none";b.el.setWidth(j-b.trigger.getWidth());this["hidden"+g]=true};d.show=function(){var j=b.wrap.getWidth();this.dom.style.display="";
b.el.setWidth(j-b.trigger.getWidth());this["hidden"+g]=false};if(this.allTriggers[f].hide){d.dom.style.display="none";this["hidden"+g]=true}if(this.disabled)this.mun(d,"click",this.allTriggers[f].handler,this,{preventDefault:true});else{this.mon(d,"click",this.allTriggers[f].handler,this,{preventDefault:true});d.addClassOnOver("x-form-trigger-over");d.addClassOnClick("x-form-trigger-click")}},this);this.triggers=a.elements},initBaseTrigger:function(){this.baseTriggers[0].handler=this.onTriggerClearClick;
this.baseTriggers[1].handler=this.onTriggerDropDownClick;this.baseTriggers[2].handler=this.onTriggerDictSelectClick;this.baseTriggers[3].handler=this.onTriggerDictEditClick;this.baseTriggers[0].hide=this.hideTriggerClear;this.baseTriggers[1].hide=this.hideTriggerDropDown;this.baseTriggers[2].hide=this.hideTriggerDictSelect;this.baseTriggers[3].hide=this.hideTriggerDictEdit;if(!this.getValue()){this.baseTriggers[0].hide=true;this.baseTriggers[3].hide=true}},getTriggerWidth:function(){var a=0;Ext.each(this.triggers,
function(b,d){var e="Trigger"+(d+1),f=b.getWidth();a+=f===0&&!this["hidden"+e]?this.defaultTriggerWidth:f},this);return a},onDestroy:function(){Ext.destroy(this.triggers);Ext.destroy(this.allTriggers);Ext.destroy(this.baseTriggers);Ext.m3.AdvancedComboBox.superclass.onDestroy.call(this)},onTriggerDropDownClick:function(){if(this.fireEvent("beforerequest",this)){if(this.isExpanded())this.collapse();else{this.getStore().load();this.onFocus({});this.doQuery(this.allQuery,true)}this.el.focus()}},onTriggerDictSelectClick:function(){this.onSelectInDictionary()},
onTriggerClearClick:function(){if(this.askBeforeDeleting){var a=this;Ext.Msg.show({title:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435",msg:"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435?",icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,
fn:function(b){b=="yes"&&a.clearValue()}})}else this.clearValue()},onTriggerDictEditClick:function(){this.onEditBtn()},onSelect:function(a,b){if(this.fireEvent("afterselect",this,a.data[this.valueField],a.data[this.displayField])){Ext.m3.AdvancedComboBox.superclass.onSelect.call(this,a,b);this.showClearBtn();this.showEditBtn();this.fireEvent("change",this,a.data[this.valueField||this.displayField]);this.fireEvent("changed",this)}},showClearBtn:function(){if(!this.hideTriggerClear){this.el.parent().setOverflow("hidden");
this.getTrigger(0).show()}},hideClearBtn:function(){this.el.parent().setOverflow("auto");this.getTrigger(0).hide()},showEditBtn:function(){if(this.actionEditUrl&&!this.hideTriggerDictEdit&&this.getValue()){this.el.parent().setOverflow("hidden");this.getTrigger(3).show()}},hideEditBtn:function(){if(this.actionEditUrl){this.el.parent().setOverflow("auto");this.getTrigger(3).hide()}},clearValue:function(){var a=this.getValue();Ext.m3.AdvancedComboBox.superclass.clearValue.call(this);this.hideClearBtn();
this.hideEditBtn();this.fireEvent("change",this,"",a);this.fireEvent("changed",this)},setValue:function(a){Ext.m3.AdvancedComboBox.superclass.setValue.call(this,a);if(a)if(this.rendered){this.showClearBtn();this.showEditBtn()}else this.hideTrigger4=this.hideTrigger1=true},onSelectInDictionary:function(){assert(this.actionSelectUrl,"actionSelectUrl is undefined");if(this.fireEvent("beforerequest",this)){var a=this;Ext.Ajax.request({url:this.actionSelectUrl,method:"POST",params:this.actionContextJson,
success:function(b){(b=smart_eval(b.responseText))&&b.on("closed_ok",function(d,e){a.fireEvent("afterselect",a,d,e)&&a.addRecordToStore(d,e)})},failure:function(){uiAjaxFailMessage.apply(this,arguments)}})}},addRecordToStore:function(a,b){var d=new Ext.data.Record;d.id=a;d[this.displayField]=b;this.getStore().loadData({total:1,rows:[d]});d=this.getValue();this.setValue(a);this.collapse();this.fireEvent("change",this,a,d);this.fireEvent("changed",this)},onEditBtn:function(){assert(this.actionEditUrl,
"actionEditUrl is undefined");var a=this.getValue();assert(a,"Value not selected but edit window called");Ext.Ajax.request({url:this.actionEditUrl,method:"POST",params:Ext.applyIf({id:a},this.actionContextJson),success:function(b){smart_eval(b.responseText)},failure:function(){uiAjaxFailMessage()}})},triggerBlur:function(){this.focusClass&&this.el.removeClass(this.focusClass);this.wrap&&this.wrap.removeClass(this.wrapFocusClass);!this.getValue()&&this.lastQuery&&this.setRawValue("");this.validate()}});
Ext.reg("m3-select",Ext.m3.AdvancedComboBox);
Ext.m3.AdvancedDataField=Ext.extend(Ext.form.DateField,{constructor:function(a,b){this.baseTriggers=[{iconCls:"x-form-date-trigger",handler:null,hide:null},{iconCls:"x-form-current-date-trigger",handler:null,hide:null}];this.hideTriggerToday=false;if(b.hideTriggerToday)this.hideTriggerToday=true;Ext.m3.AdvancedDataField.superclass.constructor.call(this,a)},initComponent:function(){Ext.m3.AdvancedDataField.superclass.initComponent.call(this);this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",
cn:[]};Ext.each(this.baseTriggers,function(a){this.triggerConfig.cn.push({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+a.iconCls})},this);this.initBaseTrigger()},initTrigger:function(){var a=this.trigger.select(".x-form-trigger",true),b=this;a.each(function(d,e,f){var g="Trigger"+(f+1);d.hide=function(){var j=b.wrap.getWidth();this.dom.style.display="none";b.el.setWidth(j-b.trigger.getWidth());this["hidden"+g]=true};d.show=function(){var j=b.wrap.getWidth();this.dom.style.display="";b.el.setWidth(j-
b.trigger.getWidth());this["hidden"+g]=false};if(this.baseTriggers[f].hide){d.dom.style.display="none";this["hidden"+g]=true}this.mon(d,"click",this.baseTriggers[f].handler,this,{preventDefault:true});d.addClassOnOver("x-form-trigger-over");d.addClassOnClick("x-form-trigger-click")},this);this.triggers=a.elements},initBaseTrigger:function(){this.baseTriggers[0].handler=this.onTriggerClick;this.baseTriggers[1].handler=function(){var a=new Date;this.setValue(a);this.fireEvent("select",this,a)};this.baseTriggers[1].hide=
this.hideTriggerToday}});Ext.reg("m3-date",Ext.m3.AdvancedDataField);Ext.ns("Ext.m3.CodeEditorConfig");Ext.apply(Ext.m3.CodeEditorConfig,{cssPath:"m3static/vendor/codemirror/css/",jsPath:"m3static/vendor/codemirror/js/"});
Ext.apply(Ext.m3.CodeEditorConfig,{parser:{python:{parserfile:["parsepython.js"],stylesheet:Ext.m3.CodeEditorConfig.cssPath+"pythoncolors.css"},css:{parserfile:["parsecss.js"],stylesheet:Ext.m3.CodeEditorConfig.cssPath+"csscolors.css"},html:{parserfile:["parsexml.js","parsecss.js","tokenizejavascript.js","parsejavascript.js","parsehtmlmixed.js"],stylesheet:[Ext.m3.CodeEditorConfig.cssPath+"xmlcolors.css",Ext.m3.CodeEditorConfig.cssPath+"javascriptcolors.css",Ext.m3.CodeEditorConfig.cssPath+"csscolors.css"]},
javascript:{parserfile:["tokenizejavascript.js","parsejavascript.js"],stylesheet:Ext.m3.CodeEditorConfig.cssPath+"javascriptcolors.css"},sql:{parserfile:["parsesql.js"],stylesheet:Ext.m3.CodeEditorConfig.cssPath+"sqlcolors.css"}}});
Ext.m3.CodeEditor=Ext.extend(Ext.Panel,{sourceCode:"/*Default code*/ ",readOnly:false,constructor:function(a){Ext.m3.CodeEditor.superclass.constructor.call(this,a)},initComponent:function(){this.contentChanged=false;Ext.apply(this,{items:[{xtype:"textarea",readOnly:this.readOnly,hidden:true,value:this.sourceCode,enableKeyEvents:true}]});Ext.m3.CodeEditor.superclass.initComponent.apply(this,arguments)},onRender:function(){Ext.m3.CodeEditor.superclass.onRender.apply(this,arguments);this.oldSourceCode=
this.sourceCode;this.on("afterlayout",this.triggerCodeEditor,this,{single:true})},triggerCodeEditor:function(){var a=this,b=this.findByType("textarea")[0],d=Ext.applyIf(this.codeMirrorEditor||{},{height:"100%",width:"100%",lineNumbers:true,textWrapping:false,content:b.getValue(),indentUnit:4,tabMode:"shift",readOnly:b.readOnly,basefiles:["codemirror_base.js"],path:Ext.m3.CodeEditorConfig.jsPath,autoMatchParens:true,initCallback:function(e){e.win.document.body.lastChild.scrollIntoView();try{var f=
Ext.state.Manager.get("edcmr_"+a.itemId+"_lnmbr")!==undefined?Ext.state.Manager.get("edcmr_"+a.itemId+"_lnmbr"):1;e.jumpToLine(f)}catch(g){}Ext.fly(e.win.document.body).on("keydown",function(j){if(j.ctrlKey&&j.keyCode==83){a.fireEvent("save");j.stopEvent()}})},onChange:function(){var e=a.codeMirrorEditor.getCode();b.setValue(e);a.oldSourceCode==e?a.setTitleClass(true):a.setTitleClass();a.fireEvent("contentChaged",a)}});d=Ext.applyIf(d,Ext.m3.CodeEditorConfig.parser[a.parser||"python"]);this.codeMirrorEditor=
new CodeMirror.fromTextArea(Ext.getDom(b.id).id,d)},getCode:function(){return typeof this.codeMirrorEditor!="undefined"?this.codeMirrorEditor.getCode():""},setTitleClass:function(a){this.contentChanged=a!==true}});Ext.reg("uxCodeEditor",Ext.m3.CodeEditor);
Ext.m3.EditWindow=Ext.extend(Ext.m3.Window,{constructor:function(a,b){this.formUrl=this.formId=null;this.changesCount=0;this.originalTitle=null;if(b)if(b.form){if(b.form.id)this.formId=b.form.id;if(b.form.url)this.formUrl=b.form.url}Ext.m3.EditWindow.superclass.constructor.call(this,a,b)},initComponent:function(){Ext.m3.EditWindow.superclass.initComponent.call(this);this.items.each(function(a){this.setFieldOnChange(a,this)},this);this.addEvents("beforesubmit","closing_canceled")},getForm:function(){assert(this.formId,
"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d formId \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u044b");return Ext.getCmp(this.formId).getForm()},submitForm:function(a,b,d){assert(this.formUrl,"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d url \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u044b");if((a=Ext.getCmp(this.formId).getForm())&&!a.isValid())Ext.Msg.show({title:"\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0444\u043e\u0440\u043c\u044b",msg:"\u041d\u0430 \u0444\u043e\u0440\u043c\u0435 \u0438\u043c\u0435\u044e\u0442\u0441\u044f \u043d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435 \u043f\u043e\u043b\u044f",
buttons:Ext.Msg.OK,icon:Ext.Msg.WARNING});else{var e=this,f=new Ext.LoadMask(this.body,{msg:"\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435..."});d={url:this.formUrl,submitEmptyText:false,params:Ext.applyIf(d||{},this.actionContextJson||{}),success:function(g,j){e.fireEvent("closed_ok",j.response.responseText);e.close(true);try{smart_eval(j.response.responseText)}finally{f.hide();e.disableToolbars(false)}},failure:function(){uiAjaxFailMessage.apply(e,arguments);f.hide();e.disableToolbars(false)}};
if(e.fireEvent("beforesubmit",d)){this.disableToolbars(true);f.show();a.submit(d)}}},onChangeFieldValue:function(a,b,d,e){if(a.originalValue!==b){a.isModified||e.changesCount++;a.isModified=true}else{a.isModified&&e.changesCount--;a.isModified=false}e.updateTitle();a.updateLabel()},setFieldOnChange:function(a,b){if(a){a instanceof Ext.form.Field&&a.isEdit&&a.on("change",function(e,f,g){b.onChangeFieldValue(e,f,g,b)});if(a.items)if(a.items instanceof Array)for(var d=0;d<a.items.length;d++)b.setFieldOnChange(a.items[d],
b);else a.items.each(function(e){b.setFieldOnChange(e,b)});if(a.titleItems)for(d=0;d<a.titleItems.length;d++)b.setFieldOnChange(a.titleItems[d],b)}},updateTitle:function(){if(this.title!==this.originalTitle&&this.originalTitle===null)this.originalTitle=this.title;this.changesCount!==0?this.setTitle("*"+this.originalTitle):this.setTitle(this.originalTitle)},close:function(a){if(this.changesCount!==0&&!a){var b=this;Ext.Msg.show({title:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435",msg:"\u0414\u0430\u043d\u043d\u044b\u0435 \u0431\u044b\u043b\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u044b! C\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f?",
buttons:Ext.Msg.YESNOCANCEL,fn:function(d){if(d==="yes")this.submitForm();else d==="no"?Ext.m3.EditWindow.superclass.close.call(b):b.fireEvent("closing_canceled")},animEl:"elId",icon:Ext.MessageBox.QUESTION,scope:this})}else Ext.m3.EditWindow.superclass.close.call(this)},disableToolbars:function(a){for(var b=[this.getTopToolbar(),this.getFooterToolbar(),this.getBottomToolbar()],d=0;d<b.length;d++)b[d]&&b[d].setDisabled(a)}});Ext.ns("Ext.ux.grid");
Ext.ux.grid.Exporter=Ext.extend(Ext.util.Observable,{title:"",sendDatFromStore:true,constructor:function(){Ext.ux.grid.Exporter.superclass.constructor.call(this)},init:function(a){if(a instanceof Ext.grid.GridPanel){this.grid=a;this.grid.on("afterrender",this.onRender,this)}this.dataUrl=this.grid.dataUrl},onRender:function(){if(!this.grid.tbar){this.grid.elements+=",tbar";tbar=new Ext.Toolbar;this.grid.tbar=tbar;this.grid.add(tbar);this.grid.doLayout()}this.grid.tbar.insert(0,new Ext.Button({text:"\u042d\u043a\u0441\u043f\u043e\u0440\u0442",
iconCls:"icon-application-go",listeners:{scope:this,click:this.exportData}}))},exportData:function(){columns=[];Ext.each(this.grid.colModel.config,function(a){columns.push({data_index:a.dataIndex,header:a.header,id:a.id,is_column:a.isCoumn,sortable:a.sortable,width:a.width})});data=[];this.sendDatFromStore&&Ext.each(this.grid.store.data.items,function(a){data.push(a.data)});params={columns:Ext.encode(columns),title:this.title||this.grid.title||this.grid.id,data:Ext.encode(data)};Ext.Ajax.request({url:"/ui/exportgrid-export",
success:function(a){location.href=a.responseText},failure:function(){},params:params})}});Ext.m3.HelpWindow=Ext.extend(Ext.Window,{constructor:function(a){this.title="\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f";this.minimizable=this.maximizable=this.maximized=true;this.width=800;this.height=550;Ext.m3.HelpWindow.superclass.constructor.call(this,a)}});function showHelpWindow(a){window.open(a)}
Ext.m3.ObjectGrid=Ext.extend(Ext.m3.GridPanel,{constructor:function(a,b){assert(b.allowPaging!==undefined,"allowPaging is undefined");assert(b.rowIdName!==undefined,"rowIdName is undefined");assert(b.actions!==undefined,"actions is undefined");this.allowPaging=b.allowPaging;this.rowIdName=b.rowIdName;this.columnParamName=b.columnParamName;this.actionNewUrl=b.actions.newUrl;this.actionEditUrl=b.actions.editUrl;this.actionDeleteUrl=b.actions.deleteUrl;this.actionDataUrl=b.actions.dataUrl;this.actionContextJson=
b.actions.contextJson;this.readOnly=b.readOnly;Ext.m3.ObjectGrid.superclass.constructor.call(this,a,b)},initComponent:function(){Ext.m3.ObjectGrid.superclass.initComponent.call(this);var a=this.getStore();a.baseParams=Ext.applyIf(a.baseParams||{},this.actionContextJson||{});this.addEvents("beforenewrequest","afternewrequest","beforeeditrequest","aftereditrequest","beforedeleterequest","afterdeleterequest")},onNewRecord:function(){assert(this.actionNewUrl,"actionNewUrl is not define");var a=new Ext.LoadMask(this.body),
b={url:this.actionNewUrl,params:this.actionContextJson||{},success:function(e,f){if(d.fireEvent("afternewrequest",d,e,f)){try{var g=d.childWindowOpenHandler(e,f)}finally{a.hide();d.disableToolbars(false)}return g}a.hide();d.disableToolbars(false)},failure:function(){uiAjaxFailMessage.apply(this,arguments);a.hide();d.disableToolbars(false)}};if(this.fireEvent("beforenewrequest",this,b)){var d=this;this.disableToolbars(true);a.show();Ext.Ajax.request(b)}},onEditRecord:function(){assert(this.actionEditUrl,
"actionEditUrl is not define");assert(this.rowIdName,"rowIdName is not define");if(this.getSelectionModel().hasSelection()){var a={},b=this.getSelectionModel();if(b instanceof Ext.grid.RowSelectionModel)if(b.singleSelect)a[this.rowIdName]=b.getSelected().id;else{b=b.getSelections();for(var d=[],e=0,f=b.length;e<f;e++)d.push(b[e].id);a[this.rowIdName]=d.join()}else if(b instanceof Ext.grid.CellSelectionModel){assert(this.columnParamName,"columnParamName is not define");if(b=b.getSelectedCell()){d=
this.getStore().getAt(b[0]);a[this.rowIdName]=d.id;a[this.columnParamName]=this.getColumnModel().getDataIndex(b[1])}}var g=new Ext.LoadMask(this.body);a={url:this.actionEditUrl,params:Ext.applyIf(a,this.actionContextJson||{}),success:function(h,k){if(j.fireEvent("aftereditrequest",j,h,k)){try{var l=j.childWindowOpenHandler(h,k)}finally{g.hide();j.disableToolbars(false)}return l}g.hide();j.disableToolbars(false)},failure:function(){uiAjaxFailMessage.apply(this,arguments);g.hide();j.disableToolbars(false)}};
if(this.fireEvent("beforeeditrequest",this,a)){var j=this;this.disableToolbars(true);g.show();Ext.Ajax.request(a)}}},onDeleteRecord:function(){assert(this.actionDeleteUrl,"actionDeleteUrl is not define");assert(this.rowIdName,"rowIdName is not define");var a=this;a.getSelectionModel().hasSelection()&&Ext.Msg.show({title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438",msg:"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c?",
icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,fn:function(b){if(b=="yes"){b={};var d=a.getSelectionModel();if(d instanceof Ext.grid.RowSelectionModel)if(d.singleSelect)b[a.rowIdName]=d.getSelected().id;else{d=d.getSelections();for(var e=[],f=0,g=d.length;f<g;f++)e.push(d[f].id);b[a.rowIdName]=e.join()}else if(d instanceof Ext.grid.CellSelectionModel){assert(a.columnParamName,"columnParamName is not define");if(d=d.getSelectedCell()){e=a.getStore().getAt(d[0]);b[a.rowIdName]=e.id;b[a.columnParamName]=
a.getColumnModel().getDataIndex(d[1])}}var j=new Ext.LoadMask(a.body);b={url:a.actionDeleteUrl,params:Ext.applyIf(b,a.actionContextJson||{}),success:function(h,k){if(a.fireEvent("afterdeleterequest",a,h,k)){try{var l=a.deleteOkHandler(h,k)}finally{j.hide();a.disableToolbars(false)}return l}j.hide();a.disableToolbars(false)},failure:function(){uiAjaxFailMessage.apply(this,arguments);j.hide();a.disableToolbars(false)}};if(a.fireEvent("beforedeleterequest",a,b)){a.disableToolbars(true);j.show();Ext.Ajax.request(b)}}}})},
childWindowOpenHandler:function(a){if(a=smart_eval(a.responseText)){var b=this;a.on("closed_ok",function(){return b.refreshStore()})}},deleteOkHandler:function(a){smart_eval(a.responseText);this.refreshStore()},refreshStore:function(){if(this.allowPaging){var a=this.getBottomToolbar();a&&a instanceof Ext.PagingToolbar&&a.changePage(Math.ceil((a.cursor+a.pageSize)/a.pageSize))}else this.getStore().load()},disableToolbars:function(a){for(var b=[this.getTopToolbar(),this.getFooterToolbar(),this.getBottomToolbar()],
d=0;d<b.length;d++)b[d]&&!this.readOnly&&b[d].setDisabled(a)}});
Ext.m3.EditorObjectGrid=Ext.extend(Ext.m3.EditorGridPanel,{constructor:function(a,b){assert(b.allowPaging!==undefined,"allowPaging is undefined");assert(b.rowIdName!==undefined,"rowIdName is undefined");assert(b.actions!==undefined,"actions is undefined");this.allowPaging=b.allowPaging;this.rowIdName=b.rowIdName;this.columnParamName=b.columnParamName;this.actionNewUrl=b.actions.newUrl;this.actionEditUrl=b.actions.editUrl;this.actionDeleteUrl=b.actions.deleteUrl;this.actionDataUrl=b.actions.dataUrl;
this.actionContextJson=b.actions.contextJson;Ext.m3.EditorObjectGrid.superclass.constructor.call(this,a,b)},initComponent:function(){Ext.m3.EditorObjectGrid.superclass.initComponent.call(this);var a=this.getStore();a.baseParams=Ext.applyIf(a.baseParams||{},this.actionContextJson||{});this.addEvents("beforenewrequest","afternewrequest","beforeeditrequest","aftereditrequest","beforedeleterequest","afterdeleterequest")},onNewRecord:function(){assert(this.actionNewUrl,"actionNewUrl is not define");var a=
{url:this.actionNewUrl,params:this.actionContextJson||{},success:function(d,e){if(b.fireEvent("afternewrequest",b,d,e))return b.childWindowOpenHandler(d,e)},failure:Ext.emptyFn};if(this.fireEvent("beforenewrequest",this,a)){var b=this;Ext.Ajax.request(a)}},onEditRecord:function(){assert(this.actionEditUrl,"actionEditUrl is not define");assert(this.rowIdName,"rowIdName is not define");if(this.getSelectionModel().hasSelection()){var a={},b=this.getSelectionModel();if(b instanceof Ext.grid.RowSelectionModel)if(b.singleSelect)a[this.rowIdName]=
b.getSelected().id;else{b=b.getSelections();for(var d=[],e=0,f=b.length;e<f;e++)d.push(b[e].id);a[this.rowIdName]=d}else if(b instanceof Ext.grid.CellSelectionModel){assert(this.columnParamName,"columnParamName is not define");if(b=b.getSelectedCell()){d=this.getStore().getAt(b[0]);a[this.rowIdName]=d.id;a[this.columnParamName]=this.getColumnModel().getDataIndex(b[1])}}a={url:this.actionEditUrl,params:Ext.applyIf(a,this.actionContextJson||{}),success:function(j,h){if(g.fireEvent("aftereditrequest",
g,j,h))return g.childWindowOpenHandler(j,h)},failure:Ext.emptyFn};if(this.fireEvent("beforeeditrequest",this,a)){var g=this;Ext.Ajax.request(a)}}},onDeleteRecord:function(){assert(this.actionDeleteUrl,"actionDeleteUrl is not define");assert(this.rowIdName,"rowIdName is not define");var a=this;a.getSelectionModel().hasSelection()&&Ext.Msg.show({title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438",msg:"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c?",
icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,fn:function(b){if(b=="yes"){b={};var d=a.getSelectionModel();if(d instanceof Ext.grid.RowSelectionModel)if(d.singleSelect)b[a.rowIdName]=d.getSelected().id;else{d=d.getSelections();for(var e=[],f=0,g=d.length;f<g;f++)e.push(d[f].id);b[a.rowIdName]=e}else if(d instanceof Ext.grid.CellSelectionModel){assert(a.columnParamName,"columnParamName is not define");if(d=d.getSelectedCell()){e=a.getStore().getAt(d[0]);b[a.rowIdName]=e.id;b[a.columnParamName]=a.getColumnModel().getDataIndex(d[1])}}b=
{url:a.actionDeleteUrl,params:Ext.applyIf(b,a.actionContextJson||{}),success:function(j,h){if(a.fireEvent("afterdeleterequest",a,j,h))return a.deleteOkHandler(j,h)},failure:Ext.emptyFn};a.fireEvent("beforedeleterequest",a,b)&&Ext.Ajax.request(b)}}})},childWindowOpenHandler:function(a){if(a=smart_eval(a.responseText)){var b=this;a.on("closed_ok",function(){return b.refreshStore()})}},deleteOkHandler:function(a){smart_eval(a.responseText);this.refreshStore()},refreshStore:function(){if(this.allowPaging){var a=
this.getBottomToolbar();a&&a instanceof Ext.PagingToolbar&&a.changePage(Math.ceil((a.cursor+a.pageSize)/a.pageSize))}else this.getStore().load()}});
Ext.m3.ObjectTree=Ext.extend(Ext.m3.AdvancedTreeGrid,{constructor:function(a,b){assert(b.allowPaging!==undefined,"allowPaging is undefined");assert(b.rowIdName!==undefined,"rowIdName is undefined");assert(b.actions!==undefined,"actions is undefined");this.allowPaging=b.allowPaging;this.rowIdName=b.rowIdName;this.actionNewUrl=b.actions.newUrl;this.actionEditUrl=b.actions.editUrl;this.actionDeleteUrl=b.actions.deleteUrl;this.actionDataUrl=b.actions.dataUrl;this.actionContextJson=b.actions.contextJson;
Ext.m3.ObjectTree.superclass.constructor.call(this,a,b)},initComponent:function(){Ext.m3.AdvancedTreeGrid.superclass.initComponent.call(this);var a=this.getStore();a.baseParams=Ext.applyIf(a.baseParams||{},this.actionContextJson||{})},onNewRecord:function(){assert(this.actionNewUrl,"actionNewUrl is not define");var a=this;Ext.Ajax.request({url:this.actionNewUrl,params:this.actionContextJson||{},success:function(b,d){return a.childWindowOpenHandler(b,d)},failure:Ext.emptyFn})},onNewRecordChild:function(){assert(this.actionNewUrl,
"actionNewUrl is not define");if(this.getSelectionModel().getSelected()){var a={};a[this.rowIdName]=this.getSelectionModel().getSelected().get("_parent");var b=this;Ext.Ajax.request({url:this.actionNewUrl,params:Ext.applyIf(a,this.actionContextJson||{}),success:function(d,e){return b.childWindowOpenHandler(d,e)},failure:Ext.emptyFn})}else Ext.Msg.show({title:"\u041d\u043e\u0432\u044b\u0439",msg:"\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d",buttons:Ext.Msg.OK,
icon:Ext.MessageBox.INFO})},onEditRecord:function(){assert(this.actionEditUrl,"actionEditUrl is not define");assert(this.rowIdName,"rowIdName is not define");if(this.getSelectionModel().hasSelection()){var a={};a[this.rowIdName]=this.getSelectionModel().getSelected().id;var b=this;Ext.Ajax.request({url:this.actionEditUrl,params:Ext.applyIf(a,this.actionContextJson||{}),success:function(d,e){return b.childWindowOpenHandler(d,e)},failure:Ext.emptyFn})}},onDeleteRecord:function(){assert(this.actionDeleteUrl,
"actionDeleteUrl is not define");assert(this.rowIdName,"rowIdName is not define");var a=this;Ext.Msg.show({title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438",msg:"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c?",icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,
fn:function(b){if(b=="yes")if(a.getSelectionModel().hasSelection()){b={};b[a.rowIdName]=a.getSelectionModel().getSelected().id;Ext.Ajax.request({url:a.actionDeleteUrl,params:Ext.applyIf(b,a.actionContextJson||{}),success:function(d,e){return a.deleteOkHandler(d,e)},failure:Ext.emptyFn})}}})},childWindowOpenHandler:function(a){if(a=smart_eval(a.responseText)){var b=this;a.on("closed_ok",function(){return b.refreshStore()})}},deleteOkHandler:function(a){smart_eval(a.responseText);this.refreshStore()},
refreshStore:function(){if(this.allowPaging){var a=this.getBottomToolbar();a&&a instanceof Ext.PagingToolbar&&a.changePage(Math.ceil((a.cursor+a.pageSize)/a.pageSize))}else this.getStore().load()}});Ext.namespace("Ext.ux");
Ext.ux.OnDemandLoad=function(){loadComponent=function(a,b){var d=a.substring(a.lastIndexOf(".")),e=document.getElementsByTagName("head")[0],f=false;if(d===".js"){var g=document.createElement("script");g.setAttribute("type","text/javascript");g.setAttribute("src",a);g.onload=g.onreadystatechange=function(){if(!f){f=true;typeof b=="function"&&b();e.removeChild(g)}}}else if(d===".css"){g=document.createElement("link");g.setAttribute("type","text/css");g.setAttribute("rel","stylesheet");g.setAttribute("href",
a)}typeof g!="undefined"&&e.appendChild(g)};return{load:function(a,b){loadComponent(a,b)}}}();
var CodeMirrorConfig=window.CodeMirrorConfig||{},CodeMirror=function(){function a(h,k){for(var l in k)h.hasOwnProperty(l)||(h[l]=k[l])}function b(h,k){for(var l=0;l<h.length;l++)k(h[l])}function d(h){return document.createElementNS&&document.documentElement.namespaceURI!==null?document.createElementNS("http://www.w3.org/1999/xhtml",h):document.createElement(h)}function e(h,k){var l=d("div"),m=d("div");l.style.position="absolute";l.style.height="100%";if(l.style.setExpression)try{l.style.setExpression("height",
"this.previousSibling.offsetHeight + 'px'")}catch(n){}l.style.top="0px";l.style.left="0px";l.style.overflow="hidden";h.appendChild(l);m.className="CodeMirror-line-numbers";l.appendChild(m);m.innerHTML="<div>"+k+"</div>";return l}function f(h){if(typeof h.parserfile=="string")h.parserfile=[h.parserfile];if(typeof h.basefiles=="string")h.basefiles=[h.basefiles];if(typeof h.stylesheet=="string")h.stylesheet=[h.stylesheet];var k=' spellcheck="'+(h.disableSpellcheck?"false":"true")+'"',l=['<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html'+
k+"><head>"];l.push('<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7"/>');var m=h.noScriptCaching?"?nocache="+(new Date).getTime().toString(16):"";b(h.stylesheet,function(n){l.push('<link rel="stylesheet" type="text/css" href="'+n+m+'"/>')});b(h.basefiles.concat(h.parserfile),function(n){/^https?:/.test(n)||(n=h.path+n);l.push('<script type="text/javascript" src="'+n+m+'"><\/script>')});l.push('</head><body style="border-width: 0;" class="editbox"'+k+"></body></html>");return l.join("")}
function g(h,k){this.options=k=k||{};a(k,CodeMirrorConfig);if(k.dumbTabs)k.tabMode="spaces";else if(k.normalTab)k.tabMode="default";if(k.cursorActivity)k.onCursorActivity=k.cursorActivity;var l=this.frame=d("iframe");if(k.iframeClass)l.className=k.iframeClass;l.frameBorder=0;l.style.border="0";l.style.width="100%";l.style.height="100%";l.style.display="block";var m=this.wrapping=d("div");m.style.position="relative";m.className="CodeMirror-wrapping";m.style.width=k.width;m.style.height=k.height=="dynamic"?
k.minHeight+"px":k.height;var n=this.textareaHack=d("textarea");m.appendChild(n);n.style.position="absolute";n.style.left="-10000px";n.style.width="10px";n.tabIndex=1E5;l.CodeMirror=this;if(k.domain&&j){this.html=f(k);l.src="javascript:(function(){document.open();"+(k.domain?'document.domain="'+k.domain+'";':"")+"document.write(window.frameElement.CodeMirror.html);document.close();})()"}else l.src="javascript:;";h.appendChild?h.appendChild(m):h(m);m.appendChild(l);if(k.lineNumbers)this.lineNumbers=
e(m,k.firstLineNumber);this.win=l.contentWindow;if(!k.domain||!j){this.win.document.open();this.win.document.write(f(k));this.win.document.close()}}a(CodeMirrorConfig,{stylesheet:[],path:"",parserfile:[],basefiles:["util.js","stringstream.js","select.js","undo.js","editor.js","tokenize.js"],iframeClass:null,passDelay:200,passTime:50,lineNumberDelay:200,lineNumberTime:50,continuousScanning:false,saveFunction:null,onLoad:null,onChange:null,undoDepth:50,undoDelay:800,disableSpellcheck:true,textWrapping:true,
readOnly:false,width:"",height:"300px",minHeight:100,autoMatchParens:false,markParen:null,unmarkParen:null,parserConfig:null,tabMode:"indent",enterMode:"indent",electricChars:true,reindentOnLoad:false,activeTokens:null,onCursorActivity:null,lineNumbers:false,firstLineNumber:1,onLineNumberClick:null,indentUnit:2,domain:null,noScriptCaching:false,incrementalLoading:false});var j=document.selection&&window.ActiveXObject&&/MSIE/.test(navigator.userAgent);g.prototype={init:function(){this.options.initCallback&&
this.options.initCallback(this);this.options.onLoad&&this.options.onLoad(this);this.options.lineNumbers&&this.activateLineNumbers();this.options.reindentOnLoad&&this.reindent();this.options.height=="dynamic"&&this.setDynamicHeight()},getCode:function(){return this.editor.getCode()},setCode:function(h){this.editor.importCode(h)},selection:function(){this.focusIfIE();return this.editor.selectedText()},reindent:function(){this.editor.reindent()},reindentSelection:function(){this.focusIfIE();this.editor.reindentSelection(null)},
focusIfIE:function(){this.win.select.ie_selection&&document.activeElement!=this.frame&&this.focus()},focus:function(){this.win.focus();this.editor.selectionSnapshot&&this.win.select.setBookmark(this.win.document.body,this.editor.selectionSnapshot)},replaceSelection:function(h){this.focus();this.editor.replaceSelection(h);return true},replaceChars:function(h,k,l){this.editor.replaceChars(h,k,l)},getSearchCursor:function(h,k,l){return this.editor.getSearchCursor(h,k,l)},undo:function(){this.editor.history.undo()},
redo:function(){this.editor.history.redo()},historySize:function(){return this.editor.history.historySize()},clearHistory:function(){this.editor.history.clear()},grabKeys:function(h,k){this.editor.grabKeys(h,k)},ungrabKeys:function(){this.editor.ungrabKeys()},setParser:function(h,k){this.editor.setParser(h,k)},setSpellcheck:function(h){this.win.document.body.spellcheck=h},setStylesheet:function(h){if(typeof h==="string")h=[h];for(var k={},l={},m=this.win.document.getElementsByTagName("link"),n=0,
o;o=m[n];n++)if(o.rel.indexOf("stylesheet")!==-1)for(var q=0;q<h.length;q++){var v=h[q];if(o.href.substring(o.href.length-v.length)===v){k[o.href]=true;l[v]=true}}for(n=0;o=m[n];n++)if(o.rel.indexOf("stylesheet")!==-1)o.disabled=!(o.href in k);for(q=0;q<h.length;q++){v=h[q];if(!(v in l)){o=this.win.document.createElement("link");o.rel="stylesheet";o.type="text/css";o.href=v;this.win.document.getElementsByTagName("head")[0].appendChild(o)}}},setTextWrapping:function(h){if(h!=this.options.textWrapping){this.win.document.body.style.whiteSpace=
h?"":"nowrap";this.options.textWrapping=h;if(this.lineNumbers){this.setLineNumbers(false);this.setLineNumbers(true)}}},setIndentUnit:function(h){this.win.indentUnit=h},setUndoDepth:function(h){this.editor.history.maxDepth=h},setTabMode:function(h){this.options.tabMode=h},setEnterMode:function(h){this.options.enterMode=h},setLineNumbers:function(h){if(h&&!this.lineNumbers){this.lineNumbers=e(this.wrapping,this.options.firstLineNumber);this.activateLineNumbers()}else if(!h&&this.lineNumbers){this.wrapping.removeChild(this.lineNumbers);
this.wrapping.style.paddingLeft="";this.lineNumbers=null}},cursorPosition:function(h){this.focusIfIE();return this.editor.cursorPosition(h)},firstLine:function(){return this.editor.firstLine()},lastLine:function(){return this.editor.lastLine()},nextLine:function(h){return this.editor.nextLine(h)},prevLine:function(h){return this.editor.prevLine(h)},lineContent:function(h){return this.editor.lineContent(h)},setLineContent:function(h,k){this.editor.setLineContent(h,k)},removeLine:function(h){this.editor.removeLine(h)},
insertIntoLine:function(h,k,l){this.editor.insertIntoLine(h,k,l)},selectLines:function(h,k,l,m){this.win.focus();this.editor.selectLines(h,k,l,m)},nthLine:function(h){for(var k=this.firstLine();h>1&&k!==false;h--)k=this.nextLine(k);return k},lineNumber:function(h){for(var k=0;h!==false;){k++;h=this.prevLine(h)}return k},jumpToLine:function(h){if(typeof h=="number")h=this.nthLine(h);this.selectLines(h,0);this.win.focus()},currentLine:function(){return this.lineNumber(this.cursorLine())},cursorLine:function(){return this.cursorPosition().line},
cursorCoords:function(h){return this.editor.cursorCoords(h)},activateLineNumbers:function(){function h(){if(o.offsetWidth!=0){for(var w=o;w.parentNode;w=w.parentNode);if(!p.parentNode||w!=document||!q.Editor){try{F()}catch(x){}clearInterval(G)}else if(p.offsetWidth!=C){C=p.offsetWidth;o.parentNode.style.paddingLeft=C+"px"}}}function k(){p.scrollTop=t.scrollTop||v.documentElement.scrollTop||0}function l(w){var x=u.firstChild.offsetHeight;if(x!=0){x=Math.ceil((50+Math.max(t.offsetHeight,Math.max(o.offsetHeight,
t.scrollHeight||0)))/x);for(var z=u.childNodes.length;z<=x;z++){var H=d("div");H.appendChild(document.createTextNode(w?String(z+s.options.firstLineNumber):"\u00a0"));u.appendChild(H)}}}function m(){function w(){l(true);k()}s.updateNumbers=w;var x=q.addEventHandler(q,"scroll",k,true),z=q.addEventHandler(q,"resize",w,true);F=function(){x();z();if(s.updateNumbers==w)s.updateNumbers=null};w()}function n(){function w(A,K){B||(B=u.appendChild(d("div")));M&&M(B,K,A);D.push(B);D.push(A);I=B.offsetHeight+
B.offsetTop;B=B.nextSibling}function x(){for(var A=0;A<D.length;A+=2)D[A].innerHTML=D[A+1];D=[]}function z(){if(!(!u.parentNode||u.parentNode!=s.lineNumbers)){for(var A=(new Date).getTime()+s.options.lineNumberTime;y;){for(w(L++,y.previousSibling);y&&!q.isBR(y);y=y.nextSibling)for(var K=y.offsetTop+y.offsetHeight;u.offsetHeight&&K-3>I;){var N=I;w("&nbsp;");if(I<=N)break}if(y)y=y.nextSibling;if((new Date).getTime()>A){x();E=setTimeout(z,s.options.lineNumberDelay);return}}for(;B;)w(L++);x();k()}}function H(A){k();
l(A);y=t.firstChild;B=u.firstChild;I=0;L=s.options.firstLineNumber;z()}function J(){E&&clearTimeout(E);if(s.editor.allClean())H();else E=setTimeout(J,200)}var y,B,L,I,D=[],M=s.options.styleNumbers;H(true);var E=null;s.updateNumbers=J;var O=q.addEventHandler(q,"scroll",k,true),P=q.addEventHandler(q,"resize",J,true);F=function(){E&&clearTimeout(E);if(s.updateNumbers==J)s.updateNumbers=null;O();P()}}var o=this.frame,q=o.contentWindow,v=q.document,t=v.body,p=this.lineNumbers,u=p.firstChild,s=this,C=null;
p.onclick=function(w){var x=s.options.onLineNumberClick;if(x){w=(w||window.event).target||(w||window.event).srcElement;var z=w==p?NaN:Number(w.innerHTML);isNaN(z)||x(z,w)}};var F=function(){};h();var G=setInterval(h,500);(this.options.textWrapping||this.options.styleNumbers?n:m)()},setDynamicHeight:function(){function h(){for(var t=0,p=n.lastChild,u;p&&m.isBR(p);){p.hackBR||t++;p=p.previousSibling}if(p){o=p.offsetHeight;u=p.offsetTop+(1+t)*o}else if(o)u=t*o;if(u)k.wrapping.style.height=Math.max(v+
u,k.options.minHeight)+"px"}var k=this,l=k.options.onCursorActivity,m=k.win,n=m.document.body,o=null,q=null,v=2*k.frame.offsetTop;n.style.overflowY="hidden";m.document.documentElement.style.overflowY="hidden";this.frame.scrolling="no";setTimeout(h,300);k.options.onCursorActivity=function(t){l&&l(t);clearTimeout(q);q=setTimeout(h,100)}}};g.InvalidLineHandle={toString:function(){return"CodeMirror.InvalidLineHandle"}};g.replace=function(h){if(typeof h=="string")h=document.getElementById(h);return function(k){h.parentNode.replaceChild(k,
h)}};g.fromTextArea=function(h,k){function l(){h.value=o.getCode()}if(typeof h=="string")h=document.getElementById(h);k=k||{};if(h.style.width&&k.width==null)k.width=h.style.width;if(h.style.height&&k.height==null)k.height=h.style.height;if(k.content==null)k.content=h.value;if(h.form){typeof h.form.addEventListener=="function"?h.form.addEventListener("submit",l,false):h.form.attachEvent("onsubmit",l);if(typeof h.form.submit=="function"){var m=h.form.submit,n=function(){l();h.form.submit=m;h.form.submit();
h.form.submit=n};h.form.submit=n}}h.style.display="none";var o=new g(function(q){h.nextSibling?h.parentNode.insertBefore(q,h.nextSibling):h.parentNode.appendChild(q)},k);o.save=l;o.toTextArea=function(){l();h.parentNode.removeChild(o.wrapping);h.style.display="";if(h.form){if(typeof h.form.submit=="function")h.form.submit=m;typeof h.form.removeEventListener=="function"?h.form.removeEventListener("submit",l,false):h.form.detachEvent("onsubmit",l)}};return o};g.isProbablySupported=function(){var h;
return window.opera?Number(window.opera.version())>=9.52:/Apple Computer, Inc/.test(navigator.vendor)&&(h=navigator.userAgent.match(/Version\/(\d+(?:\.\d+)?)\./))?Number(h[1])>=3:document.selection&&window.ActiveXObject&&(h=navigator.userAgent.match(/MSIE (\d+(?:\.\d*)?)\b/))?Number(h[1])>=6:(h=navigator.userAgent.match(/gecko\/(\d{8})/i))?Number(h[1])>=20050901:(h=navigator.userAgent.match(/AppleWebKit\/(\d+)/))?Number(h[1])>=525:null};return g}();Ext.ns("Ext.ux.form");
Ext.ux.form.FileUploadField=Ext.extend(Ext.form.TextField,{readOnly:true,autoSize:Ext.emptyFn,iconClsSelectFile:"x-form-file-icon",iconClsClearFile:"x-form-file-clear-icon",iconClsDownloadFile:"x-form-file-download-icon",constructor:function(a,b){if(b){if(b.prefixUploadField)this.prefixUploadField=b.prefixUploadField;if(b.fileUrl)this.fileUrl=b.fileUrl;if(a.readOnly)this.readOnlyAll=true;if(b.possibleFileExtensions)this.possibleFileExtensions=b.possibleFileExtensions}Ext.ux.form.FileUploadField.superclass.constructor.call(this,
a,b)},initComponent:function(){Ext.ux.form.FileUploadField.superclass.initComponent.call(this);this.addEvents("fileselected")},onRender:function(a,b){Ext.ux.form.FileUploadField.superclass.onRender.call(this,a,b);this.value=this.getFileName();this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.createFileInput();var d=Ext.applyIf(this.buttonCfg||{},{iconCls:this.iconClsSelectFile});this.buttonFile=new Ext.Button(Ext.apply(d,{renderTo:this.wrap,
width:16,cls:"x-form-file-btn"+(d.iconCls?" x-btn-icon":""),tooltip:{text:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0444\u0430\u0439\u043b",width:150}}));this.buttonClear=new Ext.Button({renderTo:this.wrap,width:16,cls:"x-form-file-clear",iconCls:this.iconClsClearFile,handler:this.clickClearField,scope:this,hidden:this.value?false:true,tooltip:{text:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",width:65}});this.renderHelperBtn();this.bindListeners();this.resizeEl=this.positionEl=this.wrap;
if(this.readOnlyAll){this.buttonFile.setDisabled(true);this.buttonFile.getEl().setStyle("z-index",3);this.buttonClear.setDisabled(true);this.getHelperBtn()&&this.getHelperBtn().setDisabled(true)}},renderHelperBtn:function(){this.buttonDownload=new Ext.Button({renderTo:this.wrap,width:16,cls:"x-form-file-download",iconCls:this.iconClsDownloadFile,handler:this.clickDownload,scope:this,hidden:this.value?false:true,tooltip:{text:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c",width:65}})},getHelperBtn:function(){return this.buttonDownload},
bindListeners:function(){this.fileInput.on({scope:this,mouseenter:function(){this.buttonFile.addClass(["x-btn-over","x-btn-focus"])},mouseleave:function(){this.buttonFile.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},mousedown:function(){this.buttonFile.addClass("x-btn-click")},mouseup:function(){this.buttonFile.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},change:function(){if(this.isFileExtensionOK()){var a=this.fileInput.dom.value;this.setValue(a);this.fireEvent("fileselected",
this,a);if(a){this.fileUrl=null;if(!this.buttonClear.isVisible()){this.buttonClear.show();this.el.setWidth(this.el.getWidth()-this.buttonClear.getWidth())}}}else{Ext.Msg.show({title:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435",msg:"\u041d\u0435\u0432\u0435\u0440\u043d\u043e\u0435 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435 \u0444\u0430\u0439\u043b\u0430",buttons:Ext.Msg.OK,fn:Ext.emptyFn,animEl:"elId",icon:Ext.MessageBox.WARNING});this.reset()}}})},createFileInput:function(){this.fileInput=
this.wrap.createChild({id:this.getFileInputId(),name:(this.prefixUploadField||"")+this.name,cls:"x-form-file",tag:"input",type:"file",size:1,width:20});Ext.QuickTips.unregister(this.fileInput);Ext.QuickTips.register({target:this.fileInput,text:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0444\u0430\u0439\u043b",width:86,dismissDelay:1E4})},reset:function(){this.fileInput.remove();this.createFileInput();this.bindListeners();Ext.ux.form.FileUploadField.superclass.reset.call(this)},getFileInputId:function(){return this.id+
"-file"},onResize:function(a,b){Ext.ux.form.FileUploadField.superclass.onResize.call(this,a,b);this.wrap.setWidth(a);a=this.wrap.getWidth()-this.buttonFile.getEl().getWidth();var d=this.buttonClear.getWidth();if(d)a-=d;if(d=this.getHelperBtn()?this.getHelperBtn().getWidth():0)a-=d;Ext.isWebKit?this.el.setWidth(a+5):this.el.setWidth(a)},onDestroy:function(){Ext.ux.form.FileUploadField.superclass.onDestroy.call(this);Ext.QuickTips.unregister(this.fileInput);Ext.destroy(this.fileInput,this.buttonFile,
this.buttonClear,this.getHelperBtn(),this.wrap)},onDisable:function(){Ext.ux.form.FileUploadField.superclass.onDisable.call(this);this.doDisable(true)},onEnable:function(){Ext.ux.form.FileUploadField.superclass.onEnable.call(this);this.doDisable(false)},doDisable:function(a){this.fileInput.dom.disabled=a;this.buttonFile.setDisabled(a);this.buttonClear.setDisabled(a);this.getHelperBtn()&&this.getHelperBtn().setDisabled(a)},preFocus:Ext.emptyFn,alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,
"tl-tr",[2,0])},clickClearField:function(){this.reset();this.setValue("");var a=this.el.getWidth()+this.buttonClear.getWidth();if(this.getHelperBtn()){a+=this.getHelperBtn().isVisible()?this.getHelperBtn().getWidth():0;this.getHelperBtn().hide()}this.el.setWidth(a);this.buttonClear.hide()},getFileUrl:function(a){return document.location.protocol+"//"+document.location.host+"/"+a},clickDownload:function(){var a=this.getFileUrl(this.fileUrl);a&&window.open(a)},getFileName:function(){return this.value?
this.value.split("/").reverse()[0]:""},isFileExtensionOK:function(){var a=this.fileInput.dom.value.split(".");if(a.length>0)return this.possibleFileExtensions?this.possibleFileExtensions.split(",").indexOf(a[a.length-1].toLowerCase())!=-1:true;return false},setReadOnly:function(a){Ext.ux.form.FileUploadField.superclass.setReadOnly.call(this,a)}});Ext.reg("fileuploadfield",Ext.ux.form.FileUploadField);Ext.form.FileUploadField=Ext.ux.form.FileUploadField;Ext.ns("Ext.ux.form");
Ext.ux.form.ImageUploadField=Ext.extend(Ext.form.FileUploadField,{iconClsSelectFile:"x-form-image-icon",iconClsClearFile:"x-form-image-clear-icon",iconClsPreviewImage:"x-form-image-preview-icon",constructor:function(a,b){if(b){if(b.thumbnailWidth)this.thumbnailWidth=b.thumbnailWidth;if(b.thumbnailHeight)this.thumbnailHeight=b.thumbnailHeight;if(b.prefixThumbnailImg)this.prefixThumbnailImg=b.prefixThumbnailImg;if(b.thumbnail)this.thumbnail=b.thumbnail;if(b.fileUrl){var d=b.fileUrl.split("/"),e=d.slice(0,
d.length-1);d=d[d.length-1];var f=this.prefixThumbnailImg||"";e=String.format("{0}/{1}{2}",e.join("/"),f,d);this.previewTip=new Ext.QuickTip({id:"preview_tip_window",html:String.format('<a href="{0}" rel="lightbox"><image src="{1}" WIDTH={2} HEIGHT={3} OnClick=Ext.getCmp("preview_tip_window").hide()></a>',b.fileUrl,this.getFileUrl(e),this.thumbnailWidth,this.thumbnailHeight),autoHide:false,width:this.thumbnailWidth+10,height:this.thumbnailHeight+10})}}Ext.ux.form.ImageUploadField.superclass.constructor.call(this,
a,b)},renderHelperBtn:function(){if(this.thumbnail)this.buttonPreview=new Ext.Button({renderTo:this.wrap,width:16,cls:"x-form-file-download",iconCls:this.iconClsPreviewImage,handler:this.clickHelperBtn,scope:this,hidden:this.value?false:true,tooltip:{text:"\u041f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043f\u043e\u043a\u0430\u0437",width:140}})},getHelperBtn:function(){return this.buttonPreview},clickHelperBtn:function(){var a=this.getEl(),b=a.getXY();
this.previewTip.showAt([b[0],b[1]+a.getHeight()])},createFileInput:function(){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:(this.prefixUploadField||"")+this.name,cls:"x-form-file",tag:"input",type:"file",size:1,width:20});Ext.QuickTips.unregister(this.fileInput);Ext.QuickTips.register({target:this.fileInput,text:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435",width:130,dismissDelay:1E4})},onDestroy:function(){Ext.ux.form.ImageUploadField.superclass.onDestroy.call(this);
Ext.destroy(this.previewTip)}});Ext.ux.Lightbox.register("a[rel^=lightbox]");Ext.reg("imageuploadfield",Ext.ux.form.ImageUploadField);function createAdvancedTreeGrid(a,b){return new Ext.m3.AdvancedTreeGrid(a,b)}function createGridPanel(a,b){return a.editor?new Ext.m3.EditorGridPanel(a,b):new Ext.m3.GridPanel(a,b)}function createObjectGrid(a,b){return a.editor?new Ext.m3.EditorObjectGrid(a,b):new Ext.m3.ObjectGrid(a,b)}function createObjectTree(a,b){return new Ext.m3.ObjectTree(a,b)}
function createAdvancedComboBox(a,b){return new Ext.m3.AdvancedComboBox(a,b)}function createAdvancedDataField(a,b){return new Ext.m3.AdvancedDataField(a,b)}
Ext.onReady(function(){Ext.override(Ext.Window,{tmpModal:false,manager:new Ext.WindowGroup,constrain:true,activateChildWindow:function(){this.toFront()},listeners:{beforeshow:function(){var a=Ext.get(this.renderTo);a&&a.getHeight()<this.getHeight()&&this.setHeight(a.getHeight());if(this.parentWindow){this.parentWindow.setDisabled(true);this.parentWindow.el.removeClass("x-masked-relative");this.parentWindow.on("activate",this.activateChildWindow,this);this.modal=false;this.tmpModal=true;if(window.AppDesktop)(a=
AppDesktop.getDesktop().taskbar.tbPanel.getTabWin(this.parentWindow))&&a.mask()}if(this.modal){(a=Ext.get("ux-taskbar"))&&a.mask();(a=Ext.get("ux-toptoolbar"))&&a.mask()}},beforeclose:function(){if(this.tmpModal&&this.parentWindow){this.parentWindow.un("activate",this.activateChildWindow,this);this.parentWindow.setDisabled(false);this.parentWindow.toFront();if(window.AppDesktop){var a=AppDesktop.getDesktop().taskbar.tbPanel.getTabWin(this.parentWindow);a&&a.unmask()}}if(this.modal){(a=Ext.get("ux-taskbar"))&&
a.unmask();(a=Ext.get("ux-toptoolbar"))&&a.unmask()}},hide:function(){if(this.modal)if(!this.parentWindow){var a=Ext.get("ux-taskbar");a&&a.unmask();(a=Ext.get("ux-toptoolbar"))&&a.unmask()}}}})});
Ext.override(Ext.ux.tree.TreeGrid,{fitColumns:function(){var a=this.getInnerWidth()-Ext.num(this.scrollOffset,Ext.getScrollBarWidth()),b=this.getTotalColumnWidth(),d=this.getVisibleColumns(),e,f=0;for(e=0;e<d.length;e++){if(e==d.length-1){d[e].width=a-f-1;break}d[e].width=Math.floor(a/100*(d[e].width*100/b))-1;f+=d[e].width}this.updateColumnWidths()},onResize:function(a,b){Ext.ux.tree.TreeGrid.superclass.onResize.apply(this,arguments);var d=this.innerBody.dom,e=this.innerHd.dom;if(d){if(Ext.isNumber(b))d.style.height=
this.body.getHeight(true)-e.offsetHeight+"px";if(Ext.isNumber(a)){var f=Ext.num(this.scrollOffset,Ext.getScrollBarWidth());if(this.reserveScrollOffset||d.offsetWidth-d.clientWidth>10)this.setScrollOffset(f);else{var g=this;setTimeout(function(){g.setScrollOffset(d.offsetWidth-d.clientWidth>10?f:0)},10)}}this.fitColumns()}}});
Ext.override(Ext.tree.ColumnResizer,{onEnd:function(){var a=this.proxy.getWidth(),b=this.tree;this.proxy.remove();delete this.dragHd;b.columns[this.hdIndex].width=a;b.fitColumns();setTimeout(function(){b.headersDisabled=false},100)}});Ext.override(Ext.tree.TreeNodeUI,{onDblClick:function(a){a.preventDefault();if(!this.disabled)if(this.fireEvent("beforedblclick",this.node,a)!==false){this.checkbox&&this.toggleCheck();this.fireEvent("dblclick",this.node,a)}}});
Ext.override(Ext.form.Action.Submit,{run:function(){var a=this.options,b=this.getMethod(),d=b=="GET";if(a.clientValidation===false||this.form.isValid()){if(a.submitEmptyText===false){var e=[];this.form.items.each(function(f){if(f.el.getValue()==f.emptyText){e.push(f);f.el.dom.value=""}f instanceof Ext.form.CompositeField&&f.items.each(function(g){if(g.el.getValue()==g.emptyText){e.push(g);g.el.dom.value=""}})})}Ext.Ajax.request(Ext.apply(this.createCallback(a),{form:this.form.el.dom,url:this.getUrl(d),
method:b,headers:a.headers,params:!d?this.getParams():null,isUpload:this.form.fileUpload}));a.submitEmptyText===false&&Ext.each(e,function(f){f.applyEmptyText&&f.applyEmptyText()})}else if(a.clientValidation!==false){this.failureType=Ext.form.Action.CLIENT_INVALID;this.form.afterAction(this,false)}}});Ext.override(Ext.form.Checkbox,{onClick:function(a){if(this.readOnly){a.stopEvent();return false}this.el.dom.checked!=this.checked&&this.setValue(this.el.dom.checked)}});
Ext.override(Ext.PagingToolbar,{onPagingBlur:Ext.emptyFn});if(Ext.isIE7||Ext.isIE6)Ext.Panel.override({setAutoScroll:function(){if(this.rendered&&this.autoScroll){var a=this.body||this.el;if(a){a.setOverflow("auto");a.dom.style.position="relative"}}}});
Ext.override(Ext.ux.tree.TreeGridNodeUI,{renderElements:function(a,b,d,e){var f=a.getOwnerTree(),g=Ext.isBoolean(b.checked);g=Ext.isBoolean(b.checked);var j=f.columns,h=j[0],k,l,m;this.indentMarkup=a.parentNode?a.parentNode.ui.getChildIndent():"";l=['<tbody class="x-tree-node">','<tr ext:tree-node-id="',a.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',b.cls,'">','<td class="x-treegrid-col">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,
'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',b.icon||this.emptyIcon,'" class="x-tree-node-icon',b.icon?" x-tree-node-inline-icon":"",b.iconCls?" "+b.iconCls:"",'" unselectable="on" />',g?'<input class="x-tree-node-cb" type="checkbox" '+(b.checked?'checked="checked" />':"/>"):"",'<a hidefocus="on" class="x-tree-node-anchor" href="',b.href?b.href:"#",'" tabIndex="1" ',b.hrefTarget?' target="'+b.hrefTarget+'"':"",">",'<span unselectable="on">',h.tpl?h.tpl.apply(b):b[h.dataIndex]||h.text,"</span></a>",
"</td>"];k=1;for(m=j.length;k<m;k++){h=j[k];l.push('<td class="x-treegrid-col ',h.cls?h.cls:"",'">','<div unselectable="on" class="x-treegrid-text"',h.align?' style="text-align: '+h.align+';"':"",">",h.tpl?h.tpl.apply(b):b[h.dataIndex],"</div>","</td>")}l.push('</tr><tr class="x-tree-node-ct"><td colspan="',j.length,'">','<table class="x-treegrid-node-ct-table" cellpadding="0" cellspacing="0" style="table-layout: fixed; display: none; width: ',f.innerCt.getWidth(),'px;"><colgroup>');k=0;for(m=j.length;k<
m;k++)l.push('<col style="width: ',j[k].hidden?0:j[k].width,'px;" />');l.push("</colgroup></table></td></tr></tbody>");this.wrap=e!==true&&a.nextSibling&&a.nextSibling.ui.getEl()?Ext.DomHelper.insertHtml("beforeBegin",a.nextSibling.ui.getEl(),l.join("")):Ext.DomHelper.insertHtml("beforeEnd",d,l.join(""));this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1].firstChild.firstChild;a=this.elNode.firstChild.childNodes;this.indentNode=a[0];this.ecNode=a[1];this.iconNode=a[2];index=3;
if(g){this.checkbox=a[3];this.checkbox.defaultChecked=this.checkbox.checked;index++}this.anchor=a[index];this.textNode=a[index].firstChild}});Ext.override(Ext.ux.tree.TreeGrid,{getChecked:function(a,b){b=b||this.root;var d=[];b.cascade(function(){if(this.attributes.checked)d.push(!a?this:a=="id"?this.id:this.attributes[a])});return d}});
